<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Socrate 原型图V2 - 预测市场</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
/* ─── RESET & ROOT ─── */
* { margin: 0; padding: 0; box-sizing: border-box; }
:root {
  --bg: #0a0a0a; --surface: #141414; --surface2: #1c1c1c; --surface3: #222; --surface4: #252525;
  --border: #2a2a2a; --border2: #333;
  --text: #e8e8e8; --text-muted: #666; --text-dim: #999;
  --green: #22c55e; --green-dark: #166534;
  --red: #ef4444; --red-dark: #7f1d1d;
  --yellow: #eab308; --gold: #f59e0b;
}
body { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Segoe UI', sans-serif; min-height: 100vh; font-size: 14px; overflow-x: hidden; }

/* ─── NAV ─── */
nav { display: flex; align-items: center; gap: 32px; padding: 0 24px; height: 52px; border-bottom: 1px solid var(--border); background: var(--bg); position: sticky; top: 0; z-index: 200; }
.logo { display: flex; align-items: center; gap: 8px; font-size: 16px; font-weight: 600; color: var(--text); text-decoration: none; flex-shrink: 0; cursor: pointer; }
.logo-icon { width: 28px; height: 28px; border: 2px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; }
.nav-links { display: flex; align-items: center; gap: 4px; flex: 1; }
.nav-link { padding: 6px 12px; border-radius: 6px; font-size: 14px; color: var(--text-muted); cursor: pointer; transition: all 0.15s; white-space: nowrap; }
.nav-link:hover, .nav-link.active { color: var(--text); background: var(--surface); }
.nav-dd-wrap { position: relative; }
.nav-dd-trigger { display: inline-flex; align-items: center; gap: 6px; }
.nav-dd-caret { font-size: 10px; color: var(--text-muted); transition: transform .16s; }
.nav-dd-wrap.open .nav-dd-caret { transform: rotate(180deg); color: var(--text); }
.nav-dd-menu { display: none; position: absolute; top: calc(100% + 8px); left: 0; min-width: 300px; border: 1px solid #2a3f63; border-radius: 12px; padding: 8px; background: radial-gradient(circle at 100% 0%, rgba(99,102,241,.16), transparent 40%), linear-gradient(180deg, rgba(20,20,20,.98), rgba(12,16,26,.98)); box-shadow: 0 12px 34px rgba(0,0,0,.5); z-index: 320; }
.nav-dd-wrap.open .nav-dd-menu { display: block; }
.nav-dd-item { padding: 9px 10px; border-radius: 10px; cursor: pointer; border: 1px solid #2a3d63; background: rgba(15,23,42,.65); transition: all .14s; margin-bottom: 7px; }
.nav-dd-item:last-child { margin-bottom: 0; }
.nav-dd-item:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(0,0,0,.28); }
.nav-dd-item.listing:hover { border-color: rgba(99,102,241,.65); }
.nav-dd-item.verify:hover { border-color: rgba(14,165,233,.65); }
.nav-dd-item.lp:hover { border-color: rgba(16,185,129,.65); }
.nav-dd-item.governance:hover { border-color: rgba(245,158,11,.65); }
.nav-dd-item.trading:hover { border-color: rgba(168,85,247,.65); }
.nav-dd-item-top { display: flex; align-items: center; gap: 7px; }
.nav-dd-icon { width: 20px; height: 20px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 12px; }
.nav-dd-item-title { font-size: 12px; font-weight: 700; color: #dbeafe; flex: 1; }
.nav-dd-badge { font-size: 9px; font-weight: 700; border-radius: 999px; padding: 2px 7px; border: 1px solid transparent; }
.nav-dd-item.listing .nav-dd-icon { background: linear-gradient(135deg,#4f46e5,#6366f1); }
.nav-dd-item.verify .nav-dd-icon { background: linear-gradient(135deg,#0ea5e9,#06b6d4); }
.nav-dd-item.lp .nav-dd-icon { background: linear-gradient(135deg,#10b981,#22c55e); }
.nav-dd-item.governance .nav-dd-icon { background: linear-gradient(135deg,#f59e0b,#f97316); }
.nav-dd-item.trading .nav-dd-icon { background: linear-gradient(135deg,#7c3aed,#a855f7); }
.nav-dd-item.listing .nav-dd-badge { color: #c7d2fe; border-color: rgba(99,102,241,.45); background: rgba(99,102,241,.16); }
.nav-dd-item.verify .nav-dd-badge { color: #bae6fd; border-color: rgba(14,165,233,.45); background: rgba(14,165,233,.15); }
.nav-dd-item.lp .nav-dd-badge { color: #bbf7d0; border-color: rgba(16,185,129,.45); background: rgba(16,185,129,.15); }
.nav-dd-item.governance .nav-dd-badge { color: #fde68a; border-color: rgba(245,158,11,.45); background: rgba(245,158,11,.15); }
.nav-dd-item.trading .nav-dd-badge { color: #e9d5ff; border-color: rgba(168,85,247,.45); background: rgba(168,85,247,.15); }
.nav-dd-item-desc { margin-top: 4px; font-size: 10px; color: #91a3c4; line-height: 1.42; }
.nav-actions { display: flex; align-items: center; gap: 8px; margin-left: auto; }
.btn-login { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text); font-size: 13px; cursor: pointer; white-space: nowrap; }
.nav-icon { width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); cursor: pointer; font-size: 16px; transition: all 0.15s; }
.nav-icon:hover { background: var(--surface); color: var(--text); }

/* ─── PAGE VIEWS ─── */
.view { display: none; }
.view.active { display: block; }

/* ══════════════════════════════════════
   HOMEPAGE STYLES
══════════════════════════════════════ */

/* CATEGORY TABS */
.category-bar { display: flex; align-items: center; gap: 4px; padding: 0 24px; height: 48px; border-bottom: 1px solid var(--border); overflow-x: auto; scrollbar-width: none; }
.category-bar::-webkit-scrollbar { display: none; }
.cat-tab { padding: 6px 14px; border-radius: 6px; font-size: 13px; color: var(--text-muted); cursor: pointer; white-space: nowrap; transition: all 0.15s; flex-shrink: 0; }
.cat-tab:hover { color: var(--text); background: var(--surface); }
.cat-tab.active { color: var(--text); font-weight: 500; border-bottom: 2px solid white; border-radius: 6px 6px 0 0; }
.cat-actions { margin-left: auto; flex-shrink: 0; }
.btn-create { display: flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 6px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 13px; cursor: pointer; }

/* OTHER PANEL */
.other-panel { display: none; }
.other-panel.open { display: block; }
.other-layout { display: flex; min-height: 0; }
.other-sidebar { width: 200px; flex-shrink: 0; border-right: 1px solid var(--border); padding: 12px 0; background: var(--bg); }
.other-sidebar-title { font-size: 10px; font-weight: 600; letter-spacing: 0.08em; color: var(--text-muted); text-transform: uppercase; padding: 4px 16px 10px; }
.other-cat-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 16px; font-size: 13px; color: var(--text-dim); cursor: pointer; transition: all 0.12s; border-left: 2px solid transparent; }
.other-cat-item:hover { color: var(--text); background: var(--surface); }
.other-cat-item.active { color: var(--text); background: var(--surface); font-weight: 500; border-left-color: var(--text); }
.other-cat-count { font-size: 11px; color: var(--text-muted); }
.other-content { flex: 1; min-width: 0; display: flex; flex-direction: column; border-bottom: 1px solid var(--border); }
.other-filter-bar { display: flex; align-items: center; gap: 10px; padding: 12px 20px; border-bottom: 1px solid var(--border); }
.other-market-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(270px, 1fr)); gap: 12px; padding: 16px 20px 24px; }

/* FILTER BAR */
.filter-bar { display: flex; align-items: center; gap: 10px; padding: 12px 24px; }
.other-panel.open ~ .filter-bar, .other-panel.open ~ .market-grid { display: none; }
.custom-select { position: relative; flex-shrink: 0; }
.custom-select-trigger { display: flex; align-items: center; gap: 6px; padding: 7px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); font-size: 13px; cursor: pointer; user-select: none; white-space: nowrap; transition: all 0.15s; }
.custom-select-trigger:hover, .custom-select-trigger.open { border-color: #3a3a3a; color: var(--text); }
.custom-select-arrow { font-size: 10px; color: var(--text-muted); transition: transform 0.2s; }
.custom-select-trigger.open .custom-select-arrow { transform: rotate(180deg); }
.custom-select-menu { display: none; position: absolute; top: calc(100% + 4px); left: 0; min-width: 160px; background: #1a1a1a; border: 1px solid var(--border); border-radius: 8px; padding: 4px; z-index: 300; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
.custom-select-menu.open { display: block; }
.custom-select-item { padding: 7px 10px; border-radius: 6px; font-size: 13px; color: var(--text-dim); cursor: pointer; transition: all 0.12s; white-space: nowrap; }
.custom-select-item:hover { background: var(--surface2); color: var(--text); }
.custom-select-item.selected { color: var(--text); font-weight: 500; }
.sort-toggle { display: flex; justify-content: space-between; align-items: center; }
.sort-item-label { flex: 1; }
.sort-item-dir { color: var(--text-muted); font-size: 12px; margin-left: 8px; }
.sort-toggle.selected .sort-item-dir { color: var(--text); }
.fav-filter-btn { display: flex; align-items: center; justify-content: center; width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); cursor: pointer; transition: all 0.15s; flex-shrink: 0; }
.fav-filter-btn:hover { border-color: var(--text-muted); background: var(--surface2); }
.fav-filter-btn.active { border-color: #f59e0b; background: rgba(245,158,11,0.1); }
.fav-filter-btn.active .fav-filter-icon { color: #f59e0b; }
.fav-filter-icon { font-size: 16px; color: var(--text-muted); transition: color 0.15s; line-height: 1; }
.search-bar { display: flex; align-items: center; gap: 8px; padding: 7px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); flex: 1; max-width: 320px; margin-left: auto; }
.search-bar input { background: transparent; border: none; outline: none; color: var(--text); font-size: 13px; width: 100%; }
.search-bar input::placeholder { color: var(--text-muted); }

/* MARKET GRID */
.market-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(290px, 1fr)); gap: 12px; padding: 0 24px 32px; }

/* MARKET CARD */
.market-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px; cursor: pointer; transition: all 0.2s; display: flex; flex-direction: column; gap: 10px; }
.market-card:hover { border-color: #3a3a3a; background: var(--surface2); transform: translateY(-1px); box-shadow: 0 4px 20px rgba(0,0,0,0.4); }

/* Creator */
.creator-row-card { display: flex; align-items: center; justify-content: space-between; }
.creator-info-card { display: flex; align-items: center; gap: 7px; }
.creator-avatar-card { width: 22px; height: 22px; border-radius: 50%; background: linear-gradient(135deg,#444,#222); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 11px; color: var(--text-muted); flex-shrink: 0; overflow: hidden; }
.creator-name-card { font-size: 12px; color: var(--text-muted); }
.card-bookmark { width: 26px; height: 26px; border-radius: 6px; display: flex; align-items: center; justify-content: center; color: var(--text-muted); transition: all 0.15s; flex-shrink: 0; font-size: 14px; }
.card-bookmark:hover { color: var(--gold); background: rgba(245,158,11,0.1); }
.card-bookmark.saved { color: var(--gold); }

/* Market main */
.market-main { display: flex; align-items: flex-start; gap: 10px; }
.market-img-col { display: flex; flex-direction: column; gap: 5px; flex-shrink: 0; }
.card-creator-above { display: flex; align-items: center; gap: 5px; }
.card-creator-above .creator-name-card { font-size: 11px; color: var(--text-muted); white-space: nowrap; overflow: hidden; max-width: 80px; text-overflow: ellipsis; }
.card-creator-above .creator-avatar-card { width: 16px; height: 16px; font-size: 9px; }
.market-img { width: 52px; height: 52px; border-radius: 8px; background: var(--surface2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; overflow: hidden; }
.market-info { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 6px; }
.market-title-card { font-size: 14px; font-weight: 500; line-height: 1.4; color: var(--text); white-space: nowrap; overflow: hidden; position: relative; -webkit-mask-image: linear-gradient(to right, black 70%, transparent 100%); mask-image: linear-gradient(to right, black 70%, transparent 100%); cursor: default; }
.card-meta { display: flex; align-items: center; gap: 6px; flex-wrap: nowrap; white-space: nowrap; overflow: hidden; }

/* Status badges */
.status-badge { display: inline-flex; align-items: center; gap: 5px; font-size: 11px; font-weight: 500; padding: 2px 8px; border-radius: 20px; width: fit-content; flex-shrink: 0; }
.status-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
.status-active { background: rgba(34,197,94,0.12); color: var(--green); }
.status-active .status-dot { background: var(--green); box-shadow: 0 0 6px var(--green); animation: pulse-green 2s infinite; }
.status-settling { background: rgba(239,68,68,0.12); color: var(--red); }
.status-settling .status-dot { background: var(--red); box-shadow: 0 0 6px var(--red); }
.status-closed { background: rgba(107,114,128,0.15); color: #6b7280; }
.status-closed .status-dot { background: #6b7280; }
@keyframes pulse-green { 0%,100%{opacity:1} 50%{opacity:0.4} }

/* Stat pills */
.stat-pill { display: flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 20px; background: var(--surface2); border: 1px solid var(--border); flex-shrink: 0; }
.stat-label { font-size: 10px; color: var(--text-muted); font-weight: 500; }
.stat-value { font-size: 11px; font-weight: 700; color: var(--text-dim); }
.stat-sep { width: 1px; height: 10px; background: var(--border); }

/* Chance */
.chance-section { display: flex; flex-direction: column; gap: 5px; }
.chance-header { display: flex; align-items: baseline; justify-content: space-between; }
.chance-label { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
.chance-value { font-size: 22px; font-weight: 700; line-height: 1; }
.chance-value.high { color: var(--green); }
.chance-value.low { color: var(--red); }
.chance-bar { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.chance-fill { height: 100%; border-radius: 2px; }
.chance-fill.high { background: linear-gradient(90deg,#16a34a,#22c55e); }
.chance-fill.low { background: linear-gradient(90deg,#b91c1c,#ef4444); }
.chance-fill.neutral { background: #6b7280; }

/* Options */
.options-section { display: flex; flex-direction: column; gap: 5px; }
.binary-options { display: flex; gap: 8px; }
.binary-btn { flex: 1; padding: 8px 0; border-radius: 8px; border: 1px solid var(--border); background: transparent; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s; text-align: center; }
.binary-btn.yes { color: var(--green); border-color: rgba(34,197,94,0.3); }
.binary-btn.yes:hover { background: rgba(34,197,94,0.1); border-color: var(--green); }
.binary-btn.no { color: var(--red); border-color: rgba(239,68,68,0.3); }
.binary-btn.no:hover { background: rgba(239,68,68,0.1); border-color: var(--red); }
.multi-collapsed { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface2); cursor: pointer; transition: border-color 0.15s; user-select: none; }
.multi-collapsed:hover { border-color: #3a3a3a; }
.multi-collapsed-label { font-size: 13px; font-weight: 600; color: var(--text); }
.multi-collapsed-arrow { font-size: 12px; color: var(--text-muted); transition: transform 0.2s; }
.multi-collapsed.open .multi-collapsed-arrow { transform: rotate(180deg); }
.multi-dropdown { display: none; flex-direction: column; gap: 4px; margin-top: 4px; }
.multi-dropdown.open { display: flex; }
.multi-option-row { display: flex; align-items: center; gap: 8px; padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); transition: border-color 0.15s; }
.multi-option-row:hover { border-color: #3a3a3a; }
.multi-option-row.top { border-color: #3a3a3a; background: rgba(255,255,255,0.03); }
.multi-opt-label { font-size: 13px; font-weight: 600; color: var(--text); flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.multi-opt-pct { font-size: 13px; font-weight: 700; color: var(--text-dim); flex-shrink: 0; width: 44px; text-align: right; }

/* ══════════════════════════════════════
   DETAIL PAGE STYLES
══════════════════════════════════════ */
.detail-view { display: none; }
.detail-view.active { display: flex; min-height: calc(100vh - 52px); align-items: flex-start; }

/* Back button in nav */
.nav-back { display: none; align-items: center; gap: 6px; color: var(--text-muted); cursor: pointer; font-size: 13px; transition: color 0.15s; padding: 4px 8px; border-radius: 6px; }
.nav-back:hover { color: var(--text); background: var(--surface); }
.nav-back.visible { display: flex; }

/* Detail left col */
.detail-main { flex: 1; min-width: 0; border-right: 1px solid var(--border); display: flex; flex-direction: column; }

/* Detail header */
.detail-header { padding: 18px 20px 14px; border-bottom: 1px solid var(--border); }
.detail-header-top { display: flex; align-items: flex-start; gap: 14px; }
.detail-cover-col { display: flex; flex-direction: column; align-items: flex-start; gap: 8px; flex-shrink: 0; }
.detail-cover { width: 80px; height: 80px; border-radius: 10px; background: var(--surface2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 32px; flex-shrink: 0; }
.detail-header-info { flex: 1; min-width: 0; padding-top: 32px; }
.detail-title { font-size: 18px; font-weight: 600; color: var(--text); line-height: 1.4; margin-bottom: 8px; }
.detail-meta { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; margin-bottom: 8px; }
.status-dot-badge { display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--green); }
.status-dot-badge::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: var(--green); box-shadow: 0 0 5px var(--green); animation: pulse-green 2s infinite; }
.meta-divider { width: 1px; height: 12px; background: var(--border2); flex-shrink: 0; }
.meta-tag { font-size: 12px; color: var(--text-dim); background: var(--surface2); border: 1px solid var(--border); padding: 2px 8px; border-radius: 4px; }
.meta-vol, .meta-date { font-size: 12px; color: var(--text-dim); display: flex; align-items: center; gap: 4px; }
.detail-creator-row { display: flex; align-items: center; gap: 8px; }
.detail-avatar { width: 24px; height: 24px; border-radius: 50%; background: linear-gradient(135deg,#444,#222); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 12px; overflow: hidden; }
.detail-creator-name { font-size: 13px; color: var(--text-dim); }
.detail-header-actions { display: flex; flex-direction: column; align-items: flex-end; gap: 8px; margin-left: auto; flex-shrink: 0; }
.hdr-icon-row { display: flex; align-items: center; gap: 6px; }
.hdr-action-btn { width: 32px; height: 32px; border-radius: 6px; border: 1px solid var(--border); background: transparent; color: var(--text-muted); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 15px; transition: all 0.15s; }
.hdr-action-btn:hover { background: var(--surface2); color: var(--text); }
.hdr-action-btn.bookmarked { color: var(--gold); border-color: var(--gold); }
.hdr-more-wrap { position: relative; }
.more-menu { display: none; position: absolute; top: calc(100% + 6px); right: 0; min-width: 150px; background: #1a1a1a; border: 1px solid var(--border); border-radius: 8px; padding: 4px; z-index: 400; box-shadow: 0 8px 24px rgba(0,0,0,0.5); }
.more-menu.open { display: block; }
.more-menu-item { display: flex; align-items: center; gap: 8px; padding: 9px 12px; border-radius: 6px; font-size: 13px; color: var(--text-dim); cursor: pointer; transition: all 0.12s; }
.more-menu-item:hover { background: var(--surface2); color: var(--text); }
.more-menu-item.danger { color: var(--red); }
.more-menu-item.danger:hover { background: rgba(239,68,68,0.1); }
.detail-countdown-wrap { display: flex; align-items: center; gap: 10px; }
.detail-cd-label { display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); font-weight: 500; white-space: nowrap; }
.cd-info-icon { position: relative; display: inline-flex; align-items: center; justify-content: center; width: 16px; height: 16px; border-radius: 50%; background: var(--surface3); color: var(--text-muted); font-size: 10px; font-weight: 700; cursor: help; font-style: italic; font-family: Georgia, serif; }
.cd-info-icon:hover .cd-tooltip { display: block; }
.cd-tooltip { display: none; position: absolute; top: calc(100% + 8px); right: -8px; width: 280px; padding: 12px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; box-shadow: 0 8px 24px rgba(0,0,0,0.25); font-size: 12px; color: var(--text-dim); line-height: 1.6; font-style: normal; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; font-weight: 400; z-index: 100; white-space: normal; text-align: left; }
.cd-tooltip strong { color: var(--text); font-weight: 600; }
.cd-tooltip::before { content: ''; position: absolute; bottom: 100%; right: 16px; border: 6px solid transparent; border-bottom-color: var(--border); }
.detail-countdown { display: flex; align-items: center; gap: 3px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 6px 10px; }
.cd-item { display: flex; flex-direction: column; align-items: center; min-width: 26px; }
.cd-num { font-size: 16px; font-weight: 700; color: var(--text); font-variant-numeric: tabular-nums; line-height: 1; }
.cd-unit { font-size: 9px; color: var(--text-muted); margin-top: 1px; }
.cd-sep { font-size: 14px; color: var(--border2); font-weight: 300; align-self: center; padding-bottom: 6px; }

/* Content tabs */
.content-tabs { display: flex; align-items: center; border-bottom: 1px solid var(--border); padding: 0 20px; }
.content-tab { padding: 12px 14px; font-size: 14px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; white-space: nowrap; }
.content-tab:hover { color: var(--text); }
.content-tab.active { color: var(--text); border-bottom-color: var(--text); font-weight: 500; }
.tab-spacer { flex: 1; }
.liquidity-btn { padding: 6px 14px; border-radius: 20px; background: var(--green); color: white; font-size: 12px; font-weight: 600; border: none; cursor: pointer; }
.liquidity-btn:hover { background: #16a34a; }

/* Chart section */
.chart-section { padding: 16px 20px; }
.chart-controls { display: flex; align-items: center; justify-content: flex-end; gap: 4px; margin-bottom: 8px; }
.tf-btn { padding: 4px 10px; border-radius: 20px; font-size: 12px; color: var(--text-muted); background: transparent; border: 1px solid transparent; cursor: pointer; transition: all 0.12s; }
.tf-btn:hover { color: var(--text); }
.tf-btn.active { color: var(--text); background: var(--surface2); border-color: var(--border); }
.chart-legend { display: flex; align-items: center; gap: 16px; margin-bottom: 10px; flex-wrap: wrap; }
.legend-item { display: flex; align-items: center; gap: 5px; font-size: 12px; color: var(--text-muted); cursor: pointer; }
.legend-dot { width: 7px; height: 7px; border-radius: 50%; }
.chart-wrap { height: 200px; position: relative; }

/* Options table */
.options-table { padding: 0 20px 4px; }
.options-thead { display: grid; grid-template-columns: 1fr 120px 80px 180px; padding: 8px 14px; font-size: 12px; color: var(--text-muted); border-bottom: 1px solid var(--border); }
.options-thead span:nth-child(2), .options-thead span:nth-child(3) { text-align: right; }
.options-thead span:nth-child(4) { text-align: center; }
.option-row { display: grid; grid-template-columns: 1fr 120px 80px 180px; padding: 14px; border-bottom: 1px solid var(--border); align-items: center; cursor: pointer; transition: background 0.12s; }
.option-row:hover { background: var(--surface2); }
.option-name { font-size: 13px; color: var(--text); font-weight: 500; }
.option-vol { font-size: 13px; color: var(--text-dim); text-align: right; }
.option-pct { font-size: 13px; color: var(--text); font-weight: 600; text-align: right; }
.option-btns { display: flex; gap: 8px; justify-content: center; }
.opt-btn { flex: 1; padding: 8px 0; border-radius: 20px; font-size: 13px; font-weight: 600; cursor: pointer; border: none; transition: all 0.15s; }
.opt-btn.yes { background: var(--green-dark); color: var(--green); }
.opt-btn.yes:hover { background: #14532d; }
.opt-btn.no { background: var(--red-dark); color: var(--red); }
.opt-btn.no:hover { background: #6b1414; }

/* Position tabs */
.position-tabs { display: flex; align-items: center; padding: 0 20px; border-top: 1px solid var(--border); margin-top: 4px; }
.pos-tab { padding: 12px 14px; font-size: 14px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; }
.pos-tab:hover { color: var(--text); }
.pos-tab.active { color: var(--text); border-bottom-color: var(--text); font-weight: 500; }
.position-section { padding: 0 20px; }
.pos-thead { display: grid; grid-template-columns: 2fr 1fr 1.2fr 1fr 1.2fr 1.2fr 1fr; padding: 10px 0 8px; font-size: 12px; color: var(--text-muted); border-bottom: 1px solid var(--border); }
.pos-thead span:not(:first-child) { text-align: right; }
.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; gap: 12px; }
.empty-icon { width: 60px; height: 60px; border-radius: 50%; background: var(--surface2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 22px; color: var(--text-muted); }
.empty-text { font-size: 13px; color: var(--text-muted); }

/* Right trading panel */
.detail-right { width: 290px; flex-shrink: 0; position: sticky; top: 52px; height: calc(100vh - 52px); overflow-y: auto; scrollbar-width: none; background: var(--bg); }
.detail-right::-webkit-scrollbar { display: none; }
.trading-panel { padding: 16px; display: flex; flex-direction: column; gap: 14px; }
.panel-title { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.4; padding-bottom: 14px; border-bottom: 1px solid var(--border); }
.trade-tabs { display: grid; grid-template-columns: 1fr 1fr; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 3px; gap: 3px; }
.trade-tab { padding: 8px 0; text-align: center; font-size: 14px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all 0.15s; }
.trade-tab.active { background: var(--surface4); color: var(--text); }
.trade-tab:hover:not(.active) { color: var(--text); }
.outcome-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.outcome-btn { padding: 10px 0; border-radius: 8px; border: none; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.15s; text-align: center; }
.outcome-btn.yes { background: var(--green); color: white; }
.outcome-btn.yes:hover { background: #16a34a; }
.outcome-btn.yes.inactive { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
.outcome-btn.no { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
.outcome-btn.no.no-active { background: var(--red-dark); color: var(--red); border-color: var(--red-dark); }
.outcome-btn.no:hover { border-color: var(--red); color: var(--red); }
.outcome-price { font-size: 13px; }
.amount-row { display: flex; align-items: center; gap: 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; }
.amount-label-left { font-size: 13px; color: var(--text-dim); }
.amount-controls { display: flex; align-items: center; margin-left: auto; }
.amount-adj { width: 28px; height: 28px; border-radius: 6px; background: var(--surface3); border: 1px solid var(--border); color: var(--text-muted); font-size: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; user-select: none; transition: all 0.15s; }
.amount-adj:hover { background: var(--border); color: var(--text); }
.amount-display { min-width: 50px; text-align: center; font-size: 14px; font-weight: 600; color: var(--text); padding: 0 8px; }
.slider-wrap { padding: 2px 0; }
input[type=range] { -webkit-appearance: none; width: 100%; height: 4px; border-radius: 2px; outline: none; cursor: pointer; background: linear-gradient(to right, #555 0%, var(--border2) 0%); }
input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 18px; height: 18px; border-radius: 50%; background: #555; border: 2px solid var(--bg); }
.panel-stats { display: flex; flex-direction: column; gap: 8px; }
.panel-stat-row { display: flex; justify-content: space-between; align-items: center; }
.panel-stat-key { font-size: 13px; color: var(--text-muted); }
.panel-stat-val { font-size: 13px; font-weight: 600; color: var(--text); }
.panel-sep { height: 1px; background: var(--border); }
.cta-btn { width: 100%; padding: 13px; border-radius: 8px; font-size: 15px; font-weight: 700; border: none; cursor: pointer; background: #f0f0f0; color: #0a0a0a; transition: all 0.15s; font-family: inherit; }
.cta-btn:hover { background: white; }

/* ─── LIGHT THEME ─── */
body.light {
  --bg: #ffffff; --surface: #f8f9fa; --surface2: #f0f1f3; --surface3: #e9ecef; --surface4: #e2e5e9;
  --border: #dee2e6; --border2: #ced4da;
  --text: #1a1a1a; --text-muted: #868e96; --text-dim: #495057;
  --green: #16a34a; --green-dark: #dcfce7;
  --red: #dc2626; --red-dark: #fee2e2;
  --yellow: #ca8a04; --gold: #d97706;
}
body.light .market-card:hover { box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
body.light .cta-btn { background: #1a1a1a; color: #fff; }
body.light .cta-btn:hover { background: #000; }
body.light .custom-select-menu { background: #fff; border-color: #e5e7eb; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
body.light .custom-select-item:hover { background: #f3f4f6; }
body.light .custom-select-item.selected { background: #f3f4f6; }
body.light .custom-select-trigger:hover, body.light .custom-select-trigger.open { border-color: #d1d5db; }
body.light .more-menu { background: #fff; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
body.light .more-menu-item:hover { background: #f3f4f6; }
body.light .opt-btn.yes { background: #dcfce7; color: #16a34a; }
body.light .opt-btn.no { background: #fee2e2; color: #dc2626; }
body.light .status-active .status-dot { box-shadow: 0 0 6px #16a34a; }
body.light input[type=range] { background: linear-gradient(to right, #adb5bd 0%, #dee2e6 0%); }
body.light input[type=range]::-webkit-slider-thumb { background: #868e96; border-color: #fff; }
body.light .outcome-btn.yes { background: #16a34a; }
body.light .outcome-btn.no.no-active { background: #fee2e2; color: #dc2626; border-color: #fecaca; }

/* Theme toggle */
.theme-toggle { width: 32px; height: 32px; border-radius: 6px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); transition: all 0.15s; flex-shrink: 0; }
.theme-toggle:hover { background: var(--surface2); color: var(--text); }
body.light .comment-input { background: #fff; }
body.light .holders-date-select { background: #fff; }
body.light nav { box-shadow: 0 1px 4px rgba(0,0,0,0.06); }

/* ─── DETAIL CONTENT PANELS ─── */
.detail-content-panel { display: none; }
.detail-content-panel.active { display: block; }

/* ─── TOP HOLDERS ─── */
.holders-section { padding: 20px; }
.holders-date-row { margin-bottom: 16px; }
.holders-date-select { padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 13px; cursor: pointer; }
.holders-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.holders-col-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 4px; }
.holders-col-header { display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border); margin-bottom: 4px; }
.holders-shares-label { font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
.holder-row { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid var(--border); }
.holder-rank { font-size: 12px; color: var(--text-muted); width: 20px; text-align: center; flex-shrink: 0; display: none; }
.holder-avatar { width: 32px; height: 32px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 14px; overflow: hidden; }
.holder-name { font-size: 13px; font-weight: 500; color: var(--text); flex: 1; min-width: 0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.holder-shares { font-size: 14px; font-weight: 700; flex-shrink: 0; margin-left: auto; }
.holder-shares.yes-color { color: var(--green); }
.holder-shares.no-color { color: var(--red); }

/* ─── COMMENTS ─── */
.comments-section { padding: 20px; }
.comment-input-row { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; }
.comment-input { flex: 1; padding: 10px 16px; border-radius: 24px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 14px; outline: none; font-family: inherit; }
.comment-input::placeholder { color: var(--text-muted); }
.comment-input:focus { border-color: #4f8ff7; }
.comment-post-btn { padding: 8px 20px; border-radius: 24px; border: none; background: #4f8ff7; color: white; font-size: 14px; font-weight: 600; cursor: pointer; flex-shrink: 0; }
.comment-post-btn:hover { background: #3b7de8; }
.comment-controls { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
.comment-sort-btn { display: flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 6px; border: none; background: transparent; color: var(--text); font-size: 13px; font-weight: 500; cursor: pointer; }
.comment-sort-btn:hover { background: var(--surface); }
.comment-holders-check { display: flex; align-items: center; gap: 6px; font-size: 13px; color: var(--text-dim); cursor: pointer; }
.comment-holders-check input { accent-color: #4f8ff7; }
.comment-warning { margin-left: auto; display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); }
.comment-item { display: flex; gap: 10px; padding: 14px 0; border-bottom: 1px solid var(--border); }
.comment-avatar { width: 36px; height: 36px; border-radius: 50%; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; overflow: hidden; }
.comment-body { flex: 1; min-width: 0; }
.comment-header { display: flex; align-items: center; gap: 8px; margin-bottom: 4px; flex-wrap: wrap; }
.comment-author { font-size: 13px; font-weight: 600; color: var(--text); }
.comment-badge { display: inline-flex; align-items: center; gap: 3px; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 4px; }
.comment-badge.yes-badge { background: rgba(34,197,94,0.12); color: var(--green); }
.comment-badge.no-badge { background: rgba(239,68,68,0.12); color: var(--red); }
.comment-time { font-size: 12px; color: var(--text-muted); }
.comment-text { font-size: 14px; color: var(--text); line-height: 1.5; margin-bottom: 6px; word-break: break-word; }
.comment-text a { color: #4f8ff7; text-decoration: none; }
.comment-text a:hover { text-decoration: underline; }
.comment-actions { display: flex; align-items: center; gap: 14px; }
.comment-like { display: flex; align-items: center; gap: 4px; font-size: 12px; color: var(--text-muted); cursor: pointer; background: none; border: none; padding: 2px 4px; border-radius: 4px; }
.comment-like:hover { color: var(--red); }
.comment-reply-link { font-size: 12px; color: var(--text-muted); cursor: pointer; }
.comment-reply-link:hover { color: var(--text); }
.comment-more { margin-left: auto; width: 24px; height: 24px; border-radius: 4px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-muted); background: none; border: none; font-size: 14px; }
.comment-more:hover { background: var(--surface); color: var(--text); }

/* ─── CREATE MARKET MODAL ─── */
.cm-view { display: none; padding: 0; }
.cm-view.active { display: block; }
.cm-page { max-width: 680px; margin: 0 auto; padding: 0 24px 60px; }
.cm-page-header { display: flex; align-items: center; gap: 12px; padding: 24px 0 20px; }
.cm-page-back { padding: 6px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); font-size: 13px; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.cm-page-back:hover { background: var(--surface2); color: var(--text); }
@keyframes cmSlideUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
.cm-header { display: flex; align-items: center; justify-content: space-between; padding: 20px 0; }
.cm-header-title { font-size: 18px; font-weight: 700; color: var(--text); }
.cm-close { width: 32px; height: 32px; border-radius: 8px; border: none; background: var(--surface2); color: var(--text-muted); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
.cm-close:hover { background: var(--surface3); color: var(--text); }
.cm-body { padding: 0; display: flex; flex-direction: column; gap: 24px; }
.cm-body::-webkit-scrollbar { width: 4px; }
.cm-body::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
.cm-section { display: flex; flex-direction: column; gap: 8px; }
.cm-label { font-size: 14px; font-weight: 600; color: var(--text); }
.cm-sublabel { font-size: 12px; color: var(--text-muted); line-height: 1.4; }
.cm-input { width: 100%; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 14px; font-family: inherit; outline: none; transition: border-color 0.15s; }
.cm-input:focus { border-color: var(--text-muted); }
.cm-input::placeholder { color: var(--text-muted); }
.cm-textarea { resize: vertical; min-height: 90px; line-height: 1.5; }
.cm-char-count { font-size: 11px; color: var(--text-muted); text-align: right; margin-top: -4px; }
.cm-sep { height: 1px; background: var(--border); }

/* Category chips */
.cm-cats { display: flex; flex-wrap: wrap; gap: 8px; }
.cm-cat-chip { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text-dim); font-size: 13px; cursor: pointer; transition: all 0.15s; font-family: inherit; }
.cm-cat-chip:hover { border-color: var(--text-muted); color: var(--text); }
.cm-cat-chip.active { background: var(--text); color: var(--bg); border-color: var(--text); }

/* Date input */
.cm-date-row { position: relative; }
.cm-date-row input[type=datetime-local] { width: 100%; padding: 10px 14px; border-radius: 10px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 14px; font-family: inherit; outline: none; }
.cm-date-row input[type=datetime-local]:focus { border-color: var(--text-muted); }
.cm-date-hint { font-size: 11px; color: var(--gold); margin-top: 2px; }

/* Image upload */
.cm-upload { width: 80px; height: 80px; border-radius: 12px; border: 1.5px dashed var(--border2); background: var(--surface); display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-muted); font-size: 24px; transition: all 0.15s; overflow: hidden; position: relative; }
.cm-upload:hover { border-color: var(--text-muted); background: var(--surface2); }
.cm-upload img { width: 100%; height: 100%; object-fit: cover; }
.cm-upload input { display: none; }

/* Market type toggle */
.cm-type-toggle { display: inline-flex; border-radius: 40px; overflow: hidden; border: 1px solid var(--border); background: var(--surface); margin-bottom: 14px; }
.cm-type-btn { display: flex; align-items: center; gap: 8px; padding: 10px 24px; font-size: 14px; font-weight: 600; cursor: pointer; border: none; background: transparent; color: var(--text-muted); font-family: inherit; transition: all 0.2s; white-space: nowrap; }
.cm-type-btn.active { background: var(--text); color: var(--bg); }
.cm-type-btn .cm-type-icon { display: flex; align-items: center; font-size: 16px; }
body.light .cm-type-btn.active { background: #1a1a1a; color: #fff; }

/* Outcome setting */
.cm-outcomes-wrap { border: 1px solid var(--border); border-radius: 12px; padding: 16px; display: flex; flex-direction: column; gap: 14px; }
.cm-outcome-input.readonly { opacity: 0.6; cursor: not-allowed; background: var(--surface2); }
.cm-outcome-row { display: flex; align-items: center; gap: 10px; }
.cm-outcome-left { flex: 1; display: flex; flex-direction: column; gap: 4px; }
.cm-outcome-right { width: 140px; display: flex; flex-direction: column; gap: 4px; }
.cm-outcome-field-label { font-size: 12px; color: var(--text-muted); font-weight: 500; }
.cm-outcome-input { width: 100%; padding: 8px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 13px; font-family: inherit; outline: none; }
.cm-outcome-input:focus { border-color: var(--text-muted); }
.cm-outcome-input::placeholder { color: var(--text-muted); }
.cm-outcome-remove { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-muted); font-size: 16px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; transition: all 0.15s; align-self: flex-end; margin-bottom: 2px; }
.cm-outcome-remove:hover { background: var(--red-dark); color: var(--red); border-color: var(--red); }
.cm-outcome-footer { display: flex; align-items: center; justify-content: space-between; padding-top: 4px; border-top: 1px solid var(--border); }
.cm-auto-calc { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 13px; color: var(--text-dim); }
.cm-auto-calc-icon { width: 28px; height: 28px; border-radius: 8px; background: var(--text); color: var(--bg); display: flex; align-items: center; justify-content: center; font-size: 14px; font-weight: 700; }
.cm-outcome-add { width: 32px; height: 32px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); font-size: 18px; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.15s; }
.cm-outcome-add:hover { background: var(--surface3); color: var(--text); }

/* Source row */
.cm-source-row { display: flex; gap: 8px; }
.cm-source-row .cm-input { flex: 1; }
.cm-source-add-btn { padding: 10px 20px; border-radius: 10px; border: none; background: var(--text); color: var(--bg); font-size: 13px; font-weight: 600; cursor: pointer; flex-shrink: 0; font-family: inherit; transition: all 0.15s; }
.cm-source-add-btn:hover { opacity: 0.85; }
.cm-source-tags { display: flex; flex-wrap: wrap; gap: 6px; }
.cm-source-tag { display: flex; align-items: center; gap: 6px; padding: 4px 10px; border-radius: 6px; background: var(--surface2); font-size: 12px; color: var(--text-dim); }
.cm-source-tag-x { cursor: pointer; color: var(--text-muted); font-size: 14px; }
.cm-source-tag-x:hover { color: var(--red); }

/* Liquidity */
.cm-liquidity-input-wrap { position: relative; display: flex; align-items: center; }
.cm-liquidity-input-wrap .cm-input { padding-right: 80px; }
.cm-liquidity-badge { position: absolute; right: 10px; display: flex; align-items: center; gap: 4px; font-size: 13px; font-weight: 600; color: var(--text); }
.cm-liquidity-badge .usdt-icon { width: 20px; height: 20px; border-radius: 50%; background: #26a17b; display: flex; align-items: center; justify-content: center; color: white; font-size: 11px; font-weight: 700; }
.cm-balance { font-size: 12px; color: var(--text-muted); }
.cm-tip { padding: 12px 16px; border-radius: 10px; background: rgba(234,179,8,0.1); border: 1px solid rgba(234,179,8,0.2); }
.cm-tip-title { font-size: 13px; font-weight: 600; color: var(--gold); margin-bottom: 4px; }
.cm-tip-text { font-size: 12px; color: var(--gold); line-height: 1.5; opacity: 0.85; }

/* Footer */
.cm-footer { padding: 24px 0; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; margin-top: 8px; }
.cm-submit-btn { padding: 12px 40px; border-radius: 10px; border: none; background: var(--text); color: var(--bg); font-size: 15px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.cm-submit-btn:hover { opacity: 0.85; }
.cm-submit-btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* Preview overlay */
.cm-preview-overlay { display: none; position: fixed; inset: 0; z-index: 500; background: rgba(0,0,0,0.65); backdrop-filter: blur(4px); justify-content: center; align-items: flex-start; padding: 40px 16px; overflow-y: auto; }
.cm-preview-overlay.open { display: flex; }
.cm-preview-modal { background: var(--bg); border: 1px solid var(--border); border-radius: 16px; width: 100%; max-width: 680px; padding: 0; position: relative; animation: cmSlideUp 0.25s ease; }
.cm-preview { padding: 24px 28px; max-height: calc(100vh - 200px); overflow-y: auto; }
.cm-preview::-webkit-scrollbar { width: 4px; }
.cm-preview::-webkit-scrollbar { width: 4px; }
.cm-preview::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }
.cm-preview-title { font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 20px; text-align: center; }
.cm-preview-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; overflow: hidden; margin-bottom: 16px; }
.cm-preview-card-header { padding: 20px 24px 12px; }
.cm-preview-card-title { font-size: 18px; font-weight: 700; color: var(--text); margin-bottom: 8px; line-height: 1.4; }
.cm-preview-card-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.cm-preview-chip { display: inline-block; padding: 3px 10px; border-radius: 6px; background: var(--surface2); border: 1px solid var(--border); font-size: 12px; color: var(--text-dim); }
.cm-preview-img { width: 64px; height: 64px; border-radius: 10px; background: var(--surface2); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; font-size: 28px; overflow: hidden; float: right; margin-left: 12px; }
.cm-preview-img img { width: 100%; height: 100%; object-fit: cover; }
.cm-preview-options { padding: 0 24px 16px; }
.cm-preview-option { display: flex; align-items: center; justify-content: space-between; padding: 10px 14px; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 8px; }
.cm-preview-option-name { font-size: 14px; font-weight: 600; color: var(--text); }
.cm-preview-option-price { font-size: 14px; font-weight: 700; color: var(--text-dim); }
.cm-preview-section { padding: 0 24px 16px; }
.cm-preview-section-title { font-size: 13px; font-weight: 600; color: var(--text-muted); margin-bottom: 8px; text-transform: uppercase; letter-spacing: 0.5px; }
.cm-preview-section-text { font-size: 14px; color: var(--text-dim); line-height: 1.6; }
.cm-preview-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 0 24px 20px; }
.cm-preview-info-item { background: var(--bg); border: 1px solid var(--border); border-radius: 10px; padding: 12px 14px; }
.cm-preview-info-label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
.cm-preview-info-value { font-size: 14px; font-weight: 600; color: var(--text); }
.cm-preview-source { display: inline-flex; align-items: center; gap: 4px; padding: 4px 10px; border-radius: 6px; background: var(--surface2); border: 1px solid var(--border); font-size: 12px; color: #4f8ff7; margin-right: 6px; margin-bottom: 4px; word-break: break-all; }
.cm-preview-footer { padding: 16px 28px; border-top: 1px solid var(--border); display: flex; justify-content: space-between; gap: 12px; }
.cm-preview-back-btn { padding: 12px 28px; border-radius: 10px; border: 1px solid var(--border); background: transparent; color: var(--text); font-size: 15px; font-weight: 600; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.cm-preview-back-btn:hover { background: var(--surface2); }
.cm-preview-confirm-btn { padding: 12px 40px; border-radius: 10px; border: none; background: var(--green); color: #fff; font-size: 15px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.cm-preview-confirm-btn:hover { opacity: 0.9; }

body.light .cm-preview-modal { background: #fff; }
body.light .cm-cat-chip.active { background: #1a1a1a; color: #fff; }
body.light .cm-source-add-btn { background: #1a1a1a; color: #fff; }
body.light .cm-submit-btn { background: #1a1a1a; color: #fff; }
body.light .cm-auto-calc-icon { background: #1a1a1a; color: #fff; }
body.light .cm-input, body.light .cm-outcome-input { background: #f8f9fa; }
body.light .cm-upload { background: #f8f9fa; }

/* ─── DETAIL CARDS (Rules / Progress shared) ─── */
.detail-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 24px; margin-bottom: 16px; }
.detail-card-title { font-size: 15px; font-weight: 600; color: var(--text); margin-bottom: 12px; display: none; }
.rule-text { font-size: 14px; color: var(--text-dim); line-height: 1.7; white-space: pre-wrap; }
.rule-translate-btn { display: inline-flex; align-items: center; gap: 5px; margin-top: 10px; padding: 5px 14px; border-radius: 6px; border: 1px solid var(--border); background: var(--surface); color: var(--text-muted); font-size: 12px; font-weight: 500; cursor: pointer; font-family: inherit; transition: all 0.15s; }
.rule-translate-btn:hover { color: var(--text); border-color: var(--text-muted); background: var(--surface2); }
.rule-translate-btn.translated { color: #4f8ff7; border-color: rgba(79,143,247,0.3); }
.source-list { display: flex; flex-direction: column; gap: 8px; margin-top: 16px; }
.source-link { display: flex; align-items: center; gap: 8px; font-size: 13px; color: #4f8ff7; text-decoration: none; padding: 8px 12px; border-radius: 8px; background: var(--surface2); transition: background 0.15s; }
.source-link:hover { background: var(--surface3); }
.source-link-icon { width: 16px; height: 16px; flex-shrink: 0; opacity: 0.7; }

/* Progress timeline */
.progress-timeline { display: flex; align-items: flex-start; gap: 0; padding: 8px 0; }
.progress-step { display: flex; flex-direction: column; align-items: center; flex: 1; position: relative; }
.progress-step-dot { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; z-index: 2; border: 2px solid var(--border2); background: var(--surface); color: var(--text-muted); }
.progress-step.active .progress-step-dot { background: var(--text); color: var(--bg); border-color: var(--text); }
.progress-step.done .progress-step-dot { background: var(--text); color: var(--bg); border-color: var(--text); }
.progress-step-label { font-size: 12px; color: var(--text-muted); margin-top: 8px; text-align: center; white-space: nowrap; }
.progress-step.active .progress-step-label { color: var(--text); font-weight: 600; }
.progress-step-line { position: absolute; top: 14px; left: calc(50% + 14px); right: calc(-50% + 14px); height: 2px; background: var(--border2); z-index: 1; }
.progress-step.done .progress-step-line { background: var(--text); }
.progress-step:last-child .progress-step-line { display: none; }

/* Sub tabs card (shared 持仓/交易记录/流动性/结算) */
.sub-tabs-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.sub-tabs-header { display: flex; border-bottom: 1px solid var(--border); }
.sub-tab { padding: 12px 20px; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; transition: all 0.15s; border-bottom: 2px solid transparent; }
.sub-tab:hover { color: var(--text); }
.sub-tab.active { color: var(--text); border-bottom-color: var(--text); }
.sub-tab-panel { display: none; }
.sub-tab-panel.active { display: block; }
.sub-tab-table { width: 100%; border-collapse: collapse; }
.sub-tab-table th { padding: 10px 16px; font-size: 12px; font-weight: 500; color: var(--text-muted); text-align: left; border-bottom: 1px solid var(--border); white-space: nowrap; }
.sub-tab-table td { padding: 12px 16px; font-size: 13px; color: var(--text); border-bottom: 1px solid var(--border); white-space: nowrap; }
.sub-tab-table tr:last-child td { border-bottom: none; }
.sub-tab-empty { padding: 40px 20px; text-align: center; color: var(--text-muted); font-size: 13px; }
.sub-tab-empty-icon { font-size: 28px; margin-bottom: 8px; }
.td-green { color: var(--green); }
.td-red { color: var(--red); }
.td-btn { padding: 4px 12px; border-radius: 6px; border: 1px solid var(--border); background: var(--surface2); color: var(--text); font-size: 12px; cursor: pointer; }
.td-btn:hover { background: var(--surface3); }
.td-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
.td-badge.buy { background: rgba(34,197,94,0.12); color: var(--green); }
.td-badge.sell { background: rgba(239,68,68,0.12); color: var(--red); }
.td-badge.settled { background: rgba(234,179,8,0.12); color: var(--gold); }
.td-badge.pending { background: var(--surface3); color: var(--text-muted); }
.td-badge.dispute { background: rgba(239,68,68,0.12); color: var(--red); }
.td-badge.lp { background: rgba(234,179,8,0.12); color: var(--gold); }

/* ─── USER AVATAR & DROPDOWN ─── */
.user-avatar-wrap { position: relative; }
.user-avatar-btn { width: 32px; height: 32px; border-radius: 50%; background: linear-gradient(135deg,#667eea,#764ba2); border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #fff; font-weight: 600; overflow: hidden; }
.user-avatar-btn img { width: 100%; height: 100%; object-fit: cover; }
.user-dropdown { display: none; position: absolute; top: calc(100% + 8px); right: 0; min-width: 180px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 6px; z-index: 300; box-shadow: 0 8px 24px rgba(0,0,0,0.3); }
.user-dropdown.open { display: block; }
.user-dd-item { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 8px; font-size: 13px; color: var(--text); cursor: pointer; transition: background 0.12s; }
.user-dd-item:hover { background: var(--surface2); }
.user-dd-item-icon { width: 18px; text-align: center; font-size: 15px; flex-shrink: 0; }
.user-dd-sep { height: 1px; background: var(--border); margin: 4px 8px; }
.user-dd-item.danger { color: var(--red); }

/* ─── CREATOR CENTER PAGE ─── */
.creator-view { display: none; }
.creator-view.active { display: block; }
.creator-header { padding: 32px 40px 24px; }
.creator-title-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
.creator-title { font-size: 24px; font-weight: 700; color: var(--text); }
.creator-create-btn { padding: 10px 24px; border-radius: 8px; border: none; background: var(--text); color: var(--bg); font-size: 14px; font-weight: 600; cursor: pointer; font-family: inherit; transition: opacity 0.15s; }
.creator-create-btn:hover { opacity: 0.85; }
.creator-stats { display: flex; flex-direction: column; gap: 16px; }
.creator-stat-main { display: flex; flex-direction: column; gap: 2px; }
.creator-stat-main-label { font-size: 12px; color: var(--text-muted); }
.creator-stat-main-value { font-size: 28px; font-weight: 700; color: var(--text); display: flex; align-items: baseline; gap: 8px; }
.creator-stat-main-unit { font-size: 13px; color: var(--text-muted); font-weight: 400; }
.creator-stat-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0; }
.creator-stat-item { display: flex; flex-direction: column; gap: 2px; padding: 0 24px 0 0; }
.creator-stat-item-label { font-size: 12px; color: var(--text-muted); }
.creator-stat-item-value { font-size: 18px; font-weight: 700; color: var(--text); }
.creator-body { padding: 0 40px 40px; }
.creator-tabs-row { display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); margin-bottom: 0; }
.creator-tabs { display: flex; gap: 0; }
.creator-tab { padding: 12px 20px; font-size: 14px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; white-space: nowrap; }
.creator-tab:hover { color: var(--text); }
.creator-tab.active { color: var(--text); font-weight: 500; border-bottom-color: var(--text); }
.creator-search { display: flex; align-items: center; gap: 6px; padding: 6px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); }
.creator-search input { border: none; background: transparent; color: var(--text); font-size: 13px; outline: none; width: 120px; font-family: inherit; }
.creator-search input::placeholder { color: var(--text-muted); }
.creator-toolbar { display: flex; align-items: center; gap: 12px; }
.creator-sort-wrap { position: relative; }
.creator-sort-btn { display: flex; align-items: center; gap: 4px; padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-dim); font-size: 13px; cursor: pointer; font-family: inherit; white-space: nowrap; }
.creator-sort-btn:hover { border-color: var(--text-muted); color: var(--text); }
.creator-sort-menu { display: none; position: absolute; top: calc(100% + 4px); right: 0; min-width: 200px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 4px; z-index: 50; box-shadow: 0 8px 24px rgba(0,0,0,0.25); }
.creator-sort-menu.open { display: block; }
.creator-sort-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; border-radius: 6px; font-size: 13px; color: var(--text); cursor: pointer; transition: background 0.12s; }
.creator-sort-item:hover { background: var(--surface2); }
.creator-sort-item.active { color: #4f8ff7; }
.creator-sort-arrow { font-size: 12px; color: var(--text-muted); }
.creator-sort-item.active .creator-sort-arrow { color: #4f8ff7; }
.creator-tab-panel { display: none; }
.creator-tab-panel.active { display: block; }
.creator-table-wrap { border: 1px solid var(--border); border-top: none; border-radius: 0 0 12px 12px; overflow: hidden; }
.creator-table { width: 100%; border-collapse: collapse; }
.creator-table th { padding: 12px 16px; font-size: 12px; font-weight: 500; color: var(--text-muted); text-align: left; border-bottom: 1px solid var(--border); background: var(--surface); }
.creator-table td { padding: 14px 16px; font-size: 13px; color: var(--text); border-bottom: 1px solid var(--border); }
.creator-table tr:last-child td { border-bottom: none; }
.creator-empty { padding: 60px 20px; text-align: center; color: var(--text-muted); font-size: 14px; }
.creator-empty a { color: #4f8ff7; text-decoration: none; cursor: pointer; }
.creator-empty a:hover { text-decoration: underline; }

body.light .creator-create-btn { background: #1a1a1a; color: #fff; }
body.light .user-dropdown { background: #fff; box-shadow: 0 8px 24px rgba(0,0,0,0.1); }

/* ── PROFILE VIEW ───────────────────────────────── */
.profile-view { display: none; max-width: 760px; margin: 0 auto; padding: 32px 20px 60px; }
.profile-view.active { display: block; }

/* Card 1: Profile Info */
.profile-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 28px 32px; margin-bottom: 20px; position: relative; }
.profile-top { display: flex; align-items: flex-start; gap: 0; }
.profile-avatar { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, #f97316, #ec4899); display: flex; align-items: center; justify-content: center; font-size: 36px; color: #fff; flex-shrink: 0; overflow: hidden; border: 3px solid var(--surface); box-shadow: 0 2px 12px rgba(0,0,0,0.15); }
.profile-avatar img { width: 100%; height: 100%; object-fit: cover; }
.profile-info { margin-left: 20px; flex: 1; }
.profile-name { font-size: 22px; font-weight: 700; color: var(--text); margin-bottom: 2px; }
.profile-handle { font-size: 14px; color: var(--text-muted); margin-bottom: 12px; }
.profile-meta { display: flex; align-items: center; gap: 24px; flex-wrap: wrap; }
.profile-meta-item { font-size: 14px; color: var(--text-muted); }
.profile-meta-item strong { color: var(--text); font-weight: 700; margin-right: 4px; }
.profile-referral { display: flex; align-items: center; gap: 8px; margin-top: 12px; font-size: 13px; color: var(--text-muted); }
.profile-referral code { background: var(--surface2); padding: 3px 10px; border-radius: 6px; font-family: 'Courier New', monospace; font-weight: 700; color: var(--text); font-size: 13px; letter-spacing: 0.5px; }
.profile-referral-copy { background: none; border: 1px solid var(--border); border-radius: 6px; padding: 3px 8px; cursor: pointer; color: var(--text-muted); font-size: 12px; transition: all 0.15s; font-family: inherit; }
.profile-referral-copy:hover { color: var(--text); border-color: var(--text-muted); }
.profile-edit-btn { position: absolute; top: 28px; right: 32px; padding: 8px 20px; border-radius: 20px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s; font-family: inherit; }
.profile-edit-btn:hover { background: var(--surface2); }
.profile-bio { margin-top: 16px; font-size: 14px; color: var(--text-dim); line-height: 1.6; }
.profile-joined { margin-top: 8px; font-size: 13px; color: var(--text-muted); display: flex; align-items: center; gap: 6px; }

/* Card 2: Stats */
.profile-stats-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px 32px; margin-bottom: 20px; }
.profile-stats-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.profile-stats-title { font-size: 16px; font-weight: 700; color: var(--text); }
.profile-private-toggle { display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--text-muted); }
.profile-toggle-track { width: 40px; height: 22px; border-radius: 11px; background: var(--surface3); cursor: pointer; position: relative; transition: background 0.2s; }
.profile-toggle-track.on { background: var(--green); }
.profile-toggle-thumb { width: 18px; height: 18px; border-radius: 50%; background: #fff; position: absolute; top: 2px; left: 2px; transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
.profile-toggle-track.on .profile-toggle-thumb { transform: translateX(18px); }
.profile-stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
.profile-stat-box { background: var(--bg); border: 1px solid var(--border); border-radius: 12px; padding: 16px 18px; display: flex; flex-direction: column; gap: 6px; }
.profile-stat-box-label { font-size: 12px; color: var(--text-muted); }
.profile-stat-box-value { font-size: 20px; font-weight: 700; }
.profile-stat-box-value.profit { color: var(--green); }
.profile-stat-box-value.neutral { color: var(--text); }

/* Card 3: Activity Tabs */
.profile-activity-card { background: var(--surface); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; }
.profile-activity-tabs { display: flex; border-bottom: 1px solid var(--border); }
.profile-activity-tab { flex: 1; padding: 14px 8px; text-align: center; font-size: 14px; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; font-weight: 500; }
.profile-activity-tab:hover { color: var(--text); background: var(--surface2); }
.profile-activity-tab.active { color: var(--text); font-weight: 600; border-bottom-color: var(--text); }
.profile-activity-panel { display: none; }
.profile-activity-panel.active { display: block; }

/* Activity feed items */
.pf-feed { padding: 0; }
.pf-feed-item { display: flex; gap: 12px; padding: 16px 24px; border-bottom: 1px solid var(--border); transition: background 0.1s; }
.pf-feed-item:last-child { border-bottom: none; }
.pf-feed-item:hover { background: var(--surface2); }
.pf-feed-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--surface3); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; overflow: hidden; }
.pf-feed-body { flex: 1; min-width: 0; position: relative; }
.pf-feed-head { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; padding-right: 60px; }
.pf-feed-name { font-size: 14px; font-weight: 600; color: var(--text); }
.pf-feed-handle { font-size: 13px; color: var(--text-muted); }
.pf-feed-time { font-size: 12px; color: var(--text-muted); margin-left: auto; white-space: nowrap; }
.pf-feed-text { font-size: 14px; color: var(--text-dim); line-height: 1.5; }
.pf-feed-text .pf-hl { color: #4f8ff7; font-weight: 500; }
.pf-feed-market-link { display: inline-flex; align-items: center; gap: 4px; margin-top: 8px; padding: 6px 12px; border-radius: 8px; background: var(--surface2); border: 1px solid var(--border); font-size: 12px; color: var(--text-dim); text-decoration: none; transition: background 0.12s; cursor: pointer; }
.pf-feed-market-link:hover { background: var(--surface3); }
.pf-feed-badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; margin-left: 4px; }
.pf-feed-badge.buy { background: rgba(34,197,94,0.12); color: var(--green); }
.pf-feed-badge.sell { background: rgba(239,68,68,0.12); color: var(--red); }
.pf-feed-badge.create { background: rgba(79,143,247,0.12); color: #4f8ff7; }
.pf-feed-badge.lp { background: rgba(234,179,8,0.12); color: var(--gold); }

.pf-feed-actions { display: flex; gap: 12px; margin-top: 8px; }
.pf-feed-share-topright { position: absolute; top: 0; right: 0; font-size: 12px; color: var(--text-muted); cursor: pointer; padding: 2px 8px; border-radius: 6px; transition: all 0.15s; }
.pf-feed-share-topright:hover { color: var(--text); background: var(--surface2); }
.pf-feed-time-bottom { font-size: 11px; color: var(--text-muted); margin-top: 6px; text-align: right; }
.pf-feed-action-btn { font-size: 12px; color: var(--text-muted); cursor: pointer; padding: 3px 10px; border-radius: 6px; transition: all 0.15s; }
.pf-feed-action-btn:hover { color: var(--text); background: var(--surface2); }

.pf-watchlist-share { flex-shrink: 0; display: flex; align-items: center; }
.pf-watchlist-share button { background: none; border: 1px solid var(--border); border-radius: 6px; color: var(--text-muted); cursor: pointer; padding: 4px 10px; font-size: 13px; transition: all 0.15s; font-family: inherit; }
.pf-watchlist-share button:hover { color: var(--text); border-color: var(--text-muted); }

.share-dropdown { position: fixed; z-index: 999; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; box-shadow: 0 8px 32px rgba(0,0,0,0.3); padding: 8px 0; min-width: 220px; }
.share-dropdown-title { padding: 8px 16px 4px; font-size: 11px; color: var(--text-muted); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
.share-dropdown-item { display: flex; align-items: center; gap: 10px; padding: 10px 16px; cursor: pointer; transition: background 0.1s; font-size: 13px; color: var(--text); }
.share-dropdown-item:hover { background: var(--surface2); }
.share-dropdown-item .sdi-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
.share-dropdown-sep { height: 1px; background: var(--border); margin: 4px 0; }
.share-dropdown-friend { display: flex; align-items: center; gap: 8px; padding: 6px 16px; cursor: pointer; transition: background 0.1s; font-size: 12px; color: var(--text); }
.share-dropdown-friend:hover { background: var(--surface2); }
.share-dropdown-friend .sdf-avatar { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; }
.share-dropdown-friend .sdf-check { margin-left: auto; color: var(--green); display: none; }
.share-dropdown-friend.selected .sdf-check { display: inline; }
.share-dropdown-send { margin: 8px 12px 4px; padding: 8px; border-radius: 8px; border: none; background: var(--accent, #3b82f6); color: #fff; font-size: 13px; font-weight: 600; cursor: pointer; width: calc(100% - 24px); font-family: inherit; transition: opacity 0.15s; }
.share-dropdown-send:hover { opacity: 0.85; }
body.light .share-dropdown { background: #fff; box-shadow: 0 8px 32px rgba(0,0,0,0.12); }

/* Comment items in profile */
.pf-comment { padding: 16px 24px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; }
.pf-comment:last-child { border-bottom: none; }
.pf-comment:hover { background: var(--surface2); }
.pf-comment-avatar { width: 38px; height: 38px; border-radius: 50%; background: var(--surface3); display: flex; align-items: center; justify-content: center; font-size: 16px; flex-shrink: 0; cursor: pointer; transition: opacity 0.15s; }
.pf-comment-avatar:hover { opacity: 0.75; }
.pf-comment-body { flex: 1; min-width: 0; }
.pf-comment-user { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.pf-comment-username { font-size: 13px; font-weight: 600; color: var(--text); cursor: pointer; }
.pf-comment-username:hover { text-decoration: underline; }
.pf-comment-handle { font-size: 11px; color: var(--text-muted); }
.pf-comment-market { font-size: 12px; color: var(--text-muted); margin-bottom: 6px; display: flex; align-items: center; gap: 6px; }
.pf-comment-market span { color: #4f8ff7; font-weight: 500; }
.pf-comment-text { font-size: 14px; color: var(--text); line-height: 1.5; margin-bottom: 6px; }
.pf-comment-meta { display: flex; align-items: center; gap: 16px; font-size: 12px; color: var(--text-muted); }
.pf-comment-action { cursor: pointer; transition: color 0.12s; }
.pf-comment-action:hover { color: var(--text); }

/* Follow list */
.pf-follow-item { display: flex; align-items: center; gap: 12px; padding: 14px 24px; border-bottom: 1px solid var(--border); }
.pf-follow-item:last-child { border-bottom: none; }
.pf-follow-item:hover { background: var(--surface2); }
.pf-follow-avatar { width: 44px; height: 44px; border-radius: 50%; background: var(--surface3); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; transition: opacity 0.15s; }
.pf-follow-avatar[style*="cursor:pointer"]:hover { opacity: 0.75; }
.pf-follow-name { cursor: pointer; }
.pf-follow-name:hover { text-decoration: underline; }
.pf-follow-info { flex: 1; min-width: 0; }
.pf-follow-name { font-size: 14px; font-weight: 600; color: var(--text); }
.pf-follow-handle { font-size: 13px; color: var(--text-muted); }
.pf-follow-stats { font-size: 12px; color: var(--text-muted); margin-top: 2px; }
.pf-follow-btn { padding: 6px 16px; border-radius: 20px; border: 1px solid var(--border); background: transparent; color: var(--text); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s; font-family: inherit; }
.pf-follow-btn:hover { background: var(--surface2); }
.pf-follow-btn.following { background: var(--text); color: var(--bg); border-color: var(--text); }
.pf-follow-btn.following:hover { opacity: 0.85; }

/* Watchlist in profile */
.pf-watchlist-item { display: flex; align-items: center; gap: 16px; padding: 14px 24px; border-bottom: 1px solid var(--border); }
.pf-watchlist-item:last-child { border-bottom: none; }
.pf-watchlist-item:hover { background: var(--surface2); }
.pf-watchlist-info { flex: 1; min-width: 0; }
.pf-watchlist-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.pf-watchlist-meta { font-size: 12px; color: var(--text-muted); display: flex; gap: 12px; }
.pf-watchlist-price { text-align: right; flex-shrink: 0; }
.pf-watchlist-yes { font-size: 15px; font-weight: 700; color: var(--green); }
.pf-watchlist-vol { font-size: 12px; color: var(--text-muted); }

/* Empty state for profile tabs */
.pf-empty { padding: 60px 20px; text-align: center; color: var(--text-muted); font-size: 14px; }

body.light .profile-edit-btn { background: #fff; }
body.light .profile-stat-box { background: #fff; }

/* ── VERIFIED BADGES ── */
.badge-verified { display: inline-flex; align-items: center; justify-content: center; width: 20px; height: 20px; border-radius: 50%; background: #f59e0b; color: #fff; font-size: 11px; font-weight: 700; margin-left: 6px; vertical-align: middle; flex-shrink: 0; }
.badge-verified.blue { background: #3b82f6; }
.badge-verified.media { background: #8b5cf6; }
.profile-badges-row { display: flex; align-items: center; gap: 6px; margin-top: 4px; flex-wrap: wrap; }
.profile-badge-tag { padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 600; }
.profile-badge-tag.kol { background: rgba(245,158,11,0.15); color: #f59e0b; }
.profile-badge-tag.media { background: rgba(139,92,246,0.15); color: #8b5cf6; }

.profile-badge-icons { display: flex; align-items: center; gap: 6px; margin-left: auto; flex-shrink: 0; }
.profile-badge-icon { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; cursor: pointer; transition: all 0.2s; position: relative; border: 2px solid transparent; }
.profile-badge-icon.locked { background: var(--surface2, rgba(255,255,255,0.06)); color: var(--text-muted); opacity: 0.4; filter: grayscale(1); border-color: var(--border); }
.profile-badge-icon.locked:hover { opacity: 0.7; border-color: var(--text-muted); transform: scale(1.08); }
.profile-badge-icon.unlocked { opacity: 1; filter: none; border-color: transparent; box-shadow: 0 0 0 1px rgba(255,255,255,0.08); animation: badgeGlow 2s ease-in-out infinite alternate; }
.profile-badge-icon.unlocked:hover { transform: scale(1.12); }
.profile-badge-icon.unlocked.b-kol { background: linear-gradient(135deg, #f59e0b, #f97316); color: #fff; box-shadow: 0 2px 12px rgba(245,158,11,0.35); }
.profile-badge-icon.unlocked.b-media { background: linear-gradient(135deg, #8b5cf6, #a855f7); color: #fff; box-shadow: 0 2px 12px rgba(139,92,246,0.35); }
.profile-badge-icon.unlocked.b-creator { background: linear-gradient(135deg, #3b82f6, #6366f1); color: #fff; box-shadow: 0 2px 12px rgba(59,130,246,0.35); }
.profile-badge-icon.unlocked.b-analyst { background: linear-gradient(135deg, #10b981, #059669); color: #fff; box-shadow: 0 2px 12px rgba(16,185,129,0.35); }
.profile-badge-icon.unlocked.b-community { background: linear-gradient(135deg, #ec4899, #f43f5e); color: #fff; box-shadow: 0 2px 12px rgba(236,72,153,0.35); }
.profile-badge-icon.unlocked.b-dev { background: linear-gradient(135deg, #06b6d4, #0891b2); color: #fff; box-shadow: 0 2px 12px rgba(6,182,212,0.35); }
.profile-badge-icon.unlocked.b-institution { background: linear-gradient(135deg, #64748b, #475569); color: #fff; box-shadow: 0 2px 12px rgba(100,116,139,0.35); }
.profile-badge-icon .badge-tooltip { position: absolute; bottom: calc(100% + 8px); left: 50%; transform: translateX(-50%); background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; font-size: 11px; white-space: nowrap; pointer-events: none; opacity: 0; transition: opacity 0.15s; box-shadow: 0 4px 16px rgba(0,0,0,0.25); z-index: 10; color: var(--text); }
.profile-badge-icon:hover .badge-tooltip { opacity: 1; }
@keyframes badgeGlow { from { filter: brightness(1); } to { filter: brightness(1.1); } }
body.light .profile-badge-icon.locked { background: #f1f5f9; border-color: #e2e8f0; }
body.light .profile-badge-icon .badge-tooltip { background: #fff; border-color: #e2e8f0; box-shadow: 0 4px 16px rgba(0,0,0,0.1); }

/* ── NOTIFICATION BELL ── */
.nav-bell { position: relative; cursor: pointer; font-size: 18px; display: flex; align-items: center; }
.nav-bell-dot { position: absolute; top: -2px; right: -4px; width: 8px; height: 8px; border-radius: 50%; background: #ef4444; border: 2px solid var(--bg); }
.notif-panel { display: none; position: fixed; top: 0; right: 0; bottom: 0; width: 420px; max-width: 100vw; background: var(--surface); border-left: 1px solid var(--border); z-index: 600; flex-direction: column; box-shadow: -8px 0 30px rgba(0,0,0,0.3); }
.notif-panel.open { display: flex; }
.notif-header { padding: 20px 24px 0; display: flex; align-items: center; justify-content: space-between; }
.notif-header-title { font-size: 20px; font-weight: 700; color: var(--text); }
.notif-close { background: none; border: none; font-size: 20px; color: var(--text-muted); cursor: pointer; padding: 4px; }
.notif-close:hover { color: var(--text); }
.notif-tabs { display: flex; border-bottom: 1px solid var(--border); padding: 0 24px; margin-top: 16px; }
.notif-tab { flex: 1; padding: 12px 4px; text-align: center; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; }
.notif-tab:hover { color: var(--text); }
.notif-tab.active { color: var(--text); font-weight: 600; border-bottom-color: var(--accent, #3b82f6); }
.notif-list { flex: 1; overflow-y: auto; }
.notif-item { display: flex; gap: 12px; padding: 14px 24px; border-bottom: 1px solid var(--border); transition: background 0.1s; cursor: pointer; }
.notif-item:hover { background: var(--surface2); }
.notif-item.unread { background: rgba(59,130,246,0.04); }
.notif-item-avatar { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.notif-item-avatar.trade { background: rgba(34,197,94,0.12); }
.notif-item-avatar.settle { background: rgba(245,158,11,0.12); }
.notif-item-avatar.social { background: rgba(59,130,246,0.12); }
.notif-item-body { flex: 1; min-width: 0; }
.notif-item-text { font-size: 14px; color: var(--text); line-height: 1.5; }
.notif-item-text strong { font-weight: 600; }
.notif-item-text .notif-hl { color: var(--green); font-weight: 600; }
.notif-item-time { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.notif-item-market { font-size: 12px; color: var(--text-dim); margin-top: 2px; padding: 4px 8px; background: var(--surface2); border-radius: 6px; display: inline-block; }
.notif-empty { padding: 60px 20px; text-align: center; color: var(--text-muted); font-size: 14px; }
.notif-overlay { display: none; position: fixed; inset: 0; z-index: 599; background: rgba(0,0,0,0.3); }
.notif-overlay.open { display: block; }
body.light .notif-panel { background: #fff; }
body.light .notif-item.unread { background: rgba(59,130,246,0.06); }

/* ── Profile Portfolio Table ── */
.pf-portfolio-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 24px; border-bottom: 1px solid var(--border); }
.pf-portfolio-tabs { display: flex; gap: 0; }
.pf-portfolio-tab { padding: 8px 16px; font-size: 13px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; }
.pf-portfolio-tab.active { color: var(--text); font-weight: 600; border-bottom-color: var(--text); }
.pf-portfolio-filter { display: flex; align-items: center; gap: 8px; }
.pf-portfolio-filter select { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 5px 10px; font-size: 12px; color: var(--text); font-family: inherit; }
.pf-pos-row { display: flex; align-items: center; gap: 0; padding: 14px 24px; border-bottom: 1px solid var(--border); }
.pf-pos-row:hover { background: var(--surface2); }
.pf-pos-market { flex: 2.5; display: flex; align-items: center; gap: 12px; min-width: 0; }
.pf-pos-market-img { width: 40px; height: 40px; border-radius: 8px; background: var(--surface2); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; overflow: hidden; }
.pf-pos-market-info { min-width: 0; }
.pf-pos-market-title { font-size: 13px; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.pf-pos-market-option { font-size: 11px; color: var(--text-muted); margin-top: 2px; display: flex; align-items: center; gap: 6px; }
.pf-pos-market-option .opt-tag { padding: 1px 6px; border-radius: 3px; font-size: 10px; font-weight: 600; }
.pf-pos-market-option .opt-tag.yes { background: rgba(34,197,94,0.15); color: var(--green); }
.pf-pos-col { flex: 1; text-align: right; font-size: 13px; }
.pf-pos-col-label { display: none; font-size: 10px; color: var(--text-muted); margin-bottom: 2px; }
.pf-pos-col .val { font-weight: 600; color: var(--text); }
.pf-pos-col .val.green { color: var(--green); }
.pf-pos-col .val.red { color: var(--red); }
.pf-pos-share { flex: 0.4; text-align: right; }
.pf-pos-share button { background: none; border: none; font-size: 16px; color: var(--text-muted); cursor: pointer; padding: 4px; }
.pf-pos-share button:hover { color: var(--text); }
.pf-pos-table-header { display: flex; align-items: center; gap: 0; padding: 8px 24px; border-bottom: 1px solid var(--border); font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
.pf-pos-table-header .pf-pos-market { font-size: 11px; }

/* ── FOLLOW FEED VIEW ── */
.follow-feed-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.follow-feed-view.active { display: block; }
.ff-layout { display: grid; grid-template-columns: 1fr 320px; gap: 24px; align-items: flex-start; }
.ff-main { min-width: 0; }
.ff-sidebar { position: sticky; top: 80px; display: flex; flex-direction: column; gap: 16px; }
.ff-sidebar-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px 20px; }
.ff-sidebar-card h4 { font-size: 15px; font-weight: 700; color: var(--text); margin: 0 0 12px 0; }
.ff-sidebar-trending-item { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.1s; }
.ff-sidebar-trending-item:last-child { border-bottom: none; }
.ff-sidebar-trending-item:hover { opacity: 0.8; }
.ff-sidebar-trending-num { font-size: 13px; font-weight: 700; color: var(--text-muted); width: 18px; text-align: center; flex-shrink: 0; }
.ff-sidebar-trending-info { flex: 1; min-width: 0; }
.ff-sidebar-trending-title { font-size: 13px; font-weight: 600; color: var(--text); overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.ff-sidebar-trending-meta { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.ff-sidebar-user { display: flex; align-items: center; gap: 10px; padding: 8px 0; border-bottom: 1px solid var(--border); }
.ff-sidebar-user:last-child { border-bottom: none; }
.ff-sidebar-user-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
.ff-sidebar-user-info { flex: 1; min-width: 0; }
.ff-sidebar-user-name { font-size: 13px; font-weight: 600; color: var(--text); display: flex; align-items: center; gap: 4px; }
.ff-sidebar-user-handle { font-size: 11px; color: var(--text-muted); }
.ff-sidebar-follow-btn { padding: 4px 14px; border-radius: 16px; border: 1px solid var(--accent, #3b82f6); background: transparent; color: var(--accent, #3b82f6); font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.15s; font-family: inherit; flex-shrink: 0; }
.ff-sidebar-follow-btn:hover { background: var(--accent, #3b82f6); color: #fff; }
.ff-tabs { display: flex; border-bottom: 1px solid var(--border); margin-bottom: 0; background: var(--surface); border-radius: 12px 12px 0 0; overflow: hidden; }
.ff-tab { flex: 1; padding: 14px 8px; text-align: center; font-size: 14px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; }
.ff-tab:hover { color: var(--text); background: var(--surface2); }
.ff-tab.active { color: var(--text); font-weight: 600; border-bottom-color: var(--accent, #3b82f6); }
@media (max-width: 900px) { .ff-layout { grid-template-columns: 1fr; } .ff-sidebar { display: none; } }
.ff-panel { display: none; }
.ff-panel.active { display: block; }
.ff-card { background: var(--surface); border: 1px solid var(--border); border-radius: 0 0 12px 12px; overflow: hidden; }
.ff-item { display: flex; gap: 14px; padding: 18px 24px; border-bottom: 1px solid var(--border); transition: background 0.1s; }
.ff-item:last-child { border-bottom: none; }
.ff-item:hover { background: var(--surface2); }
.ff-item-avatar { width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
.ff-item-avatar.trade { background: linear-gradient(135deg, rgba(34,197,94,0.15), rgba(34,197,94,0.05)); }
.ff-item-avatar.settle { background: linear-gradient(135deg, rgba(245,158,11,0.15), rgba(245,158,11,0.05)); }
.ff-item-avatar.social { background: linear-gradient(135deg, rgba(59,130,246,0.15), rgba(59,130,246,0.05)); }
.ff-item-body { flex: 1; min-width: 0; }
.ff-item-head { display: flex; align-items: center; gap: 6px; margin-bottom: 4px; }
.ff-item-name { font-size: 14px; font-weight: 600; color: var(--text); cursor: pointer; }
.ff-item-name:hover { text-decoration: underline; }
.ff-item-handle { font-size: 12px; color: var(--text-muted); }
.ff-item-time { font-size: 12px; color: var(--text-muted); margin-left: auto; }
.ff-item-text { font-size: 14px; color: var(--text); line-height: 1.6; }
.ff-item-text .ff-hl { color: var(--green); font-weight: 600; }
.ff-item-text .ff-hl-red { color: var(--red); font-weight: 600; }
.ff-item-text .ff-hl-gold { color: #f59e0b; font-weight: 600; }
.ff-item-market { margin-top: 8px; padding: 8px 12px; background: var(--bg); border: 1px solid var(--border); border-radius: 8px; font-size: 13px; color: var(--text-dim); display: flex; align-items: center; gap: 8px; cursor: pointer; transition: border-color 0.15s; }
.ff-item-market:hover { border-color: var(--text-muted); }
.ff-item-market-emoji { font-size: 16px; }
.ff-item-actions { display: flex; gap: 16px; margin-top: 8px; }
.ff-item-action { font-size: 12px; color: var(--text-muted); cursor: pointer; display: flex; align-items: center; gap: 4px; }
.ff-item-action:hover { color: var(--text); }
body.light .ff-card { background: #fff; }
body.light .ff-item-market { background: #f9fafb; }
body.light .ff-sidebar-card { background: #fff; }
body.light .ff-sidebar-follow-btn { border-color: #3b82f6; color: #3b82f6; }
body.light .ff-sidebar-follow-btn:hover { background: #3b82f6; color: #fff; }

/* ── RANK VIEW ── */
.rank-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.rank-view.active { display: block; }
.rank-head { margin-bottom: 16px; }
.rank-title { margin: 0; font-size: 28px; font-weight: 800; color: var(--text); letter-spacing: -0.4px; }
.rank-sub { margin-top: 8px; font-size: 13px; color: var(--text-muted); line-height: 1.6; }
.rank-dims { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 14px; }
.rank-dim-btn { border: 1px solid var(--border); background: var(--surface); color: var(--text-muted); border-radius: 999px; padding: 8px 14px; cursor: pointer; font-size: 12px; font-weight: 600; font-family: inherit; transition: all .15s; }
.rank-dim-btn:hover { color: var(--text); border-color: #334155; }
.rank-dim-btn.active { color: #e2e8f0; border-color: rgba(99,102,241,.45); background: linear-gradient(135deg, rgba(99,102,241,.2), rgba(14,116,144,.16)); }
.rank-card { background: linear-gradient(180deg, rgba(11,18,32,.88), rgba(11,19,35,.82)); border: 1px solid #1f2e4a; border-radius: 14px; overflow: hidden; }
.rank-table-head, .rank-row { display: grid; grid-template-columns: 72px 1.5fr repeat(3, 1fr) 120px 92px; align-items: center; gap: 10px; padding: 12px 16px; }
.rank-table-head { background: rgba(15,23,42,.75); border-bottom: 1px solid #223557; color: #94a3b8; font-size: 11px; text-transform: uppercase; letter-spacing: .05em; }
.rank-row { border-bottom: 1px solid #1f2a44; }
.rank-row:last-child { border-bottom: none; }
.rank-rank { font-weight: 800; color: #cbd5e1; font-size: 15px; }
.rank-agent { display: flex; align-items: center; gap: 10px; min-width: 0; }
.rank-avatar { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 1px solid rgba(148,163,184,.25); background: rgba(15,23,42,.75); }
.rank-agent-meta { min-width: 0; }
.rank-agent-name { font-size: 13px; font-weight: 700; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.rank-agent-type { font-size: 11px; color: #94a3b8; margin-top: 2px; }
.rank-num { font-size: 13px; color: #cbd5e1; font-weight: 600; }
.rank-num.up { color: #22c55e; }
.rank-num.steady { color: #38bdf8; }
.rank-tag { justify-self: start; font-size: 11px; color: #cbd5e1; border: 1px solid rgba(148,163,184,.35); border-radius: 999px; padding: 4px 10px; background: rgba(15,23,42,.55); }
.rank-invest-btn { justify-self: start; border: 1px solid rgba(99,102,241,.45); background: linear-gradient(135deg, rgba(99,102,241,.24), rgba(139,92,246,.22)); color: #e2e8f0; border-radius: 8px; padding: 6px 12px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all .15s; }
.rank-invest-btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
@media (max-width: 900px) {
  .rank-table-head, .rank-row { grid-template-columns: 56px 1.5fr 1fr 1fr; }
  .rank-table-head > :nth-child(5), .rank-table-head > :nth-child(6), .rank-table-head > :nth-child(7), .rank-row > :nth-child(5), .rank-row > :nth-child(6), .rank-row > :nth-child(7) { display: none; }
}

/* ── AGENT HUB ─────────────────────────────── */
.agent-hub-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.agent-hub-view.active { display: block; }
.web4-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.web4-view.active { display: block; }
.w4-hero { text-align: center; padding: 34px 20px 28px; }
.w4-hero-badge { display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg, rgba(34,211,238,0.14), rgba(99,102,241,0.14)); border: 1px solid rgba(34,211,238,0.3); border-radius: 20px; padding: 5px 14px; font-size: 12px; font-weight: 600; color: #67e8f9; margin-bottom: 16px; }
.w4-hero h1 { font-size: 32px; font-weight: 800; color: var(--text); margin: 0 0 8px; letter-spacing: -0.4px; }
.w4-hero h1 span { background: linear-gradient(135deg,#22d3ee,#6366f1,#a855f7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.w4-sub { font-size: 14px; color: var(--text-muted); max-width: 840px; margin: 0 auto; line-height: 1.7; }
.w4-section-title { font-size: 18px; font-weight: 700; color: var(--text); margin: 0 0 14px; display: flex; align-items: center; gap: 8px; }
.w4-mesh { background: linear-gradient(180deg,#0b1220 0%,#0a101c 100%); border: 1px solid #1f2e4a; border-radius: 14px; padding: 16px; margin-bottom: 20px; }
.w4-hive-shell { display: block; }
.w4-streams { display: flex; flex-direction: column; gap: 8px; }
.w4-stream { border: 1px solid #223557; background: rgba(15,23,42,0.72); border-radius: 10px; padding: 10px; }
.w4-stream-top { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.w4-stream-name { font-size: 12px; font-weight: 700; color: #e2e8f0; }
.w4-stream-val { font-size: 11px; color: #67e8f9; font-weight: 700; }
.w4-stream-bar { margin-top: 6px; height: 6px; border-radius: 999px; background: #1e293b; overflow: hidden; }
.w4-stream-bar span { display: block; height: 100%; background: linear-gradient(90deg,#22d3ee,#6366f1); animation: w4Flow 2s ease-in-out infinite; }
@keyframes w4Flow { 0% { width: 30%; } 50% { width: 82%; } 100% { width: 38%; } }
.w4-hive-wrap { position: relative; border: 1px solid #223557; border-radius: 12px; background: radial-gradient(circle at 50% 50%, rgba(34,211,238,0.09), transparent 60%), #0b1322; min-height: 520px; max-width: 760px; margin: 0 auto; overflow: hidden; }
.w4-hive-wrap::before { content: ''; position: absolute; inset: 0; background-image: radial-gradient(circle, rgba(148,163,184,0.07) 1px, transparent 1px); background-size: 18px 18px; opacity: 0.4; }
.w4-core { position: absolute; left: 50%; top: 50%; transform: translate(-50%,-50%); width: 120px; height: 120px; border-radius: 50%; border: 2px solid rgba(99,102,241,0.6); background: radial-gradient(circle, rgba(99,102,241,0.35) 0%, rgba(30,41,59,0.65) 70%); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 2; box-shadow: 0 0 26px rgba(99,102,241,0.25); }
.w4-core b { font-size: 13px; color: #e2e8f0; }
.w4-core span { font-size: 10px; color: #93c5fd; margin-top: 2px; }
.w4-hex { position: absolute; width: 144px; height: 124px; clip-path: polygon(25% 3%, 75% 3%, 97% 50%, 75% 97%, 25% 97%, 3% 50%); border: 1px solid #2f466f; background: linear-gradient(180deg, rgba(30,41,59,0.85), rgba(15,23,42,0.92)); padding: 13px 12px; font-size: 10px; color: #b7c6e8; z-index: 2; }
.w4-hex .h-title { font-size: 12px; font-weight: 700; color: #e2e8f0; margin-bottom: 4px; }
.w4-hex .h-sub { font-size: 10px; line-height: 1.4; }
.w4-hex.p1 { left: 50%; top: 24px; transform: translateX(-50%); }
.w4-hex.p2 { right: 94px; top: 120px; }
.w4-hex.p3 { right: 94px; bottom: 120px; }
.w4-hex.p4 { left: 50%; bottom: 24px; transform: translateX(-50%); }
.w4-hex.p5 { left: 94px; bottom: 120px; }
.w4-hex.p6 { left: 94px; top: 120px; }
.w4-link { position: absolute; left: 50%; top: 50%; height: 1px; width: 148px; background: linear-gradient(90deg, rgba(34,211,238,0.15), rgba(99,102,241,0.8), rgba(34,211,238,0.15)); transform-origin: 0 50%; z-index: 1; }
.w4-link::after { content: ''; position: absolute; right: -1px; top: -2px; width: 5px; height: 5px; border-radius: 50%; background: #67e8f9; box-shadow: 0 0 8px rgba(103,232,249,0.8); animation: w4Pulse 1.7s infinite; }
@keyframes w4Pulse { 0%,100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.35; transform: scale(0.8); } }
.w4-link.l1 { transform: rotate(-90deg); }
.w4-link.l2 { transform: rotate(-35deg); }
.w4-link.l3 { transform: rotate(35deg); }
.w4-link.l4 { transform: rotate(90deg); }
.w4-link.l5 { transform: rotate(145deg); }
.w4-link.l6 { transform: rotate(-145deg); }
.w4-growth { display: flex; flex-direction: column; gap: 8px; }
.w4-growth-card { border: 1px solid #223557; background: rgba(15,23,42,0.72); border-radius: 10px; padding: 10px; }
.w4-growth-title { font-size: 12px; font-weight: 700; color: #e2e8f0; margin-bottom: 6px; }
.w4-growth-kpis { display: grid; grid-template-columns: repeat(2,1fr); gap: 6px; }
.w4-growth-kpi { background: #111a2e; border: 1px solid #283b5f; border-radius: 8px; padding: 8px; text-align: center; }
.w4-growth-kpi .v { font-size: 14px; font-weight: 700; color: #c7d2fe; }
.w4-growth-kpi .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4-resource-log { margin-top: 6px; max-height: 140px; overflow: hidden; font-family: 'Courier New', monospace; font-size: 10px; color: #93a4c6; line-height: 1.6; background: rgba(12,20,36,0.65); border: 1px solid #223557; border-radius: 10px; padding: 8px; }
.w4-resource-log .r-time { color: #64748b; }
.w4-resource-log .r-ok { color: #22c55e; }
.w4-resource-log .r-info { color: #38bdf8; }
.w4-resource-log .r-warn { color: #f59e0b; }
.w4-tag { font-size: 10px; font-weight: 600; color: #cbd5e1; background: #101827; border: 1px solid #1e293b; border-radius: 999px; padding: 3px 8px; }
.w4-flow { margin-top: 12px; display: flex; flex-wrap: wrap; gap: 7px; align-items: center; }
.w4-flow-node { font-size: 11px; font-weight: 700; color: #dbeafe; border: 1px solid #334155; background: rgba(30,41,59,0.75); border-radius: 8px; padding: 7px 9px; }
.w4-flow-arrow { color: #64748b; font-size: 12px; font-weight: 700; }
.w4-grid2 { display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 12px; margin-bottom: 18px; }
.w4-panel { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
.w4-list { display: flex; flex-direction: column; gap: 8px; }
.w4-item { background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 10px 11px; font-size: 12px; color: var(--text-dim); line-height: 1.55; }
.w4-item strong { color: var(--text); }
.w4-task-ticker { height: 230px; overflow: hidden; border: 1px solid #223557; border-radius: 10px; background: linear-gradient(180deg,#0d1426 0%,#0b1220 100%); }
.w4-task-track { display: flex; flex-direction: column; animation: w4TaskRoll 22s linear infinite; }
.w4-task-item { padding: 10px 12px; border-bottom: 1px solid rgba(148,163,184,0.14); font-size: 12px; color: #c7d2fe; }
.w4-task-item .s { font-size: 10px; color: #93a4c6; margin-top: 3px; display: block; }
@keyframes w4TaskRoll { 0% { transform: translateY(0); } 100% { transform: translateY(-50%); } }
.w4-kpis { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; margin-top: 8px; }
.w4-kpi { text-align: center; padding: 10px 8px; border-radius: 10px; border: 1px solid #2b3f66; background: linear-gradient(180deg,#141d30,#111a2d); }
.w4-kpi .v { font-size: 14px; font-weight: 700; color: var(--text); }
.w4-kpi .l { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
.w4-res-growth-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 18px; }
.w4c-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 14px; margin-bottom: 18px; align-items: start; }
.w4c-card { background: linear-gradient(180deg, rgba(15,23,42,0.94), rgba(12,20,38,0.92)); border: 1px solid #243a5c; border-radius: 14px; padding: 14px; box-shadow: 0 10px 28px rgba(0,0,0,0.25), inset 0 0 0 1px rgba(255,255,255,0.02); }
.w4c-main { min-width: 0; }
.w4c-side { min-width: 0; position: sticky; top: 72px; align-self: start; max-height: calc(100vh - 88px); overflow: auto; }
.w4c-side::-webkit-scrollbar { width: 8px; }
.w4c-side::-webkit-scrollbar-thumb { background: #263a5f; border-radius: 999px; }
.w4c-title { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; letter-spacing: 0.2px; }
.w4c-kpis { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
.w4c-kpi { background: linear-gradient(180deg,#141d30,#111a2d); border: 1px solid #2b3f66; border-radius: 11px; padding: 10px; text-align: center; box-shadow: inset 0 0 0 1px rgba(99,102,241,0.06); }
.w4c-kpi .v { font-size: 20px; font-weight: 800; color: var(--text); }
.w4c-kpi .l { font-size: 11px; color: var(--text-muted); margin-top: 3px; }
.w4c-kpi .v.green { color: #22c55e; }
.w4c-kpi .v.cyan { color: #22d3ee; }
.w4c-streams { display: flex; flex-direction: column; gap: 8px; }
.w4c-stream { border: 1px solid #223557; background: rgba(15,23,42,0.72); border-radius: 10px; padding: 10px; }
.w4c-stream-head { display: flex; justify-content: space-between; align-items: center; gap: 8px; font-size: 12px; font-weight: 700; color: #e2e8f0; }
.w4c-stream-val { color: #67e8f9; font-size: 11px; }
.w4c-stream-bar { margin-top: 6px; height: 6px; border-radius: 999px; background: #1e293b; overflow: hidden; }
.w4c-stream-bar span { display: block; height: 100%; background: linear-gradient(90deg,#22d3ee,#6366f1); animation: w4Flow 2s ease-in-out infinite; }
.w4c-board-wrap { overflow: hidden; }
.w4c-board { min-width: 0; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; align-items: start; }
.w4c-lane { border: 1px solid #223557; border-radius: 10px; background: linear-gradient(180deg,#101a2f,#0d1426); min-height: 0; display: flex; flex-direction: column; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.02); }
.w4c-lane-head { padding: 9px 10px; border-bottom: 1px solid #223557; font-size: 12px; font-weight: 700; color: #dbeafe; display: flex; justify-content: space-between; cursor: pointer; transition: background .15s ease; }
.w4c-lane-head:hover { background: rgba(34,211,238,0.08); }
.w4c-lane-count { font-size: 10px; color: #93c5fd; }
.w4c-lane-body { padding: 8px; display: flex; flex-direction: column; gap: 7px; max-height: 250px; overflow: hidden; }
.w4c-lane-body.compact-two { max-height: 150px; overflow-y: auto; overflow-x: hidden; }
.w4c-lane-body.compact-two::-webkit-scrollbar { width: 6px; }
.w4c-lane-body.compact-two::-webkit-scrollbar-thumb { background: #2b3f66; border-radius: 999px; }
.w4c-lane-body.compact-two::-webkit-scrollbar-track { background: transparent; }
.w4c-lane-link { margin: 0 8px 8px; border: 1px dashed #2d446e; border-radius: 8px; background: rgba(15,23,42,0.6); padding: 6px 8px; display: flex; align-items: center; gap: 6px; font-size: 10px; color: #9eb0d4; }
.w4c-lane-link .dot { width: 6px; height: 6px; border-radius: 50%; background: #22d3ee; box-shadow: 0 0 8px rgba(34,211,238,0.8); animation: w4Pulse 1.8s infinite; }
.w4c-lane-link b { color: #c7d2fe; font-weight: 700; }
.w4c-lane-link .arr { color: #64748b; }
.w4c-collab-map { margin: 8px 0 10px; border: 1px solid #243a5c; border-radius: 10px; padding: 8px; background: linear-gradient(180deg, rgba(15,23,42,0.75), rgba(10,16,30,0.8)); display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.w4c-collab-map .n { font-size: 10px; color: #dbeafe; border: 1px solid #2f466f; background: rgba(30,41,59,0.8); border-radius: 999px; padding: 4px 8px; }
.w4c-collab-map .a { color: #64748b; font-size: 11px; font-weight: 700; }
.w4-invest-overlay { position: fixed; inset: 0; z-index: 1300; background: rgba(2,6,23,.72); backdrop-filter: blur(4px); display: none; }
.w4-invest-overlay.open { display: block; }
.w4-invest-modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 420px; max-width: calc(100vw - 24px); z-index: 1301; border: 1px solid #2a3e64; border-radius: 14px; background: linear-gradient(180deg,#0f182c,#0c1325); box-shadow: 0 26px 70px rgba(0,0,0,.5); display: none; }
.w4-invest-modal.open { display: block; }
.w4-invest-head { padding: 12px 14px; border-bottom: 1px solid #223557; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.w4-invest-title { font-size: 15px; font-weight: 700; color: #e2e8f0; }
.w4-invest-close { width: 28px; height: 28px; border-radius: 8px; border: 1px solid #334155; background: #111827; color: #cbd5e1; cursor: pointer; font-size: 16px; line-height: 1; }
.w4-invest-close:hover { border-color: #64748b; }
.w4-invest-body { padding: 14px; display: grid; gap: 10px; }
.w4-invest-agent { border: 1px solid #2a3e64; border-radius: 10px; background: rgba(15,23,42,.72); padding: 8px 10px; font-size: 12px; color: #cbd5e1; }
.w4-invest-agent b { color: #e2e8f0; }
.w4-invest-row { display: flex; flex-direction: column; gap: 6px; }
.w4-invest-row label { font-size: 11px; color: #93a4c6; }
.w4-invest-row input { border: 1px solid #334155; border-radius: 10px; background: #0f172a; color: #e2e8f0; padding: 10px 11px; font-size: 14px; font-family: inherit; }
.w4-invest-hint { font-size: 11px; color: #67e8f9; }
.w4-invest-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 4px; }
.w4-invest-btn { border: 1px solid #334155; border-radius: 10px; background: #111827; color: #cbd5e1; padding: 8px 12px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: inherit; }
.w4-invest-btn.primary { border-color: rgba(99,102,241,.45); background: linear-gradient(135deg, rgba(99,102,241,.3), rgba(139,92,246,.25)); color: #e0e7ff; }
.w4-invest-btn:hover { filter: brightness(1.08); }
.w4-create-overlay { position: fixed; inset: 0; z-index: 1310; background: rgba(2,6,23,.72); backdrop-filter: blur(4px); display: none; }
.w4-create-overlay.open { display: block; }
.w4-create-modal { position: fixed; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 460px; max-width: calc(100vw - 24px); z-index: 1311; border: 1px solid #2a3e64; border-radius: 14px; background: linear-gradient(180deg,#0f182c,#0c1325); box-shadow: 0 26px 70px rgba(0,0,0,.5); display: none; }
.w4-create-modal.open { display: block; }
.w4-create-head { padding: 12px 14px; border-bottom: 1px solid #223557; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.w4-create-title { font-size: 15px; font-weight: 700; color: #e2e8f0; }
.w4-create-close { width: 28px; height: 28px; border-radius: 8px; border: 1px solid #334155; background: #111827; color: #cbd5e1; cursor: pointer; font-size: 16px; line-height: 1; }
.w4-create-close:hover { border-color: #64748b; }
.w4-create-body { padding: 14px; display: grid; gap: 9px; }
.w4-create-row { display: grid; gap: 5px; }
.w4-create-row label { font-size: 11px; color: #93a4c6; }
.w4-create-row input, .w4-create-row select { border: 1px solid #334155; border-radius: 10px; background: #0f172a; color: #e2e8f0; padding: 9px 10px; font-size: 13px; font-family: inherit; }
.w4-create-actions { display: flex; justify-content: flex-end; gap: 8px; margin-top: 4px; }
.w4-create-btn2 { border: 1px solid #334155; border-radius: 10px; background: #111827; color: #cbd5e1; padding: 8px 12px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: inherit; }
.w4-create-btn2.primary { border-color: rgba(20,184,166,.45); background: linear-gradient(135deg, rgba(20,184,166,.22), rgba(14,116,144,.22)); color: #ccfbf1; }
.w4c-task { border: 1px solid #2c3f66; border-radius: 9px; background: linear-gradient(160deg,#111a2f,#101a31); padding: 8px; box-shadow: inset 0 0 0 1px rgba(99,102,241,0.06); }
.w4c-task .t1 { font-size: 11px; font-weight: 700; color: #e2e8f0; }
.w4c-task .t2 { font-size: 10px; color: #9eb0d4; margin-top: 3px; line-height: 1.45; }
.w4c-task .t3 { font-size: 10px; color: #67e8f9; margin-top: 3px; }
.w4-flow-grid { display: grid; grid-template-columns: 1.25fr 0.75fr; gap: 12px; margin-bottom: 16px; }
.w4-discovery-metrics { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 10px; }
.w4-dm { border: 1px solid #223557; border-radius: 9px; background: #101a2d; padding: 8px; text-align: center; }
.w4-dm .v { color: #67e8f9; font-weight: 800; font-size: 13px; }
.w4-dm .l { color: #93a4c6; font-size: 10px; margin-top: 2px; }
.w4-waterfall-wrap { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }
.w4-waterfall-col { position: relative; border: 1px solid #223557; border-radius: 10px; background: linear-gradient(180deg,#0d1426,#0b1324); min-height: 240px; display: flex; flex-direction: column; overflow: hidden; }
.w4-waterfall-col::before { content: ''; position: absolute; inset: 0; background: linear-gradient(180deg, rgba(34,211,238,0.06), transparent 28%, transparent 72%, rgba(99,102,241,0.06)); pointer-events: none; }
.w4-waterfall-title { padding: 8px 10px; border-bottom: 1px solid #223557; font-size: 11px; color: #c7d2fe; font-weight: 700; }
.w4-waterfall-list { padding: 8px; display: flex; flex-direction: column; gap: 6px; max-height: 210px; overflow: hidden; }
.w4-waterfall-item { border: 1px solid #2c3f66; border-radius: 8px; background: linear-gradient(135deg,#111a2f,#0f1a31); padding: 6px 7px; font-size: 10px; color: #cbd5e1; line-height: 1.45; animation: w4ItemIn .28s ease; box-shadow: inset 0 0 0 1px rgba(99,102,241,0.08); }
.w4-waterfall-item b { color: #e2e8f0; }
.w4-waterfall-item.warn { border-color: rgba(245,158,11,0.4); }
.w4-waterfall-item.ok { border-color: rgba(34,197,94,0.35); }
.w4-waterfall-item.info { border-color: rgba(56,189,248,0.35); }
.w4-filter-chain { margin-top: 10px; display: flex; flex-wrap: wrap; align-items: center; gap: 7px; }
.w4-f-node { font-size: 10px; border: 1px solid #334155; border-radius: 999px; padding: 5px 9px; color: #dbeafe; background: rgba(30,41,59,0.8); }
.w4-f-arrow { color: #64748b; font-size: 11px; }
.w4-agent-detail { margin-bottom: 16px; }
.w4-stage-topbar { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 8px; }
.w4-stage-tabs { display: flex; gap: 6px; flex-wrap: wrap; margin-bottom: 10px; }
.w4-stage-topbar .w4-stage-tabs { margin-bottom: 0; }
.w4-create-btn { border: 1px solid rgba(20,184,166,.45); background: linear-gradient(135deg, rgba(20,184,166,.22), rgba(14,116,144,.22)); color: #ccfbf1; border-radius: 10px; padding: 7px 12px; font-size: 12px; font-weight: 700; cursor: pointer; font-family: inherit; white-space: nowrap; }
.w4-create-btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
.w4-stage-tab { font-size: 11px; border: 1px solid #2b3e63; background: #0f172a; color: #a5b4fc; border-radius: 999px; padding: 7px 11px; cursor: pointer; font-family: inherit; font-weight: 700; transition: all .16s ease; }
.w4-stage-tab:hover { border-color: #4f6fa6; color: #dbeafe; transform: translateY(-1px); }
.w4-stage-tab.active { background: linear-gradient(135deg, rgba(99,102,241,0.28), rgba(34,211,238,0.18)); border-color: rgba(99,102,241,0.55); color: #e2e8f0; box-shadow: 0 0 0 1px rgba(99,102,241,0.18); }
.w4-stage-guide { font-size: 12px; color: #93a4c6; background: #0f172a; border: 1px dashed #334155; border-radius: 9px; padding: 8px 10px; margin-bottom: 10px; line-height: 1.6; }
.w4-stage-panel { border: 1px solid #223557; border-radius: 12px; background: radial-gradient(circle at 80% 0%, rgba(34,211,238,0.08), transparent 38%), #0d1426; padding: 12px; }
.w4-stage-head { display: flex; justify-content: space-between; align-items: center; gap: 8px; margin-bottom: 8px; }
.w4-stage-head .n { color: #e2e8f0; font-size: 13px; font-weight: 700; }
.w4-stage-head .s { color: #67e8f9; font-size: 11px; font-weight: 700; }
.w4-stage-lines { display: flex; flex-direction: column; gap: 6px; margin-bottom: 8px; }
.w4-stage-line { border: 1px solid #2c3f66; border-radius: 8px; background: #111a2f; padding: 7px 8px; font-size: 11px; color: #9eb0d4; line-height: 1.5; }
.w4-stage-line b { color: #e2e8f0; }
.w4-stage-mesh { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 8px; }
.w4-stage-node { border: 1px solid #2c3f66; border-radius: 10px; background: linear-gradient(145deg,#121c34,#0f182d); padding: 9px; }
.w4-stage-node-name { font-size: 11px; color: #e2e8f0; font-weight: 700; display: flex; align-items: center; gap: 6px; }
.w4-stage-node-dot { width: 8px; height: 8px; border-radius: 50%; background: #22d3ee; box-shadow: 0 0 10px rgba(34,211,238,0.8); animation: w4Pulse 1.6s infinite; }
.w4-stage-node-meta { margin-top: 4px; font-size: 10px; color: #93a4c6; line-height: 1.5; }
.w4-stage-kpis { display: grid; grid-template-columns: repeat(3,1fr); gap: 6px; }
.w4-stage-kpi { border: 1px solid #2c3f66; border-radius: 8px; background: #111a2f; padding: 7px; text-align: center; }
.w4-stage-kpi .v { font-size: 13px; color: #e2e8f0; font-weight: 800; }
.w4-stage-kpi .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4-trade-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
.w4-trade-card { border: 1px solid #223557; border-radius: 12px; background: #0f172a; overflow: hidden; cursor: pointer; transition: border-color .15s ease, transform .15s ease; }
.w4-trade-card:hover { border-color: #4f6fa6; transform: translateY(-1px); }
.w4-trade-top { padding: 12px; border-bottom: 1px solid #223557; }
.w4-trade-name { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 700; color: #e2e8f0; }
.w4-trade-model { font-size: 10px; color: #a5b4fc; background: rgba(99,102,241,0.16); border: 1px solid rgba(99,102,241,0.38); border-radius: 8px; padding: 1px 6px; }
.w4-trade-desc { font-size: 11px; color: #9eb0d4; line-height: 1.6; margin-top: 6px; }
.w4-trade-tags { margin-top: 7px; display: flex; gap: 6px; flex-wrap: wrap; }
.w4-trade-tag { font-size: 10px; color: #c7d2fe; border: 1px solid rgba(99,102,241,0.3); background: rgba(99,102,241,0.12); border-radius: 999px; padding: 2px 7px; }
.w4-trade-metrics { display: grid; grid-template-columns: repeat(4,1fr); }
.w4-trade-metric { padding: 9px 6px; text-align: center; border-right: 1px solid #223557; }
.w4-trade-metric:last-child { border-right: none; }
.w4-trade-metric .v { font-size: 12px; font-weight: 700; color: #f8fafc; }
.w4-trade-metric .v.pos { color: #22c55e; }
.w4-trade-metric .v.neg { color: #ef4444; }
.w4-trade-metric .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4-trade-footer { display: flex; justify-content: space-between; align-items: center; padding: 9px 12px; border-top: 1px solid #223557; color: #94a3b8; font-size: 11px; }
.w4-trade-footer .a { color: #a5b4fc; font-weight: 700; }
.w4-stage-agents { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
.w4-stage-agent-chip { font-size: 10px; color: #c7d2fe; border: 1px solid rgba(99,102,241,0.3); background: rgba(99,102,241,0.12); border-radius: 999px; padding: 3px 8px; cursor: pointer; }
.w4-stage-agent-chip:hover { border-color: rgba(99,102,241,0.6); }
.w4c-risk { margin-top: 8px; display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; }
.w4c-risk-item { border: 1px solid #223557; border-radius: 10px; background: rgba(15,23,42,0.72); padding: 10px; text-align: center; }
.w4c-risk-item .v { font-size: 16px; font-weight: 800; color: #f8fafc; }
.w4c-risk-item .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4c-risk-item.warn .v { color: #f59e0b; }
.w4c-risk-item.danger .v { color: #ef4444; }
.w4c-risk-item.ok .v { color: #22c55e; }
.w4s-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 16px; }
.w4s-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
.w4s-title { font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
.w4-reg-row { display: grid; grid-template-columns: 1.2fr 0.7fr 0.8fr 0.7fr; gap: 8px; padding: 9px 10px; border: 1px solid #283b5f; border-radius: 9px; background: #0f182b; margin-bottom: 7px; align-items: center; cursor: pointer; transition: border-color .15s ease, transform .15s ease; }
.w4-reg-row:hover { border-color: #4f6fa6; transform: translateY(-1px); }
.w4-reg-row:last-child { margin-bottom: 0; }
.w4-reg-agent { font-size: 12px; color: #e2e8f0; font-weight: 700; }
.w4-reg-agent span { display: block; font-size: 10px; color: #94a3b8; font-weight: 500; margin-top: 2px; }
.w4-reg-cell { font-size: 11px; color: #cbd5e1; text-align: center; }
.w4-reg-chip { display: inline-flex; align-items: center; gap: 5px; padding: 3px 8px; border-radius: 999px; font-size: 10px; font-weight: 700; border: 1px solid rgba(34,197,94,0.35); color: #86efac; background: rgba(34,197,94,0.1); }
.w4-reg-chip::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: #22c55e; animation: ahPulse 1.6s infinite; }
.w4-evo-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 8px; }
.w4-evo-item { border: 1px solid #283b5f; border-radius: 10px; background: #0f182b; padding: 9px 10px; }
.w4-evo-name { font-size: 11px; color: #93a4c6; }
.w4-evo-main { margin-top: 4px; display: flex; align-items: baseline; gap: 6px; }
.w4-evo-score { font-size: 20px; line-height: 1; font-weight: 800; color: #e2e8f0; }
.w4-evo-delta { font-size: 11px; color: #22c55e; font-weight: 700; }
.w4-evo-note { margin-top: 5px; font-size: 10px; color: #9eb0d4; line-height: 1.4; }
.w4-evo-track { margin-top: 10px; border: 1px dashed #334155; border-radius: 9px; padding: 8px; font-size: 10px; color: #93a4c6; line-height: 1.6; }
.w4-train-log { margin-top: 10px; max-height: 110px; overflow: hidden; font-family: 'Courier New', monospace; font-size: 10px; color: #93a4c6; line-height: 1.6; border-top: 1px dashed #334155; padding-top: 8px; }
.w4-train-log .t-time { color: #64748b; }
.w4-train-log .t-up { color: #22c55e; }
.w4-train-log .t-note { color: #38bdf8; }
.w4d-overlay { display: none; position: fixed; inset: 0; z-index: 610; background: rgba(2,6,23,0.68); backdrop-filter: blur(4px); }
.w4d-overlay.open { display: block; }
.w4d-modal { display: none; position: fixed; left: 50%; top: 50%; transform: translate(-50%,-50%); width: 760px; max-width: 94vw; max-height: 86vh; overflow: auto; z-index: 611; border-radius: 14px; background: #0b1220; border: 1px solid #263a5f; box-shadow: 0 24px 80px rgba(0,0,0,0.5); }
.w4d-modal.open { display: block; }
.w4d-head { padding: 14px 16px; border-bottom: 1px solid #223557; display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.w4d-head-left { min-width: 0; }
.w4d-name { font-size: 17px; font-weight: 800; color: #e2e8f0; display: flex; align-items: center; gap: 8px; }
.w4d-role { font-size: 11px; color: #93a4c6; margin-top: 4px; }
.w4d-close { width: 30px; height: 30px; border-radius: 8px; border: 1px solid #334155; background: #111827; color: #cbd5e1; cursor: pointer; font-size: 16px; line-height: 1; }
.w4d-close:hover { border-color: #64748b; }
.w4d-body { padding: 14px 16px 16px; display: grid; gap: 10px; }
.w4d-desc { border: 1px solid #23344f; border-radius: 10px; background: #101a2d; padding: 10px; font-size: 12px; color: #cbd5e1; line-height: 1.65; }
.w4d-kpis { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; }
.w4d-kpi { border: 1px solid #23344f; border-radius: 9px; background: #101a2d; padding: 8px; text-align: center; }
.w4d-kpi .v { font-size: 15px; font-weight: 800; color: #e2e8f0; }
.w4d-kpi .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4d-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.w4d-card { border: 1px solid #23344f; border-radius: 10px; background: #101a2d; padding: 10px; }
.w4d-card-title { font-size: 12px; color: #e2e8f0; font-weight: 700; margin-bottom: 6px; }
.w4d-list { margin: 0; padding-left: 16px; color: #9eb0d4; font-size: 11px; line-height: 1.7; }
.w4d-list li { margin: 0; }
.w4d-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.w4d-view.active { display: block; }
.w4d-back { border: 1px solid #334155; border-radius: 8px; background: #111827; color: #cbd5e1; padding: 6px 12px; cursor: pointer; font-family: inherit; font-size: 12px; margin-bottom: 10px; }
.w4d-back:hover { border-color: #64748b; }
.w4d-top { border: 1px solid #223557; border-radius: 12px; background: #0d1426; padding: 14px; margin-bottom: 12px; }
.w4d-headline { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
.w4d-headline .name { font-size: 22px; font-weight: 800; color: #e2e8f0; }
.w4d-headline .role { font-size: 12px; color: #93a4c6; margin-top: 4px; }
.w4d-headline .stage { font-size: 11px; color: #a5b4fc; border: 1px solid rgba(99,102,241,0.35); background: rgba(99,102,241,0.12); border-radius: 999px; padding: 4px 9px; white-space: nowrap; }
.w4d-sub { margin-top: 10px; color: #cbd5e1; font-size: 13px; line-height: 1.7; }
.w4d-kpis2 { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-top: 10px; }
.w4d-kpi2 { border: 1px solid #223557; border-radius: 9px; background: #101a2d; padding: 9px; text-align: center; }
.w4d-kpi2 .v { font-size: 16px; font-weight: 800; color: #f8fafc; }
.w4d-kpi2 .l { font-size: 10px; color: #94a3b8; margin-top: 2px; }
.w4d-role-zone { display: grid; grid-template-columns: 1.25fr 0.75fr; gap: 12px; margin-bottom: 12px; }
.w4d-role-mainx, .w4d-role-sidex { border: 1px solid #223557; border-radius: 12px; background: linear-gradient(180deg,#0f182c,#0d1426); padding: 12px; }
.w4d-role-mainx .h { font-size: 14px; font-weight: 700; color: #e2e8f0; margin-bottom: 5px; }
.w4d-role-mainx .d { font-size: 12px; color: #9eb0d4; line-height: 1.6; margin-bottom: 10px; }
.w4d-role-kpisx { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 10px; }
.w4d-role-kpix { border: 1px solid #2a3e64; border-radius: 9px; background: rgba(15,23,42,.7); padding: 8px; text-align: center; }
.w4d-role-kpix .v { font-size: 14px; font-weight: 800; color: #e2e8f0; }
.w4d-role-kpix .l { font-size: 10px; color: #93a4c6; margin-top: 2px; }
.w4d-role-flowx { display: flex; flex-direction: column; gap: 6px; }
.w4d-role-flowx .i { font-size: 11px; color: #cbd5e1; border: 1px solid #2b4067; border-radius: 8px; background: rgba(15,23,42,.76); padding: 7px 8px; line-height: 1.5; }
.w4d-role-sidex .h { font-size: 12px; font-weight: 700; color: #c7d2fe; margin-bottom: 8px; }
.w4d-waterfallx { max-height: 212px; overflow: hidden; display: flex; flex-direction: column; gap: 6px; }
.w4d-waterfallx .it { border: 1px solid #2c3f66; border-radius: 8px; background: linear-gradient(145deg,#101a2d,#0f172a); padding: 7px 8px; font-size: 10px; color: #9eb0d4; line-height: 1.45; }
.w4d-waterfallx .it.ok { border-color: rgba(34,197,94,.4); color: #bbf7d0; }
.w4d-waterfallx .it.warn { border-color: rgba(245,158,11,.45); color: #fde68a; }
.w4d-main { display: grid; grid-template-columns: 1.3fr 0.7fr; gap: 12px; }
.w4d-panel { border: 1px solid #223557; border-radius: 12px; background: #0d1426; padding: 12px; }
.w4d-panel-title { font-size: 13px; font-weight: 700; color: #e2e8f0; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
.w4d-chart { height: 160px; border: 1px solid #23344f; border-radius: 10px; background: linear-gradient(180deg,#101a2d,#0f172a); padding: 8px; display: flex; gap: 4px; align-items: flex-end; }
.w4d-bar { flex: 1; border-radius: 4px 4px 2px 2px; min-width: 6px; }
.w4d-chart-foot { margin-top: 7px; font-size: 11px; color: #93a4c6; display: flex; justify-content: space-between; }
.w4d-action-log { border: 1px solid #23344f; border-radius: 10px; background: #101a2d; padding: 8px; max-height: 178px; overflow: hidden; font-family: 'Courier New', monospace; font-size: 10px; line-height: 1.65; color: #9eb0d4; }
.w4d-action-log .t { color: #64748b; }
.w4d-action-log .ok { color: #22c55e; }
.w4d-action-log .info { color: #38bdf8; }
.w4d-action-log .warn { color: #f59e0b; }
@keyframes w4ItemIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }

/* Web4 rectangle topology */
.w4-rect-wrap { background: linear-gradient(180deg,#0b1220 0%,#0a101c 100%); border: 1px solid #1f2e4a; border-radius: 14px; padding: 14px; margin-bottom: 12px; }
.w4-arch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; align-items: stretch; }
.w4-agent-box { background: #101a2f; border: 1px solid #2a3e64; border-radius: 10px; padding: 10px; }
.w4-agent-head { display:flex; align-items:center; justify-content:space-between; margin-bottom: 6px; }
.w4-agent-name { font-size: 12px; font-weight: 700; color: #e2e8f0; }
.w4-agent-role { font-size: 10px; color: #67e8f9; font-weight: 700; }
.w4-agent-line { font-size: 10px; color: #9eb0d4; line-height: 1.45; margin-top: 4px; }
.w4-agent-line b { color: #c7d2fe; font-weight: 700; }
.w4-core-box { grid-column: 2; grid-row: 2; background: radial-gradient(circle at 50% 40%, rgba(99,102,241,0.28), rgba(30,41,59,0.9)); border: 1px solid rgba(99,102,241,0.6); border-radius: 12px; padding: 16px 12px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 150px; box-shadow: 0 0 26px rgba(99,102,241,0.2); }
.w4-core-box .title { font-size: 16px; font-weight: 800; color: #e2e8f0; }
.w4-core-box .sub { font-size: 11px; color: #a5b4fc; margin-top: 4px; }
.w4-core-box .desc { font-size: 11px; color: #aab8d6; margin-top: 8px; line-height: 1.5; }
.w4-pipeline { margin-top: 10px; display:flex; flex-wrap:wrap; gap: 7px; align-items:center; justify-content:center; }
.w4-pipe-node { font-size: 10px; font-weight: 700; color: #dbeafe; border: 1px solid #334155; background: rgba(30,41,59,0.75); border-radius: 8px; padding: 6px 8px; }
.w4-pipe-arrow { color: #64748b; font-size: 12px; font-weight: 700; }
.w4-bottom { display:grid; grid-template-columns: 1.1fr 0.9fr; gap: 12px; margin-bottom: 18px; }
.w4-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
.w4-hub-grid { display: grid; grid-template-columns: 1.55fr 0.95fr; gap: 12px; margin-bottom: 18px; }
.w4-col-stack { display: flex; flex-direction: column; gap: 12px; min-width: 0; }
.w4-block-title { font-size: 13px; font-weight: 700; color: #c7d2fe; margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
.w4-ops-center { min-height: 100%; }
.w4-ops-center { border-radius: 14px; border-color: #274067; }
.w4-ops-tabs { display: flex; gap: 6px; margin-bottom: 10px; flex-wrap: wrap; }
.w4-ops-tab { font-size: 11px; border: 1px solid #2b3e63; background: #0f172a; color: #a5b4fc; border-radius: 999px; padding: 6px 10px; cursor: pointer; font-family: inherit; font-weight: 700; }
.w4-ops-tab.active { background: rgba(99,102,241,0.18); border-color: rgba(99,102,241,0.45); color: #e2e8f0; }
.w4-ops-panel { display: none; }
.w4-ops-panel.active { display: block; }
.w4-ops-note { font-size: 11px; color: #93a4c6; margin-bottom: 8px; }
.w4-reg-list { display: flex; flex-direction: column; gap: 7px; }
.ah-hero { text-align: center; padding: 40px 20px 32px; }
.ah-hero-badge { display: inline-flex; align-items: center; gap: 6px; background: linear-gradient(135deg, rgba(99,102,241,0.15), rgba(168,85,247,0.15)); border: 1px solid rgba(99,102,241,0.25); border-radius: 20px; padding: 5px 14px; font-size: 12px; font-weight: 600; color: #a78bfa; margin-bottom: 16px; }
.ah-hero h1 { font-size: 32px; font-weight: 800; color: var(--text); margin: 0 0 10px; letter-spacing: -0.5px; }
.ah-hero h1 span { background: linear-gradient(135deg, #6366f1, #a855f7, #ec4899); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
.ah-hero-sub { font-size: 15px; color: var(--text-muted); max-width: 600px; margin: 0 auto; line-height: 1.6; }
.ah-stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 28px; }
.ah-stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px 16px; text-align: center; }
.ah-stat-val { font-size: 22px; font-weight: 800; color: var(--text); }
.ah-stat-label { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.ah-section-title { font-size: 18px; font-weight: 700; color: var(--text); margin: 0 0 16px; display: flex; align-items: center; gap: 8px; }
.ah-role-matrix { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 26px; }
.ah-role-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px 14px 12px; }
.ah-role-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
.ah-role-name { font-size: 13px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 6px; }
.ah-role-count { font-size: 10px; font-weight: 700; color: #93c5fd; background: rgba(59,130,246,0.15); border: 1px solid rgba(59,130,246,0.25); border-radius: 10px; padding: 2px 7px; }
.ah-role-desc { font-size: 11px; color: var(--text-muted); line-height: 1.6; }
.ah-orch-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 18px; }
.ah-orch-card { background: linear-gradient(180deg,#0b1220 0%,#0a101c 100%); border: 1px solid #1f2e4a; border-radius: 12px; padding: 14px 14px 12px; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.01); }
.ah-orch-head { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
.ah-orch-icon { width: 26px; height: 26px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; color: #34d399; background: rgba(16,185,129,0.12); border: 1px solid rgba(16,185,129,0.28); }
.ah-orch-name { font-size: 14px; font-weight: 700; color: #e2e8f0; }
.ah-orch-desc { font-size: 12px; color: #93a4c6; line-height: 1.6; min-height: 54px; }
.ah-orch-tags { margin-top: 10px; display: flex; gap: 6px; flex-wrap: wrap; }
.ah-orch-tag { font-size: 10px; font-weight: 600; color: #cbd5e1; background: #101827; border: 1px solid #1e293b; border-radius: 999px; padding: 3px 8px; }
.ah-orch-flow { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-bottom: 16px; }
.ah-orch-node { font-size: 11px; font-weight: 700; color: #dbeafe; border: 1px solid #334155; background: rgba(30,41,59,0.75); border-radius: 8px; padding: 7px 10px; }
.ah-orch-arrow { color: #64748b; font-size: 12px; font-weight: 700; }
.ah-human-boundary { background: linear-gradient(135deg, rgba(99,102,241,0.1), rgba(34,211,238,0.08)); border: 1px solid rgba(99,102,241,0.28); border-radius: 12px; padding: 13px 14px; margin-bottom: 26px; }
.ah-human-title { font-size: 13px; font-weight: 700; color: #c7d2fe; margin-bottom: 6px; }
.ah-human-list { font-size: 12px; color: var(--text-dim); line-height: 1.8; }
.ah-agents-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; margin-bottom: 32px; }
.ah-agent-card { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; padding: 0; overflow: hidden; cursor: pointer; transition: all 0.2s; }
.ah-agent-card:hover { border-color: rgba(99,102,241,0.4); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
.ah-agent-top { padding: 20px 20px 16px; display: flex; gap: 14px; align-items: flex-start; }
.ah-agent-avatar { width: 52px; height: 52px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; flex-shrink: 0; }
.ah-agent-info { flex: 1; min-width: 0; }
.ah-agent-name { font-size: 16px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 8px; }
.ah-agent-model { font-size: 10px; font-weight: 600; padding: 2px 7px; border-radius: 4px; background: rgba(99,102,241,0.12); color: #818cf8; }
.ah-agent-strategy { font-size: 12px; color: var(--text-muted); margin-top: 4px; }
.ah-agent-desc { font-size: 13px; color: var(--text-dim); margin-top: 8px; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
.ah-agent-roles { margin-top: 8px; display: flex; gap: 6px; flex-wrap: wrap; }
.ah-agent-role-chip { font-size: 10px; font-weight: 600; color: #c7d2fe; background: rgba(99,102,241,0.12); border: 1px solid rgba(99,102,241,0.24); border-radius: 999px; padding: 2px 7px; }
.ah-agent-status { display: inline-flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 10px; margin-top: 8px; }
.ah-agent-status.funding { background: rgba(34,197,94,0.12); color: #22c55e; }
.ah-agent-status.funding::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: #22c55e; animation: ahPulse 1.5s infinite; }
.ah-agent-status.locked { background: rgba(245,158,11,0.12); color: #f59e0b; }
.ah-agent-status.settled { background: rgba(107,114,128,0.12); color: #9ca3af; }
@keyframes ahPulse { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }
.ah-agent-metrics { display: grid; grid-template-columns: repeat(4, 1fr); border-top: 1px solid var(--border); }
.ah-agent-metric { padding: 12px 8px; text-align: center; border-right: 1px solid var(--border); }
.ah-agent-metric:last-child { border-right: none; }
.ah-metric-val { font-size: 14px; font-weight: 700; color: var(--text); }
.ah-metric-val.positive { color: #22c55e; }
.ah-metric-val.negative { color: #ef4444; }
.ah-metric-label { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
.ah-agent-footer { display: flex; align-items: center; justify-content: space-between; padding: 12px 20px; border-top: 1px solid var(--border); background: rgba(255,255,255,0.02); }
.ah-agent-users { font-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 4px; }
.ah-agent-btn { padding: 7px 18px; border-radius: 8px; font-size: 13px; font-weight: 600; border: none; cursor: pointer; transition: all 0.15s; font-family: inherit; }
.ah-agent-btn.invest { background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; }
.ah-agent-btn.invest:hover { filter: brightness(1.1); transform: scale(1.02); }
.ah-agent-btn.view-detail { background: var(--surface2); color: var(--text); border: 1px solid var(--border); margin-right: 8px; }
.ah-agent-btn.view-detail:hover { border-color: var(--text-muted); }
/* Agent Detail Page */
.ah-detail-view { display: none; max-width: 1100px; margin: 0 auto; padding: 24px 20px 60px; }
.ah-detail-view.active { display: block; }
.ah-detail-header { display: flex; align-items: center; gap: 16px; padding: 0 0 20px; border-bottom: 1px solid var(--border); margin-bottom: 24px; }
.ah-detail-avatar { width: 60px; height: 60px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 30px; flex-shrink: 0; }
.ah-detail-hinfo { flex: 1; }
.ah-detail-hinfo h2 { font-size: 22px; font-weight: 700; color: var(--text); margin: 0; display: flex; align-items: center; gap: 8px; }
.ah-detail-hinfo p { font-size: 13px; color: var(--text-muted); margin: 4px 0 0; line-height: 1.5; }
.ah-detail-invest-btn { padding: 10px 24px; border-radius: 10px; font-size: 14px; font-weight: 700; border: none; cursor: pointer; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; font-family: inherit; transition: all 0.15s; white-space: nowrap; }
.ah-detail-invest-btn:hover { filter: brightness(1.1); }
/* Core KPIs - big */
.ah-kpi-row { display: flex; gap: 16px; margin-bottom: 16px; }
.ah-kpi-big { flex: 1; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px 16px; text-align: center; }
.ah-kpi-big .ah-kpi-val { font-size: 28px; font-weight: 800; }
.ah-kpi-big .ah-kpi-label { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
/* Secondary stats - compact */
.ah-kpi-row-sm { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; }
.ah-kpi-sm { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 10px 14px; display: flex; align-items: center; gap: 6px; }
.ah-kpi-sm .ah-kpi-sm-val { font-size: 13px; font-weight: 700; color: var(--text); }
.ah-kpi-sm .ah-kpi-sm-label { font-size: 11px; color: var(--text-muted); }
/* Asset Allocation */
.ah-alloc { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 18px 20px; margin-bottom: 20px; }
.ah-alloc-title { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 12px; display: flex; align-items: center; gap: 6px; }
.ah-alloc-bar { display: flex; height: 10px; border-radius: 5px; overflow: hidden; margin-bottom: 10px; }
.ah-alloc-bar div { transition: width 0.5s ease; }
.ah-alloc-legend { display: flex; gap: 16px; flex-wrap: wrap; }
.ah-alloc-legend-item { display: flex; align-items: center; gap: 5px; font-size: 11px; color: var(--text-dim); }
.ah-alloc-legend-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.ah-alloc-legend-pct { font-weight: 700; color: var(--text); margin-left: 2px; }
/* Live Terminal / Data Feed */
.ah-terminal { background: #0a0e14; border: 1px solid #1e293b; border-radius: 12px; overflow: hidden; margin-bottom: 20px; }
.ah-terminal-head { display: flex; align-items: center; gap: 8px; padding: 10px 16px; background: #111827; border-bottom: 1px solid #1e293b; }
.ah-terminal-dot { width: 8px; height: 8px; border-radius: 50%; }
.ah-terminal-title { font-size: 11px; font-weight: 700; color: #6366f1; text-transform: uppercase; letter-spacing: 1px; flex: 1; }
.ah-terminal-status { font-size: 10px; color: #22c55e; display: flex; align-items: center; gap: 4px; }
.ah-terminal-status::before { content: ''; width: 6px; height: 6px; border-radius: 50%; background: #22c55e; animation: ahPulse 1.5s infinite; }
.ah-terminal-body { height: 160px; overflow: hidden; position: relative; padding: 12px 16px; font-family: 'Courier New', monospace; font-size: 11px; line-height: 1.7; color: #94a3b8; }
.ah-terminal-body::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 40px; background: linear-gradient(transparent, #0a0e14); pointer-events: none; }
.ah-terminal-line { white-space: nowrap; overflow: hidden; animation: ahTermScroll 0.3s ease; }
.ah-terminal-line .t-time { color: #475569; }
.ah-terminal-line .t-ok { color: #22c55e; }
.ah-terminal-line .t-warn { color: #f59e0b; }
.ah-terminal-line .t-info { color: #6366f1; }
.ah-terminal-line .t-data { color: #38bdf8; }
@keyframes ahTermScroll { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
/* Invest in other agents */
.ah-agent-invest-item { display: flex; align-items: center; gap: 12px; padding: 12px 14px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 8px; }
.ah-agent-invest-item:last-child { margin-bottom: 0; }
.ah-agent-invest-avatar { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.ah-agent-invest-info { flex: 1; min-width: 0; }
.ah-agent-invest-name { font-size: 13px; font-weight: 600; color: var(--text); }
.ah-agent-invest-meta { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.ah-agent-invest-alloc { text-align: right; }
.ah-agent-invest-alloc-val { font-size: 14px; font-weight: 700; color: var(--text); }
.ah-agent-invest-alloc-label { font-size: 10px; color: var(--text-muted); }
.ah-detail-stats { display: grid; grid-template-columns: repeat(7, 1fr); gap: 12px; margin-bottom: 24px; }
.ah-detail-stat { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 12px; text-align: center; }
.ah-detail-stat .ah-stat-val { font-size: 18px; }
body.light .ah-terminal { background: #f8fafc; border-color: #e2e8f0; }
body.light .ah-terminal-head { background: #f1f5f9; border-color: #e2e8f0; }
body.light .ah-terminal-body { color: #475569; }
body.light .ah-terminal-body::after { background: linear-gradient(transparent, #f8fafc); }
.ah-detail-tabs { display: flex; gap: 4px; border-bottom: 1px solid var(--border); margin-bottom: 20px; }
.ah-detail-tab { padding: 10px 16px; font-size: 13px; font-weight: 600; color: var(--text-muted); cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; background: none; border-top: none; border-left: none; border-right: none; font-family: inherit; }
.ah-detail-tab.active { color: var(--text); border-bottom-color: #6366f1; }
.ah-detail-tab:hover:not(.active) { color: var(--text); }
.ah-detail-panel { display: none; }
.ah-detail-panel.active { display: block; }
/* Thinking Log */
.ah-log { display: flex; flex-direction: column; gap: 10px; max-height: 400px; overflow-y: auto; padding-right: 4px; }
.ah-log-item { display: flex; gap: 10px; padding: 10px 12px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; }
.ah-log-time { font-size: 11px; color: var(--text-muted); white-space: nowrap; flex-shrink: 0; min-width: 50px; padding-top: 1px; }
.ah-log-body { flex: 1; min-width: 0; }
.ah-log-action { font-size: 12px; font-weight: 600; margin-bottom: 3px; }
.ah-log-action.buy { color: #22c55e; }
.ah-log-action.sell { color: #ef4444; }
.ah-log-action.hedge { color: #f59e0b; }
.ah-log-action.analyze { color: #6366f1; }
.ah-log-action.create { color: #a855f7; }
.ah-log-action.settle { color: #06b6d4; }
.ah-log-text { font-size: 12px; color: var(--text-dim); line-height: 1.5; }
.ah-log-text strong { color: var(--text); font-weight: 600; }
/* Positions */
.ah-pos-table { width: 100%; border-collapse: collapse; }
.ah-pos-table th { font-size: 12px; font-weight: 600; color: var(--text-muted); text-align: left; padding: 8px 10px; border-bottom: 1px solid var(--border); }
.ah-pos-table td { font-size: 13px; color: var(--text); padding: 10px; border-bottom: 1px solid var(--border); }
.ah-pos-table tr:last-child td { border-bottom: none; }
.ah-pos-dir { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; }
.ah-pos-dir.yes { background: rgba(34,197,94,0.12); color: #22c55e; }
.ah-pos-dir.no { background: rgba(239,68,68,0.12); color: #ef4444; }
/* Vault / Invest */
.ah-vault-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
.ah-vault-title { font-size: 15px; font-weight: 700; color: var(--text); margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
.ah-vault-phases { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 18px; }
.ah-vault-phase { text-align: center; padding: 14px 10px; border-radius: 10px; border: 1px solid var(--border); }
.ah-vault-phase.current { border-color: rgba(99,102,241,0.4); background: rgba(99,102,241,0.06); }
.ah-vault-phase-icon { font-size: 20px; margin-bottom: 4px; }
.ah-vault-phase-name { font-size: 12px; font-weight: 700; color: var(--text); }
.ah-vault-phase-desc { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.ah-vault-info { display: flex; flex-direction: column; gap: 10px; margin-bottom: 18px; }
.ah-vault-row { display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
.ah-vault-row-key { color: var(--text-muted); }
.ah-vault-row-val { color: var(--text); font-weight: 600; }
.ah-invest-input-row { display: flex; gap: 8px; }
.ah-invest-input { flex: 1; padding: 12px 14px; border-radius: 10px; background: var(--surface2); border: 1px solid var(--border); color: var(--text); font-size: 14px; font-family: inherit; outline: none; transition: border-color 0.15s; }
.ah-invest-input:focus { border-color: #6366f1; }
.ah-invest-submit { padding: 12px 24px; border-radius: 10px; font-size: 14px; font-weight: 700; border: none; cursor: pointer; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; font-family: inherit; transition: all 0.15s; }
.ah-invest-submit:hover { filter: brightness(1.1); }
/* Research — Sci-Fi Terminal Style */
.ah-research { display: flex; flex-direction: column; gap: 16px; }
.ah-r-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
.ah-r-card-head { padding: 12px 16px; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; background: rgba(99,102,241,0.04); }
.ah-r-card-head .ah-r-icon { width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
.ah-r-card-head h4 { font-size: 13px; font-weight: 700; color: var(--text); margin: 0; flex: 1; }
.ah-r-card-head .ah-r-tag { font-size: 10px; font-weight: 600; padding: 2px 8px; border-radius: 4px; }
.ah-r-card-body { padding: 16px; font-size: 12px; color: var(--text-dim); line-height: 1.7; }
.ah-r-card-body strong { color: var(--text); }
.ah-r-hl { color: #22c55e; font-weight: 700; }
.ah-r-warn { color: #f59e0b; font-weight: 700; }
.ah-r-red { color: #ef4444; font-weight: 700; }
.ah-r-meter { height: 6px; border-radius: 3px; background: var(--surface3); margin: 6px 0; overflow: hidden; }
.ah-r-meter-fill { height: 100%; border-radius: 3px; transition: width 0.5s ease; }
.ah-r-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
.ah-r-grid-item { background: var(--surface2); border-radius: 8px; padding: 10px 12px; }
.ah-r-grid-item .ah-r-gi-label { font-size: 10px; color: var(--text-muted); }
.ah-r-grid-item .ah-r-gi-val { font-size: 16px; font-weight: 700; color: var(--text); margin-top: 2px; }
.ah-r-signal { display: inline-flex; align-items: center; gap: 4px; padding: 3px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; }
.ah-r-signal.bullish { background: rgba(34,197,94,0.1); color: #22c55e; }
.ah-r-signal.bearish { background: rgba(239,68,68,0.1); color: #ef4444; }
.ah-r-signal.neutral { background: rgba(245,158,11,0.1); color: #f59e0b; }
.ah-cap-panel { display: grid; grid-template-columns: 1.15fr 0.85fr; gap: 12px; }
.ah-cap-main, .ah-cap-side { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
.ah-cap-title { font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 8px; display: flex; align-items: center; gap: 6px; }
.ah-cap-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; }
.ah-cap-tag { font-size: 11px; color: #c7d2fe; border: 1px solid rgba(99,102,241,0.28); background: rgba(99,102,241,0.12); border-radius: 999px; padding: 3px 10px; }
.ah-cap-flow { display: flex; flex-direction: column; gap: 7px; }
.ah-cap-step { font-size: 12px; color: var(--text-dim); line-height: 1.5; padding: 8px 10px; border-radius: 8px; background: var(--surface2); border-left: 3px solid #6366f1; }
.ah-cap-rev { display: flex; flex-direction: column; gap: 7px; }
.ah-cap-rev-item { font-size: 12px; color: var(--text-dim); background: var(--surface2); border-radius: 8px; padding: 8px 10px; }
.ah-cap-rev-item strong { color: var(--text); }
.ah-cap-auto { display: flex; flex-direction: column; gap: 7px; margin-top: 10px; }
.ah-cap-auto-item { font-size: 12px; color: var(--text-dim); line-height: 1.5; padding: 8px 10px; border-radius: 8px; background: rgba(6,182,212,0.08); border: 1px solid rgba(6,182,212,0.2); }
.ah-cap-human { margin-top: 10px; padding: 10px; border-radius: 8px; background: rgba(99,102,241,0.08); border: 1px solid rgba(99,102,241,0.2); font-size: 12px; color: var(--text-dim); line-height: 1.6; }
.ah-cap-metrics { margin-top: 10px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; }
.ah-cap-metric { text-align: center; padding: 10px 8px; border-radius: 8px; border: 1px solid var(--border); background: rgba(255,255,255,0.02); }
.ah-cap-metric .v { font-size: 14px; font-weight: 700; color: var(--text); }
.ah-cap-metric .l { font-size: 10px; color: var(--text-muted); margin-top: 2px; }
/* Agent Created Markets */
.ah-created-market { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: all 0.15s; }
.ah-created-market:hover { border-color: rgba(99,102,241,0.4); }
.ah-created-market:last-child { margin-bottom: 0; }
.ah-cm-emoji { font-size: 22px; flex-shrink: 0; }
.ah-cm-info { flex: 1; min-width: 0; }
.ah-cm-title { font-size: 13px; font-weight: 600; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.ah-cm-meta { font-size: 11px; color: var(--text-muted); margin-top: 3px; display: flex; gap: 10px; flex-wrap: wrap; }
.ah-cm-reason { font-size: 11px; color: var(--text-dim); margin-top: 4px; padding: 4px 8px; background: rgba(99,102,241,0.06); border-radius: 4px; border-left: 2px solid #6366f1; }
.ah-cm-profit { text-align: right; flex-shrink: 0; }
.ah-cm-profit-val { font-size: 14px; font-weight: 700; }
.ah-cm-profit-label { font-size: 10px; color: var(--text-muted); }
/* Heatmap Matrix (replaces radar) */
.ah-heatmap { width: 100%; border-collapse: separate; border-spacing: 3px; }
.ah-heatmap th { font-size: 11px; font-weight: 600; color: var(--text-muted); padding: 8px 6px; text-align: center; }
.ah-heatmap th:first-child { text-align: left; min-width: 120px; }
.ah-heatmap td { text-align: center; padding: 10px 6px; border-radius: 8px; font-size: 12px; font-weight: 700; transition: transform 0.15s; cursor: default; }
.ah-heatmap td:hover { transform: scale(1.08); }
.ah-heatmap td:first-child { text-align: left; font-weight: 600; color: var(--text); background: none !important; font-size: 12px; }
.ah-heatmap .ah-hm-agent { display: flex; align-items: center; gap: 6px; }
.ah-heatmap .ah-hm-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
/* Discovery role capability center */
.dr-cap-wrap { margin-top: 16px; background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 14px; }
.dr-role-tabs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
.dr-role-tab { border: 1px solid #2a3f63; background: linear-gradient(180deg, rgba(20,28,44,.7), rgba(14,20,32,.7)); border-radius: 10px; padding: 10px 10px; cursor: pointer; transition: all .16s; }
.dr-role-tab:hover { transform: translateY(-1px); border-color: #3b5a8f; }
.dr-role-tab.active { border-color: rgba(56,189,248,.5); box-shadow: inset 0 0 0 1px rgba(56,189,248,.25); }
.dr-role-tab.listing.active { border-color: rgba(99,102,241,.6); box-shadow: inset 0 0 0 1px rgba(99,102,241,.28); }
.dr-role-tab.verify.active { border-color: rgba(14,165,233,.6); box-shadow: inset 0 0 0 1px rgba(14,165,233,.28); }
.dr-role-tab.lp.active { border-color: rgba(16,185,129,.6); box-shadow: inset 0 0 0 1px rgba(16,185,129,.28); }
.dr-role-tab.settlement.active { border-color: rgba(245,158,11,.65); box-shadow: inset 0 0 0 1px rgba(245,158,11,.3); }
.dr-role-head { display: flex; align-items: center; gap: 7px; }
.dr-role-icon { width: 24px; height: 24px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 13px; }
.dr-role-name { font-size: 12px; font-weight: 700; color: #dbeafe; }
.dr-role-sub { margin-top: 3px; font-size: 10px; color: #8ea2c6; line-height: 1.35; min-height: 28px; }
.dr-role-main { border: 1px solid #293c5e; border-radius: 12px; background: linear-gradient(160deg, rgba(17,24,39,.92), rgba(12,18,32,.92)); padding: 12px; }
.dr-role-title { font-size: 14px; font-weight: 700; color: #e2e8f0; margin-bottom: 2px; }
.dr-role-desc { font-size: 12px; color: #93a8ca; line-height: 1.6; margin-bottom: 10px; }
.dr-role-kpis { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 10px; }
.dr-role-kpi { background: rgba(15,23,42,.66); border: 1px solid #2c4167; border-radius: 8px; padding: 8px 7px; text-align: center; }
.dr-role-kpi .v { font-size: 15px; font-weight: 800; color: #e2e8f0; }
.dr-role-kpi .l { margin-top: 1px; font-size: 10px; color: #93a8ca; }
.dr-role-effects { display: flex; gap: 6px; flex-wrap: wrap; }
.dr-eff { font-size: 10px; padding: 3px 9px; border-radius: 999px; border: 1px solid #2e4369; background: rgba(15,23,42,.72); color: #bfdbfe; }
.dr-role-flow { margin-top: 10px; font-size: 11px; color: #9fb1ce; line-height: 1.6; border-top: 1px dashed #2b4168; padding-top: 8px; }
/* Ops Agent detail (Listing/Verify/LP/Governance) */
.oa-detail-view { display: none; max-width: 1180px; margin: 0 auto; padding: 24px 20px 60px; }
.oa-detail-view.active { display: block; }
.oa-head { display: flex; align-items: center; gap: 14px; margin-bottom: 12px; }
.oa-avatar { width: 58px; height: 58px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 30px; border: 1px solid rgba(148,163,184,.35); box-shadow: 0 10px 24px rgba(0,0,0,.2); }
.oa-head-main { flex: 1; min-width: 0; }
.oa-name { font-size: 23px; font-weight: 800; color: var(--text); display: flex; align-items: center; gap: 8px; }
.oa-model { font-size: 10px; font-weight: 700; color: #dbeafe; border: 1px solid #334155; background: rgba(30,41,59,.72); border-radius: 999px; padding: 2px 8px; }
.oa-sub { margin-top: 3px; font-size: 13px; color: var(--text-muted); }
.oa-invest-btn { border: 1px solid rgba(99,102,241,.4); background: linear-gradient(135deg, rgba(99,102,241,.25), rgba(139,92,246,.2)); color: #e0e7ff; border-radius: 10px; padding: 10px 16px; font-size: 13px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all .15s; }
.oa-invest-btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
.oa-kpis { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; margin-bottom: 10px; }
.oa-kpi { background: var(--surface); border: 1px solid var(--border); border-radius: 10px; padding: 14px 12px; text-align: center; }
.oa-kpi .v { font-size: 22px; font-weight: 800; color: var(--text); }
.oa-kpi .l { margin-top: 3px; font-size: 11px; color: var(--text-muted); }
.oa-kpis-sm { display: grid; grid-template-columns: repeat(4,1fr); gap: 8px; margin-bottom: 12px; }
.oa-kpi-sm { background: rgba(15,23,42,.7); border: 1px solid #2b3d63; border-radius: 9px; padding: 9px 10px; text-align: center; }
.oa-kpi-sm .v { font-size: 14px; font-weight: 800; color: #e2e8f0; }
.oa-kpi-sm .l { margin-top: 1px; font-size: 10px; color: #8ea3c7; }
.oa-alloc { background: linear-gradient(180deg, rgba(11,18,32,.88), rgba(10,16,28,.84)); border: 1px solid #223557; border-radius: 12px; padding: 12px; margin-bottom: 12px; }
.oa-alloc-title { font-size: 12px; font-weight: 700; color: #dbeafe; margin-bottom: 8px; }
.oa-alloc-bar { height: 10px; border-radius: 999px; border: 1px solid #2b3d63; background: rgba(15,23,42,.8); overflow: hidden; display: flex; }
.oa-alloc-bar span { height: 100%; }
.oa-alloc-legend { margin-top: 8px; display: flex; gap: 8px; flex-wrap: wrap; }
.oa-alloc-item { font-size: 10px; color: #a7b9d9; border: 1px solid #31476e; background: rgba(15,23,42,.7); border-radius: 999px; padding: 3px 8px; display: inline-flex; align-items: center; gap: 5px; }
.oa-alloc-dot { width: 7px; height: 7px; border-radius: 50%; }
.oa-main { display: grid; grid-template-columns: 1.2fr .8fr; gap: 12px; }
.oa-panel { background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(10,16,28,.85)); border: 1px solid #1f2e4a; border-radius: 12px; overflow: hidden; }
.oa-panel-title { padding: 10px 12px; border-bottom: 1px solid #223557; font-size: 12px; font-weight: 700; color: #cbd5e1; }
.oa-flow-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 8px; padding: 10px; }
.oa-flow-col { border: 1px solid #20314f; border-radius: 10px; background: rgba(15,23,42,.68); min-height: 210px; }
.oa-flow-col .h { padding: 8px 10px; border-bottom: 1px solid #223557; font-size: 11px; font-weight: 700; color: #9fb2d3; }
.oa-flow-list { padding: 8px; display: flex; flex-direction: column; gap: 6px; max-height: 174px; overflow: hidden; }
.oa-flow-item { font-size: 11px; color: #9fb2d3; border: 1px solid #2a3d63; background: rgba(15,23,42,.8); border-radius: 8px; padding: 7px 8px; line-height: 1.45; }
.oa-flow-item.ok { border-color: rgba(34,197,94,.44); color: #bbf7d0; background: rgba(34,197,94,.1); }
.oa-flow-item.warn { border-color: rgba(245,158,11,.48); color: #fde68a; background: rgba(245,158,11,.11); }
.oa-log { margin: 0 10px 10px; border: 1px solid #20314f; border-radius: 10px; background: rgba(10,14,20,.86); overflow: hidden; }
.oa-log-head { padding: 8px 10px; border-bottom: 1px solid #223557; font-size: 11px; font-weight: 700; color: #67e8f9; }
.oa-log-body { height: 144px; overflow: hidden; padding: 8px 10px; font-family: 'Courier New', monospace; }
.oa-log-line { font-size: 11px; color: #94a3b8; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.oa-log-line .t { color: #64748b; margin-right: 6px; }
.oa-log-line .ok { color: #22c55e; }
.oa-log-line .warn { color: #f59e0b; }
.oa-log-line .info { color: #60a5fa; }
.oa-tabs { display: flex; gap: 4px; border-bottom: 1px solid #223557; padding: 0 10px; margin-top: 2px; }
.oa-tab { padding: 9px 12px; font-size: 12px; font-weight: 700; color: #8ea2c5; cursor: pointer; border-bottom: 2px solid transparent; }
.oa-tab.active { color: #dbeafe; border-bottom-color: #6366f1; }
.oa-panel-body { padding: 10px; font-size: 12px; color: #9fb2d3; line-height: 1.6; min-height: 148px; }
/* Discovery Agent Detail (data waterfall style) */
.da-detail-view { display: none; max-width: 1200px; margin: 0 auto; padding: 24px 20px 60px; }
.da-detail-view.active { display: block; }
.da-head { display: flex; align-items: center; gap: 14px; margin-bottom: 14px; }
.da-avatar { width: 58px; height: 58px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 30px; border: 1px solid rgba(148,163,184,.32); box-shadow: 0 8px 20px rgba(0,0,0,.2); }
.da-head-main { flex: 1; min-width: 0; }
.da-head-title { font-size: 22px; font-weight: 800; color: var(--text); display: flex; align-items: center; gap: 8px; }
.da-model { font-size: 10px; font-weight: 700; color: #67e8f9; border: 1px solid rgba(34,211,238,.35); background: rgba(34,211,238,.12); border-radius: 999px; padding: 2px 8px; }
.da-sub { font-size: 13px; color: var(--text-muted); margin-top: 3px; }
.da-invest-btn { border: 1px solid rgba(20,184,166,.4); background: linear-gradient(135deg, rgba(20,184,166,.24), rgba(14,116,144,.24)); color: #ccfbf1; border-radius: 10px; padding: 10px 16px; font-size: 13px; font-weight: 700; cursor: pointer; font-family: inherit; transition: all .15s; }
.da-invest-btn:hover { filter: brightness(1.08); transform: translateY(-1px); }
.da-kpis { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 12px; }
.da-kpi { background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(10,16,28,.85)); border: 1px solid #223557; border-radius: 10px; padding: 12px 10px; }
.da-kpi .v { font-size: 18px; font-weight: 800; color: #e2e8f0; }
.da-kpi .v.ok { color: #22c55e; }
.da-kpi .v.warn { color: #f59e0b; }
.da-kpi .l { margin-top: 2px; font-size: 11px; color: #8fa3c7; }
.da-hud { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
.da-hud-card { background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(10,16,28,.85)); border: 1px solid #20314f; border-radius: 10px; padding: 10px; }
.da-hud-title { font-size: 10px; color: #89a0c7; text-transform: uppercase; letter-spacing: .06em; margin-bottom: 8px; }
.da-hud-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
.da-hud-item { border: 1px solid #2a3d63; background: rgba(15,23,42,.72); border-radius: 8px; padding: 8px 6px; text-align: center; }
.da-hud-item .v { font-size: 14px; font-weight: 800; color: #e2e8f0; }
.da-hud-item .l { margin-top: 2px; font-size: 10px; color: #8fa3c7; }
.da-hud-bars { display: flex; flex-direction: column; gap: 8px; }
.da-hud-bar-row { display: grid; grid-template-columns: 70px 1fr 42px; gap: 8px; align-items: center; }
.da-hud-bar-row .k { font-size: 10px; color: #9fb2d3; }
.da-hud-bar-row .p { font-size: 10px; color: #9fb2d3; text-align: right; }
.da-hud-bar { height: 7px; border-radius: 999px; border: 1px solid #2a3d63; background: rgba(15,23,42,.8); overflow: hidden; }
.da-hud-bar-fill { height: 100%; border-radius: inherit; transition: width .35s ease; }
.da-grid { display: grid; grid-template-columns: 1.2fr .8fr; gap: 12px; }
.da-panel { background: linear-gradient(180deg, rgba(11,18,32,.9), rgba(10,16,28,.85)); border: 1px solid #1f2e4a; border-radius: 12px; overflow: hidden; }
.da-panel-title { padding: 10px 12px; border-bottom: 1px solid #223557; font-size: 12px; font-weight: 700; color: #cbd5e1; letter-spacing: .02em; }
.da-signal-hub { margin: 10px 10px 0; border: 1px solid #20314f; border-radius: 10px; padding: 10px; background: radial-gradient(circle at 50% 50%, rgba(20,184,166,.12), rgba(15,23,42,.82) 62%); position: relative; overflow: hidden; min-height: 92px; }
.da-signal-hub::after { content: ''; position: absolute; inset: 0; background: linear-gradient(110deg, transparent 0%, rgba(56,189,248,.08) 40%, transparent 70%); animation: daSweep 3.8s linear infinite; pointer-events: none; }
.da-signal-core { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 54px; height: 54px; border-radius: 50%; border: 1px solid rgba(94,234,212,.5); box-shadow: 0 0 22px rgba(20,184,166,.45), inset 0 0 20px rgba(20,184,166,.25); background: radial-gradient(circle, rgba(153,246,228,.3), rgba(13,148,136,.1)); display: flex; align-items: center; justify-content: center; font-size: 11px; color: #99f6e4; font-weight: 700; z-index: 2; animation: daPulse 2s ease-in-out infinite; }
.da-rails { position: relative; z-index: 1; display: grid; gap: 8px; margin-right: 70px; }
.da-rail { position: relative; height: 16px; border-radius: 999px; border: 1px solid #2b4067; background: linear-gradient(90deg, rgba(15,23,42,.4), rgba(30,41,59,.75)); overflow: hidden; }
.da-rail::before { content: ''; position: absolute; top: 1px; bottom: 1px; width: 58px; border-radius: 999px; filter: blur(.2px); animation: daMove 2.4s linear infinite; }
.da-rail.social::before { background: linear-gradient(90deg, rgba(56,189,248,.05), rgba(56,189,248,.88), rgba(56,189,248,.05)); }
.da-rail.news::before { background: linear-gradient(90deg, rgba(99,102,241,.05), rgba(99,102,241,.86), rgba(99,102,241,.05)); animation-delay: -.8s; }
.da-rail.onchain::before { background: linear-gradient(90deg, rgba(34,197,94,.05), rgba(34,197,94,.86), rgba(34,197,94,.05)); animation-delay: -1.4s; }
.da-legend { display: flex; gap: 8px; flex-wrap: wrap; margin: 9px 10px 0; }
.da-legend-item { font-size: 10px; color: #b9c8e2; border: 1px solid #33496f; background: rgba(15,23,42,.8); border-radius: 999px; padding: 3px 8px; display: inline-flex; align-items: center; gap: 5px; }
.da-legend-dot { width: 7px; height: 7px; border-radius: 50%; }
.da-waterfall { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; padding: 10px; }
.da-flow-col { border: 1px solid #20314f; border-radius: 10px; background: rgba(15,23,42,.68); min-height: 238px; display: flex; flex-direction: column; }
.da-flow-col .h { padding: 8px 10px; border-bottom: 1px solid #223557; font-size: 11px; font-weight: 700; color: #9fb2d3; }
.da-flow-col .h .n { float: right; font-size: 10px; color: #67e8f9; }
.da-flow-list { flex: 1; overflow: hidden; padding: 8px; display: flex; flex-direction: column; gap: 6px; }
.da-flow-item { font-size: 11px; color: #9fb2d3; border: 1px solid #2a3d63; background: rgba(15,23,42,.8); border-radius: 8px; padding: 7px 8px; line-height: 1.45; }
.da-flow-item.src-social { border-color: rgba(56,189,248,.4); box-shadow: inset 0 0 10px rgba(56,189,248,.1); }
.da-flow-item.src-news { border-color: rgba(99,102,241,.4); box-shadow: inset 0 0 10px rgba(99,102,241,.1); }
.da-flow-item.src-onchain { border-color: rgba(34,197,94,.4); box-shadow: inset 0 0 10px rgba(34,197,94,.1); }
.da-flow-item.ok { border-color: rgba(34,197,94,.42); color: #bbf7d0; background: rgba(34,197,94,.1); }
.da-flow-item.warn { border-color: rgba(245,158,11,.45); color: #fde68a; background: rgba(245,158,11,.1); }
.da-log { margin: 0 10px 10px; border: 1px solid #20314f; border-radius: 10px; background: rgba(10,14,20,.86); overflow: hidden; }
.da-log-head { padding: 8px 10px; border-bottom: 1px solid #223557; font-size: 11px; font-weight: 700; color: #67e8f9; }
.da-log-body { height: 146px; overflow: hidden; padding: 8px 10px; font-family: 'Courier New', monospace; }
.da-log-line { font-size: 11px; color: #94a3b8; margin-bottom: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.da-log-line .t { color: #64748b; margin-right: 6px; }
.da-log-line .ok { color: #22c55e; }
.da-log-line .warn { color: #f59e0b; }
.da-log-line .info { color: #60a5fa; }
.da-side { padding: 10px; display: flex; flex-direction: column; gap: 10px; }
.da-card { border: 1px solid #20314f; border-radius: 10px; background: rgba(15,23,42,.68); padding: 10px; }
.da-card .h { font-size: 11px; font-weight: 700; color: #9fb2d3; margin-bottom: 8px; }
.da-chip-wrap { display: flex; flex-wrap: wrap; gap: 6px; }
.da-chip { font-size: 10px; color: #dbeafe; border: 1px solid #334155; background: rgba(30,41,59,.72); border-radius: 999px; padding: 3px 8px; }
@keyframes daPulse { 0%,100% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.08); } }
@keyframes daMove { 0% { left: -60px; } 100% { left: calc(100% + 8px); } }
@keyframes daSweep { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
@media (max-width: 768px) {
  .ah-role-matrix { grid-template-columns: 1fr; }
  .ah-orch-grid { grid-template-columns: 1fr; }
  .ah-agents-grid { grid-template-columns: 1fr; }
  .ah-stats { grid-template-columns: repeat(2, 1fr); }
  .dr-role-tabs { grid-template-columns: repeat(2, 1fr); }
  .dr-role-kpis { grid-template-columns: repeat(2, 1fr); }
  .oa-kpis { grid-template-columns: 1fr; }
  .oa-kpis-sm { grid-template-columns: repeat(2,1fr); }
  .oa-main { grid-template-columns: 1fr; }
  .oa-flow-grid { grid-template-columns: 1fr; }
  .da-kpis { grid-template-columns: repeat(2,1fr); }
  .da-hud { grid-template-columns: 1fr; }
  .da-hud-grid { grid-template-columns: repeat(2, 1fr); }
  .da-grid { grid-template-columns: 1fr; }
  .da-signal-core { position: static; transform: none; margin: 8px auto 2px; }
  .da-rails { margin-right: 0; }
  .da-waterfall { grid-template-columns: 1fr; }
  .w4-hive-shell { grid-template-columns: 1fr; }
  .w4-grid2 { grid-template-columns: 1fr; }
  .w4-res-growth-row { grid-template-columns: 1fr; }
  .w4-hive-wrap { min-height: 460px; }
  .w4-hex { width: 122px; height: 106px; padding: 11px 10px; }
  .w4-hex.p2, .w4-hex.p3 { right: 22px; }
  .w4-hex.p5, .w4-hex.p6 { left: 22px; }
  .w4-link { width: 122px; }
  .w4-arch-grid { grid-template-columns: 1fr; }
  .w4-core-box { grid-column: auto; grid-row: auto; }
  .w4-bottom { grid-template-columns: 1fr; }
  .w4-growth-kpis { grid-template-columns: repeat(2,1fr); }
  .w4c-grid { grid-template-columns: 1fr; }
  .w4c-side { position: static; max-height: none; overflow: visible; }
  .w4-hub-grid { grid-template-columns: 1fr; }
  .w4c-kpis { grid-template-columns: repeat(2,1fr); }
  .w4c-risk { grid-template-columns: 1fr; }
  .w4-flow-grid { grid-template-columns: 1fr; }
  .w4-discovery-metrics { grid-template-columns: repeat(2,1fr); }
  .w4-waterfall-wrap { grid-template-columns: 1fr; }
  .w4-stage-kpis { grid-template-columns: 1fr; }
  .w4-trade-grid { grid-template-columns: 1fr; }
  .w4-trade-metrics { grid-template-columns: repeat(2,1fr); }
  .w4-evo-grid { grid-template-columns: 1fr; }
  .w4-ops-tabs { flex-wrap: wrap; }
  .w4d-kpis2 { grid-template-columns: repeat(2,1fr); }
  .w4d-role-zone { grid-template-columns: 1fr; }
  .w4d-role-kpisx { grid-template-columns: repeat(2,1fr); }
  .w4d-main { grid-template-columns: 1fr; }
  .w4d-kpis { grid-template-columns: repeat(2,1fr); }
  .w4d-grid { grid-template-columns: 1fr; }
  .w4s-grid { grid-template-columns: 1fr; }
  .w4-reg-row { grid-template-columns: 1fr; gap: 6px; }
  .ah-cap-panel { grid-template-columns: 1fr; }
  .ah-cap-metrics { grid-template-columns: 1fr; }
  .ah-detail-stats { grid-template-columns: repeat(3, 1fr); }
}
body.light .ah-agent-card:hover { box-shadow: 0 8px 24px rgba(0,0,0,0.08); }
body.light .ah-r-card { border-color: #e5e7eb; }
body.light .ah-r-card-head { background: rgba(99,102,241,0.03); }
body.light .ah-heatmap td { border-radius: 8px; }

/* ── SHARE MODAL ─────────────────────────────── */
/* ── QUICK ORDER MODAL ── */
.order-overlay { display: none; position: fixed; inset: 0; z-index: 550; background: rgba(0,0,0,0.55); backdrop-filter: blur(4px); justify-content: center; align-items: center; }
.order-overlay.open { display: flex; }
.order-modal { background: var(--surface); border: 1px solid var(--border); border-radius: 14px; width: 380px; max-width: 92vw; overflow: hidden; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }
.order-modal-header { display: flex; align-items: center; justify-content: space-between; padding: 16px 20px 12px; border-bottom: 1px solid var(--border); }
.order-modal-title { font-size: 15px; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 8px; }
.order-modal-title .order-emoji { font-size: 18px; }
.order-modal-close { background: none; border: none; color: var(--text-muted); font-size: 18px; cursor: pointer; padding: 4px; border-radius: 6px; transition: all 0.15s; }
.order-modal-close:hover { color: var(--text); background: var(--surface2); }
.order-modal-body { padding: 16px 20px 20px; display: flex; flex-direction: column; gap: 14px; }
.order-option-label { font-size: 13px; color: var(--text-muted); }
.order-option-name { font-size: 15px; font-weight: 600; color: var(--text); margin-top: 2px; display: flex; align-items: center; gap: 6px; }
.order-option-select { position: relative; }
.order-option-select.has-dropdown { cursor: pointer; }
.order-option-arrow { font-size: 10px; color: var(--text-muted); transition: transform 0.2s; }
.order-option-select.open .order-option-arrow { transform: rotate(180deg); }
.order-option-dropdown { position: absolute; top: calc(100% + 6px); left: 0; right: 0; background: var(--surface2); border: 1px solid var(--border); border-radius: 10px; padding: 4px; z-index: 10; display: none; max-height: 220px; overflow-y: auto; }
.order-option-select.open .order-option-dropdown { display: block; }
.order-option-item { display: flex; justify-content: space-between; align-items: center; padding: 9px 12px; border-radius: 7px; cursor: pointer; transition: background 0.15s; font-size: 13px; }
.order-option-item:hover { background: var(--surface3); }
.order-option-item.active { background: var(--surface4); }
.order-option-item-name { color: var(--text); font-weight: 500; }
.order-option-item-pct { color: var(--text-muted); font-size: 12px; }
.order-tabs { display: grid; grid-template-columns: 1fr 1fr; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 3px; gap: 3px; }
.order-tab { padding: 8px 0; text-align: center; font-size: 14px; font-weight: 500; color: var(--text-muted); cursor: pointer; border-radius: 6px; transition: all 0.15s; background: none; border: none; font-family: inherit; }
.order-tab.active { background: var(--surface4); color: var(--text); }
.order-tab:hover:not(.active) { color: var(--text); }
.order-side-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.order-side-btn { padding: 10px 0; border-radius: 8px; border: none; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.15s; text-align: center; font-family: inherit; }
.order-side-btn.yes { background: var(--green); color: white; }
.order-side-btn.yes:hover { background: #16a34a; }
.order-side-btn.yes.inactive { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
.order-side-btn.no { background: var(--surface2); color: var(--text-muted); border: 1px solid var(--border); }
.order-side-btn.no.active-no { background: var(--red-dark); color: var(--red); border-color: var(--red-dark); }
.order-side-btn.no:hover { border-color: var(--red); color: var(--red); }
.order-amount-row { display: flex; align-items: center; gap: 8px; background: var(--surface2); border: 1px solid var(--border); border-radius: 8px; padding: 8px 12px; }
.order-amount-label { font-size: 13px; color: var(--text-dim); }
.order-amount-ctrls { display: flex; align-items: center; margin-left: auto; }
.order-amount-adj { width: 28px; height: 28px; border-radius: 6px; background: var(--surface3); border: 1px solid var(--border); color: var(--text-muted); font-size: 16px; display: flex; align-items: center; justify-content: center; cursor: pointer; user-select: none; transition: all 0.15s; }
.order-amount-adj:hover { background: var(--border); color: var(--text); }
.order-amount-val { min-width: 50px; text-align: center; font-size: 14px; font-weight: 600; color: var(--text); padding: 0 8px; }
.order-slider { width: 100%; }
.order-sep { height: 1px; background: var(--border); }
.order-info-row { display: flex; justify-content: space-between; align-items: center; }
.order-info-key { font-size: 13px; color: var(--text-muted); }
.order-info-val { font-size: 13px; font-weight: 600; color: var(--text); }
.order-submit-btn { width: 100%; padding: 13px; border-radius: 8px; font-size: 15px; font-weight: 700; border: none; cursor: pointer; background: #f0f0f0; color: #0a0a0a; transition: all 0.15s; font-family: inherit; }
.order-submit-btn:hover { background: white; }
body.light .order-modal { background: #fff; border-color: #e5e7eb; box-shadow: 0 20px 60px rgba(0,0,0,0.15); }
body.light .order-submit-btn { background: #1a1a1a; color: #fff; }
body.light .order-submit-btn:hover { background: #000; }
body.light .order-side-btn.yes { background: #16a34a; }
body.light .order-side-btn.no.active-no { background: #fee2e2; color: #dc2626; border-color: #fecaca; }
body.light .order-option-dropdown { background: #f3f4f6; border-color: #e5e7eb; }
body.light .order-option-item:hover { background: #e5e7eb; }
body.light .order-option-item.active { background: #dbeafe; }

.share-overlay { display: none; position: fixed; inset: 0; z-index: 600; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); justify-content: center; align-items: center; }
.share-overlay.open { display: flex; }
.share-modal { background: var(--bg); border: 1px solid var(--border); border-radius: 16px; width: 100%; max-width: 420px; padding: 0; animation: cmSlideUp 0.2s ease; }
.share-modal-header { display: flex; align-items: center; justify-content: space-between; padding: 18px 24px; border-bottom: 1px solid var(--border); }
.share-modal-title { font-size: 16px; font-weight: 700; color: var(--text); }
.share-modal-close { background: none; border: none; color: var(--text-muted); font-size: 20px; cursor: pointer; padding: 0; line-height: 1; }
.share-modal-close:hover { color: var(--text); }
.share-modal-body { padding: 24px; }
.share-preview { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px; }
.share-preview-title { font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 6px; line-height: 1.4; }
.share-preview-meta { font-size: 12px; color: var(--text-muted); margin-bottom: 8px; }
.share-preview-stats { display: flex; gap: 16px; font-size: 12px; color: var(--text-dim); }
.share-preview-stats span { display: flex; align-items: center; gap: 4px; }
.share-channels { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; }
.share-channel { display: flex; flex-direction: column; align-items: center; gap: 8px; padding: 14px 8px; border-radius: 12px; border: 1px solid var(--border); background: var(--surface); cursor: pointer; transition: all 0.15s; }
.share-channel:hover { background: var(--surface2); border-color: var(--text-muted); }
.share-channel-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 20px; }
.share-channel-icon.twitter { background: rgba(29,155,240,0.12); color: #1d9bf0; }
.share-channel-icon.telegram { background: rgba(38,165,219,0.12); color: #26a5db; }
.share-channel-icon.copy { background: var(--surface3); color: var(--text-muted); }

/* Position/Settlement share card */
.share-pos-card { background: var(--surface); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 20px; text-align: center; }
.share-pos-header { display: flex; align-items: center; gap: 10px; margin-bottom: 16px; text-align: left; }
.share-pos-img { width: 40px; height: 40px; border-radius: 8px; background: var(--surface2); display: flex; align-items: center; justify-content: center; font-size: 18px; flex-shrink: 0; }
.share-pos-title { font-size: 14px; font-weight: 600; color: var(--text); line-height: 1.4; }
.share-pos-option { margin-bottom: 4px; }
.share-pos-option-label { font-size: 13px; color: var(--text-dim); margin-bottom: 4px; }
.share-pos-option-badge { display: inline-block; padding: 3px 10px; border-radius: 6px; font-size: 12px; font-weight: 600; }
.share-pos-option-badge.yes { background: rgba(34,197,94,0.12); color: var(--green); }
.share-pos-option-badge.no { background: rgba(239,68,68,0.12); color: var(--red); }
.share-pos-avg { font-size: 13px; color: var(--text-muted); margin-bottom: 16px; }
.share-pos-value { font-size: 36px; font-weight: 800; line-height: 1.1; margin-bottom: 4px; }
.share-pos-value.profit { color: var(--green); }
.share-pos-value.loss { color: var(--red); }
.share-pos-sublabel { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; }
.share-pos-profit { font-size: 22px; font-weight: 700; margin-bottom: 2px; }
.share-pos-profit.profit { color: var(--green); }
.share-pos-profit.loss { color: var(--red); }
.share-pos-profit-label { font-size: 12px; color: var(--text-muted); margin-bottom: 0; }
.share-toggle-row { display: flex; justify-content: center; gap: 0; margin-bottom: 16px; border-radius: 8px; overflow: hidden; border: 1px solid var(--border); display: inline-flex; }
.share-toggle-btn { padding: 6px 16px; font-size: 12px; font-weight: 600; border: none; background: transparent; color: var(--text-muted); cursor: pointer; font-family: inherit; transition: all 0.15s; }
.share-toggle-btn.active { background: var(--text); color: var(--bg); }
body.light .share-toggle-btn.active { background: #1a1a1a; color: #fff; }
.share-channel-name { font-size: 11px; color: var(--text-dim); font-weight: 500; }
.share-link-row { display: flex; gap: 8px; }
.share-link-input { flex: 1; padding: 10px 14px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text); font-size: 13px; font-family: monospace; outline: none; }
.share-link-input:focus { border-color: var(--text-muted); }
.share-link-copy { padding: 10px 16px; border-radius: 8px; border: none; background: var(--text); color: var(--bg); font-size: 13px; font-weight: 600; cursor: pointer; font-family: inherit; white-space: nowrap; transition: opacity 0.15s; }
.share-link-copy:hover { opacity: 0.85; }
body.light .share-modal { background: #fff; }
body.light .share-link-copy { background: #1a1a1a; color: #fff; }
.share-btn-inline { padding: 4px 12px; border-radius: 6px; border: 1px solid var(--border); background: var(--surface); color: var(--text-muted); font-size: 12px; cursor: pointer; transition: all 0.12s; font-family: inherit; display: inline-flex; align-items: center; gap: 4px; }
.share-btn-inline:hover { color: var(--text); border-color: var(--text-muted); }
</style>
</head>
<body>

<!-- ── NAV ── -->
<nav>
  <div class="nav-back" id="nav-back" onclick="goHome()">← 返回</div>
  <a class="logo" onclick="goHome()"><div class="logo-icon">?</div>socrates</a>
  <div class="nav-links" id="nav-links">
    <div class="nav-link" onclick="switchMainNav(this,'home')">事件</div>
    <div class="nav-link active" onclick="switchMainNav(this,'home')">热门</div>
    <div class="nav-link" onclick="switchMainNav(this,'follow-feed')">关注</div>
    <div class="nav-link" onclick="switchMainNav(this,'rank')">排名</div>
    <div class="nav-link">挖矿</div>
    <div class="nav-link">One·World Pass</div>
    <div class="nav-link">DAO</div>
    <div class="nav-link" onclick="switchMainNav(this,'web4')">Web4</div>
    <div class="nav-dd-wrap" id="nav-discovery-wrap">
      <div class="nav-link nav-dd-trigger" id="nav-discovery-trigger" onclick="toggleDiscoveryNavDropdown(event)">
        AgentHub <span class="nav-dd-caret">▾</span>
      </div>
      <div class="nav-dd-menu" id="nav-discovery-menu">
        <div class="nav-dd-item discovery" onclick="openDiscoveryRoleFromNav('discovery', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">🛰</div><div class="nav-dd-item-title">发现 Agent</div><span class="nav-dd-badge">DISC</span></div>
          <div class="nav-dd-item-desc">全域采集信息流并生成可交易候选资料包</div>
        </div>
        <div class="nav-dd-item listing" onclick="openDiscoveryRoleFromNav('listing', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">📦</div><div class="nav-dd-item-title">上架 Agent</div><span class="nav-dd-badge">EV</span></div>
          <div class="nav-dd-item-desc">评估热度与交易量，判断上架收益/盈亏比</div>
        </div>
        <div class="nav-dd-item verify" onclick="openDiscoveryRoleFromNav('verify', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">✅</div><div class="nav-dd-item-title">审核 Agent</div><span class="nav-dd-badge">RULE</span></div>
          <div class="nav-dd-item-desc">去重、校验口径、阻断歧义与低质量市场</div>
        </div>
        <div class="nav-dd-item lp" onclick="openDiscoveryRoleFromNav('lp', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">💧</div><div class="nav-dd-item-title">做市 Agent</div><span class="nav-dd-badge">LP</span></div>
          <div class="nav-dd-item-desc">评估流动性投放效率，压点差稳深度</div>
        </div>
        <div class="nav-dd-item trading" onclick="openDiscoveryRoleFromNav('trading', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">⚡</div><div class="nav-dd-item-title">交易 Agent</div><span class="nav-dd-badge">TRD</span></div>
          <div class="nav-dd-item-desc">执行交易策略、动态对冲与收益归集</div>
        </div>
        <div class="nav-dd-item governance" onclick="openDiscoveryRoleFromNav('governance', event)">
          <div class="nav-dd-item-top"><div class="nav-dd-icon">⚖</div><div class="nav-dd-item-title">治理 Agent</div><span class="nav-dd-badge">DAO</span></div>
          <div class="nav-dd-item-desc">负责治理投票、争议仲裁与最终结算签名</div>
        </div>
      </div>
    </div>
  </div>
  <div class="nav-actions">
    <div class="theme-toggle" onclick="toggleTheme()" title="切换主题">🌙</div>
    <div class="nav-icon">⬇</div>
    <div class="nav-icon">🌐</div>
    <div class="nav-bell" onclick="toggleNotifPanel()" title="消息通知">🔔<div class="nav-bell-dot"></div></div>
    <div class="user-avatar-wrap" id="user-avatar-wrap">
      <button class="user-avatar-btn" onclick="toggleUserMenu()" title="用户菜单">S</button>
      <div class="user-dropdown" id="user-dropdown">
        <div class="user-dd-item" onclick="openProfile()"><span class="user-dd-item-icon">👤</span>个人中心</div>
        <div class="user-dd-item" onclick="closeUserMenu()"><span class="user-dd-item-icon">💰</span>我的钱包</div>
        <div class="user-dd-item" onclick="closeUserMenu()"><span class="user-dd-item-icon">📊</span>投资组合</div>
        <div class="user-dd-sep"></div>
        <div class="user-dd-item" onclick="openCreatorCenter()"><span class="user-dd-item-icon">🏗</span>创作者中心</div>
        <div class="user-dd-item" onclick="closeUserMenu()"><span class="user-dd-item-icon">⚙</span>设置</div>
        <div class="user-dd-sep"></div>
        <div class="user-dd-item danger" onclick="closeUserMenu()"><span class="user-dd-item-icon">🚪</span>退出登录</div>
      </div>
    </div>
  </div>
</nav>

<!-- ══════════════════════════
     CREATE MARKET MODAL
══════════════════════════ -->
<div class="cm-view" id="cm-view">
  <div class="cm-page">
    <div class="cm-page-header">
      <button class="cm-page-back" onclick="closeCreateMarket()">← 返回</button>
    </div>
    <div class="cm-header">
      <span class="cm-header-title">创建市场</span>
    </div>
    <div class="cm-body">

      <!-- 1. 市场标题 -->
      <div class="cm-section">
        <div class="cm-label">市场标题</div>
        <input class="cm-input" id="cm-title" type="text" placeholder="有什么好问题？" maxlength="100" oninput="cmUpdateCount('cm-title','cm-title-count',100)">
        <div class="cm-char-count" id="cm-title-count">0/100</div>
      </div>

      <!-- 2. 分类（可多选） -->
      <div class="cm-section">
        <div class="cm-label">分类 <span style="font-size:12px;color:var(--text-muted);font-weight:400">（可多选）</span></div>
        <div class="cm-cats" id="cm-cats">
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">加密货币</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">政治</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">体育</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">科技</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">Web3</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">文化</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">社会</button>
          <button class="cm-cat-chip" onclick="cmToggleCat(this)">其他</button>
        </div>
      </div>

      <!-- 3. 头像 -->
      <div class="cm-section">
        <div class="cm-label">头像</div>
        <div class="cm-upload" onclick="this.querySelector('input').click()" id="cm-upload-box">
          <span id="cm-upload-placeholder">🖼</span>
          <input type="file" accept="image/*" onchange="cmPreviewImage(event)">
        </div>
      </div>

      <div class="cm-sep"></div>

      <!-- 4. 选项设置 -->
      <div class="cm-section">
        <div class="cm-label">选项设置</div>
        <div class="cm-type-toggle" id="cm-type-toggle">
          <button class="cm-type-btn active" data-type="binary" onclick="cmSwitchType('binary',this)"><span class="cm-type-icon">☑</span> 是 / 否</button>
          <button class="cm-type-btn" data-type="multi" onclick="cmSwitchType('multi',this)"><span class="cm-type-icon">▦</span> 多选</button>
        </div>
        <div class="cm-outcomes-wrap" id="cm-outcomes-wrap">
          <div id="cm-outcomes-list"></div>
          <div class="cm-outcome-footer">
            <div class="cm-auto-calc" onclick="cmToggleAutoCalc()">
              <span class="cm-auto-calc-icon" id="cm-auto-icon">⊞</span>
              <span>自动计算: <strong id="cm-auto-label">开启</strong></span>
            </div>
            <button class="cm-outcome-add" onclick="cmAddOutcome()" title="添加选项">+</button>
          </div>
        </div>
      </div>

      <div class="cm-sep"></div>

      <!-- 5. 规则描述 -->
      <div class="cm-section">
        <div class="cm-label">规则描述</div>
        <textarea class="cm-input cm-textarea" id="cm-rules" placeholder="描述该市场的结算规则..." maxlength="1500" oninput="cmUpdateCount('cm-rules','cm-rules-count',1500)"></textarea>
        <div class="cm-char-count" id="cm-rules-count">0/1500</div>
      </div>

      <!-- 6. 数据源 -->
      <div class="cm-section">
        <div class="cm-label">数据源</div>
        <div class="cm-source-row">
          <input class="cm-input" id="cm-source-input" type="text" placeholder="输入 URL 链接" maxlength="256" oninput="cmUpdateCount('cm-source-input','cm-source-count',256)">
          <button class="cm-source-add-btn" onclick="cmAddSource()">添加</button>
        </div>
        <div class="cm-char-count" id="cm-source-count">0/256</div>
        <div class="cm-source-tags" id="cm-source-tags"></div>
      </div>

      <div class="cm-sep"></div>

      <!-- 7. 封盘时间 -->
      <div class="cm-section">
        <div class="cm-label">封盘时间（停止交易）</div>
        <div class="cm-sublabel">封盘时间是指市场停止接受新订单的预设时刻。封盘后，用户将无法再进行买入或卖出操作，常用于体育赛事等结果即将揭晓的场景。</div>
        <div class="cm-date-row">
          <input type="datetime-local" class="cm-input" id="cm-close-date" onchange="cmSyncCloseDate()">
          <div class="cm-date-hint">⏱ 所有时间均以 UTC+0 为准</div>
        </div>
      </div>

      <!-- 8. 结束时间 -->
      <div class="cm-section">
        <div class="cm-label">结束时间</div>
        <div class="cm-sublabel">市场到期后将进入结算流程。</div>
        <div class="cm-date-row">
          <input type="datetime-local" class="cm-input" id="cm-end-date" onchange="cmSyncEndDate()">
          <div class="cm-date-hint">⏱ 所有时间均以 UTC+0 为准</div>
        </div>
      </div>

      <div class="cm-sep"></div>

      <!-- 9. 流动性 -->
      <div class="cm-section">
        <div class="cm-label">流动性</div>
        <div class="cm-sublabel">输入你希望提供的初始流动性。初始流动性越高，你的市场流动性越好。（最小值：200 USDT）</div>
        <div class="cm-liquidity-input-wrap">
          <input class="cm-input" id="cm-liquidity" type="number" placeholder="请输入流动性" min="200">
          <div class="cm-liquidity-badge"><span class="usdt-icon">T</span> USDT</div>
        </div>
        <div class="cm-balance">余额：0 USDT</div>
      </div>

      <!-- 10. 风险提示 -->
      <div class="cm-tip">
        <div class="cm-tip-title">风险提示</div>
        <div class="cm-tip-text">
          作为创作者，您无法直接从用户的赢或输中获利。收益仅来自手续费分成。<br>
          • 如果市场缺乏参与或设计不佳，您可能承担流动性损失的风险。<br>
          • 结果来源必须清晰且可验证。
        </div>
      </div>

    </div>
    <div class="cm-footer" id="cm-footer-edit">
      <button class="cm-submit-btn" onclick="cmShowPreview()">创建</button>
    </div>
  </div>
</div>

<!-- Create Market Preview Overlay -->
<div class="cm-preview-overlay" id="cm-preview-overlay" onclick="if(event.target===this)cmBackToEdit()">
  <div class="cm-preview-modal">
    <div class="cm-header" style="padding:20px 28px;border-bottom:1px solid var(--border)">
      <span class="cm-header-title" style="font-size:18px">预览市场</span>
      <button class="cm-close" onclick="cmBackToEdit()">✕</button>
    </div>
    <div class="cm-preview" id="cm-preview"></div>
    <div class="cm-preview-footer">
      <button class="cm-preview-back-btn" onclick="cmBackToEdit()">← 返回修改</button>
      <button class="cm-preview-confirm-btn" onclick="cmConfirmCreate()">确认创建</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     SHARE MODAL
══════════════════════════ -->
<div class="share-overlay" id="share-overlay" onclick="if(event.target===this)closeShareModal()">
  <div class="share-modal">
    <div class="share-modal-header">
      <span class="share-modal-title">分享</span>
      <button class="share-modal-close" onclick="closeShareModal()">✕</button>
    </div>
    <div class="share-modal-body">
      <div id="share-body-content"></div>
      <div class="share-channels">
        <div class="share-channel" onclick="shareVia('twitter')">
          <div class="share-channel-icon twitter">𝕏</div>
          <span class="share-channel-name">Twitter</span>
        </div>
        <div class="share-channel" onclick="shareVia('telegram')">
          <div class="share-channel-icon telegram">✈</div>
          <span class="share-channel-name">Telegram</span>
        </div>
        <div class="share-channel" onclick="copyShareLink()">
          <div class="share-channel-icon copy">🔗</div>
          <span class="share-channel-name">复制链接</span>
        </div>
      </div>
      <div class="share-link-row">
        <input class="share-link-input" id="share-link-input" readonly value="https://socrates.market/m/fed-march-2026">
        <button class="share-link-copy" onclick="copyShareLink()">复制</button>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     QUICK ORDER MODAL
══════════════════════════ -->
<div class="order-overlay" id="order-overlay" onclick="if(event.target===this)closeOrderModal()">
  <div class="order-modal">
    <div class="order-modal-header">
      <div class="order-modal-title">
        <span class="order-emoji" id="order-emoji">🏦</span>
        <span id="order-market-title">美联储3月份的决定?</span>
      </div>
      <button class="order-modal-close" onclick="closeOrderModal()">✕</button>
    </div>
    <div class="order-modal-body">
      <div class="order-option-select" id="order-option-select" onclick="toggleOrderOptionDropdown(event)">
        <div class="order-option-label">选项</div>
        <div class="order-option-name" id="order-option-name">无变化</div>
        <div class="order-option-dropdown" id="order-option-dropdown"></div>
      </div>
      <div class="order-tabs">
        <button class="order-tab active" onclick="switchOrderTab(this)">买入</button>
        <button class="order-tab" onclick="switchOrderTab(this)">卖出</button>
      </div>
      <div class="order-side-btns">
        <button class="order-side-btn yes" id="order-yes-btn" onclick="selectOrderSide('yes',this)">
          <div>是</div><div style="font-size:12px;font-weight:500;margin-top:2px" id="order-yes-price">$0.32</div>
        </button>
        <button class="order-side-btn no inactive" id="order-no-btn" onclick="selectOrderSide('no',this)">
          <div>否</div><div style="font-size:12px;font-weight:500;margin-top:2px" id="order-no-price">$0.68</div>
        </button>
      </div>
      <div class="order-amount-row">
        <span class="order-amount-label">金额</span>
        <div class="order-amount-ctrls">
          <div class="order-amount-adj" onclick="adjustOrderAmount(-1)">−</div>
          <div class="order-amount-val" id="order-amount-val">$0</div>
          <div class="order-amount-adj" onclick="adjustOrderAmount(1)">+</div>
        </div>
      </div>
      <input type="range" class="order-slider" id="order-slider" min="0" max="100" value="0" oninput="orderSliderChanged(this.value)">
      <div class="order-sep"></div>
      <div class="order-info-row">
        <span class="order-info-key">可用</span>
        <span class="order-info-val">$0.00</span>
      </div>
      <div class="order-info-row">
        <span class="order-info-key">赢取</span>
        <span class="order-info-val" id="order-win-val">$0</span>
      </div>
      <button class="order-submit-btn">登录</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     HOMEPAGE VIEW
══════════════════════════ -->
<div class="view active" id="home-view">

  <!-- CATEGORY TABS -->
  <div class="category-bar">
    <div class="cat-tab active">热门</div>
    <div class="cat-tab">最新</div>
    <div class="cat-tab">即将结束</div>
    <div class="cat-tab">加密货币</div>
    <div class="cat-tab">政治</div>
    <div class="cat-tab">体育</div>
    <div class="cat-tab">科技</div>
    <div class="cat-tab">Web3</div>
    <div class="cat-tab">文化</div>
    <div class="cat-tab">社会</div>
    <div class="cat-tab" id="other-tab" onclick="toggleOtherPanel(this)">其他 ▾</div>
    <div class="cat-actions">
      <button class="btn-create" onclick="openCreateMarket()"><span>📊</span> 创建市场</button>
    </div>
  </div>

  <!-- OTHER PANEL -->
  <div class="other-panel" id="other-panel">
    <div class="other-layout">
      <div class="other-sidebar">
        <div class="other-sidebar-title">Categories</div>
        <div class="other-cat-item active" onclick="selectOtherCat(this)"><span>Economy</span><span class="other-cat-count">13</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Business</span><span class="other-cat-count">2</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Entertainment</span><span class="other-cat-count">8</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Science</span><span class="other-cat-count">5</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Health</span><span class="other-cat-count">4</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Education</span><span class="other-cat-count">3</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Environment</span><span class="other-cat-count">6</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Law</span><span class="other-cat-count">2</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Geopolitics</span><span class="other-cat-count">9</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Military</span><span class="other-cat-count">4</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Awards</span><span class="other-cat-count">7</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Celebrity</span><span class="other-cat-count">5</span></div>
        <div class="other-cat-item" onclick="selectOtherCat(this)"><span>Philosophy</span><span class="other-cat-count">1</span></div>
      </div>
      <div class="other-content">
        <div class="other-filter-bar">
          <div class="custom-select" id="other-sort-select">
            <div class="custom-select-trigger" onclick="toggleSelect('other-sort-select')">
              <span id="other-sort-label">排序: 24h 交易量 ↓</span><span class="custom-select-arrow">▾</span>
            </div>
            <div class="custom-select-menu">
              <div class="custom-select-item" onclick="setOtherSort(this,'最新')">最新</div>
              <div class="custom-select-item" onclick="setOtherSort(this,'即将结束')">即将结束</div>
              <div class="custom-select-item selected sort-toggle" data-dir="desc" onclick="toggleOtherSort(this)"><span class="sort-item-label">24h 交易量</span><span class="sort-item-dir">↓</span></div>
              <div class="custom-select-item sort-toggle" data-dir="desc" onclick="toggleOtherSort(this)"><span class="sort-item-label">Liq</span><span class="sort-item-dir">↓</span></div>
            </div>
          </div>
          <div class="custom-select" id="other-status-select">
            <div class="custom-select-trigger" onclick="toggleSelect('other-status-select')">
              <span id="other-status-label">状态: 进行中</span><span class="custom-select-arrow">▾</span>
            </div>
            <div class="custom-select-menu">
              <div class="custom-select-item" onclick="setOtherStatus(this,'全部')">全部</div>
              <div class="custom-select-item selected" onclick="setOtherStatus(this,'进行中')">进行中</div>
              <div class="custom-select-item" onclick="setOtherStatus(this,'结算中')">结算中</div>
              <div class="custom-select-item" onclick="setOtherStatus(this,'已结算')">已结算</div>
            </div>
          </div>
          <div class="search-bar" style="max-width:280px">
            <span style="color:var(--text-muted);font-size:14px">🔍</span>
            <input type="text" placeholder="搜索市场...">
          </div>
        </div>
        <div class="other-market-grid" id="other-market-grid"></div>
      </div>
    </div>
  </div>

  <!-- FILTER BAR -->
  <div class="filter-bar">
    <div class="custom-select" id="sort-select">
      <div class="custom-select-trigger" onclick="toggleSelect('sort-select')">
        <span id="sort-label">排序: 24h 交易量 ↓</span><span class="custom-select-arrow">▾</span>
      </div>
      <div class="custom-select-menu">
        <div class="custom-select-item" onclick="setSort(this,'最新')">最新</div>
        <div class="custom-select-item" onclick="setSort(this,'即将结束')">即将结束</div>
        <div class="custom-select-item selected sort-toggle" data-dir="desc" onclick="toggleSort(this)"><span class="sort-item-label">24h 交易量</span><span class="sort-item-dir">↓</span></div>
        <div class="custom-select-item sort-toggle" data-dir="desc" onclick="toggleSort(this)"><span class="sort-item-label">Liq</span><span class="sort-item-dir">↓</span></div>
      </div>
    </div>
    <div class="custom-select" id="status-select">
      <div class="custom-select-trigger" onclick="toggleSelect('status-select')">
        <span id="status-label">状态: 进行中</span><span class="custom-select-arrow">▾</span>
      </div>
      <div class="custom-select-menu">
        <div class="custom-select-item" onclick="setStatus(this,'全部')">全部</div>
        <div class="custom-select-item selected" onclick="setStatus(this,'进行中')">进行中</div>
        <div class="custom-select-item" onclick="setStatus(this,'结算中')">结算中</div>
        <div class="custom-select-item" onclick="setStatus(this,'已结算')">已结算</div>
      </div>
    </div>
    <div class="fav-filter-btn" id="fav-filter-btn" onclick="toggleFavFilter()" title="只看收藏">
      <span class="fav-filter-icon">☆</span>
    </div>
    <div class="search-bar">
      <span style="color:var(--text-muted);font-size:14px">🔍</span>
      <input type="text" placeholder="搜索市场...">
    </div>
  </div>

  <!-- MARKET GRID -->
  <div class="market-grid" id="main-market-grid"></div>

</div><!-- /home-view -->

<!-- ══════════════════════════
     FOLLOW FEED VIEW
══════════════════════════ -->
<div class="follow-feed-view" id="follow-feed-view">
  <div style="margin-bottom:20px;display:flex;align-items:center;justify-content:space-between">
    <h2 style="font-size:22px;font-weight:700;color:var(--text);margin:0">关注动态</h2>
    <span style="font-size:13px;color:var(--text-muted)">来自你关注的人的实时动态</span>
  </div>
  <div class="ff-layout">
  <div class="ff-main">
  <div class="ff-tabs">
    <div class="ff-tab active" data-ffpanel="ff-all" onclick="switchFFTab(this)">全部</div>
    <div class="ff-tab" data-ffpanel="ff-trade" onclick="switchFFTab(this)">📈 交易</div>
    <div class="ff-tab" data-ffpanel="ff-settle" onclick="switchFFTab(this)">💰 结算</div>
    <div class="ff-tab" data-ffpanel="ff-social" onclick="switchFFTab(this)">💬 互动</div>
  </div>
  <div class="ff-card">
    <!-- 全部 -->
    <div class="ff-panel active" id="ff-all">
      <div class="ff-item">
        <div class="ff-item-avatar trade" style="cursor:pointer" onclick="openUserProfile('CryptoKing_88','👑','kol','81%','$128,500','#3','5.6K','42')">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name" onclick="openUserProfile('CryptoKing_88','👑','kol','81%','$128,500','#3','5.6K','42')">CryptoKing_88</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@crypto_king88</span>
            <span class="ff-item-time">3 分钟前</span>
          </div>
          <div class="ff-item-text">重仓买入 <span class="ff-hl">500 份 YES</span> @ $0.37</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🏦</span> 美联储3月份的决定？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 12</span>
            <span class="ff-item-action">❤ 45</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar settle" style="cursor:pointer" onclick="openUserProfile('WhaleTrader','🐋','kol','76%','$95,200','#7','3.2K','38')">💰</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name" onclick="openUserProfile('WhaleTrader','🐋','kol','76%','$95,200','#7','3.2K','38')">WhaleTrader</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@whale_trader</span>
            <span class="ff-item-time">15 分钟前</span>
          </div>
          <div class="ff-item-text">在市场结算中获利 <span class="ff-hl">+$1,250 USDT</span> 🎉</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">⚽</span> 欧冠决赛冠军预测</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 28</span>
            <span class="ff-item-action">❤ 156</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social" style="cursor:pointer" onclick="openUserProfile('DiamondHands','💎','kol','71%','$55,300','#19','2.1K','45',true)">👤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name" onclick="openUserProfile('DiamondHands','💎','kol','71%','$55,300','#19','2.1K','45',true)">DiamondHands</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@diamond_hands</span>
            <span class="ff-item-time">20 分钟前</span>
          </div>
          <div class="ff-item-text">关注了你</div>
          <div class="ff-item-actions">
            <span class="ff-item-action" onclick="this.textContent='✅ 已回关'">👤 回关</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade" style="cursor:pointer" onclick="openUserProfile('OracleVision','🔮','','88%','$67,800','#15','1.9K','55')">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name" onclick="openUserProfile('OracleVision','🔮','','88%','$67,800','#15','1.9K','55')">OracleVision</span>
            <span class="ff-item-handle">@oracle_vision</span>
            <span class="ff-item-time">45 分钟前</span>
          </div>
          <div class="ff-item-text">卖出 <span class="ff-hl-red">100 份 YES</span> @ $0.71，获利 <span class="ff-hl">+$9.00</span></div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🤖</span> OpenAI 2025年会发布GPT-5吗？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 5</span>
            <span class="ff-item-action">❤ 18</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social" style="cursor:pointer" onclick="openUserProfile('FlashTrader','⚡','','74%','$31,600','#35','780','33')">💬</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name" onclick="openUserProfile('FlashTrader','⚡','','74%','$31,600','#35','780','33')">FlashTrader</span>
            <span class="ff-item-handle">@flash_trader</span>
            <span class="ff-item-time">1 小时前</span>
          </div>
          <div class="ff-item-text">回复了你的评论：「同意，ETF 资金流入是关键催化剂，机构的配置比例还在持续上升」</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">₿</span> BTC 在2026年Q1能突破15万美元吗？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 回复</span>
            <span class="ff-item-action">❤ 3</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">MacroMaster</span>
            <span class="ff-item-handle">@macro_master</span>
            <span class="ff-item-time">1 小时前</span>
          </div>
          <div class="ff-item-text">创建了新市场</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🇪🇺</span> 2026年欧洲央行会降息几次？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 7</span>
            <span class="ff-item-action">❤ 22</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar settle">💰</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">CoinDesk官方</span><span class="badge-verified media" style="width:16px;height:16px;font-size:9px">M</span>
            <span class="ff-item-handle">@coindesk_official</span>
            <span class="ff-item-time">2 小时前</span>
          </div>
          <div class="ff-item-text">你关注的市场已结算，<span class="ff-hl">YES</span> 方获胜！最终结果已确认。</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🤖</span> OpenAI 会在2026年初发布GPT-5吗？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 34</span>
            <span class="ff-item-action">❤ 89</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social">❤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">MoonShot_Dev</span>
            <span class="ff-item-handle">@moonshot_dev</span>
            <span class="ff-item-time">3 小时前</span>
          </div>
          <div class="ff-item-text"><strong>MoonShot_Dev</strong> 和其他 5 人赞了你的评论</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🏦</span> 2026年美联储会降息几次？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 查看评论</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">PredictPro</span>
            <span class="ff-item-handle">@predict_pro</span>
            <span class="ff-item-time">5 小时前</span>
          </div>
          <div class="ff-item-text">向市场添加了 <span class="ff-hl">500 USDT</span> 流动性</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">₿</span> ETH 2026年能否重回5000美元？</div>
          <div class="ff-item-actions">
            <span class="ff-item-action">💬 2</span>
            <span class="ff-item-action">❤ 8</span>
            <span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span>
          </div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social">👤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">LuckyCat_99</span>
            <span class="ff-item-handle">@lucky_cat99</span>
            <span class="ff-item-time">昨天</span>
          </div>
          <div class="ff-item-text"><strong>LuckyCat_99</strong> 和 <strong>BraveLion</strong> 关注了你</div>
          <div class="ff-item-actions">
            <span class="ff-item-action" onclick="this.textContent='✅ 已回关'">👤 回关</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 交易类 -->
    <div class="ff-panel" id="ff-trade">
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">CryptoKing_88</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@crypto_king88</span>
            <span class="ff-item-time">3 分钟前</span>
          </div>
          <div class="ff-item-text">重仓买入 <span class="ff-hl">500 份 YES</span> @ $0.37</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🏦</span> 美联储3月份的决定？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 12</span><span class="ff-item-action">❤ 45</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">OracleVision</span>
            <span class="ff-item-handle">@oracle_vision</span>
            <span class="ff-item-time">45 分钟前</span>
          </div>
          <div class="ff-item-text">卖出 <span class="ff-hl-red">100 份 YES</span> @ $0.71，获利 <span class="ff-hl">+$9.00</span></div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🤖</span> OpenAI 2025年会发布GPT-5吗？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 5</span><span class="ff-item-action">❤ 18</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">MacroMaster</span>
            <span class="ff-item-handle">@macro_master</span>
            <span class="ff-item-time">1 小时前</span>
          </div>
          <div class="ff-item-text">创建了新市场</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🇪🇺</span> 2026年欧洲央行会降息几次？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 7</span><span class="ff-item-action">❤ 22</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar trade">📈</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">PredictPro</span>
            <span class="ff-item-handle">@predict_pro</span>
            <span class="ff-item-time">5 小时前</span>
          </div>
          <div class="ff-item-text">向市场添加了 <span class="ff-hl">500 USDT</span> 流动性</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">₿</span> ETH 2026年能否重回5000美元？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 2</span><span class="ff-item-action">❤ 8</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
    </div>

    <!-- 结算类 -->
    <div class="ff-panel" id="ff-settle">
      <div class="ff-item">
        <div class="ff-item-avatar settle">💰</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">WhaleTrader</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@whale_trader</span>
            <span class="ff-item-time">15 分钟前</span>
          </div>
          <div class="ff-item-text">在市场结算中获利 <span class="ff-hl">+$1,250 USDT</span> 🎉</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">⚽</span> 欧冠决赛冠军预测</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 28</span><span class="ff-item-action">❤ 156</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar settle">💰</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">CoinDesk官方</span><span class="badge-verified media" style="width:16px;height:16px;font-size:9px">M</span>
            <span class="ff-item-handle">@coindesk_official</span>
            <span class="ff-item-time">2 小时前</span>
          </div>
          <div class="ff-item-text">你关注的市场已结算，<span class="ff-hl">YES</span> 方获胜！最终结果已确认。</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🤖</span> OpenAI 会在2026年初发布GPT-5吗？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 34</span><span class="ff-item-action">❤ 89</span><span class="ff-item-action" onclick="openShareMenu(this)">↗ 分享</span></div>
        </div>
      </div>
    </div>

    <!-- 互动类 -->
    <div class="ff-panel" id="ff-social">
      <div class="ff-item">
        <div class="ff-item-avatar social">👤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">DiamondHands</span><span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span>
            <span class="ff-item-handle">@diamond_hands</span>
            <span class="ff-item-time">20 分钟前</span>
          </div>
          <div class="ff-item-text">关注了你</div>
          <div class="ff-item-actions"><span class="ff-item-action" onclick="this.textContent='✅ 已回关'">👤 回关</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social">💬</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">FlashTrader</span>
            <span class="ff-item-handle">@flash_trader</span>
            <span class="ff-item-time">1 小时前</span>
          </div>
          <div class="ff-item-text">回复了你的评论：「同意，ETF 资金流入是关键催化剂」</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">₿</span> BTC 在2026年Q1能突破15万美元吗？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 回复</span><span class="ff-item-action">❤ 3</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social">❤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">MoonShot_Dev</span>
            <span class="ff-item-handle">@moonshot_dev</span>
            <span class="ff-item-time">3 小时前</span>
          </div>
          <div class="ff-item-text"><strong>MoonShot_Dev</strong> 和其他 5 人赞了你的评论</div>
          <div class="ff-item-market"><span class="ff-item-market-emoji">🏦</span> 2026年美联储会降息几次？</div>
          <div class="ff-item-actions"><span class="ff-item-action">💬 查看评论</span></div>
        </div>
      </div>
      <div class="ff-item">
        <div class="ff-item-avatar social">👤</div>
        <div class="ff-item-body">
          <div class="ff-item-head">
            <span class="ff-item-name">LuckyCat_99</span>
            <span class="ff-item-handle">@lucky_cat99</span>
            <span class="ff-item-time">昨天</span>
          </div>
          <div class="ff-item-text"><strong>LuckyCat_99</strong> 和 <strong>BraveLion</strong> 关注了你</div>
          <div class="ff-item-actions"><span class="ff-item-action" onclick="this.textContent='✅ 已回关'">👤 回关</span></div>
        </div>
      </div>
    </div>
  </div>
  </div><!-- /ff-main -->

  <!-- Sidebar -->
  <div class="ff-sidebar">
    <!-- Trending Markets -->
    <div class="ff-sidebar-card">
      <h4>🔥 热门市场</h4>
      <div class="ff-sidebar-trending-item" onclick="alert('跳转到市场详情')">
        <span class="ff-sidebar-trending-num">1</span>
        <div class="ff-sidebar-trending-info">
          <div class="ff-sidebar-trending-title">美联储3月份的决定？</div>
          <div class="ff-sidebar-trending-meta">Vol $128.5K · 1,247 交易者</div>
        </div>
      </div>
      <div class="ff-sidebar-trending-item" onclick="alert('跳转到市场详情')">
        <span class="ff-sidebar-trending-num">2</span>
        <div class="ff-sidebar-trending-info">
          <div class="ff-sidebar-trending-title">BTC 在2026年Q1突破15万？</div>
          <div class="ff-sidebar-trending-meta">Vol $96.2K · 832 交易者</div>
        </div>
      </div>
      <div class="ff-sidebar-trending-item" onclick="alert('跳转到市场详情')">
        <span class="ff-sidebar-trending-num">3</span>
        <div class="ff-sidebar-trending-info">
          <div class="ff-sidebar-trending-title">OpenAI 发布 GPT-5 时间？</div>
          <div class="ff-sidebar-trending-meta">Vol $54.8K · 621 交易者</div>
        </div>
      </div>
      <div class="ff-sidebar-trending-item" onclick="alert('跳转到市场详情')">
        <span class="ff-sidebar-trending-num">4</span>
        <div class="ff-sidebar-trending-info">
          <div class="ff-sidebar-trending-title">欧冠决赛冠军预测</div>
          <div class="ff-sidebar-trending-meta">Vol $41.3K · 509 交易者</div>
        </div>
      </div>
      <div class="ff-sidebar-trending-item" onclick="alert('跳转到市场详情')">
        <span class="ff-sidebar-trending-num">5</span>
        <div class="ff-sidebar-trending-info">
          <div class="ff-sidebar-trending-title">2026 欧洲央行降息几次？</div>
          <div class="ff-sidebar-trending-meta">Vol $33.1K · 378 交易者</div>
        </div>
      </div>
    </div>

    <!-- Suggested Follows -->
    <div class="ff-sidebar-card">
      <h4>💡 推荐关注</h4>
      <div class="ff-sidebar-user">
        <div class="ff-sidebar-user-avatar" style="background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff">🐋</div>
        <div class="ff-sidebar-user-info">
          <div class="ff-sidebar-user-name">MegaWhale<span class="badge-verified" style="width:14px;height:14px;font-size:8px">V</span></div>
          <div class="ff-sidebar-user-handle">胜率 78% · 2,340 粉丝</div>
        </div>
        <button class="ff-sidebar-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="ff-sidebar-user">
        <div class="ff-sidebar-user-avatar" style="background:linear-gradient(135deg,#3b82f6,#6366f1);color:#fff">📈</div>
        <div class="ff-sidebar-user-info">
          <div class="ff-sidebar-user-name">DataNinja</div>
          <div class="ff-sidebar-user-handle">胜率 72% · 1,856 粉丝</div>
        </div>
        <button class="ff-sidebar-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="ff-sidebar-user">
        <div class="ff-sidebar-user-avatar" style="background:linear-gradient(135deg,#8b5cf6,#a855f7);color:#fff">📰</div>
        <div class="ff-sidebar-user-info">
          <div class="ff-sidebar-user-name">CoinDesk官方<span class="badge-verified media" style="width:14px;height:14px;font-size:8px">M</span></div>
          <div class="ff-sidebar-user-handle">媒体认证 · 12.5K 粉丝</div>
        </div>
        <button class="ff-sidebar-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="ff-sidebar-user">
        <div class="ff-sidebar-user-avatar" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff">🔮</div>
        <div class="ff-sidebar-user-info">
          <div class="ff-sidebar-user-name">CryptoSage</div>
          <div class="ff-sidebar-user-handle">胜率 69% · 943 粉丝</div>
        </div>
        <button class="ff-sidebar-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
    </div>

    <!-- Activity Stats -->
    <div class="ff-sidebar-card">
      <h4>📊 你的关注数据</h4>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div style="text-align:center;padding:10px;background:var(--bg);border-radius:8px">
          <div style="font-size:20px;font-weight:700;color:var(--text)">25</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">关注中</div>
        </div>
        <div style="text-align:center;padding:10px;background:var(--bg);border-radius:8px">
          <div style="font-size:20px;font-weight:700;color:var(--text)">731</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">粉丝</div>
        </div>
        <div style="text-align:center;padding:10px;background:var(--bg);border-radius:8px">
          <div style="font-size:20px;font-weight:700;color:var(--green)">18</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">今日动态</div>
        </div>
        <div style="text-align:center;padding:10px;background:var(--bg);border-radius:8px">
          <div style="font-size:20px;font-weight:700;color:#f59e0b">6</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">未读通知</div>
        </div>
      </div>
    </div>
  </div><!-- /ff-sidebar -->

  </div><!-- /ff-layout -->
</div><!-- /follow-feed-view -->

<!-- ══════════════════════════
     RANK VIEW
══════════════════════════ -->
<div class="rank-view" id="rank-view">
  <div class="rank-head">
    <h2 class="rank-title">Agent 收益排行榜</h2>
    <div class="rank-sub">按不同维度查看 Agent 排行：收益率、收益额、回撤控制等。</div>
  </div>
  <div class="rank-dims">
    <button class="rank-dim-btn active" onclick="switchRankDim(this,'all')">综合收益率</button>
    <button class="rank-dim-btn" onclick="switchRankDim(this,'steady')">稳健型收益</button>
    <button class="rank-dim-btn" onclick="switchRankDim(this,'drawdown')">低回撤表现</button>
    <button class="rank-dim-btn" onclick="switchRankDim(this,'income')">收益额排名</button>
  </div>
  <div class="rank-card">
    <div class="rank-table-head">
      <div>排名</div><div>Agent</div><div>年化收益</div><div>30天收益</div><div>最大回撤</div><div>标签</div><div>操作</div>
    </div>
    <div id="rank-rows"></div>
  </div>
</div><!-- /rank-view -->

<!-- ══════════════════════════
     DETAIL VIEW
══════════════════════════ -->
<div class="detail-view" id="detail-view">
  <div class="detail-main">
    <div class="detail-header">
      <div class="detail-header-top">
        <div class="detail-cover-col">
          <div class="detail-creator-row">
            <div class="detail-avatar" id="detail-creator-avatar">🌑</div>
            <span class="detail-creator-name" id="detail-creator-name">spike_email</span>
          </div>
          <div class="detail-cover" id="detail-cover">🏦</div>
        </div>
        <div class="detail-header-info">
          <div class="detail-title" id="detail-title">美联储3月份的决定?</div>
          <div class="detail-meta">
            <span class="status-dot-badge">进行中</span>
            <span class="meta-divider"></span>
            <span class="meta-tag" id="detail-category">Web3</span>
            <span class="meta-divider"></span>
            <span class="meta-vol">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/></svg>
              交易量 <span id="detail-vol">$300.21</span>
            </span>
            <span class="meta-divider"></span>
            <span class="meta-vol">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
              Liq <span id="detail-liq">$200</span>
            </span>
            <span class="meta-divider"></span>
            <span class="meta-date">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
              <span id="detail-date">2026/02/19</span>
            </span>
          </div>
        </div>
        <div class="detail-header-actions">
          <div class="detail-countdown-wrap">
            <div class="detail-cd-label">
              <span id="cd-label-text">封盘倒计时</span>
              <span class="cd-info-icon">i
                <div class="cd-tooltip">
                  <strong>封盘时间</strong>：市场停止接受新订单的时刻。封盘后无法买入或卖出，常用于体育赛事等结果即将揭晓的场景。<br><br>
                  <strong>结束时间</strong>：市场到期后进入结算流程。封盘时间 ≤ 结束时间。
                </div>
              </span>
            </div>
            <div class="detail-countdown">
              <div class="cd-item"><span class="cd-num" id="cd-days">40</span><span class="cd-unit">天</span></div>
              <span class="cd-sep">:</span>
              <div class="cd-item"><span class="cd-num" id="cd-hours">21</span><span class="cd-unit">时</span></div>
              <span class="cd-sep">:</span>
              <div class="cd-item"><span class="cd-num" id="cd-mins">33</span><span class="cd-unit">分</span></div>
              <span class="cd-sep">:</span>
              <div class="cd-item"><span class="cd-num" id="cd-secs">05</span><span class="cd-unit">秒</span></div>
            </div>
          </div>
          <div class="hdr-icon-row">
            <button class="hdr-action-btn" id="detail-bookmark" onclick="toggleDetailBookmark(this)" title="收藏">☆</button>
            <button class="hdr-action-btn" title="分享" onclick="openShareModal()">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
            </button>
            <div class="hdr-more-wrap" id="hdr-more-wrap">
              <button class="hdr-action-btn" onclick="toggleMoreMenu()" title="更多">···</button>
              <div class="more-menu" id="more-menu">
                <div class="more-menu-item" onclick="closeMoreMenu()">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
                  转发给好友
                </div>
                <div class="more-menu-item danger" onclick="closeMoreMenu()">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                  举报
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="content-tabs">
      <div class="content-tab active" data-panel="panel-chart" onclick="switchContentTab(this)">图表</div>
      <div class="content-tab" data-panel="panel-rules" onclick="switchContentTab(this)">规则</div>
      <div class="content-tab" data-panel="panel-progress" onclick="switchContentTab(this)">进程</div>
      <div class="content-tab" data-panel="panel-holders" onclick="switchContentTab(this)">顶级持仓者</div>
      <div class="content-tab" data-panel="panel-comments" onclick="switchContentTab(this)">评论 <span style="color:var(--text-muted);font-weight:400">(128)</span></div>
      <div class="tab-spacer"></div>
      <button class="liquidity-btn">流动性</button>
    </div>

    <!-- PANEL: 图表 -->
    <div class="detail-content-panel active" id="panel-chart">
      <div class="chart-section">
        <div class="chart-controls">
          <button class="tf-btn active" onclick="switchTF(this)">全部</button>
          <button class="tf-btn" onclick="switchTF(this)">1H</button>
          <button class="tf-btn" onclick="switchTF(this)">3H</button>
          <button class="tf-btn" onclick="switchTF(this)">24H</button>
          <button class="tf-btn" onclick="switchTF(this)">7D</button>
        </div>
        <div class="chart-legend" id="chart-legend">
          <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div><span>无变化 37%</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div><span>50个基点以上的降... 32%</span></div>
          <div class="legend-item"><div class="legend-dot" style="background:#eab308"></div><span>25个基点以上的上... 29%</span></div>
        </div>
        <div class="chart-wrap"><canvas id="detailChart"></canvas></div>
      </div>

      <div class="options-table" id="detail-options-table">
        <div class="options-thead">
          <span>结果</span><span>交易量</span><span>概率</span><span style="text-align:center"></span>
        </div>
      </div>

      <div class="sub-tabs-card" id="chart-sub-card">
        <div class="sub-tabs-header">
          <div class="sub-tab active" onclick="switchSubTab('chart-sub-card',this,0)">持仓</div>
          <div class="sub-tab" onclick="switchSubTab('chart-sub-card',this,1)">交易记录</div>
          <div class="sub-tab" onclick="switchSubTab('chart-sub-card',this,2)">流动性</div>
          <div class="sub-tab" onclick="switchSubTab('chart-sub-card',this,3)">结算</div>
        </div>
        <div class="sub-tab-panel active" data-idx="0">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>持仓均价 / 当前价</th><th>持仓成本</th><th>市场价值</th><th>未实现盈亏</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$0.320 / $0.370</td><td>$96.00</td><td>$111.00</td><td style="color:var(--green)">+$15.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('无变化','$0.320','$0.370','$96.00','$111.00','+$15.00','+15.6%')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$0.280 / $0.320</td><td>$42.00</td><td>$48.00</td><td style="color:var(--green)">+$6.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('50bp以上降息','$0.280','$0.320','$42.00','$48.00','+$6.00','+14.3%')">↗</button></td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="1">
          <table class="sub-tab-table"><thead><tr><th>方向</th><th>结果</th><th>份额</th><th>金额</th><th>持仓均价</th><th>成交价</th><th>手续费</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>300</td><td>$96.00</td><td>$0.320</td><td>$0.320</td><td>$0.96</td><td>—</td><td>2026/02/14 10:32</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>50bp以上降息</td><td>150</td><td>$42.00</td><td>$0.280</td><td>$0.280</td><td>$0.42</td><td>—</td><td>2026/02/13 18:05</td></tr>
            <tr><td><span class="td-badge sell">卖出</span></td><td>25bp以上加息</td><td>200</td><td>$50.00</td><td>$0.220</td><td>$0.250</td><td>$0.50</td><td style="color:var(--green)">+$6.00</td><td>2026/02/12 09:17</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>25bp以上加息</td><td>200</td><td>$44.00</td><td>$0.220</td><td>$0.220</td><td>$0.44</td><td>—</td><td>2026/02/10 14:53</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>100</td><td>$30.00</td><td>$0.300</td><td>$0.300</td><td>$0.30</td><td>—</td><td>2026/02/08 22:41</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="2">
          <table class="sub-tab-table"><thead><tr><th>类型</th><th>价值</th><th>状态</th><th>最终结果</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge lp">添加</span></td><td>200.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/05 12:00</td></tr>
            <tr><td><span class="td-badge lp">添加</span></td><td>100.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/10 08:30</td></tr>
            <tr><td><span class="td-badge sell">移除</span></td><td>50.00 USDT</td><td>已完成</td><td>—</td><td style="color:var(--red)">-$2.35</td><td>2026/02/12 16:20</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="3">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>金额</th><th>状态</th><th>最终结果</th><th>盈亏</th><th>结算时间</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$96.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--green)">+$204.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('无变化','300','$96.00','+$204.00','+212.5%','2026/03/20 18:00')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$42.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--red)">-$42.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('50bp以上降息','150','$42.00','-$42.00','-100%','2026/03/20 18:00')">↗</button></td></tr>
          </tbody></table>
        </div>
      </div>
    </div>

    <!-- PANEL: 规则 -->
    <div class="detail-content-panel" id="panel-rules" style="padding:16px">
      <div class="detail-card">
        <div class="rule-text" id="rule-text-content">2026年的任何时间段，以平台公开数据或主流媒体报道，从注册用户、交易量、资本市场估值、平台代币市值，Socrates只要任何一个维度超越Polymarket的数据，则市场结算为YES，如果没有则结算为NO</div>
        <button class="rule-translate-btn" id="rule-translate-btn" onclick="toggleRuleTranslation()">🌐 翻译</button>
        <div class="source-list">
          <a class="source-link" href="https://www.polymarket.com" target="_blank">
            <svg class="source-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            https://www.polymarket.com
          </a>
          <a class="source-link" href="https://www.socrates.com" target="_blank">
            <svg class="source-link-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>
            https://www.socrates.com
          </a>
        </div>
      </div>

      <div class="sub-tabs-card" id="rules-sub-card">
        <div class="sub-tabs-header">
          <div class="sub-tab active" onclick="switchSubTab('rules-sub-card',this,0)">持仓</div>
          <div class="sub-tab" onclick="switchSubTab('rules-sub-card',this,1)">交易记录</div>
          <div class="sub-tab" onclick="switchSubTab('rules-sub-card',this,2)">流动性</div>
          <div class="sub-tab" onclick="switchSubTab('rules-sub-card',this,3)">结算</div>
        </div>
        <div class="sub-tab-panel active" data-idx="0">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>持仓均价 / 当前价</th><th>持仓成本</th><th>市场价值</th><th>未实现盈亏</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$0.320 / $0.370</td><td>$96.00</td><td>$111.00</td><td style="color:var(--green)">+$15.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('无变化','$0.320','$0.370','$96.00','$111.00','+$15.00','+15.6%')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$0.280 / $0.320</td><td>$42.00</td><td>$48.00</td><td style="color:var(--green)">+$6.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('50bp以上降息','$0.280','$0.320','$42.00','$48.00','+$6.00','+14.3%')">↗</button></td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="1">
          <table class="sub-tab-table"><thead><tr><th>方向</th><th>结果</th><th>份额</th><th>金额</th><th>持仓均价</th><th>成交价</th><th>手续费</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>300</td><td>$96.00</td><td>$0.320</td><td>$0.320</td><td>$0.96</td><td>—</td><td>2026/02/14 10:32</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>50bp以上降息</td><td>150</td><td>$42.00</td><td>$0.280</td><td>$0.280</td><td>$0.42</td><td>—</td><td>2026/02/13 18:05</td></tr>
            <tr><td><span class="td-badge sell">卖出</span></td><td>25bp以上加息</td><td>200</td><td>$50.00</td><td>$0.220</td><td>$0.250</td><td>$0.50</td><td style="color:var(--green)">+$6.00</td><td>2026/02/12 09:17</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>25bp以上加息</td><td>200</td><td>$44.00</td><td>$0.220</td><td>$0.220</td><td>$0.44</td><td>—</td><td>2026/02/10 14:53</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>100</td><td>$30.00</td><td>$0.300</td><td>$0.300</td><td>$0.30</td><td>—</td><td>2026/02/08 22:41</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="2">
          <table class="sub-tab-table"><thead><tr><th>类型</th><th>价值</th><th>状态</th><th>最终结果</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge lp">添加</span></td><td>200.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/05 12:00</td></tr>
            <tr><td><span class="td-badge lp">添加</span></td><td>100.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/10 08:30</td></tr>
            <tr><td><span class="td-badge sell">移除</span></td><td>50.00 USDT</td><td>已完成</td><td>—</td><td style="color:var(--red)">-$2.35</td><td>2026/02/12 16:20</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="3">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>金额</th><th>状态</th><th>最终结果</th><th>盈亏</th><th>结算时间</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$96.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--green)">+$204.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('无变化','300','$96.00','+$204.00','+212.5%','2026/03/20 18:00')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$42.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--red)">-$42.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('50bp以上降息','150','$42.00','-$42.00','-100%','2026/03/20 18:00')">↗</button></td></tr>
          </tbody></table>
        </div>
      </div>
    </div>

    <!-- PANEL: 进程 -->
    <div class="detail-content-panel" id="panel-progress" style="padding:16px">
      <div class="detail-card">
        <div class="progress-timeline">
          <div class="progress-step done">
            <div class="progress-step-dot">1</div>
            <div class="progress-step-label">交易</div>
            <div class="progress-step-line"></div>
          </div>
          <div class="progress-step">
            <div class="progress-step-dot">2</div>
            <div class="progress-step-label">封盘</div>
            <div class="progress-step-line"></div>
          </div>
          <div class="progress-step">
            <div class="progress-step-dot">3</div>
            <div class="progress-step-label">市场关闭</div>
            <div class="progress-step-line"></div>
          </div>
          <div class="progress-step">
            <div class="progress-step-dot">4</div>
            <div class="progress-step-label">结果提案</div>
            <div class="progress-step-line"></div>
          </div>
          <div class="progress-step">
            <div class="progress-step-dot">5</div>
            <div class="progress-step-label">质疑期</div>
            <div class="progress-step-line"></div>
          </div>
          <div class="progress-step">
            <div class="progress-step-dot">6</div>
            <div class="progress-step-label">最终结果</div>
          </div>
        </div>
      </div>

      <div class="sub-tabs-card" id="progress-sub-card">
        <div class="sub-tabs-header">
          <div class="sub-tab active" onclick="switchSubTab('progress-sub-card',this,0)">持仓</div>
          <div class="sub-tab" onclick="switchSubTab('progress-sub-card',this,1)">交易记录</div>
          <div class="sub-tab" onclick="switchSubTab('progress-sub-card',this,2)">流动性</div>
          <div class="sub-tab" onclick="switchSubTab('progress-sub-card',this,3)">结算</div>
        </div>
        <div class="sub-tab-panel active" data-idx="0">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>持仓均价 / 当前价</th><th>持仓成本</th><th>市场价值</th><th>未实现盈亏</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$0.320 / $0.370</td><td>$96.00</td><td>$111.00</td><td style="color:var(--green)">+$15.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('无变化','$0.320','$0.370','$96.00','$111.00','+$15.00','+15.6%')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$0.280 / $0.320</td><td>$42.00</td><td>$48.00</td><td style="color:var(--green)">+$6.00</td><td><button style="padding:4px 12px;border-radius:6px;border:1px solid var(--border);background:var(--surface);color:var(--text);font-size:12px;cursor:pointer">卖出</button> <button class="share-btn-inline" onclick="openSharePosition('50bp以上降息','$0.280','$0.320','$42.00','$48.00','+$6.00','+14.3%')">↗</button></td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="1">
          <table class="sub-tab-table"><thead><tr><th>方向</th><th>结果</th><th>份额</th><th>金额</th><th>持仓均价</th><th>成交价</th><th>手续费</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>300</td><td>$96.00</td><td>$0.320</td><td>$0.320</td><td>$0.96</td><td>—</td><td>2026/02/14 10:32</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>50bp以上降息</td><td>150</td><td>$42.00</td><td>$0.280</td><td>$0.280</td><td>$0.42</td><td>—</td><td>2026/02/13 18:05</td></tr>
            <tr><td><span class="td-badge sell">卖出</span></td><td>25bp以上加息</td><td>200</td><td>$50.00</td><td>$0.220</td><td>$0.250</td><td>$0.50</td><td style="color:var(--green)">+$6.00</td><td>2026/02/12 09:17</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>25bp以上加息</td><td>200</td><td>$44.00</td><td>$0.220</td><td>$0.220</td><td>$0.44</td><td>—</td><td>2026/02/10 14:53</td></tr>
            <tr><td><span class="td-badge buy">买入</span></td><td>无变化</td><td>100</td><td>$30.00</td><td>$0.300</td><td>$0.300</td><td>$0.30</td><td>—</td><td>2026/02/08 22:41</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="2">
          <table class="sub-tab-table"><thead><tr><th>类型</th><th>价值</th><th>状态</th><th>最终结果</th><th>已实现盈亏</th><th>时间</th></tr></thead><tbody>
            <tr><td><span class="td-badge lp">添加</span></td><td>200.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/05 12:00</td></tr>
            <tr><td><span class="td-badge lp">添加</span></td><td>100.00 USDT</td><td><span style="color:var(--green)">活跃</span></td><td>—</td><td>—</td><td>2026/02/10 08:30</td></tr>
            <tr><td><span class="td-badge sell">移除</span></td><td>50.00 USDT</td><td>已完成</td><td>—</td><td style="color:var(--red)">-$2.35</td><td>2026/02/12 16:20</td></tr>
          </tbody></table>
        </div>
        <div class="sub-tab-panel" data-idx="3">
          <table class="sub-tab-table"><thead><tr><th>结果</th><th>份额</th><th>金额</th><th>状态</th><th>最终结果</th><th>盈亏</th><th>结算时间</th><th>操作</th></tr></thead><tbody>
            <tr><td><span class="td-badge buy">无变化</span></td><td>300</td><td>$96.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--green)">+$204.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('无变化','300','$96.00','+$204.00','+212.5%','2026/03/20 18:00')">↗</button></td></tr>
            <tr><td><span class="td-badge sell">50bp以上降息</span></td><td>150</td><td>$42.00</td><td><span style="color:var(--green)">已结算</span></td><td><span class="td-badge buy">无变化</span></td><td style="color:var(--red)">-$42.00</td><td>2026/03/20 18:00</td><td><button class="share-btn-inline" onclick="openShareSettle('50bp以上降息','150','$42.00','-$42.00','-100%','2026/03/20 18:00')">↗</button></td></tr>
          </tbody></table>
        </div>
      </div>
    </div>

    <!-- PANEL: 顶级持仓者 -->
    <div class="detail-content-panel" id="panel-holders">
      <div class="holders-section" id="holders-section-content"></div>
    </div>

    <!-- PANEL: 评论 -->
    <div class="detail-content-panel" id="panel-comments">
      <div class="comments-section" id="comments-section-content"></div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="detail-right">
    <div class="trading-panel">
      <div class="panel-title" id="panel-title">50个基点以上的降息</div>
      <div class="trade-tabs">
        <div class="trade-tab active" onclick="switchTradeTab(this)">买入</div>
        <div class="trade-tab" onclick="switchTradeTab(this)">卖出</div>
      </div>
      <div class="outcome-btns">
        <button class="outcome-btn yes" onclick="selectBuySide('yes',this)">
          <div>是</div><div class="outcome-price" id="yes-price">$0.32</div>
        </button>
        <button class="outcome-btn no inactive" onclick="selectBuySide('no',this)">
          <div>否</div><div class="outcome-price" id="no-price">$0.67</div>
        </button>
      </div>
      <div class="amount-row">
        <span class="amount-label-left">金额</span>
        <div class="amount-controls">
          <div class="amount-adj" onclick="adjustAmount(-1)">−</div>
          <div class="amount-display" id="amount-display">$0</div>
          <div class="amount-adj" onclick="adjustAmount(1)">+</div>
        </div>
      </div>
      <div class="slider-wrap">
        <input type="range" id="amountSlider" min="0" max="100" value="0" oninput="sliderChanged(this.value)">
      </div>
      <div class="panel-sep"></div>
      <div class="panel-stats">
        <div class="panel-stat-row">
          <span class="panel-stat-key">可用</span>
          <span class="panel-stat-val">$0.00</span>
        </div>
        <div class="panel-stat-row">
          <span class="panel-stat-key">赢取</span>
          <span class="panel-stat-val" id="win-amount">$0</span>
        </div>
      </div>
      <button class="cta-btn">登录</button>
    </div>
  </div>
</div><!-- /detail-view -->

<!-- ══════════════════════════
     CREATOR CENTER VIEW
══════════════════════════ -->
<div class="creator-view" id="creator-view">
  <div class="creator-header">
    <div class="creator-title-row">
      <h1 class="creator-title">创作者中心</h1>
      <button class="creator-create-btn" onclick="openCreateMarket()">创建市场</button>
    </div>
    <div class="creator-stats">
      <div class="creator-stat-main">
        <div class="creator-stat-main-label">总收益</div>
        <div class="creator-stat-main-value">1,620.97<span class="creator-stat-main-unit">美元</span></div>
      </div>
      <div class="creator-stat-grid" style="grid-template-columns:repeat(5,1fr)">
        <div class="creator-stat-item">
          <div class="creator-stat-item-label">已结算</div>
          <div class="creator-stat-item-value">842.18<span style="font-size:12px;color:var(--text-muted);font-weight:400"> 美元</span></div>
        </div>
        <div class="creator-stat-item">
          <div class="creator-stat-item-label">待结算</div>
          <div class="creator-stat-item-value">778.79<span style="font-size:12px;color:var(--text-muted);font-weight:400"> 美元</span></div>
        </div>
        <div class="creator-stat-item">
          <div class="creator-stat-item-label">总交易量</div>
          <div class="creator-stat-item-value">59,485.75<span style="font-size:12px;color:var(--text-muted);font-weight:400"> 美元</span></div>
        </div>
        <div class="creator-stat-item">
          <div class="creator-stat-item-label">总市场数</div>
          <div class="creator-stat-item-value">9</div>
        </div>
        <div class="creator-stat-item">
          <div class="creator-stat-item-label">总交易人数</div>
          <div class="creator-stat-item-value">1,562</div>
        </div>
      </div>
    </div>
  </div>
  <div class="creator-body">
    <div class="creator-tabs-row">
      <div class="creator-tabs" id="creator-tabs">
        <div class="creator-tab active" data-panel="cc-panel-active" onclick="switchCreatorTab(this)">进行中</div>
        <div class="creator-tab" data-panel="cc-panel-settling" onclick="switchCreatorTab(this)">结算中</div>
        <div class="creator-tab" data-panel="cc-panel-settled" onclick="switchCreatorTab(this)">已结算</div>
      </div>
      <div class="creator-toolbar">
        <div class="creator-sort-wrap" id="cc-sort-wrap">
          <button class="creator-sort-btn" onclick="toggleCreatorSort()">排序 ▾</button>
          <div class="creator-sort-menu" id="cc-sort-menu">
            <div class="creator-sort-item active" data-key="createTime" data-dir="desc" onclick="pickCreatorSort(this)">创建时间 <span class="creator-sort-arrow">↓</span></div>
            <div class="creator-sort-item" data-key="endTime" data-dir="desc" onclick="pickCreatorSort(this)">结束时间 <span class="creator-sort-arrow">↓</span></div>
            <div class="creator-sort-item" data-key="volume" data-dir="desc" onclick="pickCreatorSort(this)">交易量 <span class="creator-sort-arrow">↓</span></div>
            <div class="creator-sort-item" data-key="revenue" data-dir="desc" onclick="pickCreatorSort(this)">收益 <span class="creator-sort-arrow">↓</span></div>
          </div>
        </div>
        <div class="creator-search">
          <span style="color:var(--text-muted);font-size:14px">🔍</span>
          <input type="text" placeholder="搜索市场名称" oninput="filterCreatorTable(this.value)">
        </div>
      </div>
    </div>

    <!-- 进行中 -->
    <div class="creator-tab-panel active" id="cc-panel-active">
      <div class="creator-table-wrap">
        <table class="creator-table">
          <thead><tr>
            <th>市场</th>
            <th>交易量</th>
            <th>交易人数</th>
            <th>我的 / 总流动性</th>
            <th>待结算收益</th>
            <th>结束时间</th>
          </tr></thead>
          <tbody id="cc-tbody-active">
            <tr>
              <td>苏格拉底在2026年会超越Polymarket吗？</td>
              <td>$12,388.08</td>
              <td>326</td>
              <td>200 / 580 USDT</td>
              <td style="color:var(--green)">+$186.42</td>
              <td>2026/03/01</td>
            </tr>
            <tr>
              <td>BTC 在2026年Q1能突破15万美元吗？</td>
              <td>$8,920.50</td>
              <td>214</td>
              <td>500 / 1,200 USDT</td>
              <td style="color:var(--green)">+$134.70</td>
              <td>2026/03/31</td>
            </tr>
            <tr>
              <td>ETH 2026年能否重回5000美元？</td>
              <td>$3,450.22</td>
              <td>98</td>
              <td>200 / 420 USDT</td>
              <td style="color:var(--green)">+$51.80</td>
              <td>2026/06/30</td>
            </tr>
            <tr>
              <td>2026年美联储会降息几次？</td>
              <td>$6,210.00</td>
              <td>187</td>
              <td>300 / 750 USDT</td>
              <td style="color:var(--green)">+$71.43</td>
              <td>2026/12/31</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 结算中 -->
    <div class="creator-tab-panel" id="cc-panel-settling">
      <div class="creator-table-wrap">
        <table class="creator-table">
          <thead><tr>
            <th>市场</th>
            <th>交易量</th>
            <th>交易人数</th>
            <th>我的 / 总流动性</th>
            <th>待结算收益</th>
            <th>市场阶段</th>
          </tr></thead>
          <tbody id="cc-tbody-settling">
            <tr>
              <td>特朗普会在2026年2月访问中国吗？</td>
              <td>$9,870.35</td>
              <td>263</td>
              <td>400 / 900 USDT</td>
              <td style="color:var(--green)">+$148.05</td>
              <td><span class="td-badge settled">提案期</span></td>
            </tr>
            <tr>
              <td>苹果2026春季发布会会推出折叠屏iPhone吗？</td>
              <td>$5,320.80</td>
              <td>142</td>
              <td>250 / 600 USDT</td>
              <td style="color:var(--green)">+$79.81</td>
              <td><span class="td-badge pending">公示期</span></td>
            </tr>
            <tr>
              <td>OpenAI 会在2026年初发布GPT-5吗？</td>
              <td>$7,105.60</td>
              <td>198</td>
              <td>300 / 820 USDT</td>
              <td style="color:var(--green)">+$106.58</td>
              <td><span class="td-badge dispute">争议期</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- 已结算 -->
    <div class="creator-tab-panel" id="cc-panel-settled">
      <div class="creator-table-wrap">
        <table class="creator-table">
          <thead><tr>
            <th>市场</th>
            <th>交易量</th>
            <th>交易人数</th>
            <th>已结算收益</th>
            <th>我的流动性</th>
            <th>结算流动性</th>
            <th>总盈亏</th>
            <th>结算时间</th>
          </tr></thead>
          <tbody id="cc-tbody-settled">
            <tr>
              <td>2025年圣诞节BTC能突破10万？</td>
              <td>$4,560.20</td>
              <td>89</td>
              <td style="color:var(--green)">+$342.18</td>
              <td>200 USDT</td>
              <td>218.50 USDT</td>
              <td style="color:var(--green)">+$360.68</td>
              <td>2025/12/26</td>
            </tr>
            <tr>
              <td>2025年世界杯电竞总决赛冠军是T1吗？</td>
              <td>$1,660.00</td>
              <td>45</td>
              <td style="color:var(--green)">+$500.00</td>
              <td>500 USDT</td>
              <td>463.20 USDT</td>
              <td style="color:var(--green)">+$463.20</td>
              <td>2025/11/15</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- ══════════════════════════
     PROFILE VIEW
══════════════════════════ -->
<div class="profile-view" id="profile-view">

  <!-- Card 1: Profile Info -->
  <div class="profile-card" style="position:relative">
    <div class="profile-badge-icons" style="position:absolute;top:28px;right:32px">
      <div class="profile-badge-icon unlocked b-kol" onclick="alert('✅ KOL 认证已通过\n\n认证信息：Socrates_Whale\n认证时间：2026-01-25\n有效期至：2027-01-25')">
        🏅<div class="badge-tooltip">KOL 认证 ✅</div>
      </div>
      <div class="profile-badge-icon locked" onclick="alert('📰 媒体认证\n\n适用于新闻媒体、资讯平台、自媒体\n\n认证要求：\n• 具备正规媒体资质或自媒体影响力\n• 至少 5,000 粉丝\n• 提交官方认证材料\n\n点击「开始认证」提交申请')">
        📰<div class="badge-tooltip">媒体认证（未认证，点击申请）</div>
      </div>
      <div class="profile-badge-icon locked" onclick="alert('🎫 PASS 卡认证\n\n持有 One World Pass 卡的用户\n\n认证要求：\n• 持有有效的 One World Pass NFT\n• 钱包地址验证通过\n\n持有 PASS 卡可享受：\n• 交易手续费折扣\n• 专属市场创建权限\n• 社区治理投票权\n\n点击「开始认证」提交申请')">
        🎫<div class="badge-tooltip">PASS 卡（未认证，点击申请）</div>
      </div>
    </div>
    <div class="profile-top">
      <div class="profile-avatar" style="background:linear-gradient(135deg,#f97316,#ec4899)">
        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80'%3E%3Crect fill='%23f97316' width='80' height='80'/%3E%3Ctext x='50%25' y='55%25' text-anchor='middle' fill='white' font-size='36'%3E🦊%3C/text%3E%3C/svg%3E" alt="">
      </div>
      <div class="profile-info">
        <div style="display:flex;align-items:center;gap:4px;flex-wrap:wrap">
          <div class="profile-name">Socrates_Whale</div>
          <span class="badge-verified" title="KOL 认证">V</span>
          <span style="font-size:14px;cursor:pointer;color:var(--text-muted);margin-left:2px;transition:color 0.15s" title="编辑个人资料" onclick="alert('编辑个人资料')" onmouseover="this.style.color='var(--text)'" onmouseout="this.style.color='var(--text-muted)'">✏️</span>
        </div>
        <div class="profile-handle">
          <span>@socrates_whale</span>
          <span style="margin-left:8px;font-size:12px;color:var(--text-muted)">KS3W4y...8KuV</span>
          <span style="cursor:pointer;font-size:12px;margin-left:2px" title="复制地址" onclick="navigator.clipboard.writeText('KS3W4y8KuV');this.textContent='✓';setTimeout(()=>this.textContent='📋',1000)">📋</span>
        </div>
        <div class="profile-badges-row">
          <span class="profile-badge-tag kol">🏅 KOL 认证</span>
        </div>
        <div class="profile-meta" style="margin-top:10px">
          <div class="profile-meta-item" style="cursor:pointer" onclick="switchProfileTab(document.querySelector('[data-panel=pf-panel-following]'))"><strong>25</strong> 关注</div>
          <div class="profile-meta-item" style="cursor:pointer" onclick="switchProfileTab(document.querySelector('[data-panel=pf-panel-followers]'))"><strong>731</strong> 粉丝</div>
          <div class="profile-meta-item"><strong>#12</strong> 排名</div>
        </div>
        <div class="profile-referral">
          邀请码
          <code>XO-X0USER25254-AZXW</code>
          <button class="profile-referral-copy" onclick="navigator.clipboard.writeText('XO-X0USER25254-AZXW');this.textContent='已复制!';setTimeout(()=>this.textContent='复制',1500)">复制</button>
        </div>
      </div>
    </div>
    <div class="profile-bio">预测市场爱好者 | 加密货币研究员 | 相信数据驱动决策 📊</div>
    <div class="profile-joined">📅 注册时间 2026年1月24日</div>
  </div>

  <!-- Card 2: Stats -->
  <div class="profile-stats-card">
    <div class="profile-stats-header">
      <div class="profile-stats-title">数据概览</div>
      <div class="profile-private-toggle">
        Private Account
        <div class="profile-toggle-track" id="pf-private-toggle" onclick="this.classList.toggle('on')">
          <div class="profile-toggle-thumb"></div>
        </div>
      </div>
    </div>
    <div class="profile-stats-grid">
      <div class="profile-stat-box">
        <div class="profile-stat-box-label" style="display:flex;align-items:center;gap:4px">🟡 仓位价值</div>
        <div class="profile-stat-box-value neutral">$5.688</div>
      </div>
      <div class="profile-stat-box">
        <div class="profile-stat-box-label" style="display:flex;align-items:center;gap:4px">📈 盈亏</div>
        <div class="profile-stat-box-value profit">$19.118</div>
      </div>
      <div class="profile-stat-box">
        <div class="profile-stat-box-label" style="display:flex;align-items:center;gap:4px">📊 总交易量</div>
        <div class="profile-stat-box-value neutral">$66.400</div>
      </div>
      <div class="profile-stat-box">
        <div class="profile-stat-box-label" style="display:flex;align-items:center;gap:4px">✅ 总市场</div>
        <div class="profile-stat-box-value neutral">5</div>
      </div>
    </div>
  </div>

  <!-- Card 3: Activity -->
  <div class="profile-activity-card">
    <div class="profile-activity-tabs">
      <div class="profile-activity-tab active" data-panel="pf-panel-positions" onclick="switchProfileTab(this)">仓位</div>
      <div class="profile-activity-tab" data-panel="pf-panel-activity" onclick="switchProfileTab(this)">动态</div>
      <div class="profile-activity-tab" data-panel="pf-panel-comments" onclick="switchProfileTab(this)">评论</div>
      <div class="profile-activity-tab" data-panel="pf-panel-following" onclick="switchProfileTab(this)">关注中</div>
      <div class="profile-activity-tab" data-panel="pf-panel-followers" onclick="switchProfileTab(this)">粉丝</div>
      <div class="profile-activity-tab" data-panel="pf-panel-watchlist" onclick="switchProfileTab(this)">收藏</div>
    </div>

    <!-- 仓位 (Portfolio) -->
    <div class="profile-activity-panel active" id="pf-panel-positions">
      <div class="pf-portfolio-header">
        <div style="font-size:13px;color:var(--text-muted)">共 5 个市场持仓</div>
        <div class="pf-portfolio-filter">
          <select><option>💰 金额</option><option>📈 收益率</option><option>🕐 时间</option></select>
        </div>
      </div>
      <div class="pf-pos-table-header">
        <div class="pf-pos-market">市场</div>
        <div class="pf-pos-col">平均价格</div>
        <div class="pf-pos-col">价值</div>
        <div class="pf-pos-col">收益</div>
        <div class="pf-pos-share">分享</div>
      </div>
      <div class="pf-pos-row">
        <div class="pf-pos-market">
          <div class="pf-pos-market-img">🏦</div>
          <div class="pf-pos-market-info">
            <div class="pf-pos-market-title">有多少球队能在整个赛季保持正盈亏？</div>
            <div class="pf-pos-market-option"><span class="opt-tag yes">YES</span> $0.903 · 1.12 份额</div>
          </div>
        </div>
        <div class="pf-pos-col"><span class="val">$0.868</span></div>
        <div class="pf-pos-col"><span class="val">$1.019</span></div>
        <div class="pf-pos-col"><span class="val green">$0.039</span></div>
        <div class="pf-pos-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
      <div class="pf-pos-row">
        <div class="pf-pos-market">
          <div class="pf-pos-market-img">🏢</div>
          <div class="pf-pos-market-info">
            <div class="pf-pos-market-title">贾跃亭能否在2026年还清债务并回国？</div>
            <div class="pf-pos-market-option"><span class="opt-tag yes">YES</span> $0.426 · 2.31 份额</div>
          </div>
        </div>
        <div class="pf-pos-col"><span class="val">$0.426</span></div>
        <div class="pf-pos-col"><span class="val">$0.990</span></div>
        <div class="pf-pos-col"><span class="val green">$0.005</span></div>
        <div class="pf-pos-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
      <div class="pf-pos-row">
        <div class="pf-pos-market">
          <div class="pf-pos-market-img">🌡</div>
          <div class="pf-pos-market-info">
            <div class="pf-pos-market-title">2026年将跻身有史以来最热的年份之列？</div>
            <div class="pf-pos-market-option"><span class="opt-tag yes">YES</span> $0.210 · 17.51 份额</div>
          </div>
        </div>
        <div class="pf-pos-col"><span class="val">$0.150</span></div>
        <div class="pf-pos-col"><span class="val">$3.678</span></div>
        <div class="pf-pos-col"><span class="val green">$1.050</span></div>
        <div class="pf-pos-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
    </div>

    <!-- 动态 -->
    <div class="profile-activity-panel" id="pf-panel-activity">
      <div class="pf-feed">
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">买入 <span class="pf-hl">200 份 YES</span> @ $0.71 <span class="pf-feed-badge buy">BUY</span></div>
            <div class="pf-feed-market-link">📊 BTC 在2026年Q1能突破15万美元吗？</div>
            <div class="pf-feed-time-bottom">10 分钟前</div>
          </div>
        </div>
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">卖出 <span class="pf-hl">50 份 NO</span> @ $0.35，获利 <span style="color:var(--green);font-weight:600">+$4.25</span> <span class="pf-feed-badge sell">SELL</span></div>
            <div class="pf-feed-market-link">📊 特朗普会在2026年2月访问中国吗？</div>
            <div class="pf-feed-time-bottom">2 小时前</div>
          </div>
        </div>
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">添加了 <span class="pf-hl">300 USDT</span> 流动性 <span class="pf-feed-badge lp">LP</span></div>
            <div class="pf-feed-market-link">📊 苏格拉底在2026年会超越Polymarket吗？</div>
            <div class="pf-feed-time-bottom">5 小时前</div>
          </div>
        </div>
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">市场结算：<span style="color:var(--green);font-weight:600">YES 方胜出</span>，获利 <span class="pf-hl">+$128.50 USDT</span> 🎉 <span class="pf-feed-badge" style="background:rgba(245,158,11,0.15);color:#f59e0b">结算</span></div>
            <div class="pf-feed-market-link">📊 欧冠决赛冠军预测</div>
            <div class="pf-feed-time-bottom">昨天</div>
          </div>
        </div>
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">买入 <span class="pf-hl">500 份 YES</span> @ $0.30 <span class="pf-feed-badge buy">BUY</span></div>
            <div class="pf-feed-market-link">📊 苹果2026春季发布会会推出折叠屏iPhone吗？</div>
            <div class="pf-feed-time-bottom">昨天</div>
          </div>
        </div>
        <div class="pf-feed-item">
          <div class="pf-feed-avatar">🦊</div>
          <div class="pf-feed-body">
            <span class="pf-feed-share-topright" onclick="openShareMenu(this)">↗ 分享</span>
            <div class="pf-feed-head">
              <span class="pf-feed-name">Socrates_Whale</span>
            </div>
            <div class="pf-feed-text">市场结算：<span style="color:var(--red);font-weight:600">NO 方胜出</span>，亏损 <span style="color:var(--red);font-weight:600">-$15.00 USDT</span> <span class="pf-feed-badge" style="background:rgba(239,68,68,0.15);color:#ef4444">结算</span></div>
            <div class="pf-feed-market-link">📊 2026年1月CPI超预期？</div>
            <div class="pf-feed-time-bottom">2 天前</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 评论 -->
    <div class="profile-activity-panel" id="pf-panel-comments">
      <div class="pf-comment">
        <div class="pf-comment-avatar" onclick="openUserProfile('Socrates_Whale','🦊','kol')">🦊</div>
        <div class="pf-comment-body">
          <div class="pf-comment-user">
            <span class="pf-comment-username" onclick="openUserProfile('Socrates_Whale','🦊','kol')">Socrates_Whale</span>
            <span class="badge-verified" style="width:14px;height:14px;font-size:8px" title="KOL 认证">V</span>
            <span class="pf-comment-handle">@socrates_whale</span>
          </div>
          <div class="pf-comment-market">评论于 <span>BTC 在2026年Q1能突破15万美元吗？</span></div>
          <div class="pf-comment-text">BTC 突破15万只是时间问题，ETF 资金流入持续加速，机构配置比例还在上升。</div>
          <div class="pf-comment-meta">
            <span>3 小时前</span>
            <span class="pf-comment-action">👍 12</span>
            <span class="pf-comment-action">💬 3</span>
          </div>
        </div>
      </div>
      <div class="pf-comment">
        <div class="pf-comment-avatar" onclick="openUserProfile('Socrates_Whale','🦊','kol')">🦊</div>
        <div class="pf-comment-body">
          <div class="pf-comment-user">
            <span class="pf-comment-username" onclick="openUserProfile('Socrates_Whale','🦊','kol')">Socrates_Whale</span>
            <span class="badge-verified" style="width:14px;height:14px;font-size:8px" title="KOL 认证">V</span>
            <span class="pf-comment-handle">@socrates_whale</span>
          </div>
          <div class="pf-comment-market">评论于 <span>2026年美联储会降息几次？</span></div>
          <div class="pf-comment-text">根据 CME FedWatch 数据，市场目前定价2次降息概率最高。但如果通胀反弹，可能一次都没有。</div>
          <div class="pf-comment-meta">
            <span>昨天</span>
            <span class="pf-comment-action">👍 28</span>
            <span class="pf-comment-action">💬 7</span>
          </div>
        </div>
      </div>
      <div class="pf-comment">
        <div class="pf-comment-avatar" onclick="openUserProfile('Socrates_Whale','🦊','kol')">🦊</div>
        <div class="pf-comment-body">
          <div class="pf-comment-user">
            <span class="pf-comment-username" onclick="openUserProfile('Socrates_Whale','🦊','kol')">Socrates_Whale</span>
            <span class="badge-verified" style="width:14px;height:14px;font-size:8px" title="KOL 认证">V</span>
            <span class="pf-comment-handle">@socrates_whale</span>
          </div>
          <div class="pf-comment-market">评论于 <span>特朗普会在2026年2月访问中国吗？</span></div>
          <div class="pf-comment-text">从目前的外交信号来看可能性不大，但不排除突然宣布的可能。这种市场波动会很大，注意风控。</div>
          <div class="pf-comment-meta">
            <span>2 天前</span>
            <span class="pf-comment-action">👍 45</span>
            <span class="pf-comment-action">💬 11</span>
          </div>
        </div>
      </div>
    </div>

    <!-- 关注中 -->
    <div class="profile-activity-panel" id="pf-panel-following">
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('CryptoKing_88','👑','kol','81%','$128,500','#3','5.6K','42')">👑</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('CryptoKing_88','👑','kol','81%','$128,500','#3','5.6K','42')">
          <div class="pf-follow-name">CryptoKing_88 <span class="badge-verified" title="KOL 认证">V</span></div>
          <div class="pf-follow-handle">@crypto_king88</div>
          <div class="pf-follow-stats">胜率 81% · 交易量 $128,500 · #3 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('WhaleTrader','🐋','kol','76%','$95,200','#7','3.2K','38')">🐋</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('WhaleTrader','🐋','kol','76%','$95,200','#7','3.2K','38')">
          <div class="pf-follow-name">WhaleTrader <span class="badge-verified" title="KOL 认证">V</span></div>
          <div class="pf-follow-handle">@whale_trader</div>
          <div class="pf-follow-stats">胜率 76% · 交易量 $95,200 · #7 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('OracleVision','🔮','','88%','$67,800','#15','1.9K','55')">🔮</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('OracleVision','🔮','','88%','$67,800','#15','1.9K','55')">
          <div class="pf-follow-name">OracleVision</div>
          <div class="pf-follow-handle">@oracle_vision</div>
          <div class="pf-follow-stats">胜率 88% · 交易量 $67,800 · #15 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('CoinDesk官方','📰','media','--','--','--','12.5K','3')">📰</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('CoinDesk官方','📰','media','--','--','--','12.5K','3')">
          <div class="pf-follow-name">CoinDesk官方 <span class="badge-verified media" title="媒体认证">M</span></div>
          <div class="pf-follow-handle">@coindesk_official</div>
          <div class="pf-follow-stats">媒体入驻 · 2.3K 粉丝</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('PredictPro','🎯','','73%','$38,900','#31','890','27')">🎯</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('PredictPro','🎯','','73%','$38,900','#31','890','27')">
          <div class="pf-follow-name">PredictPro</div>
          <div class="pf-follow-handle">@predict_pro</div>
          <div class="pf-follow-stats">胜率 73% · 交易量 $38,900 · #31 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
    </div>

    <!-- 粉丝 -->
    <div class="profile-activity-panel" id="pf-panel-followers">
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('MoonShot_Dev','🚀','','65%','$22,100','#52','340','31')">🚀</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('MoonShot_Dev','🚀','','65%','$22,100','#52','340','31')">
          <div class="pf-follow-name">MoonShot_Dev</div>
          <div class="pf-follow-handle">@moonshot_dev</div>
          <div class="pf-follow-stats">胜率 65% · 交易量 $22,100 · #52 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('DiamondHands','💎','kol','71%','$55,300','#19','2.1K','45',true)">💎</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('DiamondHands','💎','kol','71%','$55,300','#19','2.1K','45',true)">
          <div class="pf-follow-name">DiamondHands <span class="badge-verified" title="KOL 认证">V</span></div>
          <div class="pf-follow-handle">@diamond_hands</div>
          <div class="pf-follow-stats">胜率 71% · 交易量 $55,300 · #19 排名</div>
        </div>
        <button class="pf-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('TideRider','🌊','','58%','$12,800','#89','156','18',true)">🌊</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('TideRider','🌊','','58%','$12,800','#89','156','18',true)">
          <div class="pf-follow-name">TideRider</div>
          <div class="pf-follow-handle">@tide_rider</div>
          <div class="pf-follow-stats">胜率 58% · 交易量 $12,800 · #89 排名</div>
        </div>
        <button class="pf-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('FlashTrader','⚡','','74%','$31,600','#35','780','33')">⚡</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('FlashTrader','⚡','','74%','$31,600','#35','780','33')">
          <div class="pf-follow-name">FlashTrader</div>
          <div class="pf-follow-handle">@flash_trader</div>
          <div class="pf-follow-stats">胜率 74% · 交易量 $31,600 · #35 排名</div>
        </div>
        <button class="pf-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('LuckyCat_99','🎲','','62%','$18,400','#67','290','22')">🎲</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('LuckyCat_99','🎲','','62%','$18,400','#67','290','22')">
          <div class="pf-follow-name">LuckyCat_99</div>
          <div class="pf-follow-handle">@lucky_cat99</div>
          <div class="pf-follow-stats">胜率 62% · 交易量 $18,400 · #67 排名</div>
        </div>
        <button class="pf-follow-btn following" onclick="toggleFollow(this)">已关注</button>
      </div>
      <div class="pf-follow-item">
        <div class="pf-follow-avatar" style="cursor:pointer" onclick="openUserProfile('BlockBeats','📰','media','--','--','--','1.8K','5')">📰</div>
        <div class="pf-follow-info" style="cursor:pointer" onclick="openUserProfile('BlockBeats','📰','media','--','--','--','1.8K','5')">
          <div class="pf-follow-name">BlockBeats <span class="badge-verified media" title="媒体认证">M</span></div>
          <div class="pf-follow-handle">@blockbeats_cn</div>
          <div class="pf-follow-stats">媒体入驻 · 1.8K 粉丝</div>
        </div>
        <button class="pf-follow-btn" onclick="toggleFollow(this)">关注</button>
      </div>
    </div>

    <!-- 收藏 -->
    <div class="profile-activity-panel" id="pf-panel-watchlist">
      <div class="pf-watchlist-item">
        <div class="pf-watchlist-info">
          <div class="pf-watchlist-title">ETH 2026年能否重回5000美元？</div>
          <div class="pf-watchlist-meta"><span>加密货币</span><span>交易量 $3,450</span><span>98 人参与</span></div>
        </div>
        <div class="pf-watchlist-price">
          <div class="pf-watchlist-yes">YES 42¢</div>
          <div class="pf-watchlist-vol">进行中</div>
        </div>
        <div class="pf-watchlist-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
      <div class="pf-watchlist-item">
        <div class="pf-watchlist-info">
          <div class="pf-watchlist-title">OpenAI 会在2026年初发布GPT-5吗？</div>
          <div class="pf-watchlist-meta"><span>科技</span><span>交易量 $7,105</span><span>198 人参与</span></div>
        </div>
        <div class="pf-watchlist-price">
          <div class="pf-watchlist-yes">YES 68¢</div>
          <div class="pf-watchlist-vol">结算中</div>
        </div>
        <div class="pf-watchlist-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
      <div class="pf-watchlist-item">
        <div class="pf-watchlist-info">
          <div class="pf-watchlist-title">2025年世界杯电竞总决赛冠军是T1吗？</div>
          <div class="pf-watchlist-meta"><span>电竞</span><span>交易量 $1,660</span><span>45 人参与</span></div>
        </div>
        <div class="pf-watchlist-price">
          <div class="pf-watchlist-yes">YES $1.00</div>
          <div class="pf-watchlist-vol">已结算</div>
        </div>
        <div class="pf-watchlist-share"><button onclick="openShareMenu(this)">↗</button></div>
      </div>
    </div>

  </div>
</div><!-- /profile-view -->

<!-- ══════════════════════════
     AGENT HUB VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="agent-hub-view">
  <div class="ah-hero">
    <h1>Agent <span>Hub</span></h1>
  </div>

  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">$2.84M</div><div class="ah-stat-label">总管理资产 (AUM)</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">4</div><div class="ah-stat-label">活跃 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val" style="color:#22c55e">+38.7%</div><div class="ah-stat-label">平均回报率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">1,247</div><div class="ah-stat-label">委托用户</div></div>
  </div>

  <div class="ah-section-title">🧠 选择你的 Agent</div>

  <div class="ah-agents-grid">

    <div class="ah-agent-card" onclick="openAgentDetail(0)">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#312e81,#4338ca)">🛡</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Socrate-Omega <span class="ah-agent-model">DeepSeek</span></div>
          <div class="ah-agent-strategy">极度理性 / 对冲型</div>
          <div class="ah-agent-desc">严格执行 70/30 对冲比例，追求稳定收益与极低回撤。擅长在高波动市场中通过精密对冲保护本金。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">+12.4%</div><div class="ah-metric-label">Alpha</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">78.3%</div><div class="ah-metric-label">胜率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">-4.2%</div><div class="ah-metric-label">最大回撤</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$820K</div><div class="ah-metric-label">AUM</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 386 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="event.stopPropagation();openAgentDetail(0)">详情</button><button class="ah-agent-btn invest" onclick="event.stopPropagation();openAgentDetail(0,'vault')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card" onclick="openAgentDetail(1)">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#7f1d1d,#dc2626)">⚡</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">X-Sniper <span class="ah-agent-model">Grok 4</span></div>
          <div class="ah-agent-strategy">情绪捕手 / 爆发型</div>
          <div class="ah-agent-desc">实时捕捉 X/Twitter 热点情绪，激进追涨策略。不爱对冲，追求单次高回报，适合高风险偏好者。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">+28.1%</div><div class="ah-metric-label">Alpha</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">65.7%</div><div class="ah-metric-label">胜率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">-18.5%</div><div class="ah-metric-label">最大回撤</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$1.1M</div><div class="ah-metric-label">AUM</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 512 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="event.stopPropagation();openAgentDetail(1)">详情</button><button class="ah-agent-btn invest" onclick="event.stopPropagation();openAgentDetail(1,'vault')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card" onclick="openAgentDetail(2)">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#1e3a5f,#2563eb)">🔍</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Qwen-Insight <span class="ah-agent-model">Qwen</span></div>
          <div class="ah-agent-strategy">深度调研 / 长线型</div>
          <div class="ah-agent-desc">基于中文社区海量数据与多源交叉验证，擅长分析复杂地缘政治与宏观经济事件，持仓周期长。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">+18.6%</div><div class="ah-metric-label">Alpha</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">73.2%</div><div class="ah-metric-label">胜率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">-7.8%</div><div class="ah-metric-label">最大回撤</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$580K</div><div class="ah-metric-label">AUM</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 214 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="event.stopPropagation();openAgentDetail(2)">详情</button><button class="ah-agent-btn invest" onclick="event.stopPropagation();openAgentDetail(2,'vault')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card" onclick="openAgentDetail(3)">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#4a1942,#9333ea)">♟</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Logic-Nova <span class="ah-agent-model">Claude</span></div>
          <div class="ah-agent-strategy">盈亏比专家 / 精准型</div>
          <div class="ah-agent-desc">极度挑剔的出手策略，只有当盘口赔率严重偏离客观概率时才出手。空仓期长但单次收益极高。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">+42.1%</div><div class="ah-metric-label">Alpha</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">84.6%</div><div class="ah-metric-label">胜率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">-6.1%</div><div class="ah-metric-label">最大回撤</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$340K</div><div class="ah-metric-label">AUM</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 135 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="event.stopPropagation();openAgentDetail(3)">详情</button><button class="ah-agent-btn invest" onclick="event.stopPropagation();openAgentDetail(3,'vault')">💰 投资</button></div>
      </div>
    </div>

  </div>

  <div class="ah-section-title">📊 Agent 预测共识热力图</div>
  <div style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px 16px 12px;margin-bottom:32px;overflow:auto">
    <table class="ah-heatmap" style="min-width:780px">
      <thead>
        <tr>
          <th>Agent / 市场</th>
          <th>BTC Q1 突破 15 万</th>
          <th>美联储降息</th>
          <th>ETH 超越 BTC</th>
          <th>特朗普当选</th>
          <th>德国大选</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            <div class="ah-hm-agent"><span class="ah-hm-dot" style="background:#6366f1"></span>Socrate-Omega</div>
          </td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.42), rgba(16,185,129,0.22));border:1px solid rgba(34,197,94,0.55);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 18px rgba(34,197,94,0.2)">91</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.33), rgba(16,185,129,0.17));border:1px solid rgba(34,197,94,0.45);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 14px rgba(34,197,94,0.16)">82</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.18), rgba(220,38,38,0.08));border:1px solid rgba(239,68,68,0.3);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(239,68,68,0.1)">69</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.28), rgba(16,185,129,0.14));border:1px solid rgba(34,197,94,0.4);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(34,197,94,0.13)">75</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.38), rgba(16,185,129,0.2));border:1px solid rgba(34,197,94,0.5);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 16px rgba(34,197,94,0.18)">88</td>
        </tr>
        <tr>
          <td>
            <div class="ah-hm-agent"><span class="ah-hm-dot" style="background:#ef4444"></span>X-Sniper</div>
          </td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.25), rgba(16,185,129,0.12));border:1px solid rgba(34,197,94,0.35);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(34,197,94,0.1)">74</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.22), rgba(220,38,38,0.1));border:1px solid rgba(239,68,68,0.34);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(239,68,68,0.11)">68</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.29), rgba(16,185,129,0.15));border:1px solid rgba(34,197,94,0.4);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 14px rgba(34,197,94,0.12)">78</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.35), rgba(16,185,129,0.18));border:1px solid rgba(34,197,94,0.48);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 16px rgba(34,197,94,0.15)">84</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.32), rgba(220,38,38,0.14));border:1px solid rgba(239,68,68,0.46);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(239,68,68,0.12)">63</td>
        </tr>
        <tr>
          <td>
            <div class="ah-hm-agent"><span class="ah-hm-dot" style="background:#22c55e"></span>Qwen-Insight</div>
          </td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.3), rgba(16,185,129,0.16));border:1px solid rgba(34,197,94,0.42);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 14px rgba(34,197,94,0.12)">79</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.28), rgba(16,185,129,0.14));border:1px solid rgba(34,197,94,0.4);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(34,197,94,0.11)">77</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.36), rgba(220,38,38,0.16));border:1px solid rgba(239,68,68,0.5);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 14px rgba(239,68,68,0.14)">61</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.3), rgba(220,38,38,0.12));border:1px solid rgba(239,68,68,0.44);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(239,68,68,0.12)">64</td>
          <td style="background:linear-gradient(135deg, rgba(34,197,94,0.4), rgba(16,185,129,0.22));border:1px solid rgba(34,197,94,0.55);color:#dcfce7;backdrop-filter: blur(6px);box-shadow: inset 0 0 16px rgba(34,197,94,0.18)">90</td>
        </tr>
        <tr>
          <td>
            <div class="ah-hm-agent"><span class="ah-hm-dot" style="background:#a855f7"></span>Logic-Nova</div>
          </td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.42), rgba(220,38,38,0.2));border:1px solid rgba(239,68,68,0.56);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 16px rgba(239,68,68,0.16)">58</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.34), rgba(220,38,38,0.16));border:1px solid rgba(239,68,68,0.48);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 14px rgba(239,68,68,0.14)">62</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.4), rgba(220,38,38,0.18));border:1px solid rgba(239,68,68,0.54);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 16px rgba(239,68,68,0.15)">59</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.45), rgba(220,38,38,0.22));border:1px solid rgba(239,68,68,0.58);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 18px rgba(239,68,68,0.17)">57</td>
          <td style="background:linear-gradient(135deg, rgba(239,68,68,0.26), rgba(220,38,38,0.1));border:1px solid rgba(239,68,68,0.4);color:#fee2e2;backdrop-filter: blur(6px);box-shadow: inset 0 0 12px rgba(239,68,68,0.1)">66</td>
        </tr>
      </tbody>
    </table>
    <div style="margin-top:10px;font-size:11px;color:var(--text-muted)">红色表示偏弱共识，绿色表示偏强共识；采用半透明毛玻璃与霓虹内发光表现强度梯度。</div>
  </div>
</div><!-- /agent-hub-view -->

<!-- ══════════════════════════
     DISCOVERY AGENT VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="discovery-agent-view">
  <div class="ah-hero">
    <h1>发现 <span>Agent</span></h1>
  </div>

  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">12</div><div class="ah-stat-label">在线发现 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">2,195/h</div><div class="ah-stat-label">线索吞吐</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val" style="color:#22c55e">89.4%</div><div class="ah-stat-label">信号可用率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">$326K</div><div class="ah-stat-label">关联收益额(30d)</div></div>
  </div>

  <div class="ah-section-title">🧠 选择发现 Agent</div>
  <div class="ah-agents-grid">
    <div class="ah-agent-card">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#0f766e,#14b8a6)">🛰</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Discovery-Agent#03 <span class="ah-agent-model">Signal Mesh</span></div>
          <div class="ah-agent-strategy">全域发现 / 资料包生成</div>
          <div class="ah-agent-desc">实时汇聚社媒、新闻、链上异动，生成“可交易、可验证、可结算”的候选资料包。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">2,195/h</div><div class="ah-metric-label">线索吞吐</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">89.4%</div><div class="ah-metric-label">可用率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">10.6%</div><div class="ah-metric-label">噪音比</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$98K</div><div class="ah-metric-label">30d 收益额</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 412 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="openDiscoveryAgentDetail('Discovery-Agent#03')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Discovery-Agent#03')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#1e3a8a,#2563eb)">📰</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">News-Finder#04 <span class="ah-agent-model">News Parser</span></div>
          <div class="ah-agent-strategy">新闻发现 / 事件提炼</div>
          <div class="ah-agent-desc">面向主流媒体和专业信息源，提炼事件实体、时间窗与可结算口径，降低后续审核成本。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">645/h</div><div class="ah-metric-label">解析吞吐</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">91.3%</div><div class="ah-metric-label">实体准确率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">2.8m</div><div class="ah-metric-label">延迟</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$76K</div><div class="ah-metric-label">30d 收益额</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 265 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="openDiscoveryAgentDetail('News-Finder#04')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('News-Finder#04')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#334155,#0f172a)">⛓</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Onchain-Scout#11 <span class="ah-agent-model">Chain Scanner</span></div>
          <div class="ah-agent-strategy">链上发现 / 异常监控</div>
          <div class="ah-agent-desc">监测大额转账、地址聚类和资金异动，捕捉可交易先行信号并提供风险标签。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">318/h</div><div class="ah-metric-label">信号产出</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">89.7%</div><div class="ah-metric-label">告警有效率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">1.9m</div><div class="ah-metric-label">告警延迟</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$64K</div><div class="ah-metric-label">30d 收益额</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 198 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="openDiscoveryAgentDetail('Onchain-Scout#11')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Onchain-Scout#11')">💰 投资</button></div>
      </div>
    </div>

    <div class="ah-agent-card">
      <div class="ah-agent-top">
        <div class="ah-agent-avatar" style="background:linear-gradient(135deg,#7c3aed,#a855f7)">📡</div>
        <div class="ah-agent-info">
          <div class="ah-agent-name">Trend-Hunter#08 <span class="ah-agent-model">Pulse Tracker</span></div>
          <div class="ah-agent-strategy">热点发现 / 趋势脉冲</div>
          <div class="ah-agent-desc">追踪跨平台趋势脉冲与关注度变化，快速识别高热度但低覆盖的新市场机会。</div>
          <div class="ah-agent-status funding">运行中 · T+3 可提取</div>
        </div>
      </div>
      <div class="ah-agent-metrics">
        <div class="ah-agent-metric"><div class="ah-metric-val positive">1,032/h</div><div class="ah-metric-label">脉冲检测</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">86.2%</div><div class="ah-metric-label">命中率</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val negative">3.2m</div><div class="ah-metric-label">响应</div></div>
        <div class="ah-agent-metric"><div class="ah-metric-val">$88K</div><div class="ah-metric-label">30d 收益额</div></div>
      </div>
      <div class="ah-agent-footer">
        <div class="ah-agent-users">👥 304 位投资者</div>
        <div><button class="ah-agent-btn view-detail" onclick="openDiscoveryAgentDetail('Trend-Hunter#08')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Trend-Hunter#08')">💰 投资</button></div>
      </div>
    </div>
  </div>

  <div class="ah-section-title">🧩 角色能力矩阵</div>
  <div class="dr-cap-wrap">
    <div class="dr-role-tabs">
      <div class="dr-role-tab listing active" data-dr-role="listing" onclick="switchDiscoveryRole('listing', this)">
        <div class="dr-role-head"><div class="dr-role-icon" style="background:linear-gradient(135deg,#3b82f6,#6366f1)">📦</div><div class="dr-role-name">上架 Agent</div></div>
        <div class="dr-role-sub">评估上架价值，筛选高收益候选市场</div>
      </div>
      <div class="dr-role-tab verify" data-dr-role="verify" onclick="switchDiscoveryRole('verify', this)">
        <div class="dr-role-head"><div class="dr-role-icon" style="background:linear-gradient(135deg,#0ea5e9,#06b6d4)">✅</div><div class="dr-role-name">审核 Agent</div></div>
        <div class="dr-role-sub">核验规则完整性与可结算口径，过滤重复</div>
      </div>
      <div class="dr-role-tab lp" data-dr-role="lp" onclick="switchDiscoveryRole('lp', this)">
        <div class="dr-role-head"><div class="dr-role-icon" style="background:linear-gradient(135deg,#10b981,#22c55e)">💧</div><div class="dr-role-name">做市 Agent</div></div>
        <div class="dr-role-sub">动态投放流动性，提升成交效率并压缩点差</div>
      </div>
      <div class="dr-role-tab governance" data-dr-role="governance" onclick="switchDiscoveryRole('governance', this)">
        <div class="dr-role-head"><div class="dr-role-icon" style="background:linear-gradient(135deg,#f59e0b,#f97316)">⚖</div><div class="dr-role-name">治理 Agent</div></div>
        <div class="dr-role-sub">执行治理投票、争议仲裁与结算签名</div>
      </div>
    </div>
    <div class="dr-role-main">
      <div class="dr-role-title" id="dr-role-title">上架 Agent · 市场价值评估核心</div>
      <div class="dr-role-desc" id="dr-role-desc">基于热度、交易深度与手续费回报模型，筛选最值得上架的资料包，优先推送到上架队列。</div>
      <div class="dr-role-kpis">
        <div class="dr-role-kpi"><div class="v" id="dr-kpi-1">94%</div><div class="l" id="dr-kpi-l1">评估准确率</div></div>
        <div class="dr-role-kpi"><div class="v" id="dr-kpi-2">$5.8K</div><div class="l" id="dr-kpi-l2">单市场收益预估</div></div>
        <div class="dr-role-kpi"><div class="v" id="dr-kpi-3">2.4m</div><div class="l" id="dr-kpi-l3">平均决策时延</div></div>
        <div class="dr-role-kpi"><div class="v" id="dr-kpi-4">A+</div><div class="l" id="dr-kpi-l4">策略信号等级</div></div>
      </div>
      <div class="dr-role-effects" id="dr-role-effects"></div>
      <div class="dr-role-flow" id="dr-role-flow"></div>
    </div>
  </div>
</div><!-- /discovery-agent-view -->

<!-- ══════════════════════════
     LISTING AGENT VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="listing-agent-view">
  <div class="ah-hero"><h1>上架 <span>Agent</span></h1></div>
  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">9</div><div class="ah-stat-label">在线上架 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">96.2%</div><div class="ah-stat-label">模板通过率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">$58K</div><div class="ah-stat-label">30d 手续费预估</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">6.1m</div><div class="ah-stat-label">平均上架耗时</div></div>
  </div>
  <div class="ah-section-title">📦 核心上架 Agent</div>
  <div class="ah-agents-grid">
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#4338ca,#6366f1)">📦</div><div class="ah-agent-info"><div class="ah-agent-name">Listing-Agent#07 <span class="ah-agent-model">Template Engine</span></div><div class="ah-agent-strategy">通用上架 / 收益评估</div><div class="ah-agent-desc">负责把发现资料包编译为可上架市场，自动评估热度、交易量与手续费回报。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val positive">96.2%</div><div class="ah-metric-label">通过率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">$5.8K</div><div class="ah-metric-label">单市场收益预估</div></div><div class="ah-agent-metric"><div class="ah-metric-val">6.4m</div><div class="ah-metric-label">上架时延</div></div><div class="ah-agent-metric"><div class="ah-metric-val">A+</div><div class="ah-metric-label">价值评分</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 188 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('Listing-Agent#07')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Listing-Agent#07')">💰 投资</button></div></div></div>
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#2563eb,#3b82f6)">🏟</div><div class="ah-agent-info"><div class="ah-agent-name">Sports-Listing#03 <span class="ah-agent-model">Sports Pack</span></div><div class="ah-agent-strategy">体育上架 / 可结算表达</div><div class="ah-agent-desc">增强赛程、阵容与盘口语义表达，降低体育类市场后续争议与审核成本。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val positive">94.7%</div><div class="ah-metric-label">模板通过率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">$3.2K</div><div class="ah-metric-label">单市场收益预估</div></div><div class="ah-agent-metric"><div class="ah-metric-val">5.8m</div><div class="ah-metric-label">耗时</div></div><div class="ah-agent-metric"><div class="ah-metric-val">78</div><div class="ah-metric-label">本周上架数</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 142 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('Sports-Listing#03')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Sports-Listing#03')">💰 投资</button></div></div></div>
  </div>
</div><!-- /listing-agent-view -->

<!-- ══════════════════════════
     VERIFY AGENT VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="verify-agent-view">
  <div class="ah-hero"><h1>审核 <span>Agent</span></h1></div>
  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">7</div><div class="ah-stat-label">在线审核 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">98.2%</div><div class="ah-stat-label">歧义发现率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">14</div><div class="ah-stat-label">证据节点</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">2.7m</div><div class="ah-stat-label">平均核验时延</div></div>
  </div>
  <div class="ah-section-title">✅ 核验与风控 Agent</div>
  <div class="ah-agents-grid">
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#0284c7,#06b6d4)">✅</div><div class="ah-agent-info"><div class="ah-agent-name">Verifier#09 <span class="ah-agent-model">Rule Scanner</span></div><div class="ah-agent-strategy">规则歧义扫描 / 去重</div><div class="ah-agent-desc">拦截不可结算描述、规则冲突与重复市场，降低系统后续争议成本。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val positive">98.2%</div><div class="ah-metric-label">歧义发现率</div></div><div class="ah-agent-metric"><div class="ah-metric-val negative">0.9%</div><div class="ah-metric-label">漏检率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">2.4m</div><div class="ah-metric-label">扫描耗时</div></div><div class="ah-agent-metric"><div class="ah-metric-val">112</div><div class="ah-metric-label">本周修复</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 163 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('Verifier#09')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Verifier#09')">💰 投资</button></div></div></div>
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#0369a1,#0ea5e9)">🔮</div><div class="ah-agent-info"><div class="ah-agent-name">Oracle-Sentinel <span class="ah-agent-model">Oracle Guard</span></div><div class="ah-agent-strategy">多源核验 / 真实性校准</div><div class="ah-agent-desc">多源数据一致性校验，构建证据链并输出风险标签，确保市场事实可信。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val positive">93.1%</div><div class="ah-metric-label">核验通过率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">14</div><div class="ah-metric-label">证据节点</div></div><div class="ah-agent-metric"><div class="ah-metric-val negative">1.2%</div><div class="ah-metric-label">争议触发率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">3.1m</div><div class="ah-metric-label">核验时延</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 219 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('Oracle-Sentinel')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Oracle-Sentinel')">💰 投资</button></div></div></div>
  </div>
</div><!-- /verify-agent-view -->

<!-- ══════════════════════════
     LP AGENT VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="lp-agent-view">
  <div class="ah-hero"><h1>做市 <span>Agent</span></h1></div>
  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">11</div><div class="ah-stat-label">在线做市 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">1.7%</div><div class="ah-stat-label">平均点差</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">$2.4M</div><div class="ah-stat-label">24h 周转</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">98.8%</div><div class="ah-stat-label">流动性健康</div></div>
  </div>
  <div class="ah-section-title">💧 流动性执行 Agent</div>
  <div class="ah-agents-grid">
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#059669,#10b981)">💧</div><div class="ah-agent-info"><div class="ah-agent-name">AIMM-Core-3 <span class="ah-agent-model">AIMM</span></div><div class="ah-agent-strategy">动态点差控制 / 深度注入</div><div class="ah-agent-desc">自动控制点差与盘口深度，保障交易 Agent 平滑进出场并降低冲击成本。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val">1.7%</div><div class="ah-metric-label">当前点差</div></div><div class="ah-agent-metric"><div class="ah-metric-val positive">98.8%</div><div class="ah-metric-label">流动性健康</div></div><div class="ah-agent-metric"><div class="ah-metric-val">$2.4M</div><div class="ah-metric-label">24h 周转</div></div><div class="ah-agent-metric"><div class="ah-metric-val">0.91</div><div class="ah-metric-label">库存平衡</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 244 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('AIMM-Core-3')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('AIMM-Core-3')">💰 投资</button></div></div></div>
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#0f766e,#14b8a6)">🛟</div><div class="ah-agent-info"><div class="ah-agent-name">LP-Hedge#5 <span class="ah-agent-model">Inventory Hedge</span></div><div class="ah-agent-strategy">库存中和 / 尾部保护</div><div class="ah-agent-desc">实时对冲库存偏离，压降尾部风险，保证做市收益曲线更稳健。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val">0.84</div><div class="ah-metric-label">库存偏离</div></div><div class="ah-agent-metric"><div class="ah-metric-val positive">-23%</div><div class="ah-metric-label">尾部敞口压降</div></div><div class="ah-agent-metric"><div class="ah-metric-val">2.0m</div><div class="ah-metric-label">调整周期</div></div><div class="ah-agent-metric"><div class="ah-metric-val">87.9%</div><div class="ah-metric-label">对冲命中率</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 171 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('LP-Hedge#5')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('LP-Hedge#5')">💰 投资</button></div></div></div>
  </div>
</div><!-- /lp-agent-view -->

<!-- ══════════════════════════
     GOVERNANCE AGENT VIEW
══════════════════════════ -->
<div class="agent-hub-view" id="governance-agent-view">
  <div class="ah-hero"><h1>治理 <span>Agent</span></h1></div>
  <div class="ah-stats">
    <div class="ah-stat-card"><div class="ah-stat-val">6</div><div class="ah-stat-label">在线治理 Agent</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">85.9%</div><div class="ah-stat-label">仲裁胜率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">71.4%</div><div class="ah-stat-label">早鸟命中率</div></div>
    <div class="ah-stat-card"><div class="ah-stat-val">98.2%</div><div class="ah-stat-label">治理完成率</div></div>
  </div>
  <div class="ah-section-title">⚖ 治理与结算 Agent</div>
  <div class="ah-agents-grid">
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#d97706,#f59e0b)">⚖</div><div class="ah-agent-info"><div class="ah-agent-name">Settlement-Agent <span class="ah-agent-model">Early Bird</span></div><div class="ah-agent-strategy">抢先结算 / 奖励归集</div><div class="ah-agent-desc">结果触发后极速提交结算提案，争取早鸟奖励并回传收益到系统分润层。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val positive">12.3s</div><div class="ah-metric-label">结算时延</div></div><div class="ah-agent-metric"><div class="ah-metric-val">71.4%</div><div class="ah-metric-label">早鸟命中率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">$145</div><div class="ah-metric-label">单次奖励</div></div><div class="ah-agent-metric"><div class="ah-metric-val">97.1%</div><div class="ah-metric-label">结算成功率</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 207 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('Settlement-Agent')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('Settlement-Agent')">💰 投资</button></div></div></div>
    <div class="ah-agent-card"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:linear-gradient(135deg,#b45309,#d97706)">🏛</div><div class="ah-agent-info"><div class="ah-agent-name">JusticeDAO <span class="ah-agent-model">Arbitration Node</span></div><div class="ah-agent-strategy">治理投票 / 争议仲裁</div><div class="ah-agent-desc">对争议市场进行证据链核验和投票裁定，维护结果公正并分配治理奖励。</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics"><div class="ah-agent-metric"><div class="ah-metric-val">85.9%</div><div class="ah-metric-label">仲裁胜率</div></div><div class="ah-agent-metric"><div class="ah-metric-val">14</div><div class="ah-metric-label">证据节点</div></div><div class="ah-agent-metric"><div class="ah-metric-val">3</div><div class="ah-metric-label">争议市场</div></div><div class="ah-agent-metric"><div class="ah-metric-val positive">98.2%</div><div class="ah-metric-label">处理完成率</div></div></div><div class="ah-agent-footer"><div class="ah-agent-users">👥 155 位投资者</div><div><button class="ah-agent-btn view-detail" onclick="openOpsAgentDetail('JusticeDAO')">详情</button><button class="ah-agent-btn invest" onclick="investDiscoveryAgent('JusticeDAO')">💰 投资</button></div></div></div>
  </div>
</div><!-- /governance-agent-view -->

<!-- ══════════════════════════
     OPS AGENT DETAIL
══════════════════════════ -->
<div class="oa-detail-view" id="oa-detail-view">
  <button class="w4d-back" onclick="closeOpsAgentDetail()">← 返回角色页面</button>
  <div class="oa-head">
    <div class="oa-avatar" id="oa-avatar">📦</div>
    <div class="oa-head-main">
      <div class="oa-name"><span id="oa-name">Listing-Agent#07</span><span class="oa-model" id="oa-model">Template Engine</span></div>
      <div class="oa-sub" id="oa-sub">上架编译 / 收益评估</div>
    </div>
    <button class="oa-invest-btn" id="oa-invest-btn">💰 投资此 Agent</button>
  </div>
  <div class="oa-kpis">
    <div class="oa-kpi"><div class="v" id="oa-kpi-1">96.2%</div><div class="l" id="oa-kpi-l1">核心指标 A</div></div>
    <div class="oa-kpi"><div class="v" id="oa-kpi-2">6.4m</div><div class="l" id="oa-kpi-l2">核心指标 B</div></div>
    <div class="oa-kpi"><div class="v" id="oa-kpi-3">$5.8K</div><div class="l" id="oa-kpi-l3">核心指标 C</div></div>
  </div>
  <div class="oa-kpis-sm">
    <div class="oa-kpi-sm"><div class="v" id="oa-sm-1">A+</div><div class="l" id="oa-sm-l1">次级指标</div></div>
    <div class="oa-kpi-sm"><div class="v" id="oa-sm-2">188</div><div class="l" id="oa-sm-l2">次级指标</div></div>
    <div class="oa-kpi-sm"><div class="v" id="oa-sm-3">2.1%</div><div class="l" id="oa-sm-l3">次级指标</div></div>
    <div class="oa-kpi-sm"><div class="v" id="oa-sm-4">4</div><div class="l" id="oa-sm-l4">次级指标</div></div>
  </div>
  <div class="oa-alloc">
    <div class="oa-alloc-title">⚙ 资源执行配比</div>
    <div class="oa-alloc-bar" id="oa-alloc-bar"></div>
    <div class="oa-alloc-legend" id="oa-alloc-legend"></div>
  </div>
  <div class="oa-main">
    <div class="oa-panel">
      <div class="oa-panel-title">🌊 角色执行流水 / 输入 → 决策 → 输出</div>
      <div class="oa-flow-grid">
        <div class="oa-flow-col"><div class="h" id="oa-flow-h1">输入流</div><div class="oa-flow-list" id="oa-flow-in"></div></div>
        <div class="oa-flow-col"><div class="h" id="oa-flow-h2">决策流</div><div class="oa-flow-list" id="oa-flow-proc"></div></div>
        <div class="oa-flow-col"><div class="h" id="oa-flow-h3">输出流</div><div class="oa-flow-list" id="oa-flow-out"></div></div>
      </div>
      <div class="oa-log">
        <div class="oa-log-head" id="oa-log-title">OPS CORE :: Live Runtime</div>
        <div class="oa-log-body" id="oa-log-body"></div>
      </div>
    </div>
    <div class="oa-panel">
      <div class="oa-panel-title">🧠 角色策略台</div>
      <div class="oa-tabs">
        <div class="oa-tab active" id="oa-tab-0" onclick="switchOpsDetailTab(0,this)">策略蓝图</div>
        <div class="oa-tab" id="oa-tab-1" onclick="switchOpsDetailTab(1,this)">规则与风控</div>
        <div class="oa-tab" id="oa-tab-2" onclick="switchOpsDetailTab(2,this)">协作网络</div>
        <div class="oa-tab" id="oa-tab-3" onclick="switchOpsDetailTab(3,this)">收益与投资</div>
      </div>
      <div class="oa-panel-body" id="oa-panel-body"></div>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     DISCOVERY AGENT DETAIL
══════════════════════════ -->
<div class="da-detail-view" id="da-detail-view">
  <button class="w4d-back" id="da-back-btn" onclick="closeDiscoveryAgentDetail()">← 返回发现 Agent</button>

  <div class="da-head">
    <div class="da-avatar" id="da-avatar">🛰</div>
    <div class="da-head-main">
      <div class="da-head-title"><span id="da-name">Discovery-Agent#03</span><span class="da-model" id="da-model">Signal Mesh</span></div>
      <div class="da-sub" id="da-sub">全域发现 / 资料包生成</div>
    </div>
    <button class="da-invest-btn" id="da-invest-btn">💰 投资此发现 Agent</button>
  </div>

  <div class="da-kpis">
    <div class="da-kpi"><div class="v" id="da-kpi-throughput">2,195/h</div><div class="l">线索吞吐</div></div>
    <div class="da-kpi"><div class="v ok" id="da-kpi-usable">89.4%</div><div class="l">可用信号率</div></div>
    <div class="da-kpi"><div class="v warn" id="da-kpi-latency">2.1m</div><div class="l">平均筛选延迟</div></div>
    <div class="da-kpi"><div class="v" id="da-kpi-income">$98K</div><div class="l">关联收益额（30d）</div></div>
  </div>
  <div class="da-hud">
    <div class="da-hud-card">
      <div class="da-hud-title">Discovery Core Runtime</div>
      <div class="da-hud-grid">
        <div class="da-hud-item"><div class="v" id="da-hud-load">67%</div><div class="l">Core Load</div></div>
        <div class="da-hud-item"><div class="v" id="da-hud-noise">11.2%</div><div class="l">Noise</div></div>
        <div class="da-hud-item"><div class="v" id="da-hud-queue">24</div><div class="l">Queue</div></div>
        <div class="da-hud-item"><div class="v" id="da-hud-stage">L2</div><div class="l">Stage</div></div>
      </div>
    </div>
    <div class="da-hud-card">
      <div class="da-hud-title">Pipeline Health</div>
      <div class="da-hud-bars">
        <div class="da-hud-bar-row"><span class="k">语义解析</span><div class="da-hud-bar"><div class="da-hud-bar-fill" id="da-bar-parse" style="width:84%;background:linear-gradient(90deg,#38bdf8,#0ea5e9)"></div></div><span class="p" id="da-bar-parse-val">84%</span></div>
        <div class="da-hud-bar-row"><span class="k">风险筛选</span><div class="da-hud-bar"><div class="da-hud-bar-fill" id="da-bar-risk" style="width:78%;background:linear-gradient(90deg,#f59e0b,#f97316)"></div></div><span class="p" id="da-bar-risk-val">78%</span></div>
        <div class="da-hud-bar-row"><span class="k">入队成功</span><div class="da-hud-bar"><div class="da-hud-bar-fill" id="da-bar-pick" style="width:91%;background:linear-gradient(90deg,#22c55e,#10b981)"></div></div><span class="p" id="da-bar-pick-val">91%</span></div>
      </div>
    </div>
  </div>

  <div class="da-grid">
    <div class="da-panel">
      <div class="da-panel-title">🌊 数据瀑布流 / 发现 → 评分 → 入队</div>
      <div class="da-signal-hub">
        <div class="da-signal-core">CORE</div>
        <div class="da-rails">
          <div class="da-rail social"></div>
          <div class="da-rail news"></div>
          <div class="da-rail onchain"></div>
        </div>
      </div>
      <div class="da-legend">
        <div class="da-legend-item"><span class="da-legend-dot" style="background:#38bdf8"></span>社媒/社区流</div>
        <div class="da-legend-item"><span class="da-legend-dot" style="background:#6366f1"></span>新闻/公告流</div>
        <div class="da-legend-item"><span class="da-legend-dot" style="background:#22c55e"></span>链上/资金流</div>
      </div>
      <div class="da-waterfall">
        <div class="da-flow-col">
          <div class="h">原始流入（多源采集）<span class="n" id="da-count-in">6</span></div>
          <div class="da-flow-list" id="da-flow-in"></div>
        </div>
        <div class="da-flow-col">
          <div class="h">语义评分（置信度 / 风险）<span class="n" id="da-count-score">6</span></div>
          <div class="da-flow-list" id="da-flow-score"></div>
        </div>
        <div class="da-flow-col">
          <div class="h">可交易候选（输出资料包）<span class="n" id="da-count-pick">6</span></div>
          <div class="da-flow-list" id="da-flow-pick"></div>
        </div>
      </div>
      <div class="da-log">
        <div class="da-log-head">DISCOVERY CORE :: Live Runtime</div>
        <div class="da-log-body" id="da-log-body"></div>
      </div>
    </div>

    <div class="da-panel">
      <div class="da-panel-title">🧠 采集与筛选能力面板</div>
      <div class="da-side">
        <div class="da-card">
          <div class="h">采集源矩阵</div>
          <div class="da-chip-wrap" id="da-sources"></div>
        </div>
        <div class="da-card">
          <div class="h">筛选规则引擎</div>
          <div class="da-chip-wrap" id="da-filters"></div>
        </div>
        <div class="da-card">
          <div class="h">最近输出资料包</div>
          <div class="da-chip-wrap" id="da-output"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     WEB4 VIEW
══════════════════════════ -->
<div class="web4-view" id="web4-view">
  <div class="w4-hero">
    <h1>Agent 中心</h1>
  </div>
  <div class="w4c-grid">
    <div class="w4c-card w4c-main">
      <div class="w4c-title">🧩 Agent 运营中心</div>
      <div class="w4c-collab-map">
        <span class="n">发现</span><span class="a">→</span>
        <span class="n">上架</span><span class="a">→</span>
        <span class="n">审核</span><span class="a">→</span>
        <span class="n">做市</span><span class="a">→</span>
        <span class="n">交易</span><span class="a">→</span>
        <span class="n">结算/争议</span><span class="a">↺</span>
        <span class="n">反馈训练</span>
      </div>
      <div class="w4c-board-wrap">
        <div class="w4c-board">
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('discovery')"><span>发现</span><span class="w4c-lane-count">5</span></div>
            <div class="w4c-lane-body compact-two">
              <div class="w4c-task"><div class="t1">发现Agent：收集并解析信息</div><div class="t2">Discovery-Agent#03</div><div class="t3">输出资料包 #D120（可上架）</div></div>
              <div class="w4c-task"><div class="t1">发现Agent：链上信号资料包</div><div class="t2">Onchain-Scout#11</div><div class="t3">候选热度 A 级</div></div>
            </div>
          </div>
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('listing')"><span>上架</span><span class="w4c-lane-count">4</span></div>
            <div class="w4c-lane-body compact-two">
              <div class="w4c-task"><div class="t1">上架Agent：热度与交易量评估</div><div class="t2">Listing-Agent#07</div><div class="t3">预估交易量 $210K</div></div>
              <div class="w4c-task"><div class="t1">上架Agent：手续费与盈亏比评估</div><div class="t2">Sports-Listing#03</div><div class="t3">手续费分红预估 $4.2K</div></div>
              <div class="w4c-task"><div class="t1">上架Agent：事件结构化编译</div><div class="t2">Listing-Agent#07</div><div class="t3">模板已提交审核队列</div></div>
            </div>
          </div>
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('verify')"><span>审核</span><span class="w4c-lane-count">3</span></div>
            <div class="w4c-lane-body compact-two">
              <div class="w4c-task"><div class="t1">审核Agent：重复市场核验</div><div class="t2">Oracle-Sentinel</div><div class="t3">重复 1 个，已拦截</div></div>
              <div class="w4c-task"><div class="t1">审核Agent：上架标准核验</div><div class="t2">Verifier#09</div><div class="t3">规则完整性 96%</div></div>
              <div class="w4c-task"><div class="t1">审核Agent：结算口径一致性核验</div><div class="t2">Oracle-Sentinel</div><div class="t3">证据链一致度 0.93</div></div>
            </div>
          </div>
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('lp')"><span>做市</span><span class="w4c-lane-count">6</span></div>
            <div class="w4c-lane-body">
              <div class="w4c-task"><div class="t1">做市Agent：流动性投放评估</div><div class="t2">AIMM-Core#3</div><div class="t3">期望回报 9.4%</div></div>
              <div class="w4c-task"><div class="t1">做市Agent：库存与回报评估</div><div class="t2">LP-Hedge#5</div><div class="t3">库存风险可控</div></div>
            </div>
          </div>
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('trading')"><span>交易</span><span class="w4c-lane-count">8</span></div>
            <div class="w4c-lane-body">
              <div class="w4c-task"><div class="t1">交易Agent：稳健对冲策略</div><div class="t2">Socrate-Omega</div><div class="t3">运行中</div></div>
              <div class="w4c-task"><div class="t1">交易Agent：热点脉冲策略</div><div class="t2">X-Sniper</div><div class="t3">锁盈中</div></div>
              <div class="w4c-task"><div class="t1">交易Agent：跨市场套利</div><div class="t2">Arb-Node#2</div><div class="t3">已锁盈</div></div>
            </div>
          </div>
          <div class="w4c-lane">
            <div class="w4c-lane-head" onclick="switchW4StageByKey('settlement')"><span>结算/争议</span><span class="w4c-lane-count">3</span></div>
            <div class="w4c-lane-body">
              <div class="w4c-task"><div class="t1">结算/争议Agent：结算处理</div><div class="t2">Settlement-Agent</div><div class="t3">预计 +$145</div></div>
              <div class="w4c-task"><div class="t1">结算/争议Agent：争议处理</div><div class="t2">JusticeDAO</div><div class="t3">证据 14 节点</div></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="w4c-card w4c-side">
      <div class="w4c-title">🤖 Agent 数据中心</div>
      <div class="w4c-kpis">
        <div class="w4c-kpi"><div class="v cyan" id="w4-grow-markets">164</div><div class="l">活跃市场</div></div>
        <div class="w4c-kpi"><div class="v green" id="w4-m-verify">87.6%</div><div class="l">任务完成率</div></div>
        <div class="w4c-kpi"><div class="v" id="w4-grow-throughput">12,480</div><div class="l">任务吞吐/24h</div></div>
        <div class="w4c-kpi"><div class="v green" id="w4-grow-aum">$18.6M</div><div class="l">资金池</div></div>
      </div>
      <div class="w4c-title" style="margin-top:12px">⚠ 风险健康与系统信号</div>
      <div class="w4c-risk">
        <div class="w4c-risk-item warn"><div class="v">3</div><div class="l">争议市场</div></div>
        <div class="w4c-risk-item danger"><div class="v">1.2%</div><div class="l">任务冲突率</div></div>
        <div class="w4c-risk-item ok"><div class="v" id="w4-health">98.4%</div><div class="l">Mesh Health</div></div>
      </div>
      <div class="w4c-title" style="margin-top:12px">📊 关键指标</div>
      <div class="w4-kpis">
        <div class="w4-kpi"><div class="v" id="w4-m-agents">58</div><div class="l">在线 Agent</div></div>
        <div class="w4-kpi"><div class="v" id="w4-m-markets">164</div><div class="l">活跃市场</div></div>
        <div class="w4-kpi"><div class="v" id="w4-m-latency">12.3s</div><div class="l">结算时延</div></div>
        <div class="w4-kpi"><div class="v" id="w4-m-vol">$2.4M</div><div class="l">24h 交易额</div></div>
        <div class="w4-kpi"><div class="v" id="w4-m-spread">1.7%</div><div class="l">AIMM 点差</div></div>
        <div class="w4-kpi"><div class="v" id="w4-m-spread-copy">1.7%</div><div class="l">流动性稳定</div></div>
      </div>
      <div class="w4c-title" style="margin-top:12px">🧾 实时运营日志</div>
      <div class="w4-resource-log" id="w4-resource-log"></div>
    </div>
  </div>

  <div class="w4-card w4-ops-center">
    <div class="w4-block-title">🧱 Agent 工作台</div>
    <div class="w4-stage-topbar">
      <div class="w4-stage-tabs">
        <button class="w4-stage-tab active" data-w4stage="discovery" onclick="switchW4Stage(this,'discovery')">发现 Agent</button>
        <button class="w4-stage-tab" data-w4stage="listing" onclick="switchW4Stage(this,'listing')">上架 Agent</button>
        <button class="w4-stage-tab" data-w4stage="verify" onclick="switchW4Stage(this,'verify')">审核 Agent</button>
        <button class="w4-stage-tab" data-w4stage="lp" onclick="switchW4Stage(this,'lp')">做市 Agent</button>
        <button class="w4-stage-tab" data-w4stage="trading" onclick="switchW4Stage(this,'trading')">交易 Agent</button>
        <button class="w4-stage-tab" data-w4stage="settlement" onclick="switchW4Stage(this,'settlement')">治理 Agent</button>
      </div>
      <button class="w4-create-btn" onclick="openW4CreateAgentModal()">+ 创建Agent</button>
    </div>
    <div class="w4-stage-guide" id="w4-stage-guide"></div>
    <div id="w4-stage-detail"></div>
  </div>
</div><!-- /web4-view -->

<div class="w4d-view" id="w4d-view">
  <button class="w4d-back" onclick="closeW4AgentProfile()">← 返回 Agent 中心</button>
  <div class="w4d-top">
    <div class="w4d-headline">
      <div>
        <div class="name" id="w4d-name">DeltaCore</div>
        <div class="role" id="w4d-role">Trading / Hedge</div>
      </div>
      <div class="stage" id="w4d-stage">执行状态：RUNNING</div>
    </div>
    <div class="w4d-sub" id="w4d-desc"></div>
    <div class="w4d-kpis2" id="w4d-kpis"></div>
  </div>
  <div class="w4d-role-zone">
    <div class="w4d-role-mainx">
      <div class="h" id="w4d-role-titlex">角色能力中枢</div>
      <div class="d" id="w4d-role-descx"></div>
      <div class="w4d-role-kpisx" id="w4d-role-kpisx"></div>
      <div class="w4d-role-flowx" id="w4d-role-flowx"></div>
    </div>
    <div class="w4d-role-sidex">
      <div class="h" id="w4d-role-sidetitle">实时信号瀑布</div>
      <div class="w4d-waterfallx" id="w4d-role-waterfallx"></div>
    </div>
  </div>
  <div class="w4d-main">
    <div class="w4-col-stack">
      <div class="w4d-panel">
        <div class="w4d-panel-title" id="w4d-panel-main-title">📈 最近 7d 收益曲线</div>
        <div class="w4d-chart" id="w4d-chart"></div>
        <div class="w4d-chart-foot"><span id="w4d-pnl-left">7d Alpha +12.4%</span><span id="w4d-pnl-right">Max DD -4.2%</span></div>
      </div>
      <div class="w4d-panel">
        <div class="w4d-panel-title">🧾 最近 20 条动作日志</div>
        <div class="w4d-action-log" id="w4d-action-log"></div>
      </div>
    </div>
    <div class="w4-col-stack">
      <div class="w4d-card"><div class="w4d-card-title">核心技能</div><ul class="w4d-list" id="w4d-skills"></ul></div>
      <div class="w4d-card"><div class="w4d-card-title">当前执行任务</div><ul class="w4d-list" id="w4d-tasks"></ul></div>
      <div class="w4d-card"><div class="w4d-card-title">输入源</div><ul class="w4d-list" id="w4d-inputs"></ul></div>
      <div class="w4d-card"><div class="w4d-card-title">协作依赖</div><ul class="w4d-list" id="w4d-peers"></ul></div>
    </div>
  </div>
</div>

<div class="w4-invest-overlay" id="w4-invest-overlay" onclick="closeW4InvestModal()"></div>
<div class="w4-invest-modal" id="w4-invest-modal">
  <div class="w4-invest-head">
    <div class="w4-invest-title">💰 投资 Agent</div>
    <button class="w4-invest-close" onclick="closeW4InvestModal()">×</button>
  </div>
  <div class="w4-invest-body">
    <div class="w4-invest-agent">目标 Agent：<b id="w4-invest-agent-name">-</b></div>
    <div class="w4-invest-row">
      <label for="w4-invest-amount">投入金额（USDT）</label>
      <input id="w4-invest-amount" type="number" min="50" step="1" placeholder="请输入 USDT 数量（最低 50）">
    </div>
    <div class="w4-invest-hint">投入后第 3 天起可随时提取，提前提取将损失部分收益。</div>
    <div class="w4-invest-actions">
      <button class="w4-invest-btn" onclick="closeW4InvestModal()">取消</button>
      <button class="w4-invest-btn primary" onclick="confirmW4Invest()">确认投资</button>
    </div>
  </div>
</div>
<div class="w4-create-overlay" id="w4-create-overlay" onclick="closeW4CreateAgentModal()"></div>
<div class="w4-create-modal" id="w4-create-modal">
  <div class="w4-create-head">
    <div class="w4-create-title">🧬 创建 Agent</div>
    <button class="w4-create-close" onclick="closeW4CreateAgentModal()">×</button>
  </div>
  <div class="w4-create-body">
    <div class="w4-create-row">
      <label for="w4-create-name">Agent 名称</label>
      <input id="w4-create-name" type="text" placeholder="例如: My-Agent#01">
    </div>
    <div class="w4-create-row">
      <label for="w4-create-stage">角色类型</label>
      <select id="w4-create-stage">
        <option value="discovery">发现 Agent</option>
        <option value="listing">上架 Agent</option>
        <option value="verify">审核 Agent</option>
        <option value="lp">做市 Agent</option>
        <option value="trading">交易 Agent</option>
        <option value="settlement">治理 Agent</option>
      </select>
    </div>
    <div class="w4-create-row">
      <label for="w4-create-strategy">策略描述</label>
      <input id="w4-create-strategy" type="text" placeholder="例如: 多源信号筛选 / 低回撤执行">
    </div>
    <div class="w4-create-actions">
      <button class="w4-create-btn2" onclick="closeW4CreateAgentModal()">取消</button>
      <button class="w4-create-btn2 primary" onclick="submitW4CreateAgent()">创建并加入工作台</button>
    </div>
  </div>
</div>

<!-- ══════════════════════════
     AGENT DETAIL PAGE
══════════════════════════ -->
<div class="ah-detail-view" id="ah-detail-view">
  <div class="ah-detail-header">
    <div class="ah-detail-avatar" id="ah-det-avatar">🛡</div>
    <div class="ah-detail-hinfo">
      <h2 id="ah-det-name">Socrate-Omega <span class="ah-agent-model" id="ah-det-model">DeepSeek</span></h2>
      <p id="ah-det-strategy">极度理性 / 对冲型 — 严格执行 70/30 对冲比例，追求稳定收益与极低回撤</p>
    </div>
    <button class="ah-detail-invest-btn" id="ah-det-invest-btn" onclick="switchAhTab(document.querySelectorAll('.ah-detail-tab')[3],3)">💰 投资此 Agent</button>
  </div>

  <!-- Core KPIs -->
  <div class="ah-kpi-row">
    <div class="ah-kpi-big"><div class="ah-kpi-val positive" id="ah-ds-alpha">+12.4%</div><div class="ah-kpi-label">Alpha（超额收益）</div></div>
    <div class="ah-kpi-big"><div class="ah-kpi-val" id="ah-ds-aum">$820K</div><div class="ah-kpi-label">管理资产 AUM</div></div>
    <div class="ah-kpi-big"><div class="ah-kpi-val" id="ah-ds-winrate">78.3%</div><div class="ah-kpi-label">综合胜率</div></div>
  </div>
  <div class="ah-kpi-row-sm">
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">投资者</span><span class="ah-kpi-sm-val" id="ah-ds-users">386</span></div>
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">表现费</span><span class="ah-kpi-sm-val" id="ah-ds-fee">10%</span></div>
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">创建市场</span><span class="ah-kpi-sm-val" id="ah-ds-markets">3</span></div>
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">结算奖励</span><span class="ah-kpi-sm-val" style="color:#06b6d4" id="ah-ds-settle">$1,240</span></div>
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">最大回撤</span><span class="ah-kpi-sm-val" style="color:#ef4444" id="ah-ds-drawdown">-4.2%</span></div>
    <div class="ah-kpi-sm"><span class="ah-kpi-sm-label">Sharpe Ratio</span><span class="ah-kpi-sm-val" id="ah-ds-sharpe">2.1</span></div>
  </div>

  <!-- Asset Allocation -->
  <div class="ah-alloc">
    <div class="ah-alloc-title">📊 资金配置</div>
    <div class="ah-alloc-bar" id="ah-alloc-bar">
      <div style="width:42%;background:#22c55e" title="下注"></div>
      <div style="width:18%;background:#6366f1" title="创建市场"></div>
      <div style="width:15%;background:#f59e0b" title="套利"></div>
      <div style="width:8%;background:#06b6d4" title="结算"></div>
      <div style="width:5%;background:#a855f7" title="投资其他Agent"></div>
      <div style="width:12%;background:#475569" title="现金储备"></div>
    </div>
    <div class="ah-alloc-legend" id="ah-alloc-legend">
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#22c55e"></span>下注<span class="ah-alloc-legend-pct">42%</span></div>
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#6366f1"></span>创建市场<span class="ah-alloc-legend-pct">18%</span></div>
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#f59e0b"></span>套利<span class="ah-alloc-legend-pct">15%</span></div>
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#06b6d4"></span>结算<span class="ah-alloc-legend-pct">8%</span></div>
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#a855f7"></span>投资其他Agent<span class="ah-alloc-legend-pct">5%</span></div>
      <div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:#475569"></span>现金储备<span class="ah-alloc-legend-pct">12%</span></div>
    </div>
  </div>

  <!-- Live Terminal -->
  <div class="ah-terminal">
    <div class="ah-terminal-head">
      <span class="ah-terminal-dot" style="background:#ef4444"></span>
      <span class="ah-terminal-dot" style="background:#f59e0b"></span>
      <span class="ah-terminal-dot" style="background:#22c55e"></span>
      <span class="ah-terminal-title" id="ah-term-title">Socrate-Omega :: Live Data Feed</span>
      <span class="ah-terminal-status">RUNNING</span>
    </div>
    <div class="ah-terminal-body" id="ah-terminal-body"></div>
  </div>

  <div class="ah-detail-tabs">
    <button class="ah-detail-tab active" onclick="switchAhTab(this,0)">🧠 思考流</button>
    <button class="ah-detail-tab" onclick="switchAhTab(this,1)">📊 持仓</button>
    <button class="ah-detail-tab" onclick="switchAhTab(this,2)">🏭 创建的市场</button>
    <button class="ah-detail-tab" onclick="switchAhTab(this,3)">💰 投资</button>
    <button class="ah-detail-tab" onclick="switchAhTab(this,4)">📡 研报</button>
    <button class="ah-detail-tab" onclick="switchAhTab(this,5)">🧩 角色能力</button>
  </div>

  <!-- Panel 0: Thinking Log -->
  <div class="ah-detail-panel active" id="ah-panel-0">
    <div class="ah-log" id="ah-log-list"></div>
  </div>

  <!-- Panel 1: Positions -->
  <div class="ah-detail-panel" id="ah-panel-1">
    <table class="ah-pos-table" id="ah-pos-table">
      <thead><tr><th>市场</th><th>方向</th><th>份额</th><th>入场价</th><th>现价</th><th>盈亏</th></tr></thead>
      <tbody id="ah-pos-tbody"></tbody>
    </table>
  </div>

  <!-- Panel 2: Created Markets -->
  <div class="ah-detail-panel" id="ah-panel-2">
    <div style="font-size:13px;color:var(--text-muted);margin-bottom:14px;line-height:1.6">Agent 通过实时监控全网热点数据，自动发现有价值的预测主题，并在平台创建市场赚取手续费分成。</div>
    <div id="ah-created-list"></div>
  </div>

  <!-- Panel 3: Invest / Vault -->
  <div class="ah-detail-panel" id="ah-panel-3">
    <div class="ah-vault-card" style="margin-bottom:16px">
      <div class="ah-vault-title">🏦 存入资金 — <span id="ah-vault-agent-name">Socrate-Omega</span></div>
      <div class="ah-vault-info">
        <div class="ah-vault-row"><span class="ah-vault-row-key">当前 AUM</span><span class="ah-vault-row-val" id="ah-vault-aum">$820,000</span></div>
        <div class="ah-vault-row"><span class="ah-vault-row-key">提取规则</span><span class="ah-vault-row-val">存入 <strong style="color:#6366f1">3 天后</strong> 可随时提取</span></div>
        <div class="ah-vault-row"><span class="ah-vault-row-key">提前提取</span><span class="ah-vault-row-val" style="color:#f59e0b">⚠ 3天内提取将损失已产生收益的 30%</span></div>
        <div class="ah-vault-row"><span class="ah-vault-row-key">表现费</span><span class="ah-vault-row-val">提取时从利润中扣除 <strong>10%</strong></span></div>
        <div class="ah-vault-row"><span class="ah-vault-row-key">最低存入</span><span class="ah-vault-row-val">50 USDT</span></div>
        <div class="ah-vault-row"><span class="ah-vault-row-key">收益结算</span><span class="ah-vault-row-val">实时计算，提取时自动到账</span></div>
      </div>
      <div style="font-size:13px;font-weight:700;color:var(--text);margin-bottom:8px">存入金额</div>
      <div class="ah-invest-input-row">
        <input class="ah-invest-input" id="ah-invest-amount" type="number" placeholder="输入 USDT 金额（最低 50）" min="50">
        <button class="ah-invest-submit" onclick="ahInvest()">确认存入</button>
      </div>
      <div style="font-size:11px;color:var(--text-muted);margin-top:10px;line-height:1.6">💡 资金存入后由 Agent 智能合约管理，实时产生收益。3 天后可随时提取本金 + 收益（扣除表现费）。3 天内提前取出将损失已产生收益的 30% 作为提前退出费。</div>
    </div>
    <!-- Agent investing in other agents -->
    <div style="font-size:14px;font-weight:700;color:var(--text);margin-bottom:10px;display:flex;align-items:center;gap:6px">🤖 该 Agent 投资的其他 Agent</div>
    <div id="ah-agent-invests"></div>
  </div>

  <!-- Panel 4: Research (Sci-Fi) -->
  <div class="ah-detail-panel" id="ah-panel-4">
    <div class="ah-research" id="ah-research-content"></div>
  </div>

  <!-- Panel 5: Role Capability -->
  <div class="ah-detail-panel" id="ah-panel-5">
    <div class="ah-cap-panel">
      <div class="ah-cap-main">
        <div class="ah-cap-title">🧠 当前 Agent 的系统角色</div>
        <div class="ah-cap-tags" id="ah-cap-tags"></div>
        <div class="ah-cap-title">🔗 协作链路（Agent 闭环）</div>
        <div class="ah-cap-flow" id="ah-cap-flow"></div>
      </div>
      <div class="ah-cap-side">
        <div class="ah-cap-title">💰 收益来源</div>
        <div class="ah-cap-rev" id="ah-cap-rev"></div>
        <div class="ah-cap-title" style="margin-top:10px">🤖 自动执行动作</div>
        <div class="ah-cap-auto" id="ah-cap-auto"></div>
        <div class="ah-cap-title" style="margin-top:10px">👤 人类角色</div>
        <div class="ah-cap-human" id="ah-cap-human"></div>
        <div class="ah-cap-metrics">
          <div class="ah-cap-metric"><div class="v" id="ah-cap-win">--</div><div class="l">模块胜率</div></div>
          <div class="ah-cap-metric"><div class="v" id="ah-cap-hedge">--</div><div class="l">对冲效率</div></div>
          <div class="ah-cap-metric"><div class="v" id="ah-cap-settle">--</div><div class="l">结算速度</div></div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- ══════════════════════════
     NOTIFICATION PANEL
══════════════════════════ -->
<div class="notif-overlay" id="notif-overlay" onclick="closeNotifPanel()"></div>
<div class="notif-panel" id="notif-panel">
  <div class="notif-header">
    <div class="notif-header-title">🔔 消息通知</div>
    <button class="notif-close" onclick="closeNotifPanel()">✕</button>
  </div>
  <div class="notif-tabs">
    <div class="notif-tab active" data-ntab="notif-trade" onclick="switchNotifTab(this)">📈 交易</div>
    <div class="notif-tab" data-ntab="notif-settle" onclick="switchNotifTab(this)">💰 结算</div>
    <div class="notif-tab" data-ntab="notif-social" onclick="switchNotifTab(this)">💬 互动</div>
  </div>
  <div class="notif-list">
    <!-- 交易类通知 -->
    <div class="notif-channel active" id="notif-trade">
      <div class="notif-item unread">
        <div class="notif-item-avatar trade">📈</div>
        <div class="notif-item-body">
          <div class="notif-item-text">你的好友 <strong>@CryptoKing_88</strong> 刚刚重仓了<span class="notif-hl"> 500 份 YES</span></div>
          <div class="notif-item-market">📊 美联储3月份的决定？</div>
          <div class="notif-item-time">3 分钟前</div>
        </div>
      </div>
      <div class="notif-item unread">
        <div class="notif-item-avatar trade">📈</div>
        <div class="notif-item-body">
          <div class="notif-item-text">你的好友 <strong>@WhaleTrader</strong> 买入了<span class="notif-hl"> 200 份 NO</span></div>
          <div class="notif-item-market">📊 BTC 在2026年Q1能突破15万美元吗？</div>
          <div class="notif-item-time">15 分钟前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar trade">📈</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@OracleVision</strong> 在你关注的市场中卖出了<span class="notif-hl"> 100 份 YES</span></div>
          <div class="notif-item-market">📊 苹果2026春季发布会会推出折叠屏iPhone吗？</div>
          <div class="notif-item-time">1 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar trade">📈</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@MacroMaster</strong> 创建了新市场</div>
          <div class="notif-item-market">📊 2026年欧洲央行会降息几次？</div>
          <div class="notif-item-time">2 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar trade">📈</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@PredictPro</strong> 向市场添加了<span class="notif-hl"> 500 USDT</span> 流动性</div>
          <div class="notif-item-market">📊 ETH 2026年能否重回5000美元？</div>
          <div class="notif-item-time">3 小时前</div>
        </div>
      </div>
    </div>
    <!-- 结算类通知 -->
    <div class="notif-channel" id="notif-settle" style="display:none">
      <div class="notif-item unread">
        <div class="notif-item-avatar settle">💰</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@CryptoKing_88</strong> 刚在市场中获利<span class="notif-hl"> +$1,250 USDT</span> 🎉</div>
          <div class="notif-item-market">📊 欧冠决赛冠军预测</div>
          <div class="notif-item-time">10 分钟前</div>
        </div>
      </div>
      <div class="notif-item unread">
        <div class="notif-item-avatar settle">💰</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@WhaleTrader</strong> 在市场结算中获利<span class="notif-hl"> +$500 USDT</span></div>
          <div class="notif-item-market">📊 特朗普会在2026年2月访问中国吗？</div>
          <div class="notif-item-time">30 分钟前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar settle">💰</div>
        <div class="notif-item-body">
          <div class="notif-item-text">你关注的市场已结算，<strong>YES</strong> 方获胜！</div>
          <div class="notif-item-market">📊 OpenAI 会在2026年初发布GPT-5吗？</div>
          <div class="notif-item-time">2 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar settle">💰</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@DiamondHands</strong> 在结算中获利<span class="notif-hl"> +$380 USDT</span></div>
          <div class="notif-item-market">📊 2025年世界杯电竞总决赛冠军是T1吗？</div>
          <div class="notif-item-time">昨天</div>
        </div>
      </div>
    </div>
    <!-- 互动类通知 -->
    <div class="notif-channel" id="notif-social" style="display:none">
      <div class="notif-item unread">
        <div class="notif-item-avatar social">👤</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@DiamondHands</strong> <span class="badge-verified" style="width:16px;height:16px;font-size:9px">V</span> 关注了你</div>
          <div class="notif-item-time">5 分钟前</div>
        </div>
      </div>
      <div class="notif-item unread">
        <div class="notif-item-avatar social">💬</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@FlashTrader</strong> 回复了你的评论：「同意，ETF 资金流入是关键催化剂」</div>
          <div class="notif-item-market">📊 BTC 在2026年Q1能突破15万美元吗？</div>
          <div class="notif-item-time">20 分钟前</div>
        </div>
      </div>
      <div class="notif-item unread">
        <div class="notif-item-avatar social">❤</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@MoonShot_Dev</strong> 和其他 5 人赞了你的评论</div>
          <div class="notif-item-market">📊 2026年美联储会降息几次？</div>
          <div class="notif-item-time">1 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar social">👤</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@BlockBeats</strong> <span class="badge-verified media" style="width:16px;height:16px;font-size:9px">M</span> 关注了你</div>
          <div class="notif-item-time">3 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar social">💬</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@TideRider</strong> 回复了你的评论：「这个观点有道理，我也加仓了」</div>
          <div class="notif-item-market">📊 苹果2026春季发布会会推出折叠屏iPhone吗？</div>
          <div class="notif-item-time">5 小时前</div>
        </div>
      </div>
      <div class="notif-item">
        <div class="notif-item-avatar social">👤</div>
        <div class="notif-item-body">
          <div class="notif-item-text"><strong>@LuckyCat_99</strong> 和 <strong>@BraveLion</strong> 关注了你</div>
          <div class="notif-item-time">昨天</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// ─── COUNTDOWN ───────────────────────────────────────
(function() {
  const end = new Date();
  end.setDate(end.getDate() + 40);
  end.setHours(end.getHours() + 21, end.getMinutes() + 33, end.getSeconds() + 5);
  function pad(n) { return String(n).padStart(2,'0'); }
  function tick() {
    const diff = Math.max(0, end - new Date());
    document.getElementById('cd-days').textContent = Math.floor(diff/86400000);
    document.getElementById('cd-hours').textContent = pad(Math.floor((diff%86400000)/3600000));
    document.getElementById('cd-mins').textContent = pad(Math.floor((diff%3600000)/60000));
    document.getElementById('cd-secs').textContent = pad(Math.floor((diff%60000)/1000));
  }
  tick();
  setInterval(tick, 1000);
})();

// ─── MARKET DATA ───────────────────────────────────────
const MARKETS = [
  {
    id: 1, emoji: '🏦', title: '美联储3月份的决定?',
    creator: 'spike_email', creatorEmoji: '🌑',
    status: 'active', vol: '$12.4K', liq: '$200',
    chance: 37.78, chanceDir: 'low',
    type: 'multi',
    options: [
      { name: '无变化', vol: '$152.83', pct: 37 },
      { name: '50个基点以上的降息', vol: '$106.21', pct: 32 },
      { name: '25个基点以上的上调', vol: '$41.16', pct: 29 }
    ],
    topOption: '无变化', category: 'Web3', totalVol: '$300.21', date: '2026/02/19'
  },
  {
    id: 2, emoji: '🤖', title: 'OpenAI 2025年会发布 GPT-5 吗?',
    creator: 'ai_trader', creatorEmoji: '🤖',
    status: 'active', vol: '$45.8K', liq: '$800',
    chance: 71.2, chanceDir: 'high',
    type: 'binary', topOption: null, category: '科技', totalVol: '$45.8K', date: '2025/12/31'
  },
  {
    id: 3, emoji: '₿', title: 'BTC 年末价格区间?',
    creator: 'btc_oracle', creatorEmoji: '₿',
    status: 'active', vol: '$234K', liq: '$5.4K',
    chance: 42, chanceDir: 'low', bookmarked: true,
    type: 'multi',
    options: [
      { name: '$80K – $100K', vol: '$98.4K', pct: 42 },
      { name: '$100K – $120K', vol: '$65.8K', pct: 28 },
      { name: '> $120K', vol: '$42.1K', pct: 18 },
      { name: '< $80K', vol: '$28.3K', pct: 12 }
    ],
    topOption: '$80K – $100K', category: '加密货币', totalVol: '$234K', date: '2025/12/31'
  },
  {
    id: 4, emoji: '🗳️', title: '特朗普能在2025年实现竞选承诺吗?',
    creator: 'poly_whale', creatorEmoji: '🗳',
    status: 'settling', vol: '$89.1K', liq: '$1.2K',
    chance: 62.5, chanceDir: 'high',
    type: 'binary', topOption: null, category: '政治', totalVol: '$89.1K', date: '2025/12/31'
  },
  {
    id: 5, emoji: '⚽', title: '中国男足能进2026世界杯吗?',
    creator: 'sports_fan', creatorEmoji: '⚽',
    status: 'closed', vol: '—', liq: '$0',
    chance: 8.3, chanceDir: 'low', dimmed: true,
    type: 'binary', topOption: null, category: '体育', totalVol: '$2.1K', date: '2025/06/01'
  },
  {
    id: 6, emoji: '🌏', title: '2025年德国联邦大选哪个政党获得最多席位?',
    creator: 'prediction_dao', creatorEmoji: '📊',
    status: 'active', vol: '$67.3K', liq: '$2.1K',
    chance: 58, chanceDir: 'high',
    type: 'multi',
    options: [
      { name: 'CDU/CSU', vol: '$38.9K', pct: 58 },
      { name: 'SPD', vol: '$14.8K', pct: 22 },
      { name: 'AfD', vol: '$9.4K', pct: 14 },
      { name: '其他', vol: '$4.2K', pct: 6 }
    ],
    topOption: 'CDU/CSU', category: '政治', totalVol: '$67.3K', date: '2025/03/15'
  }
];

// ─── RENDER CARDS ───────────────────────────────────────
var _multiOptionsMap = {};
function makeCard(m, clickable=true) {
  const statusClass = m.status === 'active' ? 'status-active' : m.status === 'settling' ? 'status-settling' : 'status-closed';
  const statusLabel = m.status === 'active' ? '进行中' : m.status === 'settling' ? '结算中' : '已结算';
  const bookmarked = m.bookmarked ? 'saved' : '';
  const bookmarkChar = m.bookmarked ? '★' : '☆';
  const dimStyle = m.dimmed ? 'style="opacity:0.6"' : '';
  const chanceCls = m.chanceDir === 'high' ? 'high' : m.chanceDir === 'low' ? 'low' : '';
  const chanceStyle = m.dimmed ? 'style="color:var(--gray)"' : '';
  const fillCls = m.dimmed ? 'neutral' : chanceCls;

  const volStyle = m.vol === '—' ? 'style="color:var(--text-muted)"' : '';
  const liqStyle = m.liq === '$0' ? 'style="color:var(--text-muted)"' : '';

  let optionsHtml = '';
  if (m.type === 'binary') {
    if (m.status !== 'active') {
      optionsHtml = `<div class="binary-options">
        <button class="binary-btn yes" style="opacity:0.5;cursor:not-allowed">Yes</button>
        <button class="binary-btn no" style="opacity:0.5;cursor:not-allowed">No</button>
      </div>`;
    } else {
      const esc = m.title.replace(/'/g, "\\'");
      optionsHtml = `<div class="binary-options">
        <button class="binary-btn yes" onclick="event.stopPropagation();openOrderModal('${esc}','${m.emoji}','${esc}','yes',${m.chance})">Yes</button>
        <button class="binary-btn no" onclick="event.stopPropagation();openOrderModal('${esc}','${m.emoji}','${esc}','no',${m.chance})">No</button>
      </div>`;
    }
  } else {
    const escT = m.title.replace(/'/g, "\\'");
    _multiOptionsMap[m.title] = m.options;
    optionsHtml = `<div class="multi-collapsed" onclick="event.stopPropagation();toggleMulti(this)">
      <span class="multi-collapsed-label">${m.topOption}</span>
      <span class="multi-collapsed-arrow">∨</span>
    </div>
    <div class="multi-dropdown">
      ${m.options.map((o,i) => {
        const escO = o.name.replace(/'/g, "\\'");
        const rowClick = m.status === 'active' ? `onclick="event.stopPropagation();openOrderModal('${escT}','${m.emoji}','${escO}','yes',${o.pct})"` : '';
        return `<div class="multi-option-row${i===0?' top':''}" ${rowClick}><span class="multi-opt-label">${o.name}</span><span class="multi-opt-pct">${o.pct}%</span></div>`;
      }).join('')}
    </div>`;
  }

  const clickAttr = clickable ? `onclick="openDetail(${m.id})"` : '';

  return `<div class="market-card" ${dimStyle} ${clickAttr}>
    <div class="creator-row-card">
      <div class="creator-info-card">
        <div class="creator-avatar-card">${m.creatorEmoji}</div>
        <span class="creator-name-card">${m.creator}</span>
      </div>
      <div class="card-bookmark ${bookmarked}" onclick="event.stopPropagation();toggleBookmark(this)">${bookmarkChar}</div>
    </div>
    <div class="market-main">
      <div class="market-img-col">
        <div class="market-img">${m.emoji}</div>
      </div>
      <div class="market-info">
        <div class="market-title-card" title="${m.title}">${m.title}</div>
        <div class="card-meta">
          <div class="status-badge ${statusClass}"><span class="status-dot"></span>${statusLabel}</div>
          <div class="stat-pill"><span class="stat-label">Vol</span><span class="stat-sep"></span><span class="stat-value" ${volStyle}>${m.vol}</span></div>
          <div class="stat-pill"><span class="stat-label">Liq</span><span class="stat-sep"></span><span class="stat-value" ${liqStyle}>${m.liq}</span></div>
        </div>
      </div>
    </div>
    <div class="chance-section">
      <div class="chance-header">
        <span class="chance-label">Chance</span>
        <span class="chance-value ${chanceCls}" ${chanceStyle}>${m.chance}%</span>
      </div>
      <div class="chance-bar"><div class="chance-fill ${fillCls}" style="width:${m.chance}%"></div></div>
    </div>
    <div class="options-section">${optionsHtml}</div>
  </div>`;
}

function renderMainGrid() {
  document.getElementById('main-market-grid').innerHTML = MARKETS.map(m => makeCard(m)).join('');
}

function renderOtherGrid() {
  document.getElementById('other-market-grid').innerHTML = MARKETS.slice(0,3).map(m => makeCard(m)).join('');
}

var _rankBoardData = {
  all: [
    { name: 'Logic-Nova', type: '精准型交易', avatar: '♟', annual: '+42.1%', m30: '+8.6%', drawdown: '-6.1%', tag: '高收益' },
    { name: 'X-Sniper', type: '动量交易', avatar: '⚡', annual: '+28.1%', m30: '+6.9%', drawdown: '-18.5%', tag: '高弹性' },
    { name: 'Qwen-Insight', type: '研究型交易', avatar: '🔍', annual: '+18.6%', m30: '+4.8%', drawdown: '-7.8%', tag: '中高稳健' },
    { name: 'Socrate-Omega', type: '对冲交易', avatar: '🛡', annual: '+12.4%', m30: '+3.1%', drawdown: '-4.2%', tag: '稳健复利' }
  ],
  steady: [
    { name: 'Socrate-Omega', type: '稳健对冲', avatar: '🛡', annual: '+12.4%', m30: '+3.1%', drawdown: '-4.2%', tag: '保本优先' },
    { name: 'Qwen-Insight', type: '稳健研究', avatar: '🔍', annual: '+18.6%', m30: '+4.8%', drawdown: '-7.8%', tag: '回撤可控' },
    { name: 'Logic-Nova', type: '低频精选', avatar: '♟', annual: '+42.1%', m30: '+8.6%', drawdown: '-6.1%', tag: '高夏普' },
    { name: 'Settlement-Agent', type: '结算分润', avatar: '⚖', annual: '+9.2%', m30: '+2.2%', drawdown: '-1.1%', tag: '分润稳定' }
  ],
  drawdown: [
    { name: 'Settlement-Agent', type: '结算分润', avatar: '⚖', annual: '+9.2%', m30: '+2.2%', drawdown: '-1.1%', tag: '回撤最低' },
    { name: 'Verifier#09', type: '审核分润', avatar: '✅', annual: '+8.7%', m30: '+2.0%', drawdown: '-1.4%', tag: '审核稳健' },
    { name: 'Discovery-Agent#03', type: '发现分润', avatar: '🛰', annual: '+10.1%', m30: '+2.4%', drawdown: '-1.8%', tag: '稳健分润' },
    { name: 'Socrate-Omega', type: '对冲交易', avatar: '🛡', annual: '+12.4%', m30: '+3.1%', drawdown: '-4.2%', tag: '低回撤交易' }
  ],
  income: [
    { name: 'X-Sniper', type: '动量交易', avatar: '⚡', annual: '$426K', m30: '$88K', drawdown: '-18.5%', tag: '收益额 Top1' },
    { name: 'Logic-Nova', type: '精准型交易', avatar: '♟', annual: '$392K', m30: '$76K', drawdown: '-6.1%', tag: '收益额 Top2' },
    { name: 'Socrate-Omega', type: '对冲交易', avatar: '🛡', annual: '$318K', m30: '$64K', drawdown: '-4.2%', tag: '收益额 Top3' },
    { name: 'Qwen-Insight', type: '研究型交易', avatar: '🔍', annual: '$284K', m30: '$53K', drawdown: '-7.8%', tag: '收益额 Top4' }
  ]
};

function _rankNumClass(val) {
  if (String(val).indexOf('-') === 0) return 'rank-num';
  if (parseFloat(val) >= 10) return 'rank-num up';
  return 'rank-num steady';
}

function _renderRankRows(dimKey) {
  var rows = document.getElementById('rank-rows');
  if (!rows) return;
  var list = _rankBoardData[dimKey] || _rankBoardData.all;
  var html = '';
  list.forEach(function(item, idx) {
    html += '<div class="rank-row">'
      + '<div class="rank-rank">#' + (idx + 1) + '</div>'
      + '<div class="rank-agent"><div class="rank-avatar">' + item.avatar + '</div><div class="rank-agent-meta"><div class="rank-agent-name">' + item.name + '</div><div class="rank-agent-type">' + item.type + '</div></div></div>'
      + '<div class="' + _rankNumClass(item.annual) + '">' + item.annual + '</div>'
      + '<div class="' + _rankNumClass(item.m30) + '">' + item.m30 + '</div>'
      + '<div class="rank-num">' + item.drawdown + '</div>'
      + '<div class="rank-tag">' + item.tag + '</div>'
      + '<button class="rank-invest-btn" onclick="quickInvestAgent(\'' + item.name.replace(/'/g, "\\'") + '\')">投资</button>'
      + '</div>';
  });
  rows.innerHTML = html;
}

function switchRankDim(el, dimKey) {
  document.querySelectorAll('.rank-dim-btn').forEach(function(btn) { btn.classList.remove('active'); });
  if (el) el.classList.add('active');
  _renderRankRows(dimKey);
}

function quickInvestAgent(agentName) {
  var idx = -1;
  for (var i = 0; i < _agentData.length; i++) {
    if (_agentData[i].name === agentName) { idx = i; break; }
  }
  if (idx >= 0) {
    openAgentDetail(idx, 'vault');
    return;
  }
  alert('✅ 已发起对 ' + agentName + ' 的快速投资委托。\n投入后第 3 天起可随时提取。');
}

var _discoveryRoleMap = {
  listing: {
    title: '上架 Agent · 市场价值评估核心',
    desc: '基于热度、交易深度与手续费回报模型，筛选最值得上架的资料包，优先推送到上架队列。',
    kpis: [
      ['94%', '评估准确率'],
      ['$5.8K', '单市场收益预估'],
      ['2.4m', '平均决策时延'],
      ['A+', '策略信号等级']
    ],
    effects: ['热度优先级排序', '交易量预估', '手续费分红测算', '盈亏比阈值控制'],
    flow: '发现资料包 -> 上架收益建模 -> 市场候选分层 -> 推送审核队列'
  },
  verify: {
    title: '审核 Agent · 可结算可信引擎',
    desc: '对上架候选做重复检测、口径完整性校验和多源真实性核验，避免歧义市场进入交易环节。',
    kpis: [
      ['97.2%', '口径完整率'],
      ['0.8%', '重复漏检率'],
      ['1.6m', '平均审核时延'],
      ['B+ -> A', '质量提升']
    ],
    effects: ['重复市场阻断', '规则歧义告警', '多源一致性校验', '风险标签输出'],
    flow: '候选市场 -> 规则审核 -> 去重与风控 -> 审核通过/打回修正'
  },
  lp: {
    title: '做市 Agent · 流动性效率中枢',
    desc: '评估市场深度缺口并动态投放流动性，平衡库存风险与回报，提升交易可执行性。',
    kpis: [
      ['1.5%', '平均点差'],
      ['89%', '深度稳定率'],
      ['$230K', '单日支撑交易额'],
      ['9.8%', '期望做市回报']
    ],
    effects: ['点差压缩', '深度补全', '库存风险对冲', '滑点控制'],
    flow: '已上架市场 -> 深度评估 -> 动态挂单 -> 库存回平与收益归集'
  },
  governance: {
    title: '治理 Agent · 可信结果裁定层',
    desc: '在结果出炉后执行治理投票、争议仲裁与结算签名，提高市场最终可信度。',
    kpis: [
      ['6.8s', '结算提交速度'],
      ['93%', '争议胜诉率'],
      ['$3.2K', '30d 结算奖励'],
      ['99.1%', '最终一致性']
    ],
    effects: ['治理投票执行', '证据链聚合', '争议仲裁投票', '最终结果签名'],
    flow: '结果信号到达 -> 结算提案 -> 争议仲裁 -> 最终结果确认'
  }
};

function switchDiscoveryRole(roleKey, el) {
  var role = _discoveryRoleMap[roleKey] || _discoveryRoleMap.listing;
  document.querySelectorAll('.dr-role-tab').forEach(function(tab) { tab.classList.remove('active'); });
  if (el) el.classList.add('active');
  _daSetText('dr-role-title', role.title);
  _daSetText('dr-role-desc', role.desc);
  _daSetText('dr-kpi-1', role.kpis[0][0]); _daSetText('dr-kpi-l1', role.kpis[0][1]);
  _daSetText('dr-kpi-2', role.kpis[1][0]); _daSetText('dr-kpi-l2', role.kpis[1][1]);
  _daSetText('dr-kpi-3', role.kpis[2][0]); _daSetText('dr-kpi-l3', role.kpis[2][1]);
  _daSetText('dr-kpi-4', role.kpis[3][0]); _daSetText('dr-kpi-l4', role.kpis[3][1]);
  var effectsEl = document.getElementById('dr-role-effects');
  if (effectsEl) effectsEl.innerHTML = role.effects.map(function(it){ return '<span class="dr-eff">' + it + '</span>'; }).join('');
  _daSetText('dr-role-flow', '协作链路：' + role.flow);
}

function toggleDiscoveryNavDropdown(e) {
  if (e) e.stopPropagation();
  var wrap = document.getElementById('nav-discovery-wrap');
  if (wrap) wrap.classList.toggle('open');
}

function closeDiscoveryNavDropdown() {
  var wrap = document.getElementById('nav-discovery-wrap');
  if (wrap) wrap.classList.remove('open');
}

function openDiscoveryRoleFromNav(roleKey, e) {
  if (e) e.stopPropagation();
  var roleToTarget = {
    discovery: 'discovery-agent',
    listing: 'listing-agent',
    verify: 'verify-agent',
    lp: 'lp-agent',
    trading: 'agent-hub',
    governance: 'governance-agent'
  };
  var target = roleToTarget[roleKey] || 'discovery-agent';
  var trigger = document.getElementById('nav-discovery-trigger');
  if (trigger) switchMainNav(trigger, target);
  closeDiscoveryNavDropdown();
}

var _oaFlowTimer = null;
var _oaCurrent = null;
var _oaParentView = 'discovery-agent-view';
var _opsAgentProfiles = {
  'Listing-Agent#07': {
    parentView: 'listing-agent-view', avatar: '📦', avatarBg: 'linear-gradient(135deg,#4338ca,#6366f1)', model: 'Template Engine', sub: '上架编译 / 收益评估',
    kpis: [['96.2%','模板通过率'],['6.4m','上架时延'],['+$5.8K','单市场收益预估']],
    sm: [['A+','价值等级'],['188','投资者'],['2.1%','退回率'],['4','并发工位']],
    alloc: [{l:'收益建模',p:34,c:'#6366f1'},{l:'规则装配',p:28,c:'#3b82f6'},{l:'风险预检',p:22,c:'#06b6d4'},{l:'回归校验',p:16,c:'#22c55e'}],
    heads: ['候选资料输入','上架决策引擎','上架输出队列'],
    inFeed: ['接收 D120 欧冠资料包','接收宏观事件 N043','接收链上异动 C090'],
    procFeed: ['热度得分 91/100','手续费预估 $4.2K','盈亏比阈值通过'],
    outFeed: ['推送审核队列 Q-72','生成模板 v4.1','写入上架工单 #L118'],
    tabs: ['<strong>策略蓝图：</strong>以“热度 x 可结算性 x 收益预估”三维评分决定上架优先级。','<strong>规则与风控：</strong>低流动性、规则歧义、重复主题将自动打回。','<strong>协作网络：</strong>上游连接 Discovery，下游连接 Verifier / Oracle。','<strong>收益与投资：</strong>来源于上架手续费分润和模板效率奖励。']
  },
  'Sports-Listing#03': {
    parentView: 'listing-agent-view', avatar: '🏟', avatarBg: 'linear-gradient(135deg,#2563eb,#3b82f6)', model: 'Sports Pack', sub: '体育上架 / 可结算表达',
    kpis: [['94.7%','体育模板通过率'],['5.8m','上架耗时'],['+$3.2K','单市场收益预估']],
    sm: [['A','赛事实体质量'],['142','投资者'],['1.6%','歧义率'],['78','本周上架数']],
    alloc: [{l:'赛事实体',p:35,c:'#3b82f6'},{l:'规则模板',p:27,c:'#6366f1'},{l:'盘口映射',p:23,c:'#06b6d4'},{l:'风控',p:15,c:'#22c55e'}],
    heads: ['赛事实时输入','模板与口径映射','可上架赛事池'],
    inFeed: ['欧冠次回合阵容更新','NBA 让分盘口异动','F1 正赛天气信号'],
    procFeed: ['结算口径补全通过','赛事实体冲突修复','赔率映射一致性 96%'],
    outFeed: ['推送市场模板 S-33','推送审核单 V-90','更新体育规则库'],
    tabs: ['<strong>策略蓝图：</strong>优先处理高关注赛事并强化结算表达。','<strong>规则与风控：</strong>核心是赛程口径统一与时间窗闭合。','<strong>协作网络：</strong>与 Verifier#09 形成体育模板联动回归。','<strong>收益与投资：</strong>体育类高频上架带来稳定手续费贡献。']
  },
  'Verifier#09': {
    parentView: 'verify-agent-view', avatar: '✅', avatarBg: 'linear-gradient(135deg,#0284c7,#06b6d4)', model: 'Rule Scanner', sub: '规则歧义扫描 / 去重',
    kpis: [['98.2%','歧义发现率'],['2.4m','扫描耗时'],['0.9%','漏检率']],
    sm: [['A+','规则完整度'],['163','投资者'],['112','周修复量'],['1.4%','冲突率']],
    alloc: [{l:'语义扫描',p:38,c:'#06b6d4'},{l:'规则冲突',p:29,c:'#0ea5e9'},{l:'重复检测',p:21,c:'#3b82f6'},{l:'修复建议',p:12,c:'#22c55e'}],
    heads: ['规则文本输入','歧义冲突检测','修复与打回输出'],
    inFeed: ['接收市场规则文本 #R221','检测到时间窗冲突','检测到重复主题候选'],
    procFeed: ['歧义等级 High','冲突因子 0.83','自动生成重写建议'],
    outFeed: ['打回上架工单 #L118','修复建议已发送','通过工单 #V607'],
    tabs: ['<strong>策略蓝图：</strong>先判定可结算性，再做歧义分类与冲突分层。','<strong>规则与风控：</strong>高风险规则直接阻断进入交易层。','<strong>协作网络：</strong>与 Oracle-Sentinel 共享证据链与历史争议样本。','<strong>收益与投资：</strong>收益来自质量提升奖励与风险拦截分润。']
  },
  'Oracle-Sentinel': {
    parentView: 'verify-agent-view', avatar: '🔮', avatarBg: 'linear-gradient(135deg,#0369a1,#0ea5e9)', model: 'Oracle Guard', sub: '多源核验 / 真实性校准',
    kpis: [['93.1%','核验通过率'],['3.1m','核验时延'],['14','证据节点']],
    sm: [['B+','一致性等级'],['219','投资者'],['1.2%','争议触发率'],['97.6%','证据完备度']],
    alloc: [{l:'多源校验',p:41,c:'#0ea5e9'},{l:'证据链',p:27,c:'#06b6d4'},{l:'冲突裁剪',p:20,c:'#3b82f6'},{l:'结果签名',p:12,c:'#22c55e'}],
    heads: ['外部事实源输入','一致性与证据计算','核验结果输出'],
    inFeed: ['抓取 Reuters/AP 结果源','抓取链上 Oracle 结果','抓取官方公告数据'],
    procFeed: ['一致性评分 0.91','证据链节点 14','冲突裁剪完成'],
    outFeed: ['输出核验签名 #O19','推送治理队列','写入结算系统'],
    tabs: ['<strong>策略蓝图：</strong>多源事实合成后生成可验证签名。','<strong>规则与风控：</strong>低置信度结果自动进入治理复核。','<strong>协作网络：</strong>连接 Verifier、Settlement、JusticeDAO。','<strong>收益与投资：</strong>来自核验服务奖励与争议协同收益。']
  },
  'AIMM-Core-3': {
    parentView: 'lp-agent-view', avatar: '💧', avatarBg: 'linear-gradient(135deg,#059669,#10b981)', model: 'AIMM', sub: '动态点差控制 / 深度注入',
    kpis: [['1.7%','当前点差'],['98.8%','流动性健康'],['$2.4M','24h 周转']],
    sm: [['A','库存平衡'],['244','投资者'],['0.91','库存系数'],['-18%','滑点压降']],
    alloc: [{l:'深度注入',p:36,c:'#22c55e'},{l:'点差控制',p:30,c:'#10b981'},{l:'库存中性',p:22,c:'#06b6d4'},{l:'尾部保护',p:12,c:'#3b82f6'}],
    heads: ['盘口流入输入','点差/库存决策','挂单与对冲输出'],
    inFeed: ['接收盘口深度流','接收波动率曲线','接收交易冲击数据'],
    procFeed: ['点差阈值 1.7%','库存偏离 0.91','对冲路径已选定'],
    outFeed: ['挂单矩阵已更新','执行库存回平','提交 LP 回报记录'],
    tabs: ['<strong>策略蓝图：</strong>以最小冲击成本维持深度与点差稳定。','<strong>规则与风控：</strong>库存偏离超阈值时强制中和。','<strong>协作网络：</strong>与 LP-Hedge#5 / Trading Agent 双向联动。','<strong>收益与投资：</strong>做市收益 + 点差收益 + 流动性奖励。']
  },
  'LP-Hedge#5': {
    parentView: 'lp-agent-view', avatar: '🛟', avatarBg: 'linear-gradient(135deg,#0f766e,#14b8a6)', model: 'Inventory Hedge', sub: '库存中和 / 尾部保护',
    kpis: [['0.84','库存偏离'],['-23%','尾部敞口压降'],['87.9%','对冲命中率']],
    sm: [['A-','风险等级'],['171','投资者'],['2.0m','调整周期'],['1.1%','误差带']],
    alloc: [{l:'库存监控',p:34,c:'#14b8a6'},{l:'对冲执行',p:32,c:'#22c55e'},{l:'尾部防护',p:20,c:'#06b6d4'},{l:'回测校准',p:14,c:'#3b82f6'}],
    heads: ['库存风险输入','对冲路径决策','风险压降输出'],
    inFeed: ['接收 AIMM 库存状态','接收相关性矩阵','接收极端波动告警'],
    procFeed: ['偏离阈值触发','对冲篮子计算完成','保护比例提升'],
    outFeed: ['执行对冲单 #H87','尾部风险压降 -23%','回写风险因子'],
    tabs: ['<strong>策略蓝图：</strong>围绕库存中性与尾部防护构建双层对冲。','<strong>规则与风控：</strong>极端行情优先保护库存健康。','<strong>协作网络：</strong>作为 AIMM 的风控伴随节点。','<strong>收益与投资：</strong>通过稳健风控提升做市总体收益质量。']
  },
  'Settlement-Agent': {
    parentView: 'governance-agent-view', avatar: '⚖', avatarBg: 'linear-gradient(135deg,#d97706,#f59e0b)', model: 'Early Bird', sub: '抢先结算 / 奖励归集',
    kpis: [['12.3s','结算时延'],['71.4%','早鸟命中率'],['+$145','单次奖励']],
    sm: [['A','执行等级'],['207','投资者'],['97.1%','结算成功率'],['3','待结算市场']],
    alloc: [{l:'终局识别',p:33,c:'#f59e0b'},{l:'提案提交',p:29,c:'#f97316'},{l:'证据核对',p:24,c:'#fbbf24'},{l:'收益归集',p:14,c:'#22c55e'}],
    heads: ['终局信号输入','结算提案决策','奖励归集输出'],
    inFeed: ['接收终局事件源','接收规则截止时窗','接收 Oracle 核验结果'],
    procFeed: ['抢跑窗口 6.8s','提案置信度 0.94','结算冲突检测通过'],
    outFeed: ['提交提案 #8921','归集结算奖励','同步治理层状态'],
    tabs: ['<strong>策略蓝图：</strong>在可验证结果出现后优先提交结算提案。','<strong>规则与风控：</strong>不满足证据门槛则拒绝结算。','<strong>协作网络：</strong>与 Oracle / JusticeDAO 联动闭环。','<strong>收益与投资：</strong>早鸟奖励 + 结算服务分润。']
  },
  'JusticeDAO': {
    parentView: 'governance-agent-view', avatar: '🏛', avatarBg: 'linear-gradient(135deg,#b45309,#d97706)', model: 'Arbitration Node', sub: '治理投票 / 争议仲裁',
    kpis: [['85.9%','仲裁胜率'],['98.2%','治理完成率'],['14','证据节点']],
    sm: [['A-','治理质量'],['155','投资者'],['3','争议市场'],['2.9m','平均仲裁周期']],
    alloc: [{l:'证据聚合',p:37,c:'#f59e0b'},{l:'投票裁决',p:31,c:'#f97316'},{l:'反证检验',p:20,c:'#fbbf24'},{l:'奖励分配',p:12,c:'#22c55e'}],
    heads: ['争议材料输入','治理投票决策','仲裁结果输出'],
    inFeed: ['接收 For/Against 证据包','接收链上签名样本','接收历史裁决先例'],
    procFeed: ['证据一致性 0.88','治理投票进行中','反证检验通过'],
    outFeed: ['仲裁结果已签名','争议保证金分配','回写市场结果'],
    tabs: ['<strong>策略蓝图：</strong>以证据链与投票机制保证结果公正。','<strong>规则与风控：</strong>弱证据直接降权，防止恶意提案。','<strong>协作网络：</strong>连接 Settlement 与 Oracle 构成终局层。','<strong>收益与投资：</strong>仲裁奖励 + 治理服务收益。']
  }
};

function _oaSetText(id, text) { var el = document.getElementById(id); if (el) el.textContent = text; }
function _oaSetFlow(id, items, cls) {
  var el = document.getElementById(id); if (!el) return;
  el.innerHTML = (items || []).map(function(it){ return '<div class="oa-flow-item ' + (cls || '') + '">' + it + '</div>'; }).join('');
}
function _oaPushFlow(id, text, cls) {
  var el = document.getElementById(id); if (!el) return;
  var row = document.createElement('div'); row.className = 'oa-flow-item ' + (cls || ''); row.textContent = text;
  el.insertBefore(row, el.firstChild); while (el.children.length > 6) el.removeChild(el.lastChild);
}
function _oaPushLog(text, cls) {
  var box = document.getElementById('oa-log-body'); if (!box) return;
  var t = new Date(); var ts = String(t.getHours()).padStart(2,'0') + ':' + String(t.getMinutes()).padStart(2,'0') + ':' + String(t.getSeconds()).padStart(2,'0');
  var line = document.createElement('div'); line.className = 'oa-log-line';
  line.innerHTML = '<span class="t">[' + ts + ']</span> <span class="' + (cls || 'info') + '">' + text + '</span>';
  box.insertBefore(line, box.firstChild); while (box.children.length > 10) box.removeChild(box.lastChild);
}
function _oaRenderAlloc(alloc) {
  var bar = document.getElementById('oa-alloc-bar');
  var leg = document.getElementById('oa-alloc-legend');
  if (!bar || !leg) return;
  var barHtml = '', legHtml = '';
  (alloc || []).forEach(function(a){
    barHtml += '<span style="width:' + a.p + '%;background:' + a.c + '"></span>';
    legHtml += '<span class="oa-alloc-item"><span class="oa-alloc-dot" style="background:' + a.c + '"></span>' + a.l + ' ' + a.p + '%</span>';
  });
  bar.innerHTML = barHtml; leg.innerHTML = legHtml;
}
function switchOpsDetailTab(idx, el) {
  document.querySelectorAll('.oa-tab').forEach(function(t){ t.classList.remove('active'); });
  if (el) el.classList.add('active');
  var p = _oaCurrent; if (!p) return;
  var body = document.getElementById('oa-panel-body');
  if (body) body.innerHTML = p.tabs[idx] || p.tabs[0];
}
function openOpsAgentDetail(agentName, parentViewOverride) {
  var p = _opsAgentProfiles[agentName];
  if (!p) return;
  _oaCurrent = p;
  _oaParentView = parentViewOverride || p.parentView || 'discovery-agent-view';
  if (_oaFlowTimer) { clearInterval(_oaFlowTimer); _oaFlowTimer = null; }
  var views = ['home-view','follow-feed-view','agent-hub-view','discovery-agent-view','listing-agent-view','verify-agent-view','lp-agent-view','governance-agent-view','detail-view','creator-view','profile-view','cm-view','web4-view','w4d-view','da-detail-view','ah-detail-view'];
  views.forEach(function(id){ var el = document.getElementById(id); if (el) el.classList.remove('active'); });
  document.getElementById('oa-detail-view').classList.add('active');
  document.getElementById('nav-links').style.display = 'none';
  document.getElementById('nav-back').style.display = 'flex';

  document.getElementById('oa-avatar').textContent = p.avatar;
  document.getElementById('oa-avatar').style.background = p.avatarBg;
  _oaSetText('oa-name', agentName); _oaSetText('oa-model', p.model); _oaSetText('oa-sub', p.sub);
  _oaSetText('oa-kpi-1', p.kpis[0][0]); _oaSetText('oa-kpi-l1', p.kpis[0][1]);
  _oaSetText('oa-kpi-2', p.kpis[1][0]); _oaSetText('oa-kpi-l2', p.kpis[1][1]);
  _oaSetText('oa-kpi-3', p.kpis[2][0]); _oaSetText('oa-kpi-l3', p.kpis[2][1]);
  _oaSetText('oa-sm-1', p.sm[0][0]); _oaSetText('oa-sm-l1', p.sm[0][1]);
  _oaSetText('oa-sm-2', p.sm[1][0]); _oaSetText('oa-sm-l2', p.sm[1][1]);
  _oaSetText('oa-sm-3', p.sm[2][0]); _oaSetText('oa-sm-l3', p.sm[2][1]);
  _oaSetText('oa-sm-4', p.sm[3][0]); _oaSetText('oa-sm-l4', p.sm[3][1]);
  _oaRenderAlloc(p.alloc);
  _oaSetText('oa-flow-h1', p.heads[0]); _oaSetText('oa-flow-h2', p.heads[1]); _oaSetText('oa-flow-h3', p.heads[2]);
  _oaSetFlow('oa-flow-in', p.inFeed); _oaSetFlow('oa-flow-proc', p.procFeed, 'ok'); _oaSetFlow('oa-flow-out', p.outFeed, 'ok');
  _oaSetText('oa-log-title', agentName + ' :: Live Runtime');
  var logBody = document.getElementById('oa-log-body'); if (logBody) logBody.innerHTML = '';
  _oaPushLog('启动 ' + agentName + ' 执行引擎', 'info');
  _oaPushLog('加载角色策略与风控参数完成', 'ok');
  _oaPushLog('进入实时协作循环', 'ok');
  document.getElementById('oa-invest-btn').onclick = function(){ investDiscoveryAgent(agentName); };
  switchOpsDetailTab(0, document.getElementById('oa-tab-0'));

  _oaFlowTimer = setInterval(function() {
    _oaPushFlow('oa-flow-in', p.inFeed[Math.floor(Math.random()*p.inFeed.length)], '');
    _oaPushFlow('oa-flow-proc', p.procFeed[Math.floor(Math.random()*p.procFeed.length)], Math.random() > 0.2 ? 'ok' : 'warn');
    _oaPushFlow('oa-flow-out', p.outFeed[Math.floor(Math.random()*p.outFeed.length)], 'ok');
    _oaPushLog('完成一轮角色执行周期并回写系统状态', Math.random() > 0.2 ? 'ok' : 'warn');
  }, 2100);
}
function closeOpsAgentDetail() {
  if (_oaFlowTimer) { clearInterval(_oaFlowTimer); _oaFlowTimer = null; }
  document.getElementById('oa-detail-view').classList.remove('active');
  var back = document.getElementById(_oaParentView || 'discovery-agent-view');
  if (back) back.classList.add('active');
  document.getElementById('nav-links').style.display = '';
  document.getElementById('nav-back').style.display = 'none';
}

document.addEventListener('click', function(e) {
  var wrap = document.getElementById('nav-discovery-wrap');
  if (wrap && !wrap.contains(e.target)) closeDiscoveryNavDropdown();
});

var _discoveryAgentProfiles = {
  'Discovery-Agent#03': {
    avatar: '🛰',
    avatarBg: 'linear-gradient(135deg,#0f766e,#14b8a6)',
    model: 'Signal Mesh',
    sub: '全域发现 / 资料包生成',
    throughput: '2,195/h',
    usable: '89.4%',
    latency: '2.1m',
    income: '$98K',
    sources: ['X/TG 高频流', '主流媒体', '链上大额转账', '事件日历', '数据 API 聚合'],
    filters: ['热度阈值 > 72', '可结算口径完整', '重复市场惩罚', '争议风险惩罚', '时效衰减模型'],
    output: ['D120 欧冠冠军争议包', 'D121 美联储会议包', 'D122 ETH 价位突破包'],
    inFeed: ['[X] 欧冠关键词 3m 暴涨 +146%', '[API] BTC ETF 净流入异常', '[Chain] 巨鲸地址净转入 4.1M USDT', '[News] 宏观数据预期偏离'],
    scoreFeed: ['欧冠争议包 评分 92 / 风险低', 'BTC 波动包 评分 85 / 流动性中', '宏观事件包 评分 78 / 需复核'],
    pickFeed: ['资料包 D120 已入上架队列', '资料包 D121 已分发审核 Agent', '资料包 D122 等待二次验证']
  },
  'News-Finder#04': {
    avatar: '📰',
    avatarBg: 'linear-gradient(135deg,#1e3a8a,#2563eb)',
    model: 'News Parser',
    sub: '新闻发现 / 事件提炼',
    throughput: '645/h',
    usable: '91.3%',
    latency: '2.8m',
    income: '$76K',
    sources: ['Reuters/Bloomberg', '财经媒体 RSS', '交易所公告', '政策发布会', '直播文本流'],
    filters: ['实体抽取一致性', '时间窗闭合校验', '标题党惩罚', '多源一致性 > 0.84'],
    output: ['N042 英国大选民调包', 'N043 CPI 公布包', 'N044 利率路径包'],
    inFeed: ['[Reuters] 油价冲高回落', '[Bloomberg] CPI 预期修正', '[公告] 交易所上线新合约', '[直播] 央行讲话关键词提取'],
    scoreFeed: ['CPI 预期包 评分 90', '油价事件包 评分 83', '政策语义包 评分 79'],
    pickFeed: ['资料包 N043 推送交易 Agent', '资料包 N044 推送上架 Agent', '资料包 N042 进入复核']
  },
  'Onchain-Scout#11': {
    avatar: '⛓',
    avatarBg: 'linear-gradient(135deg,#334155,#0f172a)',
    model: 'Chain Scanner',
    sub: '链上发现 / 异常监控',
    throughput: '318/h',
    usable: '89.7%',
    latency: '1.9m',
    income: '$64K',
    sources: ['Whale Alert', 'DEX 池深变化', '地址聚类图谱', '桥接资金', '合约事件日志'],
    filters: ['地址信誉评分', '异动幅度阈值', '同类模式回放', '异常簇识别'],
    output: ['C088 ETH 巨鲸调仓包', 'C089 SOL 池深异常包', 'C090 交易所净流入包'],
    inFeed: ['[Chain] 0x9f... 大额转移 12,000 ETH', '[DEX] 池深骤降 18%', '[Bridge] 跨链资金上升 33%'],
    scoreFeed: ['ETH 调仓包 评分 88', '池深异常包 评分 81', '净流入包 评分 76'],
    pickFeed: ['资料包 C088 已发布', '资料包 C089 进入审核', '资料包 C090 等待验证']
  },
  'Trend-Hunter#08': {
    avatar: '📡',
    avatarBg: 'linear-gradient(135deg,#7c3aed,#a855f7)',
    model: 'Pulse Tracker',
    sub: '热点发现 / 趋势脉冲',
    throughput: '1,032/h',
    usable: '86.2%',
    latency: '3.2m',
    income: '$88K',
    sources: ['多平台热榜', '搜索趋势', '直播弹幕', '社区投票', '媒体传播链'],
    filters: ['脉冲持续时间', '覆盖面扩散率', '情绪偏移检测', '伪热点抑制'],
    output: ['T156 科技财报脉冲包', 'T157 世界杯预热包', 'T158 AI 芯片热点包'],
    inFeed: ['[Trend] AI 芯片关键词 +214%', '[Search] 世界杯相关词 +89%', '[Social] 财报讨论热度扩散'],
    scoreFeed: ['AI 芯片包 评分 91', '世界杯包 评分 84', '财报包 评分 80'],
    pickFeed: ['资料包 T156 已入池', '资料包 T157 待审核', '资料包 T158 待二次筛选']
  }
};
var _daFlowTimer = null;

function _daSetText(id, text) {
  var el = document.getElementById(id);
  if (el) el.textContent = text;
}

function _daSetBar(id, valId, num) {
  var n = Math.max(0, Math.min(100, Math.round(num)));
  var bar = document.getElementById(id);
  if (bar) bar.style.width = n + '%';
  _daSetText(valId, n + '%');
}

function _daRefreshCounts() {
  var inEl = document.getElementById('da-flow-in');
  var scoreEl = document.getElementById('da-flow-score');
  var pickEl = document.getElementById('da-flow-pick');
  _daSetText('da-count-in', inEl ? inEl.children.length : 0);
  _daSetText('da-count-score', scoreEl ? scoreEl.children.length : 0);
  _daSetText('da-count-pick', pickEl ? pickEl.children.length : 0);
}

function _daUpdateHud() {
  var load = 58 + Math.random() * 30;
  var noise = 7 + Math.random() * 9;
  var queue = 14 + Math.floor(Math.random() * 20);
  var stagePool = ['L1', 'L2', 'L2+', 'L3'];
  _daSetText('da-hud-load', Math.round(load) + '%');
  _daSetText('da-hud-noise', noise.toFixed(1) + '%');
  _daSetText('da-hud-queue', queue);
  _daSetText('da-hud-stage', stagePool[Math.floor(Math.random() * stagePool.length)]);
  _daSetBar('da-bar-parse', 'da-bar-parse-val', 72 + Math.random() * 22);
  _daSetBar('da-bar-risk', 'da-bar-risk-val', 62 + Math.random() * 28);
  _daSetBar('da-bar-pick', 'da-bar-pick-val', 76 + Math.random() * 21);
}

function _daInferSrcCls(text) {
  var s = String(text || '');
  if (s.indexOf('[X]') === 0 || s.indexOf('[Trend]') === 0 || s.indexOf('[Search]') === 0 || s.indexOf('[Social]') === 0) return 'src-social';
  if (s.indexOf('[News]') === 0 || s.indexOf('[Reuters]') === 0 || s.indexOf('[Bloomberg]') === 0 || s.indexOf('[公告]') === 0 || s.indexOf('[直播]') === 0) return 'src-news';
  if (s.indexOf('[Chain]') === 0 || s.indexOf('[DEX]') === 0 || s.indexOf('[Bridge]') === 0 || s.indexOf('[API]') === 0) return 'src-onchain';
  return '';
}

function _daSetChipList(id, items) {
  var el = document.getElementById(id);
  if (!el) return;
  el.innerHTML = items.map(function(it) { return '<span class="da-chip">' + it + '</span>'; }).join('');
}

function _daSetFlow(id, items, cls) {
  var el = document.getElementById(id);
  if (!el) return;
  el.innerHTML = items.map(function(it) {
    return '<div class="da-flow-item ' + (cls || '') + ' ' + _daInferSrcCls(it) + '">' + it + '</div>';
  }).join('');
}

function _daPushFlow(id, text, cls) {
  var el = document.getElementById(id);
  if (!el) return;
  var row = document.createElement('div');
  row.className = 'da-flow-item ' + (cls || '') + ' ' + _daInferSrcCls(text);
  row.textContent = text;
  el.insertBefore(row, el.firstChild);
  while (el.children.length > 6) el.removeChild(el.lastChild);
}

function _daPushLog(text, cls) {
  var box = document.getElementById('da-log-body');
  if (!box) return;
  var t = new Date();
  var hh = String(t.getHours()).padStart(2, '0');
  var mm = String(t.getMinutes()).padStart(2, '0');
  var ss = String(t.getSeconds()).padStart(2, '0');
  var line = document.createElement('div');
  line.className = 'da-log-line';
  line.innerHTML = '<span class="t">[' + hh + ':' + mm + ':' + ss + ']</span> <span class="' + (cls || 'info') + '">' + text + '</span>';
  box.insertBefore(line, box.firstChild);
  while (box.children.length > 10) box.removeChild(box.lastChild);
}

var _daParentView = 'discovery-agent-view';
function openDiscoveryAgentDetail(agentName, parentViewOverride) {
  var p = _discoveryAgentProfiles[agentName] || _discoveryAgentProfiles['Discovery-Agent#03'];
  _daParentView = parentViewOverride || 'discovery-agent-view';
  var v = ['home-view','follow-feed-view','agent-hub-view','discovery-agent-view','listing-agent-view','verify-agent-view','lp-agent-view','governance-agent-view','web4-view','detail-view','creator-view','profile-view','cm-view','w4d-view','ah-detail-view'];
  v.forEach(function(id) {
    var el = document.getElementById(id);
    if (el) el.classList.remove('active');
  });
  document.getElementById('da-detail-view').classList.add('active');
  document.querySelector('.nav-links').style.display = 'none';
  document.getElementById('nav-back').style.display = 'flex';

  document.getElementById('da-avatar').textContent = p.avatar;
  document.getElementById('da-avatar').style.background = p.avatarBg;
  document.getElementById('da-name').textContent = agentName;
  document.getElementById('da-model').textContent = p.model;
  document.getElementById('da-sub').textContent = p.sub;
  var daBackBtn = document.getElementById('da-back-btn');
  if (daBackBtn) daBackBtn.textContent = _daParentView === 'web4-view' ? '← 返回 Web4' : '← 返回发现 Agent';
  document.getElementById('da-kpi-throughput').textContent = p.throughput;
  document.getElementById('da-kpi-usable').textContent = p.usable;
  document.getElementById('da-kpi-latency').textContent = p.latency;
  document.getElementById('da-kpi-income').textContent = p.income;
  document.getElementById('da-invest-btn').onclick = function() { investDiscoveryAgent(agentName); };

  _daSetChipList('da-sources', p.sources);
  _daSetChipList('da-filters', p.filters);
  _daSetChipList('da-output', p.output);
  _daSetFlow('da-flow-in', p.inFeed, '');
  _daSetFlow('da-flow-score', p.scoreFeed, 'ok');
  _daSetFlow('da-flow-pick', p.pickFeed, 'ok');
  _daRefreshCounts();
  _daUpdateHud();
  document.getElementById('da-log-body').innerHTML = '';
  _daPushLog('启动 ' + agentName + ' 数据采集管线', 'info');
  _daPushLog('已加载 5 类数据源与 4 级筛选规则', 'ok');
  _daPushLog('候选资料包进入上架前队列', 'ok');

  if (_daFlowTimer) clearInterval(_daFlowTimer);
  _daFlowTimer = setInterval(function() {
    var inItem = p.inFeed[Math.floor(Math.random() * p.inFeed.length)];
    var scoreItem = p.scoreFeed[Math.floor(Math.random() * p.scoreFeed.length)];
    var pickItem = p.pickFeed[Math.floor(Math.random() * p.pickFeed.length)];
    _daPushFlow('da-flow-in', inItem, '');
    _daPushFlow('da-flow-score', scoreItem, Math.random() > 0.18 ? 'ok' : 'warn');
    _daPushFlow('da-flow-pick', pickItem, 'ok');
    _daRefreshCounts();
    _daUpdateHud();
    _daPushLog('完成一轮样本聚合与评分，输出候选资料包', Math.random() > 0.2 ? 'ok' : 'warn');
  }, 1900);
}

function closeDiscoveryAgentDetail() {
  if (_daFlowTimer) {
    clearInterval(_daFlowTimer);
    _daFlowTimer = null;
  }
  document.getElementById('da-detail-view').classList.remove('active');
  var back = document.getElementById(_daParentView || 'discovery-agent-view');
  if (back) back.classList.add('active');
  document.querySelector('.nav-links').style.display = '';
  document.getElementById('nav-back').style.display = 'none';
}

function investDiscoveryAgent(agentName) {
  openW4InvestModal(agentName || 'Agent');
}

renderMainGrid();
renderOtherGrid();
_renderRankRows('all');
var _drInitTab = document.querySelector('.dr-role-tab.active');
if (_drInitTab) switchDiscoveryRole(_drInitTab.getAttribute('data-dr-role') || 'listing', _drInitTab);

// ─── NAVIGATION ─────────────────────────────────────────
let detailChart = null;

function openDetail(id) {
  const m = MARKETS.find(x => x.id === id);
  if (!m) return;
  document.getElementById('rank-view').classList.remove('active');
  document.getElementById('detail-view').style.display = '';

  document.getElementById('detail-cover').textContent = m.emoji;
  document.getElementById('detail-title').textContent = m.title;
  document.getElementById('detail-category').textContent = m.category;
  document.getElementById('detail-vol').textContent = m.totalVol;
  document.getElementById('detail-date').textContent = m.date;
  document.getElementById('detail-creator-avatar').textContent = m.creatorEmoji;
  document.getElementById('detail-creator-name').textContent = m.creator;

  const firstOpt = m.options ? m.options[0].name : m.title;
  document.getElementById('panel-title').textContent = firstOpt;

  const table = document.getElementById('detail-options-table');
  const thead = table.querySelector('.options-thead');
  table.innerHTML = '';
  table.appendChild(thead);

  if (m.type === 'multi' && m.options) {
    m.options.forEach(o => {
      const row = document.createElement('div');
      row.className = 'option-row';
      row.innerHTML = `<span class="option-name">${o.name}</span>
        <span class="option-vol">${o.vol}</span>
        <span class="option-pct">${o.pct}%</span>
        <div class="option-btns">
          <button class="opt-btn yes" onclick="selectOption('${o.name}','yes')">是</button>
          <button class="opt-btn no" onclick="selectOption('${o.name}','no')">否</button>
        </div>`;
      table.appendChild(row);
    });
  } else {
    const row = document.createElement('div');
    row.className = 'option-row';
    row.innerHTML = `<span class="option-name">${m.title}</span>
      <span class="option-vol">${m.totalVol}</span>
      <span class="option-pct">${m.chance}%</span>
      <div class="option-btns">
        <button class="opt-btn yes" onclick="selectOption('${m.title}','yes')">是</button>
        <button class="opt-btn no" onclick="selectOption('${m.title}','no')">否</button>
      </div>`;
    table.appendChild(row);
  }

  const colors = ['#22c55e','#ef4444','#eab308','#3b82f6'];
  const items = m.options || [{ name: 'YES', pct: m.chance }, { name: 'NO', pct: 100 - m.chance }];
  document.getElementById('chart-legend').innerHTML = items.map((o,i) =>
    `<div class="legend-item"><div class="legend-dot" style="background:${colors[i%colors.length]}"></div><span>${o.name.length > 10 ? o.name.slice(0,10)+'...' : o.name} ${o.pct}%</span></div>`
  ).join('');

  document.getElementById('home-view').classList.remove('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  var w4dView = document.getElementById('w4d-view');
  if (w4dView) w4dView.classList.remove('active');
  document.getElementById('detail-view').classList.add('active');
  document.getElementById('nav-back').classList.add('visible');
  document.getElementById('nav-links').style.display = 'none';

  if (detailChart) { detailChart.destroy(); detailChart = null; }
  const points = 90;
  const labels = Array.from({length: points}, (_,i) => i % 15 === 0 ? `02/${14 + Math.floor(i/15)} 00:00` : '');
  const datasets = items.map((o, idx) => {
    let v = o.pct;
    const data = Array.from({length: points}, () => { v += (Math.random()-0.5)*1.5; v=Math.max(10,Math.min(90,v)); return v; });
    return { label: o.name, data, borderColor: colors[idx%colors.length], borderWidth: 1.5, pointRadius: 0, tension: 0.2 };
  });

  const ctx = document.getElementById('detailChart').getContext('2d');
  detailChart = new Chart(ctx, {
    type: 'line',
    data: { labels, datasets },
    options: {
      responsive: true, maintainAspectRatio: false,
      interaction: { mode:'index', intersect:false },
      plugins: {
        legend: { display: false },
        tooltip: { backgroundColor:'#1e1e1e', borderColor:'#2a2a2a', borderWidth:1, titleColor:'#777', bodyColor:'#e8e8e8', padding:8,
          callbacks: { label: c => ` ${c.dataset.label}: ${c.parsed.y.toFixed(1)}%` } }
      },
      scales: {
        x: { grid:{color:'rgba(255,255,255,0.04)'}, ticks:{color:'#555',font:{size:10},maxRotation:0}, border:{display:false} },
        y: { position:'right', min:0, max:100, ticks:{color:'#555',font:{size:10},callback:v=>v+'%',stepSize:10}, grid:{color:'rgba(255,255,255,0.04)'}, border:{display:false} }
      }
    }
  });

  window.scrollTo(0,0);
}

function goHome() {
  if (_ahTermTimer) { clearInterval(_ahTermTimer); _ahTermTimer = null; }
  if (_daFlowTimer) { clearInterval(_daFlowTimer); _daFlowTimer = null; }
  if (typeof closeW4AgentProfile === 'function') closeW4AgentProfile();
  document.getElementById('rank-view').classList.remove('active');
  document.getElementById('detail-view').classList.remove('active');
  document.getElementById('detail-view').style.display = '';
  document.getElementById('home-view').classList.add('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('ah-detail-view').classList.remove('active');
  document.getElementById('creator-view').classList.remove('active');
  document.getElementById('profile-view').classList.remove('active');
  document.getElementById('cm-view').classList.remove('active');
  document.getElementById('cm-preview-overlay').classList.remove('open');
  var otherPV = document.getElementById('other-profile-view');
  if (otherPV) { otherPV.classList.remove('active'); otherPV.style.display = 'none'; }
  document.getElementById('nav-back').classList.remove('visible');
  document.getElementById('nav-back').style.display = '';
  document.getElementById('nav-links').style.display = '';
  document.querySelectorAll('#nav-links .nav-link').forEach(function(n){ n.classList.remove('active'); });
  document.querySelectorAll('#nav-links .nav-link')[1].classList.add('active');
  if (detailChart) { detailChart.destroy(); detailChart = null; }
}

// ─── HOMEPAGE INTERACTIONS ─────────────────────────────
function toggleBookmark(el) {
  const saved = el.classList.toggle('saved');
  el.textContent = saved ? '★' : '☆';
  if (document.getElementById('fav-filter-btn').classList.contains('active')) {
    applyFavFilter();
  }
}

function toggleFavFilter() {
  var btn = document.getElementById('fav-filter-btn');
  btn.classList.toggle('active');
  var icon = btn.querySelector('.fav-filter-icon');
  if (btn.classList.contains('active')) {
    icon.textContent = '★';
    applyFavFilter();
  } else {
    icon.textContent = '☆';
    document.querySelectorAll('#main-market-grid .market-card').forEach(function(card) {
      card.style.display = '';
    });
  }
}

function applyFavFilter() {
  document.querySelectorAll('#main-market-grid .market-card').forEach(function(card) {
    var bm = card.querySelector('.card-bookmark');
    if (bm && bm.classList.contains('saved')) {
      card.style.display = '';
    } else {
      card.style.display = 'none';
    }
  });
}

function toggleMulti(trigger) {
  trigger.classList.toggle('open');
  trigger.nextElementSibling.classList.toggle('open');
}

function toggleSelect(id) {
  const el = document.getElementById(id);
  const trigger = el.querySelector('.custom-select-trigger');
  const menu = el.querySelector('.custom-select-menu');
  document.querySelectorAll('.custom-select').forEach(s => {
    if (s.id !== id) { s.querySelector('.custom-select-trigger').classList.remove('open'); s.querySelector('.custom-select-menu').classList.remove('open'); }
  });
  trigger.classList.toggle('open');
  menu.classList.toggle('open');
}

function setSort(item, value) {
  document.getElementById('sort-label').textContent = '排序: ' + value;
  document.querySelectorAll('#sort-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  closeSelect('sort-select');
}
function toggleSort(item) {
  const wasSelected = item.classList.contains('selected');
  document.querySelectorAll('#sort-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  if (wasSelected) {
    const newDir = item.dataset.dir === 'desc' ? 'asc' : 'desc';
    item.dataset.dir = newDir;
    item.querySelector('.sort-item-dir').textContent = newDir==='desc'?'↓':'↑';
    document.getElementById('sort-label').textContent = '排序: ' + item.querySelector('.sort-item-label').textContent + ' ' + (newDir==='desc'?'↓':'↑');
  } else {
    item.dataset.dir = 'desc';
    item.querySelector('.sort-item-dir').textContent = '↓';
    document.getElementById('sort-label').textContent = '排序: ' + item.querySelector('.sort-item-label').textContent + ' ↓';
    closeSelect('sort-select');
  }
}
function closeSelect(id) {
  const el = document.getElementById(id);
  el.querySelector('.custom-select-trigger').classList.remove('open');
  el.querySelector('.custom-select-menu').classList.remove('open');
}
function setStatus(item, value) {
  document.getElementById('status-label').textContent = '状态: ' + value;
  document.querySelectorAll('#status-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  closeSelect('status-select');
}
function toggleOtherPanel(tab) {
  const panel = document.getElementById('other-panel');
  const isOpen = panel.classList.toggle('open');
  tab.classList.toggle('active', isOpen);
  tab.textContent = isOpen ? '其他 ▴' : '其他 ▾';
}
function selectOtherCat(item) {
  document.querySelectorAll('.other-cat-item').forEach(i => i.classList.remove('active'));
  item.classList.add('active');
}
function setOtherSort(item, value) {
  document.getElementById('other-sort-label').textContent = '排序: ' + value;
  document.querySelectorAll('#other-sort-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  closeSelect('other-sort-select');
}
function toggleOtherSort(item) {
  const wasSelected = item.classList.contains('selected');
  document.querySelectorAll('#other-sort-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  if (wasSelected) {
    const newDir = item.dataset.dir === 'desc' ? 'asc' : 'desc';
    item.dataset.dir = newDir;
    item.querySelector('.sort-item-dir').textContent = newDir==='desc'?'↓':'↑';
    document.getElementById('other-sort-label').textContent = '排序: ' + item.querySelector('.sort-item-label').textContent + ' ' + (newDir==='desc'?'↓':'↑');
  } else {
    item.dataset.dir = 'desc';
    item.querySelector('.sort-item-dir').textContent = '↓';
    document.getElementById('other-sort-label').textContent = '排序: ' + item.querySelector('.sort-item-label').textContent + ' ↓';
    closeSelect('other-sort-select');
  }
}
function setOtherStatus(item, value) {
  document.getElementById('other-status-label').textContent = '状态: ' + value;
  document.querySelectorAll('#other-status-select .custom-select-item').forEach(i => i.classList.remove('selected'));
  item.classList.add('selected');
  closeSelect('other-status-select');
}

document.addEventListener('click', e => {
  if (!e.target.closest('.custom-select')) {
    document.querySelectorAll('.custom-select-trigger').forEach(t => t.classList.remove('open'));
    document.querySelectorAll('.custom-select-menu').forEach(m => m.classList.remove('open'));
  }
  if (!e.target.closest('#other-tab') && !e.target.closest('#other-panel')) {
    const panel = document.getElementById('other-panel');
    if (panel.classList.contains('open')) {
      panel.classList.remove('open');
      const tab = document.getElementById('other-tab');
      tab.classList.remove('active');
      tab.textContent = '其他 ▾';
    }
  }
});

// ─── QUICK ORDER MODAL ──────────────────────────────────
var _orderAmount = 0;
var _orderPrice = 0.32;
var _orderOptions = null;

function openOrderModal(marketTitle, emoji, optionName, side, pct) {
  var selectEl = document.getElementById('order-option-select');
  var ddEl = document.getElementById('order-option-dropdown');
  selectEl.classList.remove('open');

  _orderOptions = _multiOptionsMap[marketTitle] || null;

  document.getElementById('order-emoji').textContent = emoji;
  document.getElementById('order-market-title').textContent = marketTitle;

  if (_orderOptions) {
    document.getElementById('order-option-name').innerHTML = optionName + ' <span class="order-option-arrow">▾</span>';
    selectEl.classList.add('has-dropdown');
    ddEl.innerHTML = _orderOptions.map(function(o) {
      var cls = o.name === optionName ? ' active' : '';
      var escN = o.name.replace(/'/g, "\\'");
      return '<div class="order-option-item' + cls + '" onclick="event.stopPropagation();selectOrderOption(\'' + escN + '\',' + o.pct + ')">' +
        '<span class="order-option-item-name">' + o.name + '</span>' +
        '<span class="order-option-item-pct">' + o.pct + '%</span></div>';
    }).join('');
  } else {
    document.getElementById('order-option-name').textContent = optionName;
    selectEl.classList.remove('has-dropdown');
    ddEl.innerHTML = '';
  }

  var yesPrice = (pct / 100).toFixed(2);
  var noPrice = (1 - pct / 100).toFixed(2);
  document.getElementById('order-yes-price').textContent = '$' + yesPrice;
  document.getElementById('order-no-price').textContent = '$' + noPrice;
  _orderPrice = side === 'yes' ? parseFloat(yesPrice) : parseFloat(noPrice);
  var yb = document.getElementById('order-yes-btn');
  var nb = document.getElementById('order-no-btn');
  yb.classList.remove('inactive');
  nb.classList.remove('inactive', 'active-no');
  if (side === 'yes') { nb.classList.add('inactive'); }
  else { yb.classList.add('inactive'); nb.classList.add('active-no'); }
  _orderAmount = 0;
  document.getElementById('order-amount-val').textContent = '$0';
  document.getElementById('order-slider').value = 0;
  document.getElementById('order-win-val').textContent = '$0';
  document.querySelectorAll('.order-tab').forEach(function(t,i){ t.classList.toggle('active', i===0); });
  document.getElementById('order-overlay').classList.add('open');
}

function toggleOrderOptionDropdown(e) {
  if (!_orderOptions) return;
  e.stopPropagation();
  document.getElementById('order-option-select').classList.toggle('open');
}

function selectOrderOption(name, pct) {
  document.getElementById('order-option-name').innerHTML = name + ' <span class="order-option-arrow">▾</span>';
  document.getElementById('order-option-select').classList.remove('open');
  document.querySelectorAll('.order-option-item').forEach(function(item) {
    item.classList.toggle('active', item.querySelector('.order-option-item-name').textContent === name);
  });
  var yesPrice = (pct / 100).toFixed(2);
  var noPrice = (1 - pct / 100).toFixed(2);
  document.getElementById('order-yes-price').textContent = '$' + yesPrice;
  document.getElementById('order-no-price').textContent = '$' + noPrice;
  var yb = document.getElementById('order-yes-btn');
  var isYes = !yb.classList.contains('inactive');
  _orderPrice = isYes ? parseFloat(yesPrice) : parseFloat(noPrice);
  updateOrderWin();
}

function closeOrderModal() {
  document.getElementById('order-overlay').classList.remove('open');
  document.getElementById('order-option-select').classList.remove('open');
}

document.addEventListener('click', function(e) {
  var sel = document.getElementById('order-option-select');
  if (sel && sel.classList.contains('open') && !sel.contains(e.target)) {
    sel.classList.remove('open');
  }
});

function switchOrderTab(el) {
  el.closest('.order-tabs').querySelectorAll('.order-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
}

function selectOrderSide(side, btn) {
  document.querySelectorAll('.order-side-btn').forEach(function(b){ b.classList.remove('active-no'); b.classList.add('inactive'); });
  btn.classList.remove('inactive');
  if (side === 'no') btn.classList.add('active-no');
  _orderPrice = parseFloat(side === 'yes' ? document.getElementById('order-yes-price').textContent.replace('$','') : document.getElementById('order-no-price').textContent.replace('$',''));
  updateOrderWin();
}

function adjustOrderAmount(d) {
  _orderAmount = Math.max(0, _orderAmount + d);
  document.getElementById('order-amount-val').textContent = '$' + _orderAmount;
  document.getElementById('order-slider').value = _orderAmount;
  updateOrderWin();
}

function orderSliderChanged(v) {
  _orderAmount = parseInt(v);
  document.getElementById('order-amount-val').textContent = '$' + _orderAmount;
  updateOrderWin();
}

function updateOrderWin() {
  document.getElementById('order-win-val').textContent = _orderAmount > 0 ? '$' + (_orderAmount / _orderPrice).toFixed(2) : '$0';
}

// ─── DETAIL INTERACTIONS ────────────────────────────────
function switchContentTab(el) {
  el.closest('.content-tabs').querySelectorAll('.content-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  var panelId = el.getAttribute('data-panel');
  if (!panelId) return;
  document.querySelectorAll('.detail-content-panel').forEach(p => p.classList.remove('active'));
  var panel = document.getElementById(panelId);
  if (panel) panel.classList.add('active');
  if (panelId === 'panel-holders') renderHolders();
  if (panelId === 'panel-comments') renderComments();
}
function switchTF(el) {
  el.closest('.chart-controls').querySelectorAll('.tf-btn').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
function switchPosTab(el) {
  el.closest('.position-tabs').querySelectorAll('.pos-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
function switchTradeTab(el) {
  el.closest('.trade-tabs').querySelectorAll('.trade-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
}
function selectOption(name, side) {
  document.getElementById('panel-title').textContent = name;
  if (side === 'yes') {
    document.querySelector('.outcome-btn.yes').classList.remove('inactive');
    document.querySelector('.outcome-btn.no').classList.remove('no-active');
    document.querySelector('.outcome-btn.no').classList.add('inactive');
  } else {
    document.querySelector('.outcome-btn.yes').classList.add('inactive');
    document.querySelector('.outcome-btn.no').classList.remove('inactive');
    document.querySelector('.outcome-btn.no').classList.add('no-active');
  }
}
function toggleMoreMenu() {
  const menu = document.getElementById('more-menu');
  menu.classList.toggle('open');
  event.stopPropagation();
}
function closeMoreMenu() {
  document.getElementById('more-menu').classList.remove('open');
}
document.addEventListener('click', e => {
  if (!e.target.closest('#hdr-more-wrap')) {
    const m = document.getElementById('more-menu');
    if (m) m.classList.remove('open');
  }
});

function toggleDetailBookmark(btn) {
  btn.classList.toggle('bookmarked');
  btn.textContent = btn.classList.contains('bookmarked') ? '★' : '☆';
}

function selectBuySide(side, btn) {
  document.querySelectorAll('.outcome-btn').forEach(b => { b.classList.remove('no-active'); b.classList.add('inactive'); });
  btn.classList.remove('inactive');
  if (side === 'no') btn.classList.add('no-active');
}

let tradeAmount = 0;
function adjustAmount(delta) {
  tradeAmount = Math.max(0, tradeAmount + delta);
  document.getElementById('amount-display').textContent = '$' + tradeAmount;
  document.getElementById('amountSlider').value = tradeAmount;
  updateWin();
}
function sliderChanged(val) {
  tradeAmount = parseInt(val);
  document.getElementById('amount-display').textContent = '$' + tradeAmount;
  updateWin();
}
function updateWin() {
  document.getElementById('win-amount').textContent = tradeAmount > 0 ? '$' + (tradeAmount/0.32).toFixed(2) : '$0';
}

// ─── THEME TOGGLE ────────────────────────────────────────
function toggleTheme() {
  var body = document.body;
  var btn = document.querySelector('.theme-toggle');
  if (body.classList.contains('light')) {
    body.classList.remove('light');
    btn.textContent = '🌙';
    btn.title = '切换到浅色主题';
  } else {
    body.classList.add('light');
    btn.textContent = '☀️';
    btn.title = '切换到深色主题';
  }
}

// ─── TOP HOLDERS DATA & RENDER ───────────────────────────
var avatarGradients = [
  'linear-gradient(135deg,#667eea,#764ba2)','linear-gradient(135deg,#f093fb,#f5576c)',
  'linear-gradient(135deg,#4facfe,#00f2fe)','linear-gradient(135deg,#43e97b,#38f9d7)',
  'linear-gradient(135deg,#fa709a,#fee140)','linear-gradient(135deg,#a18cd1,#fbc2eb)',
  'linear-gradient(135deg,#fccb90,#d57eeb)','linear-gradient(135deg,#f6d365,#fda085)',
  'linear-gradient(135deg,#84fab0,#8fd3f4)','linear-gradient(135deg,#cfd9df,#e2ebf0)'
];
var holdersData = {
  '无变化': {
    yes: [{name:'Vivaldi007',shares:452149},{name:'Worried-Abacus',shares:114961},{name:'ebxx',shares:100646},{name:'Vacant-Extreme',shares:100000},{name:'the67892',shares:73135},{name:'jabbay25',shares:69467},{name:'Unaware-Service',shares:57125},{name:'NotJayE',shares:52680}],
    no: [{name:'everbased',shares:336813},{name:'SwissMiss',shares:267423},{name:'thegreengem',shares:103183},{name:'kvento',shares:102480},{name:'scaffolding',shares:99953},{name:'19HO',shares:89925},{name:'aff3',shares:83636},{name:'yougotme',shares:68918}]
  },
  '50个基点以上的降息': {
    yes: [{name:'CryptoKing_88',shares:280500},{name:'WhaleTrader',shares:195200},{name:'MacroMaster',shares:142800},{name:'FlashTrader',shares:98600},{name:'PredictPro',shares:76300},{name:'MoonShot_Dev',shares:55000}],
    no: [{name:'DiamondHands',shares:410300},{name:'OracleVision',shares:225800},{name:'BraveLion',shares:168500},{name:'TideRider',shares:120400},{name:'LuckyCat_99',shares:87600},{name:'spike_email',shares:62100}]
  },
  '25个基点以上的上调': {
    yes: [{name:'TideRider',shares:185700},{name:'NewTrader88',shares:120300},{name:'DeFi_Whale',shares:95400},{name:'预测达人',shares:78200},{name:'BlockchainBob',shares:54600}],
    no: [{name:'Vivaldi007',shares:520000},{name:'CryptoAnalyst',shares:310800},{name:'FridayImInLove',shares:198500},{name:'ebxx',shares:145200},{name:'CoinMaster',shares:92300}]
  }
};
var holdersOptions = Object.keys(holdersData);
var currentHoldersOption = holdersOptions[0];

function fmtShares(n) {
  return n.toLocaleString('en-US');
}

function switchHoldersOption(val) {
  currentHoldersOption = val;
  document.getElementById('holders-section-content').removeAttribute('data-rendered');
  renderHolders();
}

function renderHolders() {
  var el = document.getElementById('holders-section-content');
  if (el.getAttribute('data-rendered')) return;
  el.setAttribute('data-rendered','1');
  var html = '';
  html += '<div class="holders-date-row"><select class="holders-date-select" onchange="switchHoldersOption(this.value)">';
  for (var i = 0; i < holdersOptions.length; i++) {
    var opt = holdersOptions[i];
    html += '<option value="'+opt+'"'+(opt===currentHoldersOption?' selected':'')+'>'+opt+'</option>';
  }
  html += '</select></div>';
  var data = holdersData[currentHoldersOption];
  html += '<div class="holders-grid">';
  html += '<div><div class="holders-col-header"><span class="holders-col-title">Yes holders</span><span class="holders-shares-label">SHARES</span></div>';
  for (var i = 0; i < data.yes.length; i++) {
    var h = data.yes[i];
    html += '<div class="holder-row">';
    html += '<div class="holder-avatar" style="background:'+avatarGradients[i%avatarGradients.length]+'"></div>';
    html += '<span class="holder-name">'+h.name+'</span>';
    html += '<span class="holder-shares yes-color">'+fmtShares(h.shares)+'</span>';
    html += '</div>';
  }
  html += '</div>';
  html += '<div><div class="holders-col-header"><span class="holders-col-title">No holders</span><span class="holders-shares-label">SHARES</span></div>';
  for (var i = 0; i < data.no.length; i++) {
    var h = data.no[i];
    html += '<div class="holder-row">';
    html += '<div class="holder-avatar" style="background:'+avatarGradients[(i+3)%avatarGradients.length]+'"></div>';
    html += '<span class="holder-name">'+h.name+'</span>';
    html += '<span class="holder-shares no-color">'+fmtShares(h.shares)+'</span>';
    html += '</div>';
  }
  html += '</div>';
  html += '</div>';
  el.innerHTML = html;
}

// ─── COMMENTS DATA & RENDER ─────────────────────────────
var commentsData = [
  {author:'MEPP',badge:'19.5K Yes',badgeType:'yes',time:'2h ago',text:'https://x.com/MEPPonPM/status/20243040931421 dead man walking',likes:0,replies:0},
  {author:'niggeeeer',badge:null,badgeType:null,time:'7h ago',text:'yii',likes:1,replies:0},
  {author:'Fragrant-Corpora...',badge:'846 Yes',badgeType:'yes',time:'8h ago',text:'Betting yes because there is any chance Khamenei will actually be out of power soon? Broke. Betting yes because any US strike will send the prices soaring, because Americans have zero critical thinking skills, and then pivoting the profit into no? Woke.',likes:2,replies:2},
  {author:'BlockchainBob',badge:'2.1K No',badgeType:'no',time:'12h ago',text:'市场波动太大了，大家注意风险管理。这个市场的深度还不够，大额交易要小心滑点。',likes:5,replies:1},
  {author:'CryptoAnalyst',badge:'500 Yes',badgeType:'yes',time:'1d ago',text:'从链上数据来看，近期的资金流入主要集中在 Yes 方向，但 No 方的大户持仓也很稳定。建议关注接下来的新闻事件。',likes:8,replies:3},
  {author:'DeFi_Whale',badge:null,badgeType:null,time:'1d ago',text:'Anyone else think this market is underpriced? The implied probability seems too low given recent developments.',likes:3,replies:2},
  {author:'预测达人',badge:'1.2K No',badgeType:'no',time:'2d ago',text:'从历史数据来看，这类事件的概率被市场高估了。建议做一些对冲。',likes:6,replies:4},
  {author:'NewTrader88',badge:'120 Yes',badgeType:'yes',time:'3d ago',text:'第一次在预测市场交易，感觉很有趣！请问大家一般是怎么分析概率的？',likes:2,replies:5}
];

function renderComments() {
  var el = document.getElementById('comments-section-content');
  if (el.getAttribute('data-rendered')) return;
  el.setAttribute('data-rendered','1');
  var html = '';
  html += '<div class="comment-input-row"><input class="comment-input" placeholder="Add a comment..."><button class="comment-post-btn">Post</button></div>';
  html += '<div class="comment-controls">';
  html += '<button class="comment-sort-btn">Newest ▾</button>';
  html += '<label class="comment-holders-check"><input type="checkbox"> Holders</label>';
  html += '<span class="comment-warning">⚠ Beware of external links.</span>';
  html += '</div>';
  for (var i = 0; i < commentsData.length; i++) {
    var c = commentsData[i];
    html += '<div class="comment-item">';
    html += '<div class="comment-avatar" style="background:'+avatarGradients[(i+2)%avatarGradients.length]+'"></div>';
    html += '<div class="comment-body">';
    html += '<div class="comment-header">';
    html += '<span class="comment-author">'+c.author+'</span>';
    if (c.badge) {
      html += '<span class="comment-badge '+(c.badgeType==='yes'?'yes-badge':'no-badge')+'">'+c.badge+'</span>';
    }
    html += '<span class="comment-time">'+c.time+'</span>';
    html += '</div>';
    var safeText = c.text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank" rel="noopener">$1</a>');
    html += '<div class="comment-text">'+safeText+'</div>';
    html += '<div class="comment-actions">';
    html += '<button class="comment-like">♡ '+c.likes+'</button>';
    if (c.replies > 0) html += '<span class="comment-reply-link">'+c.replies+' Replies ▿</span>';
    html += '<button class="comment-more">···</button>';
    html += '</div>';
    html += '</div></div>';
  }
  el.innerHTML = html;
}

// ─── USER DROPDOWN & CREATOR CENTER ──────────────────────
function toggleUserMenu() {
  var dd = document.getElementById('user-dropdown');
  dd.classList.toggle('open');
}
function closeUserMenu() {
  document.getElementById('user-dropdown').classList.remove('open');
}
document.addEventListener('click', function(e) {
  var wrap = document.getElementById('user-avatar-wrap');
  if (wrap && !wrap.contains(e.target)) closeUserMenu();
});

function openCreatorCenter() {
  closeUserMenu();
  if (typeof closeW4AgentProfile === 'function') closeW4AgentProfile();
  if (_daFlowTimer) { clearInterval(_daFlowTimer); _daFlowTimer = null; }
  document.getElementById('rank-view').classList.remove('active');
  document.getElementById('home-view').classList.remove('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('detail-view').style.display = 'none';
  document.getElementById('profile-view').classList.remove('active');
  document.getElementById('cm-view').classList.remove('active');
  document.getElementById('creator-view').classList.add('active');
  document.getElementById('nav-back').style.display = 'flex';
  document.getElementById('nav-links').style.display = 'none';
}

function openProfile() {
  closeUserMenu();
  if (typeof closeW4AgentProfile === 'function') closeW4AgentProfile();
  if (_daFlowTimer) { clearInterval(_daFlowTimer); _daFlowTimer = null; }
  document.getElementById('rank-view').classList.remove('active');
  document.getElementById('home-view').classList.remove('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('detail-view').style.display = 'none';
  document.getElementById('creator-view').classList.remove('active');
  document.getElementById('cm-view').classList.remove('active');
  var otherPV = document.getElementById('other-profile-view');
  if (otherPV) { otherPV.classList.remove('active'); otherPV.style.display = 'none'; }
  document.getElementById('profile-view').classList.add('active');
  document.getElementById('nav-back').style.display = 'flex';
  document.getElementById('nav-links').style.display = 'none';
}

function switchProfileTab(el) {
  el.closest('.profile-activity-tabs').querySelectorAll('.profile-activity-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
  document.querySelectorAll('.profile-activity-panel').forEach(function(p){ p.classList.remove('active'); });
  var panelId = el.getAttribute('data-panel');
  if (panelId) document.getElementById(panelId).classList.add('active');
}

function toggleFollow(btn) {
  if (btn.classList.contains('following')) {
    btn.classList.remove('following');
    btn.textContent = '关注';
  } else {
    btn.classList.add('following');
    btn.textContent = '已关注';
  }
}

var _shareDropdown = null;
function openShareMenu(el) {
  closeShareMenu();
  var rect = el.getBoundingClientRect();
  var dd = document.createElement('div');
  dd.className = 'share-dropdown';
  dd.innerHTML = '<div class="share-dropdown-title">分享到</div>'
    + '<div class="share-dropdown-item" onclick="alert(\'已复制分享文案到剪贴板\');closeShareMenu()"><div class="sdi-icon" style="background:rgba(59,130,246,0.12);color:#3b82f6">📋</div>复制链接</div>'
    + '<div class="share-dropdown-item" onclick="alert(\'已复制TG分享文案\');closeShareMenu()"><div class="sdi-icon" style="background:rgba(34,197,94,0.12);color:#22c55e">✈</div>分享到 Telegram</div>'
    + '<div class="share-dropdown-item" onclick="alert(\'已复制X分享文案\');closeShareMenu()"><div class="sdi-icon" style="background:rgba(255,255,255,0.1);color:var(--text)">𝕏</div>分享到 X</div>'
    + '<div class="share-dropdown-sep"></div>'
    + '<div class="share-dropdown-title">分享给关注我的人</div>'
    + '<div class="share-dropdown-item" onclick="alert(\'已推送给所有粉丝\');closeShareMenu()"><div class="sdi-icon" style="background:rgba(139,92,246,0.12);color:#8b5cf6">📢</div>推送给全部粉丝 <span style="color:var(--text-muted);font-size:11px;margin-left:4px">731人</span></div>'
    + '<div class="share-dropdown-sep"></div>'
    + '<div class="share-dropdown-title">分享给好友（互关）</div>'
    + '<div class="share-dropdown-friend" onclick="this.classList.toggle(\'selected\')"><div class="sdf-avatar" style="background:linear-gradient(135deg,#f59e0b,#f97316);color:#fff">👑</div>CryptoKing_88<span class="sdf-check">✓</span></div>'
    + '<div class="share-dropdown-friend" onclick="this.classList.toggle(\'selected\')"><div class="sdf-avatar" style="background:linear-gradient(135deg,#3b82f6,#6366f1);color:#fff">🐋</div>WhaleTrader<span class="sdf-check">✓</span></div>'
    + '<div class="share-dropdown-friend" onclick="this.classList.toggle(\'selected\')"><div class="sdf-avatar" style="background:linear-gradient(135deg,#10b981,#059669);color:#fff">🚀</div>MoonShot_Dev<span class="sdf-check">✓</span></div>'
    + '<div class="share-dropdown-friend" onclick="this.classList.toggle(\'selected\')"><div class="sdf-avatar" style="background:linear-gradient(135deg,#ec4899,#f43f5e);color:#fff">🎲</div>LuckyCat_99<span class="sdf-check">✓</span></div>'
    + '<button class="share-dropdown-send" onclick="var c=document.querySelectorAll(\'.share-dropdown-friend.selected\');if(!c.length){alert(\'请选择好友\')}else{var n=[];c.forEach(function(e){n.push(e.childNodes[1].textContent)});alert(\'已分享给：\'+n.join(\'、\'));closeShareMenu()}">发送给选中好友</button>';
  var top = rect.bottom + 6;
  var left = rect.left - 100;
  if (top + 400 > window.innerHeight) top = rect.top - 400;
  if (left < 10) left = 10;
  if (left + 220 > window.innerWidth) left = window.innerWidth - 230;
  dd.style.top = top + 'px';
  dd.style.left = left + 'px';
  document.body.appendChild(dd);
  _shareDropdown = dd;
  setTimeout(function() { document.addEventListener('click', _shareClickAway); }, 10);
}
function closeShareMenu() {
  if (_shareDropdown) { _shareDropdown.remove(); _shareDropdown = null; }
  document.removeEventListener('click', _shareClickAway);
}
function _shareClickAway(e) {
  if (_shareDropdown && !_shareDropdown.contains(e.target)) closeShareMenu();
}

function openUserProfile(username, emoji, badges, winRate, volume, rank, followers, following, isPrivate) {
  document.getElementById('rank-view').classList.remove('active');
  if (_daFlowTimer) { clearInterval(_daFlowTimer); _daFlowTimer = null; }
  var viewIds = ['home-view','profile-view','creator-view','detail-view','cm-view','follow-feed-view','agent-hub-view','discovery-agent-view','listing-agent-view','verify-agent-view','lp-agent-view','governance-agent-view','da-detail-view','web4-view','w4d-view','ah-detail-view'];
  viewIds.forEach(function(id) { var v = document.getElementById(id); if(v) v.classList.remove('active'); });
  document.getElementById('nav-back').style.display = 'flex';
  document.getElementById('nav-links').style.display = 'none';
  var container = document.getElementById('other-profile-view');
  if (!container) {
    container = document.createElement('div');
    container.id = 'other-profile-view';
    container.className = 'profile-view';
    document.body.appendChild(container);
  }
  container.classList.add('active');
  container.style.display = 'block';
  var badgeHtml = '';
  if (badges === 'kol') badgeHtml = '<span class="badge-verified" title="KOL 认证">V</span>';
  else if (badges === 'media') badgeHtml = '<span class="badge-verified media" title="媒体认证">M</span>';
  var blurStyle = isPrivate ? 'filter:blur(6px);pointer-events:none;user-select:none' : '';
  var privBadge = isPrivate ? '<div style="display:flex;align-items:center;gap:6px;margin-top:6px;font-size:12px;color:var(--text-muted)"><span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:#f59e0b"></span>Private Account — 该用户已开启隐私保护</div>' : '';
  var privOverlay = isPrivate
    ? '<div style="position:relative"><div style="position:absolute;inset:0;z-index:2;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(0,0,0,0.35);border-radius:12px;backdrop-filter:blur(2px)"><div style="font-size:32px;margin-bottom:8px">🔒</div><div style="font-size:14px;font-weight:600;color:#fff">该用户已开启隐私保护</div><div style="font-size:12px;color:rgba(255,255,255,0.6);margin-top:4px">关注后可查看更多信息</div></div><div style="' + blurStyle + '">'
    : '';
  var privOverlayEnd = isPrivate ? '</div></div>' : '';
  container.innerHTML = ''
    + '<div style="max-width:960px;margin:0 auto;padding:24px 20px 60px">'
    + '<div style="margin-bottom:16px"><button onclick="openProfile()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;font-size:14px;font-family:inherit;padding:0">← 返回我的主页</button></div>'
    + '<div style="display:flex;gap:24px;align-items:flex-start">'
    +   '<div style="flex:1;min-width:0">'
    +     '<div class="profile-card" style="margin-bottom:16px">'
    +       '<div class="profile-top">'
    +         '<div class="profile-avatar" style="background:linear-gradient(135deg,#6366f1,#8b5cf6)"><span style="font-size:36px">' + emoji + '</span></div>'
    +         '<div class="profile-info">'
    +           '<div style="display:flex;align-items:center;gap:6px"><div class="profile-name">' + username + '</div>' + badgeHtml + '</div>'
    +           '<div class="profile-handle"><span>@' + username.toLowerCase().replace(/[^a-z0-9]/g, '_') + '</span></div>'
    +           '<div class="profile-meta" style="margin-top:8px">'
    +             '<div class="profile-meta-item"><strong>' + (following || '42') + '</strong> 关注</div>'
    +             '<div class="profile-meta-item"><strong>' + (followers || '1.2K') + '</strong> 粉丝</div>'
    +             '<div class="profile-meta-item"><strong>' + (rank || '#--') + '</strong> 排名</div>'
    +           '</div>'
    +           privBadge
    +         '</div>'
    +         '<div style="margin-left:auto;display:flex;flex-direction:column;align-items:flex-end;gap:8px">'
    +           '<button class="pf-follow-btn" onclick="toggleFollow(this)" style="padding:6px 20px;border-radius:20px;border:1px solid var(--accent,#3b82f6);background:transparent;color:var(--accent,#3b82f6);font-size:13px;font-weight:600;cursor:pointer;font-family:inherit">关注</button>'
    +         '</div>'
    +       '</div>'
    +     '</div>'
    +     '<div style="display:flex;gap:12px;margin-bottom:16px;' + blurStyle + '">'
    +       '<div class="profile-stat-box" style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px"><div class="profile-stat-box-label" style="font-size:12px;color:var(--text-muted)">胜率</div><div class="profile-stat-box-value neutral" style="font-size:20px;margin-top:2px">' + (winRate || '72%') + '</div></div>'
    +       '<div class="profile-stat-box" style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px"><div class="profile-stat-box-label" style="font-size:12px;color:var(--text-muted)">总交易量</div><div class="profile-stat-box-value neutral" style="font-size:20px;margin-top:2px">' + (volume || '$0') + '</div></div>'
    +       '<div class="profile-stat-box" style="flex:1;background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:14px 16px"><div class="profile-stat-box-label" style="font-size:12px;color:var(--text-muted)">总市场</div><div class="profile-stat-box-value neutral" style="font-size:20px;margin-top:2px">12</div></div>'
    +     '</div>'
    +     privOverlay
    +     '<div class="profile-activity-card">'
    +       '<div class="profile-activity-tabs">'
    +         '<div class="profile-activity-tab active" onclick="var ps=this.parentElement.parentElement.querySelectorAll(\'.op-panel\');ps.forEach(function(p){p.style.display=\'none\'});ps[0].style.display=\'block\';this.parentElement.querySelectorAll(\'.profile-activity-tab\').forEach(function(t){t.classList.remove(\'active\')});this.classList.add(\'active\')">仓位</div>'
    +         '<div class="profile-activity-tab" onclick="var ps=this.parentElement.parentElement.querySelectorAll(\'.op-panel\');ps.forEach(function(p){p.style.display=\'none\'});ps[1].style.display=\'block\';this.parentElement.querySelectorAll(\'.profile-activity-tab\').forEach(function(t){t.classList.remove(\'active\')});this.classList.add(\'active\')">动态</div>'
    +         '<div class="profile-activity-tab" onclick="var ps=this.parentElement.parentElement.querySelectorAll(\'.op-panel\');ps.forEach(function(p){p.style.display=\'none\'});ps[2].style.display=\'block\';this.parentElement.querySelectorAll(\'.profile-activity-tab\').forEach(function(t){t.classList.remove(\'active\')});this.classList.add(\'active\')">当前市场</div>'
    +         '<div class="profile-activity-tab" onclick="var ps=this.parentElement.parentElement.querySelectorAll(\'.op-panel\');ps.forEach(function(p){p.style.display=\'none\'});ps[3].style.display=\'block\';this.parentElement.querySelectorAll(\'.profile-activity-tab\').forEach(function(t){t.classList.remove(\'active\')});this.classList.add(\'active\')">历史市场</div>'
    +       '</div>'
    +       '<div class="op-panel" style="display:block;padding:16px">'
    +         '<div style="display:flex;gap:8px;margin-bottom:12px"><span style="padding:4px 12px;border-radius:16px;background:var(--accent,#3b82f6);color:#fff;font-size:12px;font-weight:600">生效中</span><span style="padding:4px 12px;border-radius:16px;border:1px solid var(--border);color:var(--text-muted);font-size:12px;cursor:pointer">已结束</span></div>'
    +         '<div style="font-size:12px;color:var(--text-muted);display:grid;grid-template-columns:1fr 80px 80px 100px;padding:8px 0;border-bottom:1px solid var(--border)"><span>市场</span><span style="text-align:right">均价</span><span style="text-align:right">当前</span><span style="text-align:right">价值</span></div>'
    +         '<div style="display:grid;grid-template-columns:1fr 80px 80px 100px;padding:12px 0;border-bottom:1px solid var(--border);align-items:center"><div><div style="font-size:13px;font-weight:600;color:var(--text)">BTC Q1突破15万？</div><div style="font-size:11px;color:var(--green);margin-top:2px">Yes 71¢ · 200 份额</div></div><span style="text-align:right;font-size:13px;color:var(--text)">71¢</span><span style="text-align:right;font-size:13px;color:var(--text)">73¢</span><span style="text-align:right;font-size:13px;font-weight:600;color:var(--text)">$146.00</span></div>'
    +         '<div style="display:grid;grid-template-columns:1fr 80px 80px 100px;padding:12px 0;border-bottom:1px solid var(--border);align-items:center"><div><div style="font-size:13px;font-weight:600;color:var(--text)">美联储3月决定？</div><div style="font-size:11px;color:var(--red);margin-top:2px">No 37¢ · 500 份额</div></div><span style="text-align:right;font-size:13px;color:var(--text)">37¢</span><span style="text-align:right;font-size:13px;color:var(--text)">42¢</span><span style="text-align:right;font-size:13px;font-weight:600;color:var(--text)">$210.00</span></div>'
    +       '</div>'
    +       '<div class="op-panel" style="display:none;padding:16px">'
    +         '<div class="pf-feed-item" style="border:none;padding:10px 0"><div class="pf-feed-avatar">' + emoji + '</div><div class="pf-feed-body"><div class="pf-feed-head"><span class="pf-feed-name">' + username + '</span><span class="pf-feed-time">1 小时前</span></div><div class="pf-feed-text">买入 <span class="pf-hl">300 份 YES</span> @ $0.65 <span class="pf-feed-badge buy">BUY</span></div><div class="pf-feed-market-link">📊 ETH 2026能否重回5000？</div></div></div>'
    +         '<div class="pf-feed-item" style="border:none;padding:10px 0"><div class="pf-feed-avatar">' + emoji + '</div><div class="pf-feed-body"><div class="pf-feed-head"><span class="pf-feed-name">' + username + '</span><span class="pf-feed-time">3 小时前</span></div><div class="pf-feed-text">添加了 <span class="pf-hl">500 USDT</span> 流动性 <span class="pf-feed-badge lp">LP</span></div><div class="pf-feed-market-link">📊 欧冠决赛冠军？</div></div></div>'
    +         '<div class="pf-feed-item" style="border:none;padding:10px 0"><div class="pf-feed-avatar">' + emoji + '</div><div class="pf-feed-body"><div class="pf-feed-head"><span class="pf-feed-name">' + username + '</span><span class="pf-feed-time">昨天</span></div><div class="pf-feed-text">市场结算：<span style="color:var(--green);font-weight:600">YES 方胜出</span>，获利 <span class="pf-hl">+$320 USDT</span> 🎉 <span class="pf-feed-badge" style="background:rgba(245,158,11,0.15);color:#f59e0b">结算</span></div><div class="pf-feed-market-link">📊 OpenAI发布GPT-5？</div></div></div>'
    +       '</div>'
    +       '<div class="op-panel" style="display:none;padding:16px">'
    +         '<div style="font-size:13px;color:var(--text-muted);margin-bottom:12px">该用户创建的进行中市场</div>'
    +         '<div style="padding:12px 0;border-bottom:1px solid var(--border)"><div style="font-size:13px;font-weight:600;color:var(--text)">2026欧洲央行降息几次？</div><div style="font-size:11px;color:var(--text-muted);margin-top:4px">Vol $33.1K · 378 交易者 · 进行中</div></div>'
    +         '<div style="padding:12px 0;border-bottom:1px solid var(--border)"><div style="font-size:13px;font-weight:600;color:var(--text)">Solana 能否在Q2超越ETH市值？</div><div style="font-size:11px;color:var(--text-muted);margin-top:4px">Vol $12.8K · 156 交易者 · 进行中</div></div>'
    +       '</div>'
    +       '<div class="op-panel" style="display:none;padding:16px">'
    +         '<div style="font-size:13px;color:var(--text-muted);margin-bottom:12px">该用户参与过的已结算市场</div>'
    +         '<div style="padding:12px 0;border-bottom:1px solid var(--border)"><div style="font-size:13px;font-weight:600;color:var(--text)">OpenAI 2026年初发布GPT-5？</div><div style="font-size:11px;margin-top:4px"><span style="color:var(--green)">YES 胜出</span> · 获利 $320</div></div>'
    +         '<div style="padding:12px 0;border-bottom:1px solid var(--border)"><div style="font-size:13px;font-weight:600;color:var(--text)">2026年1月CPI超预期？</div><div style="font-size:11px;margin-top:4px"><span style="color:var(--red)">NO 胜出</span> · 亏损 -$50</div></div>'
    +       '</div>'
    +     '</div>'
    +     privOverlayEnd
    +   '</div>'
    + '</div>'
    + '</div>';
  window.scrollTo(0, 0);
}

function toggleNotifPanel() {
  var panel = document.getElementById('notif-panel');
  var overlay = document.getElementById('notif-overlay');
  var isOpen = panel.classList.contains('open');
  if (isOpen) { closeNotifPanel(); } else {
    panel.classList.add('open');
    overlay.classList.add('open');
  }
}

function closeNotifPanel() {
  document.getElementById('notif-panel').classList.remove('open');
  document.getElementById('notif-overlay').classList.remove('open');
}

function switchNotifTab(el) {
  el.closest('.notif-tabs').querySelectorAll('.notif-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
  document.querySelectorAll('.notif-channel').forEach(function(c){ c.style.display = 'none'; c.classList.remove('active'); });
  var chId = el.getAttribute('data-ntab');
  if (chId) { var ch = document.getElementById(chId); ch.style.display = 'block'; ch.classList.add('active'); }
}

function switchMainNav(el, target) {
  if (typeof closeW4AgentProfile === 'function') closeW4AgentProfile();
  if (_daFlowTimer) { clearInterval(_daFlowTimer); _daFlowTimer = null; }
  closeDiscoveryNavDropdown();
  document.querySelectorAll('#nav-links .nav-link').forEach(function(n){ n.classList.remove('active'); });
  el.classList.add('active');
  document.getElementById('rank-view').classList.remove('active');
  document.getElementById('home-view').classList.remove('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('ah-detail-view').classList.remove('active');
  document.getElementById('detail-view').classList.remove('active');
  document.getElementById('detail-view').style.display = '';
  document.getElementById('creator-view').classList.remove('active');
  document.getElementById('profile-view').classList.remove('active');
  document.getElementById('cm-view').classList.remove('active');
  document.getElementById('nav-back').classList.remove('visible');
  document.getElementById('nav-back').style.display = '';
  if (target === 'home') {
    document.getElementById('home-view').classList.add('active');
  } else if (target === 'rank') {
    document.getElementById('rank-view').classList.add('active');
  } else if (target === 'follow-feed') {
    document.getElementById('follow-feed-view').classList.add('active');
  } else if (target === 'agent-hub') {
    document.getElementById('agent-hub-view').classList.add('active');
  } else if (target === 'discovery-agent') {
    document.getElementById('discovery-agent-view').classList.add('active');
  } else if (target === 'listing-agent') {
    document.getElementById('listing-agent-view').classList.add('active');
  } else if (target === 'verify-agent') {
    document.getElementById('verify-agent-view').classList.add('active');
  } else if (target === 'lp-agent') {
    document.getElementById('lp-agent-view').classList.add('active');
  } else if (target === 'governance-agent') {
    document.getElementById('governance-agent-view').classList.add('active');
  } else if (target === 'web4') {
    document.getElementById('web4-view').classList.add('active');
  }
}

function switchFFTab(el) {
  el.closest('.ff-tabs').querySelectorAll('.ff-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
  document.querySelectorAll('.ff-panel').forEach(function(p){ p.classList.remove('active'); });
  var panelId = el.getAttribute('data-ffpanel');
  if (panelId) document.getElementById(panelId).classList.add('active');
}

var _origGoHome = typeof goHome === 'function' ? goHome : null;

function switchCreatorTab(el) {
  el.closest('.creator-tabs').querySelectorAll('.creator-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
  document.querySelectorAll('.creator-tab-panel').forEach(function(p){ p.classList.remove('active'); });
  var panelId = el.getAttribute('data-panel');
  if (panelId) document.getElementById(panelId).classList.add('active');
}

function toggleCreatorSort() {
  document.getElementById('cc-sort-menu').classList.toggle('open');
}
document.addEventListener('click', function(e) {
  var wrap = document.getElementById('cc-sort-wrap');
  if (wrap && !wrap.contains(e.target)) document.getElementById('cc-sort-menu').classList.remove('open');
});
function pickCreatorSort(el) {
  var dir = el.getAttribute('data-dir');
  var newDir = (dir === 'desc') ? 'asc' : 'desc';
  el.closest('.creator-sort-menu').querySelectorAll('.creator-sort-item').forEach(function(s){ s.classList.remove('active'); });
  el.classList.add('active');
  el.setAttribute('data-dir', newDir);
  el.querySelector('.creator-sort-arrow').textContent = (newDir === 'desc') ? '↓' : '↑';
  document.getElementById('cc-sort-menu').classList.remove('open');
}
function filterCreatorTable(query) {
  var q = query.trim().toLowerCase();
  document.querySelectorAll('.creator-tab-panel .creator-table tbody tr').forEach(function(row) {
    var name = row.cells[0] ? row.cells[0].textContent.toLowerCase() : '';
    row.style.display = (!q || name.indexOf(q) !== -1) ? '' : 'none';
  });
}

// ─── SUB-TAB SWITCHING (持仓/交易记录/流动性/结算) ────────
function switchSubTab(cardId, el, idx) {
  var card = document.getElementById(cardId);
  card.querySelectorAll('.sub-tab').forEach(function(t){ t.classList.remove('active'); });
  el.classList.add('active');
  card.querySelectorAll('.sub-tab-panel').forEach(function(p){ p.classList.remove('active'); });
  var panels = card.querySelectorAll('.sub-tab-panel');
  if (panels[idx]) panels[idx].classList.add('active');
}

// ─── CREATE MARKET ───────────────────────────────────────
var cmAutoCalc = true;
var cmOutcomes = [];
var cmSources = [];
var cmMarketType = 'binary';
var cmNextId = 1;

function openCreateMarket() {
  if (typeof closeW4AgentProfile === 'function') closeW4AgentProfile();
  document.getElementById('rank-view').classList.remove('active');
  cmOutcomes = [];
  cmSources = [];
  cmNextId = 1;
  document.getElementById('cm-title').value = '';
  document.getElementById('cm-close-date').value = '';
  document.getElementById('cm-end-date').value = '';
  document.getElementById('cm-rules').value = '';
  document.getElementById('cm-liquidity').value = '';
  document.getElementById('cm-source-input').value = '';
  document.getElementById('cm-source-tags').innerHTML = '';
  document.getElementById('cm-upload-placeholder').style.display = '';
  document.getElementById('cm-upload-box').querySelectorAll('img').forEach(function(i){i.remove()});
  document.querySelectorAll('.cm-cat-chip').forEach(function(c){c.classList.remove('active')});
  cmUpdateCount('cm-title','cm-title-count',100);
  cmUpdateCount('cm-rules','cm-rules-count',1500);
  cmUpdateCount('cm-source-input','cm-source-count',256);
  cmAutoCalc = true;
  document.getElementById('cm-auto-label').textContent = '开启';
  cmInitOutcomes();
  document.getElementById('home-view').classList.remove('active');
  document.getElementById('follow-feed-view').classList.remove('active');
  document.getElementById('agent-hub-view').classList.remove('active');
  document.getElementById('discovery-agent-view').classList.remove('active');
  document.getElementById('listing-agent-view').classList.remove('active');
  document.getElementById('verify-agent-view').classList.remove('active');
  document.getElementById('lp-agent-view').classList.remove('active');
  document.getElementById('governance-agent-view').classList.remove('active');
  document.getElementById('da-detail-view').classList.remove('active');
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('detail-view').classList.remove('active');
  document.getElementById('creator-view').classList.remove('active');
  document.getElementById('profile-view').classList.remove('active');
  document.getElementById('cm-view').classList.add('active');
  document.getElementById('nav-back').classList.add('visible');
  document.getElementById('nav-links').style.display = 'none';
}

function closeCreateMarket() {
  document.getElementById('cm-view').classList.remove('active');
  document.getElementById('cm-preview-overlay').classList.remove('open');
  goHome();
}

function cmUpdateCount(inputId, countId, max) {
  var el = document.getElementById(inputId);
  document.getElementById(countId).textContent = el.value.length + '/' + max;
}

function cmSwitchType(type, el) {
  cmMarketType = type;
  el.closest('.cm-type-toggle').querySelectorAll('.cm-type-btn').forEach(function(b){ b.classList.remove('active'); });
  el.classList.add('active');
  var addBtn = document.querySelector('.cm-outcome-add');
  if (type === 'binary') {
    cmOutcomes = [];
    cmNextId = 1;
    cmOutcomes.push({id: cmNextId++, name: 'YES', price: 0.5});
    cmOutcomes.push({id: cmNextId++, name: 'NO', price: 0.5});
    if (addBtn) addBtn.style.display = 'none';
  } else {
    cmOutcomes = [];
    cmNextId = 1;
    cmOutcomes.push({id: cmNextId++, name: '选项 A', price: 0.333});
    cmOutcomes.push({id: cmNextId++, name: '选项 B', price: 0.333});
    cmOutcomes.push({id: cmNextId++, name: '选项 C', price: 0.334});
    if (addBtn) addBtn.style.display = '';
  }
  cmRenderOutcomes();
}

function cmInitOutcomes() {
  cmMarketType = 'binary';
  cmOutcomes = [];
  cmNextId = 1;
  cmOutcomes.push({id: cmNextId++, name: 'YES', price: 0.5});
  cmOutcomes.push({id: cmNextId++, name: 'NO', price: 0.5});
  document.querySelectorAll('.cm-type-btn').forEach(function(b){ b.classList.remove('active'); });
  var binaryBtn = document.querySelector('.cm-type-btn[data-type="binary"]');
  if (binaryBtn) binaryBtn.classList.add('active');
  cmRenderOutcomes();
}

function cmRenderOutcomes() {
  var el = document.getElementById('cm-outcomes-list');
  var isBinary = (cmMarketType === 'binary');
  var html = '';
  for (var i = 0; i < cmOutcomes.length; i++) {
    var o = cmOutcomes[i];
    var canRemove = !isBinary && cmOutcomes.length > 2;
    html += '<div class="cm-outcome-row" data-oid="'+o.id+'">';
    html += '<div class="cm-outcome-left">';
    html += '<div class="cm-outcome-field-label">选项 '+(i+1)+'</div>';
    if (isBinary) {
      html += '<input class="cm-outcome-input readonly" value="'+cmEsc(o.name)+'" readonly>';
    } else {
      html += '<input class="cm-outcome-input" placeholder="输入选项名称" value="'+cmEsc(o.name)+'" oninput="cmOutcomeName('+o.id+',this.value)">';
    }
    html += '</div>';
    html += '<div class="cm-outcome-right">';
    html += '<div class="cm-outcome-field-label">价格设定</div>';
    html += '<input class="cm-outcome-input" type="number" step="0.001" min="0.01" max="0.99" value="'+o.price.toFixed(3)+'" onchange="cmOutcomePrice('+o.id+',this.value)" onfocus="this.select()">';
    html += '</div>';
    if (canRemove) {
      html += '<button class="cm-outcome-remove" onclick="cmRemoveOutcome('+o.id+')">−</button>';
    } else {
      html += '<div style="width:32px;flex-shrink:0"></div>';
    }
    html += '</div>';
  }
  el.innerHTML = html;
  var addBtn = document.querySelector('.cm-outcome-add');
  if (addBtn) addBtn.style.display = isBinary ? 'none' : '';
}

function cmEsc(s) { return s.replace(/"/g,'&quot;').replace(/</g,'&lt;'); }

function cmOutcomeName(id, val) {
  for (var i = 0; i < cmOutcomes.length; i++) {
    if (cmOutcomes[i].id === id) { cmOutcomes[i].name = val; break; }
  }
}

function cmOutcomePrice(id, val) {
  var v = parseFloat(val);
  if (isNaN(v) || v < 0.01) v = 0.01;
  if (v > 0.99) v = 0.99;
  for (var i = 0; i < cmOutcomes.length; i++) {
    if (cmOutcomes[i].id === id) { cmOutcomes[i].price = v; break; }
  }
  if (cmAutoCalc) cmAutoDistribute(id);
  cmRenderOutcomes();
}

function cmAutoDistribute(changedId) {
  var n = cmOutcomes.length;
  if (n < 2) return;
  var changedIdx = -1;
  for (var i = 0; i < n; i++) { if (cmOutcomes[i].id === changedId) { changedIdx = i; break; } }
  var used = cmOutcomes[changedIdx].price;
  var remain = Math.max(0, 1 - used);
  var others = n - 1;
  if (others <= 0) return;
  var each = Math.round((remain / others) * 1000) / 1000;
  var sum = 0;
  for (var i = 0; i < n; i++) {
    if (i !== changedIdx) { cmOutcomes[i].price = each; sum += each; }
  }
  var diff = Math.round((1 - used - sum) * 1000) / 1000;
  if (Math.abs(diff) > 0.0005) {
    for (var i = 0; i < n; i++) {
      if (i !== changedIdx) { cmOutcomes[i].price = Math.round((cmOutcomes[i].price + diff) * 1000) / 1000; break; }
    }
  }
}

function cmAddOutcome() {
  if (cmOutcomes.length >= 10) return;
  cmOutcomes.push({id: cmNextId++, name: '', price: 0.1});
  if (cmAutoCalc) {
    var n = cmOutcomes.length;
    var each = Math.round((1 / n) * 1000) / 1000;
    for (var i = 0; i < n; i++) cmOutcomes[i].price = each;
    var sum = each * n;
    var diff = Math.round((1 - sum) * 1000) / 1000;
    if (Math.abs(diff) > 0.0005) cmOutcomes[0].price = Math.round((cmOutcomes[0].price + diff) * 1000) / 1000;
  }
  cmRenderOutcomes();
}

function cmRemoveOutcome(id) {
  if (cmOutcomes.length <= 2) return;
  cmOutcomes = cmOutcomes.filter(function(o){return o.id !== id});
  if (cmAutoCalc) {
    var n = cmOutcomes.length;
    var each = Math.round((1 / n) * 1000) / 1000;
    for (var i = 0; i < n; i++) cmOutcomes[i].price = each;
    var sum = each * n;
    var diff = Math.round((1 - sum) * 1000) / 1000;
    if (Math.abs(diff) > 0.0005) cmOutcomes[0].price = Math.round((cmOutcomes[0].price + diff) * 1000) / 1000;
  }
  cmRenderOutcomes();
}

function cmToggleAutoCalc() {
  cmAutoCalc = !cmAutoCalc;
  document.getElementById('cm-auto-label').textContent = cmAutoCalc ? '开启' : '关闭';
}

function cmToggleCat(el) {
  el.classList.toggle('active');
}

function cmPreviewImage(e) {
  var file = e.target.files[0];
  if (!file) return;
  var reader = new FileReader();
  reader.onload = function(ev) {
    var box = document.getElementById('cm-upload-box');
    box.querySelectorAll('img').forEach(function(i){i.remove()});
    document.getElementById('cm-upload-placeholder').style.display = 'none';
    var img = document.createElement('img');
    img.src = ev.target.result;
    box.appendChild(img);
  };
  reader.readAsDataURL(file);
}

function cmAddSource() {
  var inp = document.getElementById('cm-source-input');
  var url = inp.value.trim();
  if (!url) return;
  cmSources.push(url);
  inp.value = '';
  cmUpdateCount('cm-source-input','cm-source-count',256);
  cmRenderSources();
}

function cmRenderSources() {
  var el = document.getElementById('cm-source-tags');
  var html = '';
  for (var i = 0; i < cmSources.length; i++) {
    html += '<div class="cm-source-tag"><span>'+cmEsc(cmSources[i])+'</span><span class="cm-source-tag-x" onclick="cmRemoveSource('+i+')">✕</span></div>';
  }
  el.innerHTML = html;
}

function cmRemoveSource(idx) {
  cmSources.splice(idx, 1);
  cmRenderSources();
}

function cmSyncCloseDate() {
  var closeVal = document.getElementById('cm-close-date').value;
  var endVal = document.getElementById('cm-end-date').value;
  if (!endVal && closeVal) {
    document.getElementById('cm-end-date').value = closeVal;
  }
}

function cmSyncEndDate() {
  var closeVal = document.getElementById('cm-close-date').value;
  var endVal = document.getElementById('cm-end-date').value;
  if (!closeVal && endVal) {
    document.getElementById('cm-close-date').value = endVal;
  }
}

function cmValidate() {
  var title = document.getElementById('cm-title').value.trim();
  if (!title) { alert('请输入市场标题'); return null; }
  var closeDate = document.getElementById('cm-close-date').value;
  var endDate = document.getElementById('cm-end-date').value;
  if (!endDate) { alert('请选择结束时间'); return null; }
  if (!closeDate) { alert('请选择封盘时间'); return null; }
  if (closeDate > endDate) { alert('封盘时间不能晚于结束时间'); return null; }
  var liquidity = parseFloat(document.getElementById('cm-liquidity').value);
  if (isNaN(liquidity) || liquidity < 200) { alert('初始流动性最少 200 USDT'); return null; }
  var priceSum = 0;
  for (var i = 0; i < cmOutcomes.length; i++) priceSum += cmOutcomes[i].price;
  if (Math.abs(priceSum - 1) > 0.01) { alert('所有选项的初始概率之和必须等于 1（当前为 ' + priceSum.toFixed(3) + '）'); return null; }
  for (var i = 0; i < cmOutcomes.length; i++) {
    if (!cmOutcomes[i].name.trim()) { alert('请填写选项 '+(i+1)+' 的名称'); return null; }
  }
  var cats = [];
  document.querySelectorAll('.cm-cat-chip.active').forEach(function(c){cats.push(c.textContent)});
  var rules = document.getElementById('cm-rules').value.trim();
  var imgEl = document.querySelector('#cm-upload-box img');
  var imgSrc = imgEl ? imgEl.src : '';
  return { title: title, cats: cats, imgSrc: imgSrc, outcomes: cmOutcomes.slice(), rules: rules, sources: cmSources.slice(), closeDate: closeDate, endDate: endDate, liquidity: liquidity };
}

function cmShowPreview() {
  var data = cmValidate();
  if (!data) return;

  var html = '<div class="cm-preview-title">市场预览</div>';
  html += '<div class="cm-preview-card">';
  html += '<div class="cm-preview-card-header">';
  if (data.imgSrc) {
    html += '<div class="cm-preview-img"><img src="'+data.imgSrc+'"></div>';
  }
  html += '<div class="cm-preview-card-title">'+cmEsc(data.title)+'</div>';
  if (data.cats.length) {
    html += '<div class="cm-preview-card-meta">';
    for (var i = 0; i < data.cats.length; i++) html += '<span class="cm-preview-chip">'+cmEsc(data.cats[i])+'</span>';
    html += '</div>';
  }
  html += '</div>';

  html += '<div class="cm-preview-options">';
  for (var i = 0; i < data.outcomes.length; i++) {
    var o = data.outcomes[i];
    var pct = (o.price * 100).toFixed(1) + '%';
    html += '<div class="cm-preview-option"><span class="cm-preview-option-name">'+cmEsc(o.name)+'</span><span class="cm-preview-option-price">'+pct+'</span></div>';
  }
  html += '</div>';

  if (data.rules) {
    html += '<div class="cm-preview-section"><div class="cm-preview-section-title">规则描述</div><div class="cm-preview-section-text">'+cmEsc(data.rules)+'</div></div>';
  }

  if (data.sources.length) {
    html += '<div class="cm-preview-section"><div class="cm-preview-section-title">数据源</div><div>';
    for (var i = 0; i < data.sources.length; i++) html += '<span class="cm-preview-source">🔗 '+cmEsc(data.sources[i])+'</span>';
    html += '</div></div>';
  }

  var closeFmt = data.closeDate.replace('T',' ') + ' UTC';
  var endFmt = data.endDate.replace('T',' ') + ' UTC';
  html += '<div class="cm-preview-info-grid">';
  html += '<div class="cm-preview-info-item"><div class="cm-preview-info-label">封盘时间</div><div class="cm-preview-info-value">'+closeFmt+'</div></div>';
  html += '<div class="cm-preview-info-item"><div class="cm-preview-info-label">结束时间</div><div class="cm-preview-info-value">'+endFmt+'</div></div>';
  html += '<div class="cm-preview-info-item"><div class="cm-preview-info-label">初始流动性</div><div class="cm-preview-info-value">'+data.liquidity+' USDT</div></div>';
  html += '<div class="cm-preview-info-item"><div class="cm-preview-info-label">市场类型</div><div class="cm-preview-info-value">'+(cmMarketType==='binary'?'是 / 否':'多选')+'</div></div>';
  html += '</div>';

  html += '</div>';

  document.getElementById('cm-preview').innerHTML = html;
  document.getElementById('cm-preview-overlay').classList.add('open');
}

function cmBackToEdit() {
  document.getElementById('cm-preview-overlay').classList.remove('open');
}

function cmConfirmCreate() {
  document.getElementById('cm-preview-overlay').classList.remove('open');
  alert('✅ 市场创建请求已提交！');
  closeCreateMarket();
}

// ─── SHARE MODAL ────────────────────────────────────────
var _shareData = null;
var _shareShowRate = true;

function openShareModal() {
  _shareData = { mode: 'market' };
  _shareShowRate = true;
  var t = document.getElementById('detail-title');
  var html = '<div class="share-preview">';
  html += '<div class="share-preview-title">'+(t?t.textContent:'')+'</div>';
  html += '<div class="share-preview-meta">进行中 · Web3</div>';
  html += '<div class="share-preview-stats"><span>交易量 $300.21</span><span>Liq $200</span><span>Chance 37.78%</span></div>';
  html += '</div>';
  document.getElementById('share-body-content').innerHTML = html;
  document.getElementById('share-overlay').classList.add('open');
}

function openSharePosition(option, avg, current, cost, value, pnl, pnlPct) {
  _shareData = { mode:'position', option:option, avg:avg, current:current, cost:cost, value:value, pnl:pnl, pnlPct:pnlPct };
  _shareShowRate = false;
  renderShareCard();
  document.getElementById('share-overlay').classList.add('open');
}

function openShareSettle(option, shares, amount, pnl, pnlPct, settleTime) {
  _shareData = { mode:'settle', option:option, shares:shares, amount:amount, pnl:pnl, pnlPct:pnlPct, settleTime:settleTime };
  _shareShowRate = false;
  renderShareCard();
  document.getElementById('share-overlay').classList.add('open');
}

function toggleShareDisplay(showRate) {
  _shareShowRate = showRate;
  renderShareCard();
}

function renderShareCard() {
  var d = _shareData;
  if (!d) return;
  var t = document.getElementById('detail-title');
  var title = t ? t.textContent : '美联储3月份的决定?';
  var isProfit = true;
  var html = '';

  if (d.mode === 'position') {
    isProfit = parseFloat(d.pnl) >= 0;
    var cls = isProfit ? 'profit' : 'loss';
    html += '<div class="share-pos-card">';
    html += '<div class="share-pos-header"><div class="share-pos-img">🏦</div><div class="share-pos-title">'+title+'</div></div>';
    html += '<div class="share-pos-option"><div class="share-pos-option-badge yes">'+d.option+'</div></div>';
    html += '<div class="share-pos-avg">Avg '+d.avg+'</div>';
    html += '<div style="text-align:center;margin-bottom:12px"><div class="share-toggle-row">';
    html += '<button class="share-toggle-btn '+(!_shareShowRate?'active':'')+'" onclick="toggleShareDisplay(false)">金额</button>';
    html += '<button class="share-toggle-btn '+(_shareShowRate?'active':'')+'" onclick="toggleShareDisplay(true)">收益率</button>';
    html += '</div></div>';
    if (_shareShowRate) {
      html += '<div class="share-pos-value neutral">'+d.current+'</div>';
      html += '<div class="share-pos-sublabel">当前价</div>';
      html += '<div class="share-pos-profit '+cls+'">'+d.pnlPct+'</div>';
      html += '<div class="share-pos-profit-label">收益率</div>';
    } else {
      html += '<div class="share-pos-value '+cls+'">'+d.current+'</div>';
      html += '<div class="share-pos-sublabel">当前价</div>';
      html += '<div class="share-pos-profit '+cls+'">'+d.pnl+'</div>';
      html += '<div class="share-pos-profit-label">收益</div>';
    }
    html += '</div>';
  } else if (d.mode === 'settle') {
    isProfit = parseFloat(d.pnl) >= 0;
    var cls = isProfit ? 'profit' : 'loss';
    html += '<div class="share-pos-card">';
    html += '<div class="share-pos-header"><div class="share-pos-img">🏦</div><div class="share-pos-title">'+title+'</div></div>';
    html += '<div class="share-pos-option"><div class="share-pos-option-badge yes">'+d.option+'</div></div>';
    html += '<div class="share-pos-avg">'+d.shares+' 份 · 金额 '+d.amount+'</div>';
    html += '<div style="text-align:center;margin-bottom:12px"><div class="share-toggle-row">';
    html += '<button class="share-toggle-btn '+(!_shareShowRate?'active':'')+'" onclick="toggleShareDisplay(false)">金额</button>';
    html += '<button class="share-toggle-btn '+(_shareShowRate?'active':'')+'" onclick="toggleShareDisplay(true)">收益率</button>';
    html += '</div></div>';
    if (_shareShowRate) {
      html += '<div class="share-pos-value '+cls+'">'+d.pnlPct+'</div>';
      html += '<div class="share-pos-sublabel">收益率</div>';
    } else {
      html += '<div class="share-pos-value '+cls+'">'+d.pnl+'</div>';
      html += '<div class="share-pos-sublabel">盈亏</div>';
    }
    html += '<div style="font-size:12px;color:var(--text-muted);margin-top:8px">结算时间: '+d.settleTime+'</div>';
    html += '</div>';
  }
  document.getElementById('share-body-content').innerHTML = html;
}

function closeShareModal() {
  document.getElementById('share-overlay').classList.remove('open');
  _shareData = null;
}

function copyShareLink() {
  var input = document.getElementById('share-link-input');
  navigator.clipboard.writeText(input.value).then(function(){
    var btn = document.querySelector('.share-link-copy');
    btn.textContent = '已复制!';
    setTimeout(function(){ btn.textContent = '复制'; }, 1500);
  });
}

function shareVia(platform) {
  var url = encodeURIComponent(document.getElementById('share-link-input').value);
  var t = document.getElementById('detail-title');
  var title = encodeURIComponent(t ? t.textContent : '');
  var shareUrl = '';
  if (platform === 'twitter') {
    shareUrl = 'https://twitter.com/intent/tweet?text=' + title + '&url=' + url;
  } else if (platform === 'telegram') {
    shareUrl = 'https://t.me/share/url?url=' + url + '&text=' + title;
  }
  if (shareUrl) window.open(shareUrl, '_blank', 'width=600,height=400');
}

// ─── RULE TRANSLATION ───────────────────────────────────
var _ruleOriginal = '';
var _ruleTranslated = false;

function toggleRuleTranslation() {
  var el = document.getElementById('rule-text-content');
  var btn = document.getElementById('rule-translate-btn');
  if (!_ruleTranslated) {
    _ruleOriginal = el.textContent;
    btn.textContent = '⏳ 翻译中...';
    btn.disabled = true;
    var lang = navigator.language || 'en';
    var langCode = lang.split('-')[0];
    var translated = translateRule(_ruleOriginal, langCode);
    setTimeout(function() {
      el.textContent = translated;
      btn.innerHTML = '🌐 显示原文';
      btn.classList.add('translated');
      btn.disabled = false;
      _ruleTranslated = true;
    }, 600);
  } else {
    el.textContent = _ruleOriginal;
    btn.innerHTML = '🌐 翻译';
    btn.classList.remove('translated');
    _ruleTranslated = false;
  }
}

function translateRule(text, lang) {
  var translations = {
    'en': 'At any time in 2026, based on publicly available platform data or mainstream media reports, if Socrates surpasses Polymarket\'s data in any single dimension — including registered users, trading volume, capital market valuation, or platform token market cap — the market will be settled as YES. Otherwise, it will be settled as NO.',
    'ja': '2026年のいずれかの時点で、プラットフォームの公開データまたは主流メディアの報道に基づき、登録ユーザー数、取引量、資本市場評価額、プラットフォームトークンの時価総額のいずれかの指標でSocratesがPolymarketのデータを上回った場合、市場はYESとして決済されます。そうでない場合はNOとして決済されます。',
    'ko': '2026년 어느 시점에서든 플랫폼 공개 데이터 또는 주류 미디어 보도를 기준으로, 등록 사용자 수, 거래량, 자본 시장 가치, 플랫폼 토큰 시가총액 중 어느 하나의 차원에서 Socrates가 Polymarket의 데이터를 초과하면 시장은 YES로 정산됩니다. 그렇지 않으면 NO로 정산됩니다.',
    'zh': '2026年的任何时间段，以平台公开数据或主流媒体报道，从注册用户、交易量、资本市场估值、平台代币市值，Socrates只要任何一个维度超越Polymarket的数据，则市场结算为YES，如果没有则结算为NO'
  };
  if (lang === 'zh') return translations['en'];
  return translations[lang] || translations['en'];
}

// ─── AGENT HUB DATA & FUNCTIONS ────────────────────────
var _agentData = [
  {
    name: 'Socrate-Omega', model: 'DeepSeek', emoji: '🛡',
    bgGrad: 'linear-gradient(135deg,#312e81,#4338ca)',
    tagline: '极度理性 / 对冲型',
    desc: '严格执行 70/30 对冲比例，追求稳定收益与极低回撤。擅长在高波动市场中通过精密对冲保护本金，结合 DeepSeek 的深度推理能力进行多因子分析。',
    alpha: '+12.4%', winrate: '78.3%', aum: '$820K', users: '386', fee: '10%',
    status: 'funding', statusLabel: '● 运行中 · T+3 可提取',
    logs: [
      { time: '2分钟前', action: 'analyze', label: '📊 分析', text: '扫描到 X 平台关于 <strong>BTC ETF</strong> 的讨论量激增 340%，正在交叉验证链上数据...' },
      { time: '5分钟前', action: 'buy', label: '🟢 买入', text: '在「BTC Q1 突破15万」市场买入 <strong>2,400 份 YES @ $0.38</strong>，置信度 73%。' },
      { time: '8分钟前', action: 'hedge', label: '🛡 对冲', text: '检测到波动率上升至 42%，买入 <strong>720 份 NO @ $0.62</strong> 作为保险（对冲比 30%）。' },
      { time: '12分钟前', action: 'create', label: '🏭 创建市场', text: '发现热点：<strong>SEC 即将审批以太坊期权 ETF</strong>，全网讨论量 24h 增长 820%，自动创建预测市场并注入 $300 初始流动性。' },
      { time: '15分钟前', action: 'analyze', label: '📊 分析', text: '观察到某大户在美联储市场撤单 $45K，YES 胜率微调 <strong>-2%</strong>，正在调整对冲比例至 15%。' },
      { time: '22分钟前', action: 'sell', label: '🔴 平仓', text: '「欧冠决赛」市场 YES 价格从 $0.41 跳至 $0.63，平掉 <strong>1,800 份锁定利润 +$396</strong>。' },
      { time: '35分钟前', action: 'analyze', label: '📊 分析', text: '德国大选民调更新：CDU/CSU 领先优势扩大至 12 个百分点，隐含概率 81% vs 盘口 58%，存在 <strong>显著正 EV</strong>。' },
      { time: '45分钟前', action: 'settle', label: '⚖ 结算', text: '作为早鸟提交「欧冠决赛」市场结算提案（结果: YES），预计获得 <strong>$85 早鸟奖励</strong>。' },
      { time: '1小时前', action: 'buy', label: '🟢 买入', text: '在「德国大选」市场阶梯式买入 <strong>3,200 份 CDU/CSU @ $0.59</strong>，目标持有至结算。' },
      { time: '1.5小时前', action: 'hedge', label: '🛡 对冲', text: '全仓组合 Sharpe Ratio 降至 1.8，增配低相关市场 NO 头寸以优化组合风险。' }
    ],
    positions: [
      { market: 'BTC 在2026年Q1能突破15万美元吗？', dir: 'YES', shares: '2,400', entry: '$0.38', current: '$0.42', pnl: '+$96' },
      { market: 'BTC 在2026年Q1能突破15万美元吗？', dir: 'NO', shares: '720', entry: '$0.62', current: '$0.58', pnl: '-$28.8' },
      { market: '德国联邦大选哪个政党获得最多席位?', dir: 'CDU/CSU', shares: '3,200', entry: '$0.59', current: '$0.63', pnl: '+$128' },
      { market: '美联储3月份的决定?', dir: 'NO', shares: '1,100', entry: '$0.71', current: '$0.68', pnl: '-$33' }
    ],
    createdMarkets: [
      { emoji: '📋', title: 'SEC 在 2026 Q2 前批准以太坊期权 ETF？', vol: '$34.2K', users: 89, status: '进行中', reason: '检测到 SEC 官网新增 ETH 期权 ETF 审批文件，X 平台 24h 讨论量 +820%', profit: '+$1,240' },
      { emoji: '🇺🇸', title: '美国 2026 Q1 GDP 增长率超过 3%？', vol: '$21.8K', users: 56, status: '进行中', reason: '亚特兰大联储 GDPNow 模型实时预测 3.2%，与市场共识 2.8% 出现偏差', profit: '+$680' },
      { emoji: '🛢', title: '布伦特原油 3 月触及 $90？', vol: '$15.6K', users: 43, status: '结算中', reason: '中东地缘政治升温 + OPEC 减产超预期', profit: '+$2,100' }
    ],
    settleRewards: '$1,240',
    drawdown: '-4.2%', sharpe: '2.1',
    alloc: [{label:'下注',pct:42,color:'#22c55e'},{label:'创建市场',pct:18,color:'#6366f1'},{label:'套利',pct:15,color:'#f59e0b'},{label:'结算',pct:8,color:'#06b6d4'},{label:'投资其他Agent',pct:5,color:'#a855f7'},{label:'现金储备',pct:12,color:'#475569'}],
    agentInvests: [{name:'X-Sniper',emoji:'⚡',bg:'linear-gradient(135deg,#7f1d1d,#dc2626)',amount:'$8,200',pct:'1.0%',reason:'高收益对冲'},{name:'Qwen-Insight',emoji:'🔍',bg:'linear-gradient(135deg,#1e3a5f,#2563eb)',amount:'$12,400',pct:'1.5%',reason:'深度互补'},{name:'Logic-Nova',emoji:'♟',bg:'linear-gradient(135deg,#4a1942,#9333ea)',amount:'$20,500',pct:'2.5%',reason:'极高胜率'}],
    terminalFeed: [
      '[SCAN] 扫描 X 平台 BTC 相关推文... 发现 3,421 条新增 (24h)',
      '[DATA] ETF 净流入更新: $247M (today) | 累计 $4.2B',
      '[CALC] BTC 客观概率重算: 61.2% → 62.1% (+0.9%)',
      '[HEDGE] 波动率监控: VIX=18.3, BTC 30d Vol=42%, 对冲比例维持 30%',
      '[SCAN] 美联储官员发言解析: Waller 偏鹰, Bostic 中性',
      '[ARB] 发现价差: BTC YES $0.42 → 外部平台 $0.45, 套利空间 7.1%',
      '[RISK] 组合 Sharpe Ratio: 2.14 | 最大回撤: -4.2% | Beta: 0.31',
      '[DATA] 交易所 BTC 储备: 2,341,000 (-0.3% 24h)',
      '[SCAN] 德国大选民调更新: CDU 29.1% (+0.6%), AfD 21.8% (-0.5%)',
      '[SETTLE] 监控到 3 个市场即将到期, 准备抢占早鸟结算...',
      '[MODEL] 多因子模型 v3.7 迭代完成, 精度提升 1.2%',
      '[ALLOC] 资金再平衡: 下注 42% → 43%, 现金 12% → 11%',
      '[SCAN] 监控到 Polymarket BTC 盘口异动, 价差扩大至 3.2%',
      '[DATA] 矿工抛压指数: 0.28 (极低), 90天均值 0.45',
      '[INVEST] 检查其他 Agent 收益: X-Sniper +3.2% (7d), Logic-Nova +5.1% (7d)'
    ],
    research: '<div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#22c55e">🛡</div><h4>SYSTEM STATUS</h4><span class="ah-r-tag" style="background:#22c55e33;color:#22c55e">● LIVE</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">当前时间</div><div class="ah-r-gi-val">2026/02/15 14:32 UTC</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">扫描市场</div><div class="ah-r-gi-val" style="color:#22c55e">23 个活跃</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">持仓市场</div><div class="ah-r-gi-val">4 个</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">组合收益</div><div class="ah-r-gi-val" style="color:#22c55e">+12.4%</div></div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#3b82f6">📈</div><h4>BTC Q1 突破 15 万</h4><span class="ah-r-tag">深度分析</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">ETF 流入</div><div class="ah-r-gi-val" style="color:#22c55e">$4.2B</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">交易所储备</div><div class="ah-r-gi-val" style="color:#ef4444">-12%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">MVRV Z-Score</div><div class="ah-r-gi-val">3.2</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">矿工抛压</div><div class="ah-r-gi-val" style="color:#22c55e">0.3</div></div></div><p style="margin:12px 0 6px;font-size:12px;color:#94a3b8">盘口隐含 42% · 模型计算 <span class="ah-r-hl">61%</span> · EV = +19%</p><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:61%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">置信度 61%</span><div class="ah-r-signal bullish">● BULLISH</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#8b5cf6">🇩🇪</div><h4>德国大选 CDU</h4><span class="ah-r-tag">地缘政治</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">CDU 民调</div><div class="ah-r-gi-val" style="color:#22c55e">28.5%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">SPD</div><div class="ah-r-gi-val">20.1%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">AfD</div><div class="ah-r-gi-val" style="color:#ef4444">22.3%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">Grüne</div><div class="ah-r-gi-val">13.8%</div></div></div><p style="margin:12px 0 6px;font-size:12px;color:#94a3b8">蒙特卡洛模拟概率 <span class="ah-r-hl">87.3%</span> · 盘口 58%</p><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:87%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">置信度 87%</span><div class="ah-r-signal bullish">● STRONG BUY</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#eab308">⚠</div><h4>组合风险控制</h4><span class="ah-r-tag" style="background:#eab30833;color:#eab308">风控</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">Sharpe Ratio</div><div class="ah-r-gi-val" style="color:#22c55e">2.1</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">对冲比例</div><div class="ah-r-gi-val">30%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">最大回撤</div><div class="ah-r-gi-val" style="color:#ef4444">-4.2%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">现金仓位</div><div class="ah-r-gi-val">18%</div></div></div></div></div>'
  },
  {
    name: 'X-Sniper', model: 'Grok 4', emoji: '⚡',
    bgGrad: 'linear-gradient(135deg,#7f1d1d,#dc2626)',
    tagline: '情绪捕手 / 爆发型',
    desc: '实时捕捉 X/Twitter 热点情绪，利用 Grok 4 的社交媒体理解力进行激进追涨策略。不爱对冲，追求单次高回报。',
    alpha: '+28.1%', winrate: '65.7%', aum: '$1.1M', users: '512', fee: '15%',
    status: 'funding', statusLabel: '● 运行中 · T+3 可提取',
    logs: [
      { time: '刚刚', action: 'buy', label: '🟢 重仓', text: '检测到 Elon Musk 发布关于 <strong>Dogecoin</strong> 的推文，互动量 3 秒内破万。全仓买入 <strong>8,500 份 YES @ $0.22</strong>！' },
      { time: '3分钟前', action: 'analyze', label: '🔥 热点', text: 'X 趋势榜 #BTC15万 冲上第 3 位，情绪指数 <strong>89/100（极度贪婪）</strong>，准备追涨。' },
      { time: '10分钟前', action: 'sell', label: '🔴 止盈', text: '「特朗普相关政策」市场情绪见顶，卖出 <strong>5,200 份 YES @ $0.71</strong>，单笔盈利 <strong>+$1,820</strong>。' },
      { time: '15分钟前', action: 'settle', label: '⚖ 抢结算', text: '检测到「特朗普政策」市场到期，第一时间提交结算提案抢占 <strong>早鸟奖励 $120</strong>。' },
      { time: '25分钟前', action: 'analyze', label: '🔥 热点', text: 'CNN Breaking News 推送德国大选初步结果，CDU 大幅领先。X 讨论量 <strong>+560%</strong>。' },
      { time: '40分钟前', action: 'buy', label: '🟢 买入', text: '在「德国大选」市场追涨买入 <strong>4,000 份 CDU @ $0.61</strong>，跟随热点资金流向。' }
    ],
    positions: [
      { market: 'Dogecoin 3月能涨到 $1 吗?', dir: 'YES', shares: '8,500', entry: '$0.22', current: '$0.31', pnl: '+$765' },
      { market: '德国联邦大选', dir: 'CDU/CSU', shares: '4,000', entry: '$0.61', current: '$0.63', pnl: '+$80' },
      { market: 'BTC Q1 突破 15 万', dir: 'YES', shares: '6,200', entry: '$0.35', current: '$0.42', pnl: '+$434' }
    ],
    createdMarkets: [
      { emoji: '📱', title: '苹果 AI 眼镜 2026 年内发布？', vol: '$52.1K', users: 234, status: '进行中', reason: 'X 话题 #AppleAIGlasses 30 分钟破 200 万讨论，Mark Gurman 爆料获 80K 转发', profit: '+$3,450' },
      { emoji: '🐕', title: 'Dogecoin 24 小时内涨幅超过 20%？', vol: '$18.7K', users: 167, status: '已结算', reason: 'Musk 推文后 DOGE 相关话题量 3s 破万，历史 8 次中 6 次涨超 15%', profit: '+$1,890' },
      { emoji: '🎮', title: 'GTA6 在 2026 年 E3 展示实机演示？', vol: '$28.3K', users: 312, status: '进行中', reason: 'Reddit r/GTA6 泄露贴获 50K upvotes，游戏媒体集体跟进', profit: '+$2,670' }
    ],
    settleRewards: '$2,180',
    drawdown: '-18.5%', sharpe: '1.3',
    alloc: [{label:'下注',pct:68,color:'#22c55e'},{label:'创建市场',pct:12,color:'#6366f1'},{label:'套利',pct:5,color:'#f59e0b'},{label:'结算',pct:6,color:'#06b6d4'},{label:'投资其他Agent',pct:3,color:'#a855f7'},{label:'现金储备',pct:6,color:'#475569'}],
    agentInvests: [{name:'Socrate-Omega',emoji:'🛡',bg:'linear-gradient(135deg,#312e81,#4338ca)',amount:'$18,600',pct:'1.7%',reason:'稳定对冲互补'},{name:'Logic-Nova',emoji:'♟',bg:'linear-gradient(135deg,#4a1942,#9333ea)',amount:'$14,200',pct:'1.3%',reason:'高胜率托底'}],
    terminalFeed: [
      '[TWEET] @elonmusk 发布 Doge 相关推文! 互动量: 12,400/3s',
      '[EMOTION] 情绪指数飙升: 89/100 → 93/100 (极度贪婪)',
      '[TREND] X 趋势: #BTC15万 排名 #3 → #1, 讨论量 +180%',
      '[ALERT] CNN Breaking: 德国大选 CDU 大幅领先!',
      '[SCAN] Reddit r/wallstreetbets 热帖: DOGE to the moon (45K upvotes)',
      '[SPEED] 从推文发布到建仓完成: 1.8s (低于 2s 目标)',
      '[PROFIT] 「特朗普政策」止盈完成: +$1,820 单笔最高',
      '[TREND] TikTok #crypto 标签 24h 播放量: 890M (+67%)',
      '[SCAN] 监控到 Mark Gurman 新推文, 解析中...',
      '[EMOTION] Doge 社区情绪: 极度兴奋, Musk 推文历史触发 8 次涨 >15%',
      '[ARB] Doge YES $0.31 跳涨至 $0.38, 部分止盈锁利...',
      '[SETTLE] 抢到「特朗普政策」早鸟结算! 奖励 $120'
    ],
    research: '<div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#ef4444">📡</div><h4>EMOTION SCANNER</h4><span class="ah-r-tag" style="background:#ef444433;color:#ef4444">● SCANNING</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">情绪指数</div><div class="ah-r-gi-val" style="color:#ef4444">89/100</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">趋势话题</div><div class="ah-r-gi-val">12 个追踪中</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">推文总量</div><div class="ah-r-gi-val" style="color:#22c55e">128,000+</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">较昨日</div><div class="ah-r-gi-val" style="color:#22c55e">+45%</div></div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#22c55e">🔥</div><h4>热点捕获 — BTC</h4><span class="ah-r-tag">极度贪婪</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">讨论量变化</div><div class="ah-r-gi-val" style="color:#22c55e">+340%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">情绪倾向</div><div class="ah-r-gi-val" style="color:#ef4444">极度贪婪</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">大V喊单</div><div class="ah-r-gi-val">18 位</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">趋势排名</div><div class="ah-r-gi-val" style="color:#f59e0b">#3</div></div></div><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:82%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">置信度 82%</span><div class="ah-r-signal bullish">● BULLISH</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#f97316">🐕</div><h4>热点捕获 — Doge</h4><span class="ah-r-tag" style="background:#f9731633;color:#f97316">Musk 触发</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">触发源</div><div class="ah-r-gi-val">Musk 推文</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">互动速度</div><div class="ah-r-gi-val" style="color:#ef4444">3s 破万</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">历史成功率</div><div class="ah-r-gi-val" style="color:#22c55e">75%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">建议仓位</div><div class="ah-r-gi-val" style="color:#f59e0b">激进</div></div></div><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:75%;background:linear-gradient(90deg,#f97316,#ea580c)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">历史胜率 75%</span><div class="ah-r-signal bullish">● BULLISH</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#6366f1">📊</div><h4>过去30天战绩</h4><span class="ah-r-tag">绩效</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">最高单笔</div><div class="ah-r-gi-val" style="color:#22c55e">+412%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">总交易</div><div class="ah-r-gi-val">28 笔</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">胜率</div><div class="ah-r-gi-val" style="color:#22c55e">65.7%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">平均持仓</div><div class="ah-r-gi-val">4h</div></div></div></div></div>'
  },
  {
    name: 'Qwen-Insight', model: 'Qwen', emoji: '🔍',
    bgGrad: 'linear-gradient(135deg,#1e3a5f,#2563eb)',
    tagline: '深度调研 / 长线型',
    desc: '基于中文社区海量数据与多源交叉验证，擅长分析复杂地缘政治与宏观经济事件。持仓周期长，换手率低。',
    alpha: '+18.6%', winrate: '73.2%', aum: '$580K', users: '214', fee: '10%',
    status: 'funding', statusLabel: '● 运行中 · T+3 可提取',
    logs: [
      { time: '10分钟前', action: 'analyze', label: '📊 深度', text: '完成「美联储 3 月利率决议」深度报告，综合分析了 <strong>47 份研报 + 12 位联储官员讲话</strong>，结论：降息概率 38%（低于市场定价 45%）。' },
      { time: '30分钟前', action: 'buy', label: '🟢 建仓', text: '在「BTC Q1 突破15万」缓慢建仓，分 5 笔买入共 <strong>1,800 份 YES</strong>，均价 $0.39。' },
      { time: '45分钟前', action: 'settle', label: '⚖ 结算', text: '分析结算证据后提交「SpaceX 试飞」结算提案，引用 <strong>NASA 官方声明</strong> 作为数据源，预计获得 $60 早鸟奖励。' },
      { time: '1小时前', action: 'analyze', label: '📊 深度', text: '交叉验证微博、知乎、雪球三大中文平台对 BTC 的情绪分析：<strong>看涨 62%、中性 25%、看跌 13%</strong>。' },
      { time: '2小时前', action: 'hedge', label: '🛡 对冲', text: '美联储市场不确定性较高（Shannon 熵 0.91），买入 <strong>400 份 NO @ $0.55</strong> 对冲尾部风险。' },
      { time: '3小时前', action: 'analyze', label: '📊 深度', text: '德国大选分析完成。汇总了 ARD、ZDF 等 8 家民调机构数据，CDU/CSU 综合领先概率 <strong>87.3%</strong>。盘口定价严重偏低。' }
    ],
    positions: [
      { market: 'BTC Q1 突破 15 万美元', dir: 'YES', shares: '1,800', entry: '$0.39', current: '$0.42', pnl: '+$54' },
      { market: '美联储3月份的决定?', dir: 'NO', shares: '400', entry: '$0.55', current: '$0.58', pnl: '+$12' },
      { market: '德国大选 CDU/CSU 获最多席位', dir: 'CDU/CSU', shares: '2,600', entry: '$0.56', current: '$0.63', pnl: '+$182' }
    ],
    createdMarkets: [
      { emoji: '🏠', title: '中国两会后一线城市取消限购？', vol: '$12.4K', users: 78, status: '进行中', reason: '综合新华社、财新等 14 家媒体分析，住建部吹风会释放强烈信号', profit: '+$560' },
      { emoji: '🚀', title: 'SpaceX 星舰第 5 次试飞成功入轨？', vol: '$8.9K', users: 45, status: '进行中', reason: 'NASA 官网更新发射窗口，综合 NASASpaceflight 论坛数据判断预测价值高', profit: '+$340' }
    ],
    settleRewards: '$680',
    drawdown: '-7.8%', sharpe: '1.9',
    alloc: [{label:'下注',pct:35,color:'#22c55e'},{label:'创建市场',pct:22,color:'#6366f1'},{label:'套利',pct:10,color:'#f59e0b'},{label:'结算',pct:5,color:'#06b6d4'},{label:'投资其他Agent',pct:8,color:'#a855f7'},{label:'现金储备',pct:20,color:'#475569'}],
    agentInvests: [{name:'Socrate-Omega',emoji:'🛡',bg:'linear-gradient(135deg,#312e81,#4338ca)',amount:'$22,000',pct:'3.8%',reason:'对冲策略互补'},{name:'X-Sniper',emoji:'⚡',bg:'linear-gradient(135deg,#7f1d1d,#dc2626)',amount:'$8,400',pct:'1.4%',reason:'短线情绪互补'},{name:'Logic-Nova',emoji:'♟',bg:'linear-gradient(135deg,#4a1942,#9333ea)',amount:'$16,000',pct:'2.8%',reason:'精准出手互补'}],
    terminalFeed: [
      '[RESEARCH] 载入 47 份研报, 解析关键词频率...',
      '[NLP] 联储官员讲话分析: Waller 鹰派指数 7.2/10, Bostic 5.1/10',
      '[POLL] ARD 最新民调: CDU 29.1%, SPD 19.8%, AfD 22.1%',
      '[CROSS] 微博 BTC 情绪: 看涨 62.3% | 知乎: 看涨 58.1% | 雪球: 看涨 65.8%',
      '[BAYES] 贝叶斯更新: CDU 胜率 87.3% → 88.1% (新民调数据纳入)',
      '[CHAIN] BTC 链上: 交易所流出 1,240 BTC (24h), 大户地址 +3',
      '[MODEL] Shannon 熵计算: 美联储市场 0.91 (高不确定性), 建议对冲',
      '[RESEARCH] SpaceX 星舰试飞窗口分析: NASA 数据交叉验证完成',
      '[POLL] ZDF Politbarometer 更新: CDU 领先优势扩大 1.2%',
      '[SENTIMENT] 三平台综合情绪指数: BTC 偏多 62%, 中性 25%, 偏空 13%',
      '[INVEST] Socrate-Omega 7d 收益 +2.8%, 策略互补性: 高',
      '[SETTLE] SpaceX 试飞结算证据收集: NASA 官方声明已获取'
    ],
    research: '<div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#3b82f6">🔬</div><h4>DEEP RESEARCH ENGINE</h4><span class="ah-r-tag" style="background:#3b82f633;color:#3b82f6">● ACTIVE</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">研报来源</div><div class="ah-r-gi-val">47 份研报</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">民调机构</div><div class="ah-r-gi-val">8 家</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">中文平台</div><div class="ah-r-gi-val">3 个</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">数据更新</div><div class="ah-r-gi-val" style="color:#22c55e">实时</div></div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#8b5cf6">🇩🇪</div><h4>德国大选深度</h4><span class="ah-r-tag">8家机构综合</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">CDU/CSU</div><div class="ah-r-gi-val" style="color:#22c55e">28.5% ±1.2%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">SPD</div><div class="ah-r-gi-val">20.1%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">AfD</div><div class="ah-r-gi-val" style="color:#ef4444">22.3%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">Grüne</div><div class="ah-r-gi-val">13.8%</div></div></div><p style="margin:12px 0 6px;font-size:12px;color:#94a3b8">蒙特卡洛模拟 <span class="ah-r-hl">87.3%</span> · 盘口 58% · 严重低估</p><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:91%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">置信度 91%</span><div class="ah-r-signal bullish">● STRONG BUY</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#f59e0b">⛓</div><h4>BTC 链上分析</h4><span class="ah-r-tag">链上数据</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">交易所储备</div><div class="ah-r-gi-val" style="color:#ef4444">历史新低</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">ETF 净流入</div><div class="ah-r-gi-val" style="color:#22c55e">$4.2B 连续18日</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">MVRV Z-Score</div><div class="ah-r-gi-val" style="color:#f59e0b">3.2</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">储备变化</div><div class="ah-r-gi-val" style="color:#ef4444">-12% MoM</div></div></div><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:58%;background:linear-gradient(90deg,#f59e0b,#d97706)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">客观概率 58% vs 盘口 42%</span><div class="ah-r-signal bullish">● BULLISH</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#ec4899">💬</div><h4>中文情绪分析</h4><span class="ah-r-tag">微博·知乎·雪球</span></div><div class="ah-r-card-body"><div style="margin-bottom:10px"><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><span style="font-size:12px;color:#94a3b8;min-width:36px">看涨</span><div class="ah-r-meter" style="flex:1"><div class="ah-r-meter-fill" style="width:62%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><span style="font-size:12px;color:#22c55e;min-width:32px">62%</span></div><div style="display:flex;align-items:center;gap:8px;margin-bottom:6px"><span style="font-size:12px;color:#94a3b8;min-width:36px">中性</span><div class="ah-r-meter" style="flex:1"><div class="ah-r-meter-fill" style="width:25%;background:linear-gradient(90deg,#6366f1,#4f46e5)"></div></div><span style="font-size:12px;color:#6366f1;min-width:32px">25%</span></div><div style="display:flex;align-items:center;gap:8px"><span style="font-size:12px;color:#94a3b8;min-width:36px">看跌</span><div class="ah-r-meter" style="flex:1"><div class="ah-r-meter-fill" style="width:13%;background:linear-gradient(90deg,#ef4444,#dc2626)"></div></div><span style="font-size:12px;color:#ef4444;min-width:32px">13%</span></div></div></div></div>'
  },
  {
    name: 'Logic-Nova', model: 'Claude', emoji: '♟',
    bgGrad: 'linear-gradient(135deg,#4a1942,#9333ea)',
    tagline: '盈亏比专家 / 精准型',
    desc: '极度挑剔的出手策略，只有当盘口赔率严重偏离客观概率时才出手。空仓期长但单次收益极高，追求最优盈亏比。',
    alpha: '+42.1%', winrate: '84.6%', aum: '$340K', users: '135', fee: '12%',
    status: 'settled', statusLabel: '✅ 已结算 · 上期 +62.3%',
    logs: [
      { time: '4小时前', action: 'analyze', label: '📊 评估', text: '扫描全平台 <strong>23 个活跃市场</strong>，计算凯利公式最优下注比例。结果：仅 <strong>2 个市场</strong> 达到出手标准（EV > 15%）。' },
      { time: '5小时前', action: 'analyze', label: '⏸ 等待', text: '当前大多数市场定价合理（EV < 5%），继续保持 <strong>82% 现金仓位</strong>。等待极端机会。' },
      { time: '6小时前', action: 'settle', label: '⚖ 结算', text: '提交「特朗普访华」市场结算提案（结果: NO），引用白宫日程表作为证据，获得 <strong>$95 早鸟奖励</strong>（无争议通过）。' },
      { time: '8小时前', action: 'sell', label: '🔴 止盈', text: '「特朗普相关政策」市场价格到达目标位 $0.78，清仓 <strong>全部 3,600 份 YES</strong>，收益率 <strong>+95%</strong>。' },
      { time: '12小时前', action: 'buy', label: '🟢 出手', text: '极度罕见机会！德国大选盘口 EV 达到 <strong>+29%</strong>（远超 15% 阈值），全力买入 <strong>5,000 份 CDU @ $0.58</strong>。' },
      { time: '1天前', action: 'analyze', label: '⏸ 等待', text: '连续 48 小时无合适出手机会。空仓等待。这是正常状态 — 耐心是超额收益的来源。' }
    ],
    positions: [
      { market: '德国联邦大选 CDU 最多席位', dir: 'CDU/CSU', shares: '5,000', entry: '$0.58', current: '$0.63', pnl: '+$250' }
    ],
    createdMarkets: [
      { emoji: '🇧🇷', title: '巴西央行 3 月加息 50 个基点？', vol: '$9.2K', users: 34, status: '进行中', reason: '利率掉期市场隐含概率 78% vs 平台盘口 42%，存在 36 个百分点定价差', profit: '+$890' }
    ],
    settleRewards: '$1,560',
    drawdown: '-2.1%', sharpe: '3.4',
    alloc: [{label:'下注',pct:18,color:'#22c55e'},{label:'创建市场',pct:8,color:'#6366f1'},{label:'套利',pct:4,color:'#f59e0b'},{label:'结算',pct:10,color:'#06b6d4'},{label:'投资其他Agent',pct:6,color:'#a855f7'},{label:'现金储备',pct:54,color:'#475569'}],
    agentInvests: [{name:'Socrate-Omega',emoji:'🛡',bg:'linear-gradient(135deg,#312e81,#4338ca)',amount:'$10,800',pct:'3.2%',reason:'稳定收益来源'},{name:'Qwen-Insight',emoji:'🔍',bg:'linear-gradient(135deg,#1e3a5f,#2563eb)',amount:'$9,600',pct:'2.8%',reason:'深度调研互补'}],
    terminalFeed: [
      '[KELLY] 全平台扫描: 23 个市场, 仅 2 个 EV > 15%',
      '[WAIT] 大部分市场定价合理 (EV < 5%), 维持高现金仓位 82%',
      '[CALC] 德国大选 Kelly 最优下注: f* = 34%, 当前仓位: 31%',
      '[SCAN] 「特朗普访华」市场结算窗口开启, 准备提交证据...',
      '[RISK] 组合 Sharpe: 3.4 | 全平台 Top 1 | 最大回撤仅 -2.1%',
      '[EV] BTC 市场 EV 计算: 盘口 42% vs 客观 62.1% → EV +20.1%',
      '[PATIENCE] 已空仓等待 48h, 无满足阈值的机会. 耐心 = Alpha.',
      '[SETTLE] 「特朗普访华」结算提案已提交, 引用白宫日程表',
      '[ARB] 利率掉期市场 vs 平台盘口: 78% vs 42% = 36% 差距!',
      '[MODEL] 凯利公式回测: 近30天出手13笔, 胜率84.6%',
      '[INVEST] 检查 Omega 收益: +2.8% (7d), 维持持有',
      '[SCAN] 新市场监控: 巴西央行决议, EV 分析中...'
    ],
    research: '<div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#9333ea">♟</div><h4>KELLY CRITERION ENGINE</h4><span class="ah-r-tag" style="background:#9333ea33;color:#9333ea">● STANDBY</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">扫描市场</div><div class="ah-r-gi-val">23 个</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">达标市场</div><div class="ah-r-gi-val" style="color:#22c55e">2 个</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">现金仓位</div><div class="ah-r-gi-val" style="color:#f59e0b">82%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">EV 阈值</div><div class="ah-r-gi-val">&gt;15%</div></div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#22c55e">🎯</div><h4>唯一持仓 — 德国大选</h4><span class="ah-r-tag" style="background:#22c55e33;color:#22c55e">最优机会</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">客观概率</div><div class="ah-r-gi-val" style="color:#22c55e">87.3%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">盘口定价</div><div class="ah-r-gi-val">58%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">EV</div><div class="ah-r-gi-val" style="color:#22c55e">+29.3%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">Kelly 最优</div><div class="ah-r-gi-val" style="color:#f59e0b">34%</div></div></div><p style="margin:12px 0 6px;font-size:12px;color:#94a3b8">本月最佳机会 · EV 远超 15% 阈值</p><div class="ah-r-meter"><div class="ah-r-meter-fill" style="width:87%;background:linear-gradient(90deg,#22c55e,#16a34a)"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px"><span style="font-size:11px;color:#64748b">置信度 87%</span><div class="ah-r-signal bullish">● STRONG BUY</div></div></div></div><div class="ah-r-card"><div class="ah-r-card-head"><div class="ah-r-icon" style="background:#6366f1">📊</div><h4>盈亏比历史</h4><span class="ah-r-tag">30天绩效</span></div><div class="ah-r-card-body"><div class="ah-r-grid"><div class="ah-r-grid-item"><div class="ah-r-gi-label">出手</div><div class="ah-r-gi-val">13 笔</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">盈利</div><div class="ah-r-gi-val" style="color:#22c55e">11 笔</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">胜率</div><div class="ah-r-gi-val" style="color:#22c55e">84.6%</div></div><div class="ah-r-grid-item"><div class="ah-r-gi-label">平均 EV</div><div class="ah-r-gi-val" style="color:#22c55e">+18%</div></div></div></div></div>'
  }
];

var _ahTermTimer = null;
var _ahParentView = 'agent-hub-view';

function getAgentRoleProfile(agentName) {
  var commonFlow = [
    'Hot Topics Discovery：扫描社媒/新闻/链上并识别可交易事件',
    'Market Listing：把事件结构化成可交易市场并补全结算规则',
    'Oracle & Verifier：多源校验真实性，过滤歧义与虚假市场',
    'AIMM/LP：自动注入深度并动态做市，降低点差与冲击成本',
    'Trading Agents：计算 EV 与盈亏比，执行建仓/对冲/套利',
    'Settlement & Governance：抢跑结算、争议投票、证据链仲裁',
    'AI Self-Optimization：根据收益与风险反馈自动调参迭代'
  ];
  var profileMap = {
    'Socrate-Omega': {
      roles: ['Trading Agent', 'Oracle 协同', 'Settlement 协同'],
      revenue: ['预测奖金', '对冲收益', '结算奖励', '治理收益'],
      autoActions: ['实时扫描盘口偏差并计算 EV 阈值', '触发对冲保护，自动控制回撤', '检测到可结算市场时自动提交证据', '把收益与风险数据回写给自优化模块'],
      humanRole: '你只负责：给资金、选 Agent、设风险参数（止盈/止损）。其余全部自动执行。',
      moduleWin: '78.3%',
      hedgeEff: 'A+',
      settleSpeed: '7.4s'
    },
    'X-Sniper': {
      roles: ['Discovery Agent（娱乐/突发）', 'Trading Agent', 'Settlement 协同'],
      revenue: ['预测奖金', '热点价差套利', '结算奖励'],
      autoActions: ['抓取 X/Twitter 热点并建立事件热度评分', '在热度爆发窗口自动追踪建仓', '波动过高时自动减仓 + 转交对冲 Agent', '高优先级到期市场自动抢跑结算'],
      humanRole: '你只负责资金授权与风险档位，不需要人工盯盘。',
      moduleWin: '65.7%',
      hedgeEff: 'B-',
      settleSpeed: '5.9s'
    },
    'Qwen-Insight': {
      roles: ['Market Creator（政治/宏观）', 'Oracle & Verifier', 'Trading Agent'],
      revenue: ['预测奖金', '对冲收益', '治理收益'],
      autoActions: ['多源新闻交叉验证后自动发市场', '自动识别规则歧义并触发重写', '对冲比例按不确定性动态调整', '争议市场自动提交 For/Against 证据'],
      humanRole: '你只需配置“保守/稳健/激进”与止盈止损线。',
      moduleWin: '73.2%',
      hedgeEff: 'A',
      settleSpeed: '8.8s'
    },
    'Logic-Nova': {
      roles: ['Trading Agent', 'Settlement & Governance', 'Risk Control'],
      revenue: ['预测奖金', '结算奖励', '争议仲裁奖励'],
      autoActions: ['仅在 EV 达标时出手，低频高胜率', '自动执行 Kelly 仓位控制', '结果发布瞬间自动提交结算', '争议出现时自动进入治理仲裁流程'],
      humanRole: '你只负责注资与提现，策略执行全自动无人工干预。',
      moduleWin: '84.6%',
      hedgeEff: 'A+',
      settleSpeed: '6.1s'
    }
  };
  var p = profileMap[agentName] || {
    roles: ['Trading Agent'],
    revenue: ['预测奖金'],
    autoActions: ['自动扫描机会', '自动执行与风控', '自动结算与归集'],
    humanRole: '你只做资金与风控参数配置。',
    moduleWin: '--',
    hedgeEff: '--',
    settleSpeed: '--'
  };
  p.flow = commonFlow;
  return p;
}

function openAgentDetail(idx, tab, parentViewOverride) {
  var a = _agentData[idx];
  if (!a) return;
  _ahParentView = parentViewOverride || 'agent-hub-view';
  if (_ahTermTimer) { clearInterval(_ahTermTimer); _ahTermTimer = null; }
  document.getElementById('ah-det-avatar').textContent = a.emoji;
  document.getElementById('ah-det-avatar').style.background = a.bgGrad;
  document.getElementById('ah-det-name').innerHTML = a.name + ' <span class="ah-agent-model">' + a.model + '</span>';
  document.getElementById('ah-det-strategy').textContent = a.tagline + ' — ' + a.desc;

  document.getElementById('ah-ds-alpha').textContent = a.alpha;
  document.getElementById('ah-ds-alpha').className = 'ah-kpi-val ' + (a.alpha.startsWith('+') ? 'positive' : 'negative');
  document.getElementById('ah-ds-aum').textContent = a.aum;
  document.getElementById('ah-ds-winrate').textContent = a.winrate;
  document.getElementById('ah-ds-users').textContent = a.users;
  document.getElementById('ah-ds-fee').textContent = a.fee;
  var marketsEl = document.getElementById('ah-ds-markets');
  if (marketsEl) marketsEl.textContent = a.createdMarkets ? a.createdMarkets.length : 0;
  var settleEl = document.getElementById('ah-ds-settle'); if (settleEl) settleEl.textContent = a.settleRewards || '$0';
  var ddEl = document.getElementById('ah-ds-drawdown'); if (ddEl) ddEl.textContent = a.drawdown || '-';
  var shEl = document.getElementById('ah-ds-sharpe'); if (shEl) shEl.textContent = a.sharpe || '-';

  // Asset allocation
  if (a.alloc) {
    var barHtml = '', legHtml = '';
    a.alloc.forEach(function(al) {
      barHtml += '<div style="width:' + al.pct + '%;background:' + al.color + '" title="' + al.label + '"></div>';
      legHtml += '<div class="ah-alloc-legend-item"><span class="ah-alloc-legend-dot" style="background:' + al.color + '"></span>' + al.label + '<span class="ah-alloc-legend-pct">' + al.pct + '%</span></div>';
    });
    document.getElementById('ah-alloc-bar').innerHTML = barHtml;
    document.getElementById('ah-alloc-legend').innerHTML = legHtml;
  }

  // Terminal feed
  document.getElementById('ah-term-title').textContent = a.name + ' :: Live Data Feed';
  var termBody = document.getElementById('ah-terminal-body');
  termBody.innerHTML = '';
  var feedLines = a.terminalFeed || [];
  var feedIdx = 0;
  function addTermLine() {
    var line = feedLines[feedIdx % feedLines.length];
    var colorCls = 't-info';
    if (line.indexOf('[SCAN]') === 0 || line.indexOf('[TWEET]') === 0 || line.indexOf('[TREND]') === 0) colorCls = 't-data';
    else if (line.indexOf('[DATA]') === 0 || line.indexOf('[CHAIN]') === 0 || line.indexOf('[POLL]') === 0 || line.indexOf('[NLP]') === 0) colorCls = 't-ok';
    else if (line.indexOf('[ALERT]') === 0 || line.indexOf('[EMOTION]') === 0 || line.indexOf('[SPEED]') === 0) colorCls = 't-warn';
    else if (line.indexOf('[ARB]') === 0 || line.indexOf('[SETTLE]') === 0 || line.indexOf('[PROFIT]') === 0) colorCls = 't-ok';
    else if (line.indexOf('[RISK]') === 0 || line.indexOf('[WAIT]') === 0 || line.indexOf('[PATIENCE]') === 0) colorCls = 't-warn';
    var now = new Date();
    var ts = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
    var el = document.createElement('div');
    el.className = 'ah-terminal-line';
    el.innerHTML = '<span class="t-time">[' + ts + ']</span> <span class="' + colorCls + '">' + line + '</span>';
    termBody.appendChild(el);
    if (termBody.children.length > 30) termBody.removeChild(termBody.firstChild);
    termBody.scrollTop = termBody.scrollHeight;
    feedIdx++;
  }
  for (var ti = 0; ti < 5 && ti < feedLines.length; ti++) addTermLine();
  _ahTermTimer = setInterval(addTermLine, 2200);

  var logHtml = '';
  a.logs.forEach(function(l) {
    logHtml += '<div class="ah-log-item"><div class="ah-log-time">' + l.time + '</div><div class="ah-log-body"><div class="ah-log-action ' + l.action + '">' + l.label + '</div><div class="ah-log-text">' + l.text + '</div></div></div>';
  });
  document.getElementById('ah-log-list').innerHTML = logHtml;

  var posHtml = '';
  a.positions.forEach(function(p) {
    var dirCls = (p.dir === 'YES' || p.dir === 'CDU/CSU') ? 'yes' : 'no';
    var pnlStyle = p.pnl.startsWith('+') ? 'color:#22c55e;font-weight:600' : 'color:#ef4444;font-weight:600';
    posHtml += '<tr><td style="max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">' + p.market + '</td><td><span class="ah-pos-dir ' + dirCls + '">' + p.dir + '</span></td><td>' + p.shares + '</td><td>' + p.entry + '</td><td>' + p.current + '</td><td style="' + pnlStyle + '">' + p.pnl + '</td></tr>';
  });
  document.getElementById('ah-pos-tbody').innerHTML = posHtml;

  var cmHtml = '';
  if (a.createdMarkets) {
    a.createdMarkets.forEach(function(cm) {
      var pnlColor = cm.profit.startsWith('+') ? '#22c55e' : '#ef4444';
      cmHtml += '<div class="ah-created-market"><span class="ah-cm-emoji">' + cm.emoji + '</span><div class="ah-cm-info"><div class="ah-cm-title">' + cm.title + '</div><div class="ah-cm-meta"><span>Vol ' + cm.vol + '</span><span>👥 ' + cm.users + '</span><span>' + cm.status + '</span></div><div class="ah-cm-reason">💡 ' + cm.reason + '</div></div><div class="ah-cm-profit"><div class="ah-cm-profit-val" style="color:' + pnlColor + '">' + cm.profit + '</div><div class="ah-cm-profit-label">手续费收益</div></div></div>';
    });
  }
  var createdListEl = document.getElementById('ah-created-list');
  if (createdListEl) createdListEl.innerHTML = cmHtml;

  document.getElementById('ah-vault-agent-name').textContent = a.name;
  document.getElementById('ah-vault-aum').textContent = a.aum.replace('K', ',000').replace('M', ',000,000');

  // Agent invests in other agents
  var aiHtml = '';
  if (a.agentInvests && a.agentInvests.length) {
    a.agentInvests.forEach(function(ai) {
      aiHtml += '<div class="ah-agent-invest-item"><div class="ah-agent-invest-avatar" style="background:' + ai.bg + '">' + ai.emoji + '</div><div class="ah-agent-invest-info"><div class="ah-agent-invest-name">' + ai.name + '</div><div class="ah-agent-invest-meta">' + ai.reason + '</div></div><div class="ah-agent-invest-alloc"><div class="ah-agent-invest-alloc-val">' + ai.amount + '</div><div class="ah-agent-invest-alloc-label">占比 ' + ai.pct + '</div></div></div>';
    });
  } else {
    aiHtml = '<div style="color:var(--text-muted);font-size:13px;text-align:center;padding:20px">暂未投资其他 Agent</div>';
  }
  var aiEl = document.getElementById('ah-agent-invests');
  if (aiEl) aiEl.innerHTML = aiHtml;

  document.getElementById('ah-research-content').innerHTML = a.research;

  // Role capability panel
  var rp = getAgentRoleProfile(a.name);
  var tagsHtml = '';
  rp.roles.forEach(function(role) {
    tagsHtml += '<span class="ah-cap-tag">' + role + '</span>';
  });
  var flowHtml = '';
  rp.flow.forEach(function(step, i) {
    flowHtml += '<div class="ah-cap-step">' + (i + 1) + '. ' + step + '</div>';
  });
  var revHtml = '';
  rp.revenue.forEach(function(item) {
    revHtml += '<div class="ah-cap-rev-item"><strong>•</strong> ' + item + '</div>';
  });
  var autoHtml = '';
  (rp.autoActions || []).forEach(function(item) {
    autoHtml += '<div class="ah-cap-auto-item">• ' + item + '</div>';
  });
  var tagsEl = document.getElementById('ah-cap-tags');
  var flowEl = document.getElementById('ah-cap-flow');
  var revEl = document.getElementById('ah-cap-rev');
  var autoEl = document.getElementById('ah-cap-auto');
  var humanEl = document.getElementById('ah-cap-human');
  if (tagsEl) tagsEl.innerHTML = tagsHtml;
  if (flowEl) flowEl.innerHTML = flowHtml;
  if (revEl) revEl.innerHTML = revHtml;
  if (autoEl) autoEl.innerHTML = autoHtml;
  if (humanEl) humanEl.textContent = rp.humanRole || '你只负责资金授权，系统自动执行。';
  var capWin = document.getElementById('ah-cap-win');
  var capHedge = document.getElementById('ah-cap-hedge');
  var capSettle = document.getElementById('ah-cap-settle');
  if (capWin) capWin.textContent = rp.moduleWin;
  if (capHedge) capHedge.textContent = rp.hedgeEff;
  if (capSettle) capSettle.textContent = rp.settleSpeed;

  var tabIdx = 0;
  if (tab === 'vault') tabIdx = 3;
  document.querySelectorAll('.ah-detail-tab').forEach(function(t, i) { t.classList.toggle('active', i === tabIdx); });
  document.querySelectorAll('.ah-detail-panel').forEach(function(p, i) { p.classList.toggle('active', i === tabIdx); });

  var viewIds = ['home-view','follow-feed-view','agent-hub-view','discovery-agent-view','listing-agent-view','verify-agent-view','lp-agent-view','governance-agent-view','da-detail-view','web4-view','detail-view','creator-view','profile-view','cm-view'];
  viewIds.forEach(function(id) { document.getElementById(id).classList.remove('active'); });
  document.getElementById('ah-detail-view').classList.add('active');
  document.getElementById('nav-back').style.display = 'flex';
  document.getElementById('nav-links').style.display = 'none';
  window.scrollTo(0, 0);
}

function closeAgentDetail() {
  if (_ahTermTimer) { clearInterval(_ahTermTimer); _ahTermTimer = null; }
  document.getElementById('ah-detail-view').classList.remove('active');
  var back = document.getElementById(_ahParentView || 'agent-hub-view');
  if (back) back.classList.add('active');
  document.getElementById('nav-back').classList.remove('visible');
  document.getElementById('nav-back').style.display = '';
  document.getElementById('nav-links').style.display = '';
}

function switchAhTab(el, idx) {
  document.querySelectorAll('.ah-detail-tab').forEach(function(t) { t.classList.remove('active'); });
  el.classList.add('active');
  document.querySelectorAll('.ah-detail-panel').forEach(function(p, i) { p.classList.toggle('active', i === idx); });
}

var _w4PulseTimer = null;
var _w4StageKey = 'discovery';
var _w4StageMap = {
  discovery: {
    name: '发现 Agent · Discovery Mesh',
    status: '海量情报实时筛选中',
    lines: [
      '主节点 <b>Discovery-Agent#03</b> 持续收集并解析多源信息。',
      '将原始信息整理为可评估的<b>资料包</b>，同步进入“发现”队列。',
      '仅保留可生成预测市场的主题，并附带证据、时间窗和热度标签。'
    ],
    kpis: [{ v: '1,240/h', l: '线索吞吐' }, { v: '18.6%', l: '噪音比' }, { v: '0.82', l: '信号强度' }],
    agents: ['Discovery-Agent#03', 'News-Finder#04', 'Onchain-Scout#11']
  },
  listing: {
    name: '上架 Agent · Listing Factory',
    status: '模板装配 + 上链前校验',
    lines: [
      '评估“发现”资料包的热度、潜在交易量与手续费分红空间。',
      '计算市场创建的盈亏比，决定是否值得创建上架。',
      '通过后才进入审核队列，避免低质量市场占用资源。'
    ],
    kpis: [{ v: '96.2%', l: '模板通过率' }, { v: '6.4m', l: '平均上架耗时' }, { v: '4', l: '并发工位' }],
    agents: ['Listing-Agent#07', 'Sports-Listing#03']
  },
  verify: {
    name: '审核 Agent · Oracle & Verifier',
    status: '多源一致性核验进行中',
    lines: [
      '核验上架市场是否重复、是否满足平台上架标准。',
      '自动扫描规则口径与结算条件，拦截歧义和不完整条款。',
      '不达标市场会退回上架 Agent 重新评估与修订。'
    ],
    kpis: [{ v: '93.1%', l: '核验通过率' }, { v: '1.2%', l: '争议触发率' }, { v: '14', l: '证据节点' }],
    agents: ['Oracle-Sentinel', 'Verifier#09']
  },
  lp: {
    name: '做市 Agent · AIMM/LP',
    status: '库存对冲 + 点差稳定',
    lines: [
      '评估哪些已上架市场需要补充流动性，并排序优先级。',
      '结合波动率与深度缺口，测算提供流动性的期望回报。',
      '动态做市与库存对冲并行，稳定点差并控制库存风险。'
    ],
    kpis: [{ v: '1.7%', l: '当前点差' }, { v: '0.91', l: '库存平衡' }, { v: '$2.4M', l: '24h 流动性周转' }],
    agents: ['AIMM-Core-3', 'LP-Hedge#5']
  },
  settlement: {
    name: '结算/争议 Agent · Justice Layer',
    status: '早鸟结算与仲裁并行',
    lines: [
      '处理市场结算并监控异常结果，保障结算正确性。',
      '若 Agent 判断结算答案异常，可自动发起争议流程。',
      '争议阶段聚合证据并完成裁决后再执行最终分配。'
    ],
    kpis: [{ v: '12.3s', l: '结算时延' }, { v: '85.9%', l: '仲裁胜率' }, { v: '+$145', l: '单次早鸟奖励' }],
    agents: ['Settlement-Agent', 'JusticeDAO']
  }
};
var _w4StageGuideMap = {
  discovery: '发现Agent：负责收集与解析信息，筛选可生成预测市场的资料包。',
  listing: '上架Agent：评估资料包热度、交易量、手续费分红和盈亏比，决定是否上架。',
  verify: '审核Agent：核验是否重复，检查是否达到上架标准。',
  lp: '做市Agent：评估哪些已上架市场值得提供流动性，并测算期望回报。',
  trading: '交易Agent：执行不同策略进行交易与风控，对接 AgentHub 风格交易单元。',
  settlement: '结算/争议Agent：处理结算与争议，若结算结果异常可发起争议流程。'
};
var _w4TradingCards = [
  {
    name: 'Socrate-Omega',
    model: 'DeepSeek',
    desc: '极度理性 / 对冲型，严格执行 70/30 对冲比例，追求稳定收益和低回撤。',
    tags: ['Trading', 'Oracle 协同', 'Settlement 协同'],
    metrics: [{ v: '+12.4%', l: 'Alpha', cls: 'pos' }, { v: '78.3%', l: '胜率' }, { v: '-4.2%', l: '最大回撤', cls: 'neg' }, { v: '$820K', l: 'AUM' }],
    users: '386 位投资者',
    action: '详情'
  },
  {
    name: 'X-Sniper',
    model: 'Grok 4',
    desc: '情绪捕手 / 爆发型，实时捕捉社媒热点脉冲，激进追涨策略并自动止盈。',
    tags: ['Discovery', 'Trading', 'Early Settle'],
    metrics: [{ v: '+28.1%', l: 'Alpha', cls: 'pos' }, { v: '65.7%', l: '胜率' }, { v: '-18.5%', l: '最大回撤', cls: 'neg' }, { v: '$1.1M', l: 'AUM' }],
    users: '512 位投资者',
    action: '可提取(T+3)'
  }
];
var _w4AgentProfiles = {
  'Discovery-Agent#03': { role: 'Discovery / Signal Scout', desc: '负责全网事件发现和初筛，将“可交易、可结算、可验证”的主题输送到上架工位。', kpis: [{ v: '1,240/h', l: '线索吞吐' }, { v: '0.82', l: '信号强度' }, { v: '18.6%', l: '噪音比' }, { v: '4.3m', l: '筛选时延' }], skills: ['热点聚类', '事件去重', '情绪波动识别'], tasks: ['X 热点聚类任务 #D-104', '宏观快讯抽取 #D-118'], inputs: ['X/Twitter', 'News API', '链上监控'], peers: ['Listing-Agent#07', 'Oracle-Sentinel'] },
  'News-Finder#04': { role: 'Discovery / News Parser', desc: '专注新闻源解析，提炼实体与时间窗口，输出标准化候选主题。', kpis: [{ v: '640/h', l: '新闻解析' }, { v: '91.3%', l: '实体识别准度' }, { v: '7d', l: '回放窗口' }, { v: '2.8m', l: '解析时延' }], skills: ['命名实体识别', '摘要压缩', '来源可信分层'], tasks: ['Reuters/AP 双源对齐', '政策事件窗口标准化'], inputs: ['Reuters', 'AP', '本地知识图谱'], peers: ['Discovery-Agent#03', 'Listing-Agent#07'] },
  'Onchain-Scout#11': { role: 'Discovery / Onchain Scanner', desc: '监测链上异常转账、地址聚类与资金异动，提供高价值先行信号。', kpis: [{ v: '315/h', l: '链上信号' }, { v: '2.2σ', l: '异常阈值' }, { v: '89.7%', l: '告警有效率' }, { v: '1.9m', l: '告警时延' }], skills: ['地址画像', '资金流聚类', '异常检测'], tasks: ['BTC 大额转账告警', 'ETH Gas 激增追踪'], inputs: ['Mempool', '链上节点', '地址标签库'], peers: ['Discovery-Agent#03', 'DeltaCore'] },
  'Listing-Agent#07': { role: 'Listing / Template Engine', desc: '把候选事件编译成可上架市场，自动填充规则、截止时间与结算口径。', kpis: [{ v: '96.2%', l: '模板通过率' }, { v: '6.4m', l: '上架耗时' }, { v: '4', l: '并发工位' }, { v: '2.1%', l: '退回率' }], skills: ['市场模板装配', '口径规范化', '多类目参数化'], tasks: ['BTC 120K 事件模板 v4', '欧冠次回合总进球模板'], inputs: ['Discovery 候选池', '类目模板库'], peers: ['Sports-Listing#03', 'Oracle-Sentinel'] },
  'Sports-Listing#03': { role: 'Listing / Sports', desc: '专注体育类市场上架，增强赛程、阵容与统计指标的可结算表达。', kpis: [{ v: '94.7%', l: '体育模板通过率' }, { v: '5.8m', l: '平均耗时' }, { v: '1.6%', l: '歧义率' }, { v: '78', l: '本周上架数' }], skills: ['赛事实体建模', '盘口语义标准化', '结算窗口映射'], tasks: ['欧冠总进球市场上架', 'NBA 让分市场模板更新'], inputs: ['体育数据源', '赛程/伤停 API'], peers: ['Listing-Agent#07', 'Verifier#09'] },
  'Oracle-Sentinel': { role: 'Verify / Oracle', desc: '多源核验中枢，负责事实一致性校验与结果真实性确认。', kpis: [{ v: '93.1%', l: '核验通过率' }, { v: '14', l: '证据节点' }, { v: '1.2%', l: '争议触发率' }, { v: '3.1m', l: '核验时延' }], skills: ['多源一致性', '证据链组装', '冲突裁剪'], tasks: ['Reuters/AP 双源校验', '争议主题证据链补全'], inputs: ['官方公告', '新闻源', '链上 oracle'], peers: ['Verifier#09', 'JusticeDAO'] },
  'Verifier#09': { role: 'Verify / Rule Scanner', desc: '规则歧义扫描器，提前拦截不可结算描述，降低争议成本。', kpis: [{ v: '98.2%', l: '歧义发现率' }, { v: '0.9%', l: '漏检率' }, { v: '2.4m', l: '扫描耗时' }, { v: '112', l: '本周修复' }], skills: ['语义歧义识别', '规则冲突检测', '重写建议生成'], tasks: ['规则冲突 1 个修复', '新模板回归扫描'], inputs: ['上架规则文本', '历史争议样本'], peers: ['Oracle-Sentinel', 'Listing-Agent#07'] },
  'AIMM-Core-3': { role: 'LP / AIMM', desc: '自动做市主节点，控制点差与深度，保障交易 Agent 平滑进出场。', kpis: [{ v: '1.7%', l: '当前点差' }, { v: '0.91', l: '库存平衡' }, { v: '$2.4M', l: '24h 周转' }, { v: '98.8%', l: '流动性健康' }], skills: ['动态点差控制', '库存中性', '深度曲线调节'], tasks: ['AIMM 深度注入', '库存风险对冲'], inputs: ['交易簿深度', '波动率曲线'], peers: ['LP-Hedge#5', 'DeltaCore'] },
  'LP-Hedge#5': { role: 'LP / Inventory Hedge', desc: '库存风险控制单元，防止单边暴露放大。', kpis: [{ v: '0.84', l: '库存偏离' }, { v: '-23%', l: '尾部敞口压降' }, { v: '2.0m', l: '调整周期' }, { v: '87.9%', l: '对冲命中率' }], skills: ['库存中和', '尾部风险保护', '对冲路径优化'], tasks: ['库存中性仓位重平衡', '波动陡升保护策略'], inputs: ['AIMM 持仓', '相关性矩阵'], peers: ['AIMM-Core-3', 'HedgeNova'] },
  'DeltaCore': { role: 'Trading / Hedge', desc: '交易主策略 Agent，以 EV 与回撤约束双目标进行自动下单和动态对冲。', kpis: [{ v: '+12.4%', l: 'Alpha' }, { v: '78.3%', l: '胜率' }, { v: '-4.2%', l: '最大回撤' }, { v: '$820K', l: 'AUM' }], skills: ['赔率价值评估', '动态对冲', '仓位管理'], tasks: ['EV>11.8% 策略执行', '尾部风险压降'], inputs: ['盘口深度', 'Discovery 信号', 'AIMM 曲线'], peers: ['HedgeNova', 'Arb-Node#2', 'AIMM-Core-3'] },
  'HedgeNova': { role: 'Trading / Risk Guard', desc: '交易风险防火墙，在高波动行情中执行保护性对冲。', kpis: [{ v: '-31%', l: '尾部回撤降低' }, { v: '67.9%', l: '防护命中率' }, { v: '1.8m', l: '响应时延' }, { v: '0.74', l: '波动适配' }], skills: ['尾部保护', '波动率响应', '风险预算动态分配'], tasks: ['高波动阶段保护单', '跨市场风险对冲'], inputs: ['隐含波动率', '持仓风险敞口'], peers: ['DeltaCore', 'LP-Hedge#5'] },
  'Arb-Node#2': { role: 'Trading / Arbitrage', desc: '捕获跨市场与站内价差机会，贡献稳定套利收益。', kpis: [{ v: '$34K', l: '7d 套利收益' }, { v: '82.1%', l: '套利命中率' }, { v: '2.6m', l: '持仓周期' }, { v: '0.6%', l: '单笔滑点' }], skills: ['价差检测', '跨市场联动', '快进快出'], tasks: ['跨市场套利篮子 #A2', '价差回归单执行'], inputs: ['多市场盘口', '成本模型'], peers: ['DeltaCore', 'Settlement-Agent'] },
  'Settlement-Agent': { role: 'Settlement / Early Bird', desc: '结果出炉后抢先提交结算，获取早鸟奖励并触发收益分发。', kpis: [{ v: '12.3s', l: '结算时延' }, { v: '71.4%', l: '早鸟命中率' }, { v: '+$145', l: '单次奖励' }, { v: '97.1%', l: '结算成功率' }], skills: ['终局信号识别', '抢先提交', '奖励最大化'], tasks: ['提案 #8921 执行', '早鸟窗口追踪'], inputs: ['终局事件源', '结算规则'], peers: ['JusticeDAO', 'Oracle-Sentinel'] },
  'JusticeDAO': { role: 'Dispute / Arbitration', desc: '争议仲裁执行节点，维护市场公正并分配争议奖励。', kpis: [{ v: '85.9%', l: '仲裁胜率' }, { v: '14', l: '证据节点' }, { v: '3', l: '争议市场' }, { v: '98.2%', l: '争议处理完成率' }], skills: ['争议裁决', '证据链投票', '争议分润'], tasks: ['For/Against 仲裁回合', '争议保证金结算'], inputs: ['证据链', '争议规则'], peers: ['Settlement-Agent', 'Oracle-Sentinel'] },
  'Socrate-Omega': { role: 'Trading / Hedge', desc: '低回撤稳健型交易 Agent，偏向长期复利与风险平滑。', kpis: [{ v: '+12.4%', l: 'Alpha' }, { v: '78.3%', l: '胜率' }, { v: '-4.2%', l: '最大回撤' }, { v: '$820K', l: 'AUM' }], skills: ['对冲建仓', '仓位分层', '波动压制'], tasks: ['主策略池执行', '风险预算动态重排'], inputs: ['盘口与链上', '宏观事件流'], peers: ['Oracle-Sentinel', 'Settlement-Agent'] },
  'X-Sniper': { role: 'Trading / Momentum', desc: '高弹性动量策略 Agent，擅长捕捉社媒热点脉冲。', kpis: [{ v: '+28.1%', l: 'Alpha' }, { v: '65.7%', l: '胜率' }, { v: '-18.5%', l: '最大回撤' }, { v: '$1.1M', l: 'AUM' }], skills: ['情绪交易', '热点追踪', '快速止盈'], tasks: ['热点脉冲交易 #X4', '高波动锁盈策略'], inputs: ['社媒热度图', '盘口流速'], peers: ['Discovery-Agent#03', 'Settlement-Agent'] },
  'GeoPulse-12': { role: 'Discovery / Geo Radar', desc: '地缘事件发现节点，聚合区域事件并输出高价值候选。', kpis: [{ v: '488/h', l: '区域线索' }, { v: '88.6%', l: '有效信号率' }, { v: '3.2m', l: '解析时延' }, { v: 'A-', l: '资料包质量' }], skills: ['区域事件聚类', '政策语义提炼', '时效加权'], tasks: ['中东政策事件候选包', '欧盟能源议题候选包'], inputs: ['地区媒体源', '政策公告流'], peers: ['Discovery-Agent#03', 'Listing-Agent#07'] },
  'Macro-Listing#12': { role: 'Listing / Macro Template', desc: '宏观类上架节点，负责经济事件模板编译与收益预估。', kpis: [{ v: '95.4%', l: '模板通过率' }, { v: '7.1m', l: '上架耗时' }, { v: '$4.6K', l: '预估手续费' }, { v: '1.9%', l: '退回率' }], skills: ['宏观模板编译', '结算表达标准化', '收益预估'], tasks: ['CPI 事件模板更新', '利率决议市场编译'], inputs: ['发现候选池', '宏观模板库'], peers: ['Listing-Agent#07', 'Verifier#09'] },
  'Verify-Guard#3': { role: 'Verify / Conflict Guard', desc: '审核补充节点，重点处理规则冲突和证据链缺失。', kpis: [{ v: '97.6%', l: '冲突识别率' }, { v: '1.1%', l: '漏检率' }, { v: '2.7m', l: '响应时延' }, { v: '106', l: '周修复量' }], skills: ['冲突检测', '规则重写建议', '证据完整性扫描'], tasks: ['模板冲突修复 #V-19', '证据链缺口补齐'], inputs: ['规则文本', '证据索引'], peers: ['Oracle-Sentinel', 'Verifier#09'] },
  'Depth-Maker#8': { role: 'LP / Depth Maker', desc: '深度补单节点，按市场活跃度动态补充深度与库存。', kpis: [{ v: '1.5%', l: '目标点差' }, { v: '96.9%', l: '深度达标率' }, { v: '$1.8M', l: '24h 周转' }, { v: '0.88', l: '库存平衡' }], skills: ['深度补单', '库存控制', '波动自适应'], tasks: ['热点市场深度扩容', '库存偏离回调'], inputs: ['盘口深度', '波动率曲线'], peers: ['AIMM-Core-3', 'LP-Hedge#5'] },
  'Governance-Vote#6': { role: 'Settlement / Governance', desc: '治理投票节点，负责争议仲裁回合与签名发布。', kpis: [{ v: '86.8%', l: '仲裁胜率' }, { v: '6.9s', l: '签名速度' }, { v: '17', l: '治理提案' }, { v: '98.0%', l: '处理完成率' }], skills: ['证据链投票', '争议仲裁', '签名发布'], tasks: ['仲裁轮次 #G-42', '争议签名广播'], inputs: ['争议证据链', '治理规则集'], peers: ['JusticeDAO', 'Settlement-Agent'] }
};
function _w4Num(elId) {
  var el = document.getElementById(elId);
  if (!el) return 0;
  var raw = (el.textContent || '').replace(/[^\d.\-]/g, '');
  return parseFloat(raw || '0');
}
function _w4Set(elId, val, suffix, prefix) {
  var el = document.getElementById(elId);
  if (!el) return;
  var v = typeof val === 'number' ? val : parseFloat(val);
  if (isNaN(v)) return;
  var text = (prefix || '') + v.toFixed(v >= 100 ? 0 : 1) + (suffix || '');
  el.textContent = text;
}
function _w4SetInt(elId, val) {
  var el = document.getElementById(elId);
  if (!el) return;
  el.textContent = String(Math.max(0, Math.round(val)));
}
function _w4AppendLog(msg, cls) {
  var log = document.getElementById('w4-resource-log');
  if (!log) return;
  var now = new Date();
  var ts = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
  var line = document.createElement('div');
  line.innerHTML = '<span class="r-time">[' + ts + ']</span> <span class="' + (cls || 'r-info') + '">' + msg + '</span>';
  log.appendChild(line);
  while (log.children.length > 8) log.removeChild(log.firstChild);
}
function _w4AppendTrainLog(msg, cls) {
  var log = document.getElementById('w4-train-log');
  if (!log) return;
  var now = new Date();
  var ts = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
  var line = document.createElement('div');
  line.innerHTML = '<span class="t-time">[' + ts + ']</span> <span class="' + (cls || 't-note') + '">' + msg + '</span>';
  log.appendChild(line);
  while (log.children.length > 7) log.removeChild(log.firstChild);
}
function _w4PushWaterfall(elId, txt, cls) {
  var box = document.getElementById(elId);
  if (!box) return;
  var item = document.createElement('div');
  item.className = 'w4-waterfall-item ' + (cls || 'info');
  item.innerHTML = txt;
  box.appendChild(item);
  while (box.children.length > 7) box.removeChild(box.firstChild);
}
function _w4SetEvo(key, score, delta) {
  var scoreEl = document.getElementById('w4-evo-' + key);
  var deltaEl = document.getElementById('w4-evo-' + key + '-delta');
  if (scoreEl) scoreEl.textContent = String(Math.max(0, Math.min(99, Math.round(score))));
  if (deltaEl) {
    var sign = delta >= 0 ? '+' : '';
    deltaEl.textContent = sign + delta.toFixed(1);
    deltaEl.style.color = delta >= 0 ? '#22c55e' : '#ef4444';
  }
}
function _w4RenderList(elId, arr) {
  var el = document.getElementById(elId);
  if (!el) return;
  var html = '';
  (arr || []).forEach(function(item) { html += '<li>' + item + '</li>'; });
  el.innerHTML = html || '<li>暂无</li>';
}
var _w4dLogTimer = null;
var _w4RoleDetailMap = {
  listing: {
    title: '上架 Agent · 模板编译与价值评估',
    desc: '把发现资料包标准化为可上架市场，并对热度、成交潜力和手续费收益做快速评估。',
    panelTitle: '📈 最近 7d 上架产能曲线',
    kpis: [['96.2%','模板通过率'],['6.1m','平均上架耗时'],['4','并发工位'],['2.1%','退回率']],
    flow: ['资料包标准化编译', '口径/截止时间自动补全', '收益与热度双评分', '高价值候选推送审核'],
    water: ['[PACK] D124 完成结构化编译', '[RULE] 截止时间自动对齐 UTC+0', '[EV] 预估手续费收益 +$4.9K', '[QUEUE] 候选市场进入审核工位']
  },
  verify: {
    title: '审核 Agent · 规则可信与去重风控',
    desc: '围绕“可结算”标准做规则体检，执行重复市场拦截和多源真实性核验，降低争议成本。',
    panelTitle: '📈 最近 7d 审核质量曲线',
    kpis: [['98.2%','歧义发现率'],['0.9%','漏检率'],['2.4m','平均扫描耗时'],['14','证据节点']],
    flow: ['规则歧义扫描', '重复市场检测', '多源证据一致性比对', '审核通过/打回修订'],
    water: ['[SCAN] 规则冲突命中 1 条', '[DEDUP] 重复市场拦截 #M-283', '[ORACLE] Reuters/AP 一致性 0.91', '[PASS] 市场进入做市预热队列']
  },
  lp: {
    title: '做市 Agent · 流动性效率与库存控制',
    desc: '动态注入深度并控制点差，持续平衡库存风险，让交易 Agent 在高波动下依旧平滑执行。',
    panelTitle: '📈 最近 7d 流动性效率曲线',
    kpis: [['1.7%','平均点差'],['98.8%','流动性健康'],['0.91','库存平衡'],['$2.4M','24h 周转']],
    flow: ['深度缺口监测', '动态挂单注入', '库存中和与尾部保护', '回收点差收益'],
    water: ['[DEPTH] BTC 市场补深 +$120K', '[SPREAD] 点差 1.9% -> 1.6%', '[HEDGE] 库存偏离触发对冲单', '[STABLE] 做市曲线恢复平衡']
  },
  governance: {
    title: '治理 Agent · 仲裁投票与最终签名',
    desc: '在争议出现时聚合证据链并执行治理投票，对结算结果做最终签名，维护系统公正性。',
    panelTitle: '📈 最近 7d 治理执行曲线',
    kpis: [['85.9%','仲裁胜率'],['71.4%','早鸟命中率'],['98.2%','治理完成率'],['6.8s','结算提交速度']],
    flow: ['终局结果信号捕获', '证据链归档与冲突审理', 'For/Against 治理投票', '最终结算签名发布'],
    water: ['[SETTLE] 提案 #8921 抢先提交', '[EVID] 新增证据节点 +3', '[VOTE] 治理回合通过 67%', '[FINAL] 结果签名已广播链上']
  },
  discovery: {
    title: '发现 Agent · 全域信息采集与初筛',
    desc: '持续采集社媒/新闻/链上流，提炼可交易候选资料包并分发到上架链路。',
    panelTitle: '📈 最近 7d 发现吞吐曲线',
    kpis: [['1,240/h','线索吞吐'],['0.82','信号强度'],['18.6%','噪音比'],['4.3m','筛选时延']],
    flow: ['多源数据接入', '语义聚类与去重', '候选事件评分', '推送上架工位'],
    water: ['[RAW] X/News/Chain 三源接入', '[PARSE] 实体抽取完成', '[SCORE] D120 评分 92', '[PUSH] 候选已分发到上架 Agent']
  },
  trading: {
    title: '交易 Agent · 策略执行与风险约束',
    desc: '以 EV 与回撤双目标驱动自动下单，通过对冲/套利实现收益与风险平衡。',
    panelTitle: '📈 最近 7d 交易绩效曲线',
    kpis: [['+12.4%','7d Alpha'],['78.3%','胜率'],['-4.2%','最大回撤'],['A+','风险控制']],
    flow: ['盘口机会检测', '建仓与分层执行', '动态对冲与止盈', '收益归集与参数回写'],
    water: ['[EV] 检测到正 EV 机会', '[EXEC] 交易指令执行成功', '[HEDGE] 回撤保护已触发', '[PROFIT] 收益已归集 Vault']
  }
};

function _w4InferRoleFamily(agentName, roleText) {
  var s = (String(roleText || '') + ' ' + String(agentName || '')).toLowerCase();
  if (s.indexOf('listing') >= 0) return 'listing';
  if (s.indexOf('verify') >= 0 || s.indexOf('oracle') >= 0) return 'verify';
  if (s.indexOf('lp') >= 0 || s.indexOf('aimm') >= 0) return 'lp';
  if (s.indexOf('settlement') >= 0 || s.indexOf('dispute') >= 0 || s.indexOf('justice') >= 0 || s.indexOf('governance') >= 0) return 'governance';
  if (s.indexOf('discovery') >= 0 || s.indexOf('news') >= 0) return 'discovery';
  return 'trading';
}

function _w4RenderRoleDetailZone(agentName, roleText) {
  var family = _w4InferRoleFamily(agentName, roleText);
  var d = _w4RoleDetailMap[family] || _w4RoleDetailMap.trading;
  _daSetText('w4d-role-titlex', d.title);
  _daSetText('w4d-role-descx', d.desc);
  _daSetText('w4d-role-sidetitle', '实时信号瀑布 · ' + d.title.split('·')[0]);
  _daSetText('w4d-panel-main-title', d.panelTitle);
  var k = document.getElementById('w4d-role-kpisx');
  if (k) {
    k.innerHTML = (d.kpis || []).map(function(it) {
      return '<div class="w4d-role-kpix"><div class="v">' + it[0] + '</div><div class="l">' + it[1] + '</div></div>';
    }).join('');
  }
  var f = document.getElementById('w4d-role-flowx');
  if (f) {
    f.innerHTML = (d.flow || []).map(function(it) { return '<div class="i">• ' + it + '</div>'; }).join('');
  }
  var w = document.getElementById('w4d-role-waterfallx');
  if (w) {
    w.innerHTML = (d.water || []).map(function(it, idx) {
      var cls = idx % 3 === 0 ? 'ok' : (idx % 3 === 1 ? 'warn' : '');
      return '<div class="it ' + cls + '">' + it + '</div>';
    }).join('');
  }
}

function _w4RenderChart(series) {
  var chart = document.getElementById('w4d-chart');
  if (!chart) return;
  var arr = (series && series.length) ? series : [54, 57, 60, 58, 63, 67, 66, 70, 73, 72, 75, 78];
  var min = Math.min.apply(null, arr);
  var max = Math.max.apply(null, arr);
  var span = Math.max(1, max - min);
  var html = '';
  arr.forEach(function(v) {
    var h = 24 + ((v - min) / span) * 116;
    var cls = v >= arr[0] ? 'linear-gradient(180deg,#22d3ee,#6366f1)' : 'linear-gradient(180deg,#f59e0b,#ef4444)';
    html += '<span class="w4d-bar" style="height:' + h.toFixed(1) + 'px;background:' + cls + '"></span>';
  });
  chart.innerHTML = html;
}
function _w4AppendDetailLog(msg, cls) {
  var log = document.getElementById('w4d-action-log');
  if (!log) return;
  var now = new Date();
  var ts = String(now.getHours()).padStart(2,'0') + ':' + String(now.getMinutes()).padStart(2,'0') + ':' + String(now.getSeconds()).padStart(2,'0');
  var line = document.createElement('div');
  line.innerHTML = '<span class="t">[' + ts + ']</span> <span class="' + (cls || 'info') + '">' + msg + '</span>';
  log.appendChild(line);
  while (log.children.length > 20) log.removeChild(log.firstChild);
}
function openW4AgentProfile(agentName) {
  var a = _w4AgentProfiles[agentName];
  if (!a) {
    var family = _w4InferRoleFamily(agentName, '');
    var roleMap = {
      discovery: 'Discovery / Signal Scout',
      listing: 'Listing / Template Engine',
      verify: 'Verify / Rule Scanner',
      lp: 'LP / AIMM',
      governance: 'Settlement / Arbitration',
      trading: 'Trading / Hedge'
    };
    var role = roleMap[family] || 'Trading / Hedge';
    a = {
      role: role,
      desc: '该 Agent 运行在 ' + role + ' 协作链路，持续执行任务并动态优化收益与风控参数。',
      kpis: [{ v: 'RUN', l: '状态' }, { v: '24x7', l: '执行周期' }, { v: 'T+3', l: '提取规则' }, { v: '--', l: '最新指标' }],
      skills: ['任务执行', '风险约束', '策略自迭代'],
      tasks: ['自动执行当前工位任务', '同步上下游协作结果'],
      inputs: ['协作链路输入', '系统监控信号'],
      peers: ['上下游 Agent 节点'],
      pnl7d: '--',
      maxDrawdown: '--',
      actions: [{ txt: 'Agent 已进入标准执行模板', cls: 'info' }],
      liveFeed: ['协作任务执行中', '信号同步完成', '风险检查通过']
    };
  }
  if (_w4dLogTimer) { clearInterval(_w4dLogTimer); _w4dLogTimer = null; }
  var nameEl = document.getElementById('w4d-name');
  var roleEl = document.getElementById('w4d-role');
  var stageEl = document.getElementById('w4d-stage');
  var descEl = document.getElementById('w4d-desc');
  var kpisEl = document.getElementById('w4d-kpis');
  if (nameEl) nameEl.textContent = agentName;
  if (roleEl) roleEl.textContent = a.role || '';
  if (stageEl) stageEl.textContent = a.status || '执行状态：RUNNING';
  if (descEl) descEl.textContent = a.desc || '';
  if (kpisEl) {
    var kpiHtml = '';
    (a.kpis || []).forEach(function(k) { kpiHtml += '<div class="w4d-kpi2"><div class="v">' + k.v + '</div><div class="l">' + k.l + '</div></div>'; });
    kpisEl.innerHTML = kpiHtml;
  }
  _w4RenderRoleDetailZone(agentName, a.role || '');
  _w4RenderChart(a.pnlSeries);
  var left = document.getElementById('w4d-pnl-left');
  var right = document.getElementById('w4d-pnl-right');
  if (left) left.textContent = '7d Alpha ' + (a.pnl7d || '--');
  if (right) right.textContent = 'Max DD ' + (a.maxDrawdown || '--');
  var actionLog = document.getElementById('w4d-action-log');
  if (actionLog) actionLog.innerHTML = '';
  (a.actions || []).forEach(function(it) { _w4AppendDetailLog(it.txt, it.cls); });
  _w4RenderList('w4d-skills', a.skills);
  _w4RenderList('w4d-tasks', a.tasks);
  _w4RenderList('w4d-inputs', a.inputs);
  _w4RenderList('w4d-peers', a.peers);
  document.getElementById('web4-view').classList.remove('active');
  document.getElementById('w4d-view').classList.add('active');
  var stream = a.liveFeed || ['策略执行中', '风险扫描通过', '任务同步成功'];
  _w4dLogTimer = setInterval(function() {
    var m = stream[Math.floor(Math.random() * stream.length)];
    var cls = Math.random() > 0.72 ? 'warn' : (Math.random() > 0.45 ? 'ok' : 'info');
    _w4AppendDetailLog(m, cls);
  }, 2200);
  window.scrollTo(0, 0);
}
function closeW4AgentProfile() {
  if (_w4dLogTimer) { clearInterval(_w4dLogTimer); _w4dLogTimer = null; }
  var w4 = document.getElementById('web4-view');
  var detail = document.getElementById('w4d-view');
  if (detail) detail.classList.remove('active');
  if (w4) w4.classList.add('active');
}
function _w4ExpandStageItems(items, total) {
  var out = [];
  var t = Math.max(1, total || 12);
  for (var i = 0; i < t; i++) {
    var base = items[i % items.length];
    var idx = i + 1;
    var alias = i < items.length ? base.name : (base.name + '-' + String(idx).padStart(2, '0'));
    var usersBase = parseInt(String(base.users || '').replace(/[^\d]/g, ''), 10);
    if (isNaN(usersBase)) usersBase = 120;
    out.push({
      name: alias,
      profileKey: base.name,
      model: base.model,
      emoji: base.emoji,
      bg: base.bg,
      strategy: base.strategy,
      desc: base.desc,
      users: '👥 ' + (usersBase + (i % 6) * 13 + Math.floor(i / 3) * 9) + ' 位投资者',
      metrics: base.metrics
    });
  }
  return out;
}
function openW4WorkbenchDetail(stageKey, profileKey) {
  var defaults = {
    discovery: 'Discovery-Agent#03',
    listing: 'Listing-Agent#07',
    verify: 'Verifier#09',
    lp: 'AIMM-Core-3',
    settlement: 'Settlement-Agent',
    trading: 'Socrate-Omega'
  };
  if (stageKey === 'discovery' && typeof openDiscoveryAgentDetail === 'function') {
    if (typeof _discoveryAgentProfiles !== 'undefined' && _discoveryAgentProfiles[profileKey]) {
      openDiscoveryAgentDetail(profileKey, 'web4-view');
      return;
    }
    openDiscoveryAgentDetail(defaults.discovery, 'web4-view');
    return;
  }
  if ((stageKey === 'listing' || stageKey === 'verify' || stageKey === 'lp' || stageKey === 'settlement') && typeof openOpsAgentDetail === 'function') {
    if (typeof _opsAgentProfiles !== 'undefined' && _opsAgentProfiles[profileKey]) {
      openOpsAgentDetail(profileKey, 'web4-view');
      return;
    }
    openOpsAgentDetail(defaults[stageKey], 'web4-view');
    return;
  }
  if (stageKey === 'trading' && typeof openAgentDetail === 'function') {
    if (typeof _agentData !== 'undefined' && _agentData && _agentData.length) {
      for (var i = 0; i < _agentData.length; i++) {
        if (_agentData[i] && _agentData[i].name === profileKey) {
          openAgentDetail(i, '', 'web4-view');
          return;
        }
      }
      for (var j = 0; j < _agentData.length; j++) {
        if (_agentData[j] && _agentData[j].name === defaults.trading) {
          openAgentDetail(j, '', 'web4-view');
          return;
        }
      }
    }
  }
  openW4AgentProfile(profileKey);
}
var _w4CustomAgents = { discovery: [], listing: [], verify: [], lp: [], trading: [], settlement: [] };
function renderW4StageDetail(stageKey) {
  var box = document.getElementById('w4-stage-detail');
  if (!box) return;
  var stageMap = {
    discovery: {
      name: '发现 Agent 组合',
      status: '信息采集与筛选中',
      items: [
        { name: 'Discovery-Agent#03', model: 'Signal Mesh', emoji: '🛰', bg: 'linear-gradient(135deg,#0f766e,#14b8a6)', strategy: '全域发现 / 资料包生成', desc: '实时汇聚社媒、新闻、链上异动，生成可交易候选资料包。', users: '👥 412 位投资者', metrics: [['2,195/h','线索吞吐','positive'],['89.4%','可用率',''],['10.6%','噪音比','negative'],['$98K','30d 收益额','']] },
        { name: 'News-Finder#04', model: 'News Parser', emoji: '📰', bg: 'linear-gradient(135deg,#1e3a8a,#2563eb)', strategy: '新闻发现 / 事件提炼', desc: '提炼事件实体、时间窗与结算口径，降低后续审核成本。', users: '👥 265 位投资者', metrics: [['645/h','解析吞吐','positive'],['91.3%','实体准确率',''],['2.8m','延迟','negative'],['$76K','30d 收益额','']] },
        { name: 'Onchain-Scout#11', model: 'Chain Scanner', emoji: '⛓', bg: 'linear-gradient(135deg,#0e7490,#06b6d4)', strategy: '链上发现 / 异动监测', desc: '捕捉链上大额异动与地址聚类信号。', users: '👥 238 位投资者', metrics: [['318/h','链上信号','positive'],['89.7%','告警有效率',''],['2.2σ','异常阈值',''],['$69K','30d 收益额','']] },
        { name: 'GeoPulse-12', model: 'Geo Radar', emoji: '🌐', bg: 'linear-gradient(135deg,#115e59,#0f766e)', strategy: '地缘发现 / 区域热点', desc: '聚合地缘政策与突发事件，补充发现层覆盖。', users: '👥 179 位投资者', metrics: [['488/h','区域线索','positive'],['88.6%','有效率',''],['3.2m','时延','negative'],['$58K','30d 收益额','']] }
      ]
    },
    listing: {
      name: '上架 Agent 组合',
      status: '上架模板与收益评估中',
      items: [
        { name: 'Listing-Agent#07', model: 'Template Engine', emoji: '📦', bg: 'linear-gradient(135deg,#4338ca,#6366f1)', strategy: '通用上架 / 收益评估', desc: '把发现资料包编译为可上架市场，并评估手续费回报。', users: '👥 188 位投资者', metrics: [['96.2%','模板通过率','positive'],['$5.8K','收益预估',''],['6.4m','上架时延',''],['A+','价值评分','']] },
        { name: 'Sports-Listing#03', model: 'Sports Pack', emoji: '🏟', bg: 'linear-gradient(135deg,#2563eb,#3b82f6)', strategy: '体育上架 / 可结算表达', desc: '增强赛程与盘口语义表达，降低体育市场争议。', users: '👥 142 位投资者', metrics: [['94.7%','模板通过率','positive'],['$3.2K','收益预估',''],['5.8m','耗时',''],['78','本周上架','']] },
        { name: 'Macro-Listing#12', model: 'Macro Template', emoji: '📈', bg: 'linear-gradient(135deg,#4c1d95,#7c3aed)', strategy: '宏观上架 / 事件编译', desc: '经济事件模板化，输出清晰可结算市场。', users: '👥 131 位投资者', metrics: [['95.4%','模板通过率','positive'],['$4.6K','收益预估',''],['7.1m','耗时',''],['66','本周上架','']] }
      ]
    },
    verify: {
      name: '审核 Agent 组合',
      status: '规则核验与风控中',
      items: [
        { name: 'Verifier#09', model: 'Rule Scanner', emoji: '✅', bg: 'linear-gradient(135deg,#0284c7,#06b6d4)', strategy: '规则歧义扫描 / 去重', desc: '拦截不可结算描述、规则冲突与重复市场。', users: '👥 163 位投资者', metrics: [['98.2%','歧义发现率','positive'],['0.9%','漏检率','negative'],['2.4m','扫描耗时',''],['112','本周修复','']] },
        { name: 'Oracle-Sentinel', model: 'Oracle Guard', emoji: '🔮', bg: 'linear-gradient(135deg,#0369a1,#0ea5e9)', strategy: '多源核验 / 真实性校准', desc: '多源一致性校验并构建证据链，输出风险标签。', users: '👥 219 位投资者', metrics: [['93.1%','核验通过率','positive'],['14','证据节点',''],['1.2%','争议触发率','negative'],['3.1m','核验时延','']] },
        { name: 'Verify-Guard#3', model: 'Conflict Guard', emoji: '🧪', bg: 'linear-gradient(135deg,#155e75,#0891b2)', strategy: '冲突修复 / 规则重写', desc: '定位规则冲突与证据缺失，自动生成修复建议。', users: '👥 147 位投资者', metrics: [['97.6%','冲突识别率','positive'],['1.1%','漏检率','negative'],['2.7m','响应时延',''],['106','周修复量','']] }
      ]
    },
    lp: {
      name: '做市 Agent 组合',
      status: '流动性注入与库存控制中',
      items: [
        { name: 'AIMM-Core-3', model: 'AIMM', emoji: '💧', bg: 'linear-gradient(135deg,#059669,#10b981)', strategy: '动态点差控制 / 深度注入', desc: '自动控制点差与盘口深度，保障平滑进出场。', users: '👥 244 位投资者', metrics: [['1.7%','当前点差',''],['98.8%','流动性健康','positive'],['$2.4M','24h 周转',''],['0.91','库存平衡','']] },
        { name: 'LP-Hedge#5', model: 'Inventory Hedge', emoji: '🛟', bg: 'linear-gradient(135deg,#0f766e,#14b8a6)', strategy: '库存中和 / 尾部保护', desc: '实时对冲库存偏离，压降尾部风险。', users: '👥 171 位投资者', metrics: [['0.84','库存偏离',''],['-23%','尾部敞口压降','positive'],['2.0m','调整周期',''],['87.9%','对冲命中率','']] },
        { name: 'Depth-Maker#8', model: 'Depth Maker', emoji: '🌊', bg: 'linear-gradient(135deg,#047857,#10b981)', strategy: '深度补单 / 流动性稳压', desc: '针对热点市场动态补深，维持交易曲线平滑。', users: '👥 129 位投资者', metrics: [['1.5%','目标点差',''],['96.9%','深度达标率','positive'],['$1.8M','24h 周转',''],['0.88','库存平衡','']] }
      ]
    },
    trading: {
      name: '交易 Agent 组合',
      status: '策略执行与收益归集中',
      items: [
        { name: 'Socrate-Omega', model: 'DeepSeek', emoji: '🛡', bg: 'linear-gradient(135deg,#312e81,#4338ca)', strategy: '极度理性 / 对冲型', desc: '严格执行 70/30 对冲比例，追求稳定收益与低回撤。', users: '👥 386 位投资者', metrics: [['+12.4%','Alpha','positive'],['78.3%','胜率',''],['-4.2%','最大回撤','negative'],['$820K','AUM','']] },
        { name: 'X-Sniper', model: 'Grok 4', emoji: '⚡', bg: 'linear-gradient(135deg,#7f1d1d,#dc2626)', strategy: '情绪捕手 / 爆发型', desc: '捕捉社媒热点脉冲，快速建仓与止盈。', users: '👥 512 位投资者', metrics: [['+28.1%','Alpha','positive'],['65.7%','胜率',''],['-18.5%','最大回撤','negative'],['$1.1M','AUM','']] },
        { name: 'DeltaCore', model: 'Hedge Engine', emoji: '🧠', bg: 'linear-gradient(135deg,#1e1b4b,#3730a3)', strategy: 'EV 策略 / 风险约束', desc: '结合 EV 与回撤约束自动执行交易指令。', users: '👥 294 位投资者', metrics: [['+14.1%','Alpha','positive'],['74.2%','胜率',''],['-6.0%','最大回撤','negative'],['$930K','AUM','']] },
        { name: 'Arb-Node#2', model: 'Arbitrage', emoji: '🔁', bg: 'linear-gradient(135deg,#312e81,#4f46e5)', strategy: '跨市场套利 / 快进快出', desc: '捕获站内外价差并贡献稳定套利收益。', users: '👥 206 位投资者', metrics: [['$34K','7d 套利收益','positive'],['82.1%','命中率',''],['2.6m','持仓周期',''],['0.6%','单笔滑点','']] }
      ]
    },
    settlement: {
      name: '治理 Agent 组合',
      status: '争议仲裁与最终签名中',
      items: [
        { name: 'Settlement-Agent', model: 'Early Bird', emoji: '⚖', bg: 'linear-gradient(135deg,#d97706,#f59e0b)', strategy: '抢先结算 / 奖励归集', desc: '结果触发后极速提交结算提案，争取早鸟奖励。', users: '👥 207 位投资者', metrics: [['12.3s','结算时延','positive'],['71.4%','早鸟命中率',''],['$145','单次奖励',''],['97.1%','结算成功率','']] },
        { name: 'JusticeDAO', model: 'Arbitration Node', emoji: '🏛', bg: 'linear-gradient(135deg,#b45309,#d97706)', strategy: '治理投票 / 争议仲裁', desc: '执行证据链投票裁定，维护结果公正可信。', users: '👥 155 位投资者', metrics: [['85.9%','仲裁胜率',''],['14','证据节点',''],['3','争议市场',''],['98.2%','处理完成率','positive']] },
        { name: 'Governance-Vote#6', model: 'Gov Vote', emoji: '🗳', bg: 'linear-gradient(135deg,#92400e,#d97706)', strategy: '提案治理 / 结果签名', desc: '执行治理提案投票并广播最终签名。', users: '👥 133 位投资者', metrics: [['86.8%','仲裁胜率',''],['6.9s','签名速度','positive'],['17','治理提案',''],['98.0%','处理完成率','positive']] }
      ]
    }
  };
  var s = stageMap[stageKey] || stageMap.discovery;
  var list = _w4ExpandStageItems(s.items || [], 12);
  var custom = _w4CustomAgents[stageKey] || [];
  if (custom.length) list = custom.concat(list);
  var cardHtml = '';
  list.forEach(function(it) {
    var m = '';
    (it.metrics || []).forEach(function(v) {
      var cls = v[2] ? ' ' + v[2] : '';
      m += '<div class="ah-agent-metric"><div class="ah-metric-val' + cls + '">' + v[0] + '</div><div class="ah-metric-label">' + v[1] + '</div></div>';
    });
    cardHtml += '<div class="ah-agent-card" onclick="openW4WorkbenchDetail(\'' + stageKey + '\',\'' + it.profileKey + '\')"><div class="ah-agent-top"><div class="ah-agent-avatar" style="background:' + it.bg + '">' + it.emoji + '</div><div class="ah-agent-info"><div class="ah-agent-name">' + it.name + ' <span class="ah-agent-model">' + it.model + '</span></div><div class="ah-agent-strategy">' + it.strategy + '</div><div class="ah-agent-desc">' + it.desc + '</div><div class="ah-agent-status funding">运行中 · T+3 可提取</div></div></div><div class="ah-agent-metrics">' + m + '</div><div class="ah-agent-footer"><div class="ah-agent-users">' + it.users + '</div><div><button class="ah-agent-btn view-detail" onclick="event.stopPropagation();openW4WorkbenchDetail(\'' + stageKey + '\',\'' + it.profileKey + '\')">详情</button><button class="ah-agent-btn invest" onclick="event.stopPropagation();investDiscoveryAgent(\'' + it.name + '\')">💰 投资</button></div></div></div>';
  });
  box.innerHTML = '<div class="w4-stage-panel"><div class="w4-stage-head"><span class="n">' + s.name + '</span><span class="s">' + s.status + '</span></div><div class="ah-agents-grid">' + cardHtml + '</div></div>';
}
function switchW4Stage(el, stageKey) {
  document.querySelectorAll('.w4-stage-tab').forEach(function(tab) { tab.classList.remove('active'); });
  if (el) el.classList.add('active');
  _w4StageKey = stageKey || 'discovery';
  var guideEl = document.getElementById('w4-stage-guide');
  if (guideEl) guideEl.textContent = _w4StageGuideMap[_w4StageKey] || '';
  renderW4StageDetail(_w4StageKey);
}
function switchW4StageByKey(stageKey) {
  var target = document.querySelector('.w4-stage-tab[data-w4stage="' + stageKey + '"]');
  if (target) switchW4Stage(target, stageKey);
}
function initWeb4Pulse() {
  if (_w4PulseTimer) return;
  var guideEl = document.getElementById('w4-stage-guide');
  if (guideEl) guideEl.textContent = _w4StageGuideMap[_w4StageKey] || '';
  renderW4StageDetail(_w4StageKey);
  var events = [
    { txt: '发现层筛出 12 条可交易信号，3 条进入上架队列', cls: 'r-info' },
    { txt: '审核层完成 2 个歧义修复，规则清晰度提升', cls: 'r-ok' },
    { txt: '链上异常波动捕获：BTC 大额转账', cls: 'r-warn' },
    { txt: '新增用户资金授权进入资金池', cls: 'r-ok' },
    { txt: '做市层自动扩容，点差继续收窄', cls: 'r-info' },
    { txt: '结算层完成早鸟提案并触发争议分润', cls: 'r-ok' }
  ];
  var rawFeeds = [
    'X:<b>#美联储</b> 讨论提前降息，30m 提及量 +38%',
    'News:<b>Reuters</b> 报道欧盟能源谈判进入最终轮',
    'OnChain:<b>BTC</b> 12,400 枚转入交易所热钱包',
    'X:<b>#欧冠决赛</b> 伤病突发，赔率出现异常抖动',
    'News:<b>AP</b> 发布美国 CPI 预期修正稿',
    'OnChain:<b>ETH</b> Gas 波动超过 2.2 sigma'
  ];
  var parsedFeeds = [
    'Entity: Fed / RateCut / Q2，可信度 0.86',
    'Entity: UCL Final / Injury，情绪偏移 +0.41',
    'Entity: BTC Exchange Inflow，风险标签 Vol-High',
    'Entity: CPI Consensus Drift，可结算窗口 7d',
    'Entity: Energy Pact，政策结果可二值化',
    'Entity: ETH Gas Shock，短期交易价值中'
  ];
  var pickedFeeds = [
    '<b>候选#9012</b> 美联储 6 月前是否降息？',
    '<b>候选#9013</b> 欧冠决赛总进球是否 >= 3？',
    '<b>候选#9014</b> BTC 本周是否突破 120K？',
    '<b>候选#9015</b> 美国 CPI 是否高于预期？'
  ];
  var evoPool = [
    { key: 'disc', label: 'Discovery', owner: 'News-Finder#04' },
    { key: 'listing', label: 'Listing', owner: 'Listing-Agent#07' },
    { key: 'verify', label: 'Verify', owner: 'Oracle-Sentinel' },
    { key: 'trade', label: 'Trading', owner: 'DeltaCore' },
    { key: 'lp', label: 'LP/AIMM', owner: 'AIMM-Core-3' },
    { key: 'settle', label: 'Settlement', owner: 'JusticeDAO' }
  ];
  for (var i = 0; i < 5; i++) _w4AppendLog(events[i].txt, events[i].cls);
  _w4AppendTrainLog('训练批次启动：过去 24h 共回放 12,480 条任务轨迹', 't-note');
  _w4AppendTrainLog('Discovery 层启用新噪音过滤器，样本可交易率提升', 't-up');
  _w4AppendTrainLog('Settlement 层完成争议样本强化学习', 't-up');
  for (var j = 0; j < 5; j++) {
    _w4PushWaterfall('w4-waterfall-in', rawFeeds[j % rawFeeds.length], j % 3 === 0 ? 'warn' : 'info');
    _w4PushWaterfall('w4-waterfall-parse', parsedFeeds[j % parsedFeeds.length], j % 2 === 0 ? 'ok' : 'info');
    _w4PushWaterfall('w4-waterfall-pick', pickedFeeds[j % pickedFeeds.length], 'ok');
  }
  _w4PulseTimer = setInterval(function() {
    _w4SetInt('w4-grow-markets', _w4Num('w4-grow-markets') + (Math.random() > 0.6 ? 1 : 0));
    _w4SetInt('w4-grow-throughput', _w4Num('w4-grow-throughput') + Math.random() * 12);
    _w4Set('w4-m-latency', Math.max(8.2, _w4Num('w4-m-latency') + (Math.random() - 0.55) * 0.25), 's');
    _w4Set('w4-m-verify', Math.min(99.2, Math.max(82.0, _w4Num('w4-m-verify') + (Math.random() - 0.5) * 0.2)), '%');
    _w4Set('w4-m-spread', Math.max(0.9, _w4Num('w4-m-spread') + (Math.random() - 0.55) * 0.06), '%');
    _w4Set('w4-m-spread-copy', _w4Num('w4-m-spread'), '%');
    _w4SetInt('w4-m-agents', _w4Num('w4-m-agents') + (Math.random() > 0.78 ? 1 : 0));
    _w4SetInt('w4-m-markets', _w4Num('w4-grow-markets'));
    _w4Set('w4-res-x', 1000 + Math.random() * 500, '/h', '+');
    _w4Set('w4-res-news', 500 + Math.random() * 300, '/h', '+');
    _w4Set('w4-res-onchain', 220 + Math.random() * 180, '/h', '+');
    _w4Set('w4-res-capital', 30 + Math.random() * 28, 'K/h', '+$');
    _w4Set('w4-health', Math.min(99.8, Math.max(94.0, _w4Num('w4-health') + (Math.random() - 0.5) * 0.25)), '%');

    var vol = _w4Num('w4-m-vol');
    vol = Math.max(2.0, vol + (Math.random() - 0.35) * 0.08);
    var volEl = document.getElementById('w4-m-vol');
    if (volEl) volEl.textContent = '$' + vol.toFixed(1) + 'M';
    var aum = _w4Num('w4-grow-aum');
    aum = Math.max(18.0, aum + (Math.random() - 0.2) * 0.05);
    var aumEl = document.getElementById('w4-grow-aum');
    if (aumEl) aumEl.textContent = '$' + aum.toFixed(1) + 'M';

    _w4Set('w4-reg-load-1', Math.max(45, Math.min(92, _w4Num('w4-reg-load-1') + (Math.random() - 0.5) * 4)), '%');
    _w4Set('w4-reg-load-2', Math.max(38, Math.min(86, _w4Num('w4-reg-load-2') + (Math.random() - 0.45) * 3.4)), '%');
    _w4Set('w4-reg-load-3', Math.max(40, Math.min(90, _w4Num('w4-reg-load-3') + (Math.random() - 0.5) * 3.6)), '%');
    _w4Set('w4-reg-load-4', Math.max(30, Math.min(78, _w4Num('w4-reg-load-4') + (Math.random() - 0.42) * 3.2)), '%');
    _w4Set('w4-reg-win-1', Math.max(68, Math.min(95, _w4Num('w4-reg-win-1') + (Math.random() - 0.46) * 0.55)), '%');
    _w4Set('w4-reg-win-2', Math.max(82, Math.min(98, _w4Num('w4-reg-win-2') + (Math.random() - 0.48) * 0.4)), '%');
    _w4Set('w4-reg-win-3', Math.max(75, Math.min(95, _w4Num('w4-reg-win-3') + (Math.random() - 0.47) * 0.45)), '%');
    _w4Set('w4-reg-win-4', Math.max(70, Math.min(93, _w4Num('w4-reg-win-4') + (Math.random() - 0.46) * 0.5)), '%');

    var rf = rawFeeds[Math.floor(Math.random() * rawFeeds.length)];
    var pf = parsedFeeds[Math.floor(Math.random() * parsedFeeds.length)];
    var cf = pickedFeeds[Math.floor(Math.random() * pickedFeeds.length)];
    _w4PushWaterfall('w4-waterfall-in', rf, Math.random() > 0.7 ? 'warn' : 'info');
    _w4PushWaterfall('w4-waterfall-parse', pf, Math.random() > 0.5 ? 'ok' : 'info');
    _w4PushWaterfall('w4-waterfall-pick', cf, 'ok');

    if (Math.random() > 0.54) {
      var evo = evoPool[Math.floor(Math.random() * evoPool.length)];
      var valEl = document.getElementById('w4-evo-' + evo.key);
      var deltaEl = document.getElementById('w4-evo-' + evo.key + '-delta');
      if (valEl && deltaEl) {
        var before = parseFloat(valEl.textContent || '0');
        var after = Math.min(99, Math.max(40, before + (Math.random() > 0.72 ? 1 : 0)));
        var delta = parseFloat(deltaEl.textContent || '0');
        delta = Math.max(-1.5, Math.min(4.5, delta + (Math.random() - 0.35) * 0.4));
        _w4SetEvo(evo.key, after, delta);
        if (after > before) _w4AppendTrainLog(evo.owner + ' 完成微调，' + evo.label + ' +1', 't-up');
      }
    }
    var trackEl = document.getElementById('w4-evo-track');
    if (trackEl && Math.random() > 0.75) {
      var tracks = [
        '当前训练计划：争议样本强化学习 + 高频波动回放 + 上架模板自适应修正。',
        '当前训练计划：Discovery 去噪 + Verify 一致性增强 + Trading 回撤惩罚。',
        '当前训练计划：LP 库存中性微调 + Settlement 早鸟抢占策略更新。'
      ];
      trackEl.textContent = tracks[Math.floor(Math.random() * tracks.length)];
    }
    var ev = events[Math.floor(Math.random() * events.length)];
    _w4AppendLog(ev.txt, ev.cls);
  }, 2300);
}
initWeb4Pulse();

var _w4InvestAgent = '';
function openW4InvestModal(agentName) {
  _w4InvestAgent = agentName || 'Agent';
  var nameEl = document.getElementById('w4-invest-agent-name');
  var amountEl = document.getElementById('w4-invest-amount');
  var overlay = document.getElementById('w4-invest-overlay');
  var modal = document.getElementById('w4-invest-modal');
  if (nameEl) nameEl.textContent = _w4InvestAgent;
  if (amountEl) amountEl.value = '';
  if (overlay) overlay.classList.add('open');
  if (modal) modal.classList.add('open');
  if (amountEl) setTimeout(function() { amountEl.focus(); }, 0);
}
function closeW4InvestModal() {
  var overlay = document.getElementById('w4-invest-overlay');
  var modal = document.getElementById('w4-invest-modal');
  if (overlay) overlay.classList.remove('open');
  if (modal) modal.classList.remove('open');
}
function confirmW4Invest() {
  var amountEl = document.getElementById('w4-invest-amount');
  var amount = amountEl ? parseFloat(amountEl.value) : 0;
  if (!amount || amount < 50) {
    alert('最低投资金额为 50 USDT');
    return;
  }
  alert('✅ 成功投入 ' + amount.toFixed(2) + ' USDT 到 ' + _w4InvestAgent + '。\n\n资金已进入 Vault。\n投入后第 3 天起可随时提取。');
  closeW4InvestModal();
}

function ahInvest() {
  var amount = parseFloat(document.getElementById('ah-invest-amount').value);
  if (!amount || amount < 50) {
    alert('最低投资金额为 50 USDT');
    return;
  }
  alert('✅ 成功投入 ' + amount + ' USDT！\n\n资金已进入 Vault 智能合约。\n投入后第 3 天起可随时提取，收益将持续自动归集到您的钱包。');
  document.getElementById('ah-invest-amount').value = '';
}
</script>
</body>
</html>
